function selectImage(e,t){selectedHandler=e,thisRef=t;var i=document.getElementById("fileInput");null==i&&(i=document.createElement("input"),i.id="fileInput",i.type="file",i.accept="image/*",i.style.height="0px",i.style.display="block",i.style.overflow="hidden",document.body.insertBefore(i,document.body.firstChild),i.addEventListener("change",tmpSelectFile,!1)),setTimeout(function(){i.click()},100)}function tmpSelectFile(e){var t=e.target.files[0],i=t.type;i||(i=mime[t.name.match(/\.([^\.]+)$/i)[1]]);var n=myCreateObjectURL(t);tmpCreateImage&&tmpCreateImage(n,t);var a=document.getElementById("fileInput");a.value=""}function tmpCreateImage(e,t){var i=new Image;i.onload=function(){var n=document.createElement("canvas");if(!isWeixin()&&i.height>MAX_HEIGHT){i.width*=MAX_HEIGHT/i.height,i.height=MAX_HEIGHT;var a=n.getContext("2d");a.clearRect(0,0,n.width,n.height),n.width=i.width,n.height=i.height,a.drawImage(i,0,0,i.width,i.height);var r=n.toDataURL("image/png")}else r=e;i.width=i.height=1,selectedHandler&selectedHandler(thisRef,r,t)},i.src=e,i.style.visibility="hidden",document.body.appendChild(i)}function myCreateObjectURL(e){return void 0!=window.URL?window.URL.createObjectURL(e):window.webkitURL.createObjectURL(e)}function myResolveObjectURL(e){void 0!=window.URL?window.URL.revokeObjectURL(e):window.webkitURL.revokeObjectURL(e)}function getImageData(e,t,i){function n(){bytesHandler&&bytesHandler(thisRef,this.result)}bytesHandler=t,thisRef=i;try{var a=new FileReader}catch(r){console.log("no support FileReader")}a.onload=n,a.readAsArrayBuffer(e)}function isWeixin(){var e=navigator.userAgent.toLowerCase();return"micromessenger"==e.match(/MicroMessenger/i)?!0:!1}function selectImageWX(e,t){selectedHandler=e,thisRef=t,wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){var t=e.localIds;tmpCreateImage(t[0])}})}var mime={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",bmp:"image/bmp"},selectedHandler,bytesHandler,thisRef,MAX_HEIGHT=300;