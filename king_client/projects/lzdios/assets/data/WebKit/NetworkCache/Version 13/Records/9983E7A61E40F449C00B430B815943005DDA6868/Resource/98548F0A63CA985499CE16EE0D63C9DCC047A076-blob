function genPlatformProxy(){"ctc_fire2333"==window.gameGlobal.channel?window.platform=Fire2333Platform.inst:"lzd_pkgsdk"==window.gameGlobal.channel?window.platform=PkgSDKPlatform.inst:"lzd_handjoy"==window.gameGlobal.channel&&(window.gameGlobal.isFbAdvert?window.platform=FacebookJsPlatform.inst:(window.platform=PkgSDKPlatform.inst,window.sharePlatform=FacebookSharePlatform.inst))}function genAdsPlatformProxy(){Core.DeviceUtils.isWXGame()?window.adsPlatform=WXGame.WXAdsPlatform.inst:"lzd_pkgsdk"==window.gameGlobal.channel&&(window.adsPlatform=PkgAdsPlatform.inst)}function htmlClickCallback(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o,s,a,u,h,l,c,d;return __generator(this,function(p){switch(p.label){case 0:return e=t.text.split(","),i=e[0],r=parseInt(e[1]),console.log("click link "+t.text+" "+i+" "+r),"skill"!=i&&"desc"!=i?[3,1]:(console.log("htmlClickCallback "+lastSkillid+" "+r),lastSkillid==r?(lastSkillid=null,[2]):(lastSkillid=r,n=Data.skill.get(r),o="<font strokecolor=0x0 stroke=2><b><i>"+n.name+":</i> </b></font>"+parse2html(n.desTra),s=fairygui.UIPackage.createObject(PkgName.cards,ViewName.skillInfo).asCom,s.getChild("skillDescTxt").asRichTextField.text=o,Core.LayerManager.inst.maskLayer.addChild(s),a=function(){fairygui.GTimers.inst.callDelay(100,function(t){lastSkillid==t&&(lastSkillid=null)},null,r),s.parent.removeChild(s),egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_END,a,s)},egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_END,a,s),s.center(),[2,s]));case 1:return"hero"!=i?[3,6]:null!=Core.ViewManager.inst.getView("htmlCardView")?[3,2]:(u=new CardPool.OtherCardInfo,u.contentPane=fairygui.UIPackage.createObject(PkgName.cardpool,ViewName.cardInfoOther).asCom,Core.ViewManager.inst.register("htmlCardView",u),u.setViewMode(),[3,4]);case 2:return[4,Core.ViewManager.inst.close("htmlCardView")];case 3:p.sent(),p.label=4;case 4:if(h=5,"level"!=e[2]&&(h=parseInt(e[2])),l=CardPool.CardPoolMgr.inst.getCardData(r,h),!l)for(c=5;c>0&&(l||(l=CardPool.CardPoolMgr.inst.getCardData(r,c)),!l);c--);return d=new CardPool.Card(l),d.skin=e[3],[4,Core.ViewManager.inst.open("htmlCardView",d)];case 5:return p.sent(),Core.ViewManager.inst.getView("htmlCardView").setViewMode(),[2,null];case 6:return[2]}})})}function parse2html(t,e){return void 0===e&&(e=null),t=t.replace(skillRegx,function(t,e){var i=parseInt(e),r=Data.skill.get(i),n=r.name.replace("n","");return'<a href="event:skill,'+e+'">[<u>'+n+"</u>]</a>"}),t=t.replace(descRegx,function(t,e){var i=parseInt(e),r=Data.skill.get(i),n=r.name.replace("n","");return'<a href="event:desc,'+e+'"><u><i>'+n+"</i></u></a>"}),t=t.replace(heroRegx,function(t,i){var r=parseInt(i),n=CardPool.CardPoolMgr.inst.getCardData(r,e||5);n||(n=CardPool.CardPoolMgr.inst.getCardData(r,1));var o=n.name.replace(/#c\w(.*)#n/,"$1");return'<a href="event:hero,'+i+',level,skin">[<u><i>'+o+"</i></u>]</a>"})}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(n,o){function s(t){try{u(r.next(t))}catch(e){o(e)}}function a(t){try{u(r["throw"](t))}catch(e){o(e)}}function u(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(s,a)}u((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return r([t,e])}}function r(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,o&&(s=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,o=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(s=u.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){u.label=i[1];break}if(6===i[0]&&u.label<s[1]){u.label=s[1],s=i;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(i);break}s[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(r){i=[6,r],o=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,o,s,a,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},Core;!function(t){var e=function(){function t(){}return t}();__reflect(e.prototype,"BindingItem");var i=function(){function i(){this._watchers=new Collection.Dictionary}return i.prototype.watchProp=function(i,r,n){this._watchers.containsKey(i)||this._watchers.setValue(i,new Collection.Dictionary);var o=this._watchers.getValue(i),s=new e;s._callback=r,s._thisArg=n,s._watch=t.Binding.bindHandler(this,[i],r,n),o.setValue(s,!0)},i.prototype.unwatchProp=function(t,e,i){if(this._watchers.containsKey(t)){var r=this._watchers.getValue(t),n=new Array;r.forEach(function(t,r){t._callback==e&&t._thisArg==i&&(t._watch.unwatch(),n.push(t))}),n.forEach(function(t){r.remove(t)})}},i}();t.BindingDelegate=i,__reflect(i.prototype,"Core.BindingDelegate")}(Core||(Core={}));var Core;!function(t){var e=function(e){function i(i){var r=e.call(this)||this;return i?r._myParent=i:r._myParent=fairygui.GRoot.inst,r._isInit=!1,r._viewCommon=new t.ViewCommon(r),r}return __extends(i,e),i.prototype.adjust=function(e,i){void 0===i&&(i=t.AdjustType.EXACT_FIT),i==t.AdjustType.EXCEPT_MARGIN?(this._viewCommon.adjust(e,t.AdjustType.EXACT_FIT),e.height-=window.support.topMargin):this._viewCommon.adjust(e,i)},i.prototype.setVisible=function(t){this.visible=t},i.prototype.isInit=function(){return this._isInit},i.prototype.isShow=function(){return null!=this.parent&&this.visible},i.prototype.addToParent=function(t){t&&(this._myParent=t),this._myParent.addChild(this)},i.prototype.removeFromParent=function(){this.parent&&this.parent.removeChild(this)},i.prototype.initUI=function(){this._isInit=!0},i.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},i.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},i.prototype.toTopLayer=function(){t.LayerManager.inst.topLayer.addChild(this)},i.prototype.toMainLayer=function(){t.LayerManager.inst.mainLayer.addChild(this)},i.prototype.destroy=function(){this._myParent=null,this._viewCommon.destroy(),this.dispose()},i.prototype.getNode=function(t){return this._viewCommon.getNode(t)},i}(fairygui.GComponent);t.BaseView=e,__reflect(e.prototype,"Core.BaseView",["Core.IBaseView"])}(Core||(Core={}));var Core;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._viewCommon=new t.ViewCommon(i),i}return __extends(i,e),i.prototype.setVisible=function(t){this.visible=t},i.prototype.adjust=function(e,i){void 0===i&&(i=t.AdjustType.EXACT_FIT),i==t.AdjustType.EXCEPT_MARGIN?(this._viewCommon.adjust(e,t.AdjustType.EXACT_FIT),e.height-=window.support.topMargin):this._viewCommon.adjust(e,i)},i.prototype.isInit=function(){return this._isInit},i.prototype.isShow=function(){return null!=this.parent&&this.visible},i.prototype.addToParent=function(){},i.prototype.removeFromParent=function(){},i.prototype.battleChangeLayer=function(){t.ViewManager.inst.isShow(ViewName.battle)?this.toTopLayer():this.toMainLayer()},i.prototype.toTopLayer=function(){this._myParent=t.LayerManager.inst.topLayer},i.prototype.toMainLayer=function(){this._myParent=t.LayerManager.inst.mainLayer},i.prototype.initUI=function(){this._isInit=!0},i.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._myParent?this._myParent.showWindow(this):this.show(),[2]})})},i.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.hide(),[2]})})},i.prototype.destroy=function(){this._viewCommon.destroy(),this.dispose()},i.prototype.getNode=function(t){return this._viewCommon.getNode(t)},i}(fairygui.Window);t.BaseWindow=e,__reflect(e.prototype,"Core.BaseWindow",["Core.IBaseView"])}(Core||(Core={}));var War;!function(t){var e=function(){function t(t){this._time=-1}return Object.defineProperty(t.prototype,"remainTime",{get:function(){return this._time},set:function(t){this._time=t},enumerable:!0,configurable:!0}),t.prototype.enter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.updateStatus=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},Object.defineProperty(t.prototype,"name",{get:function(){return-1},enumerable:!0,configurable:!0}),t.prototype.startHeartbeat=function(){this._time>0&&fairygui.GTimers.inst.add(1e3,this._time,this.heartbeat,this)},t.prototype.stopHeartbeat=function(){fairygui.GTimers.inst.remove(this.heartbeat,this)},t.prototype.heartbeat=function(){},t}();t.WarStatusBase=e,__reflect(e.prototype,"War.WarStatusBase");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.ST_NONE},enumerable:!0,configurable:!0}),i}(e);t.NoneStatus=i,__reflect(i.prototype,"War.NoneStatus");var r=function(t){function e(){var e=t.call(this)||this;return e._statusObjs=new Collection.Dictionary,e._curStatusObj=new i(null),e}return __extends(e,t),e.prototype.setDelegateHost=function(t){this._host=t,this.initStatus()},Object.defineProperty(e.prototype,"host",{get:function(){return this._host},enumerable:!0,configurable:!0}),e.prototype.inStatus=function(t){return this._curStatusObj.name==t},e.prototype.initStatus=function(){console.error("initStatus not implemented")},e.prototype.changeStatus=function(t,e){void 0===e&&(e=-1);for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return __awaiter(this,void 0,void 0,function(){var n,o,s;return __generator(this,function(a){switch(a.label){case 0:return this.inStatus(t)?((o=this._curStatusObj).updateStatus.apply(o,r),[2]):[4,this._curStatusObj.leave()];case 1:return a.sent(),(n=this._statusObjs.getValue(t))?(this._curStatusObj=n,this._curStatusObj.remainTime=e,[4,(s=this._curStatusObj).enter.apply(s,r)]):[3,3];case 2:return a.sent(),[3,4];case 3:this._curStatusObj=new i(this._host),a.label=4;case 4:return[2]}})})},e.prototype.updateCurStatus=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){return this.inStatus(t)?((i=this._curStatusObj).updateStatus.apply(i,e),[2]):[2,!1]})})},e.prototype.getCurStatusRemainTime=function(){return this._curStatusObj.remainTime},e.prototype.resetToNoneStatus=function(){this._curStatusObj=new i(null)},e}(Core.BindingDelegate);t.WarStatusDelegateBase=r,__reflect(r.prototype,"War.WarStatusDelegateBase")}(War||(War={}));var UI;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._card=this.getChild("card").asCom,this._expProgressBar=this.getChild("expProgressBar").asCom,this._progressText=this.getChild("progressText").asTextField,this._stateCtrl=this.getController("state"),this._selectCtrl=this.getController("select"),this._campignUnlockText=this.getChild("campignUnlockHintText").asTextField,this._campignUnlockText.visible=!1,this.selected=!1,this._expProgressX=this._expProgressBar.x,this._expProgressY=this._expProgressBar.y,this._initHeight=this.height},Object.defineProperty(e.prototype,"cardObj",{get:function(){return this._cardObj},set:function(t){this._cardObj=t,this._card.cardObj=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inHandPoint",{get:function(){return this._card.inHandPoint},set:function(t){this._card.inHandPoint=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"energyProgressBar",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected},set:function(t){this.setSelected(t)},enumerable:!0,configurable:!0}),e.prototype.setSelected=function(t){this._selected=t,this._selectCtrl.selectedPage=t?"selected":"normal",this._card.visibleLightCircle(t)},Object.defineProperty(e.prototype,"state",{get:function(){return this._stateCtrl.selectedPage},set:function(t){this._stateCtrl.selectedPage=t},enumerable:!0,configurable:!0}),e.prototype.visibleEnergyProgress=function(t){},e.prototype.visibleExpProgress=function(t){t?this._expProgressBar.parent!=this&&(this.addChild(this._expProgressBar),this._expProgressBar.x=this._expProgressX,this._expProgressBar.y=this._expProgressY,this.height+=this._expProgressBar.height):this._expProgressBar.parent==this&&(this.removeChild(this._expProgressBar),this.height-=this._expProgressBar.height),this.addChild(this._progressText),this._progressText.visible=t},e.prototype._updateProgressText=function(){this._cardObj.maxAmount<=0?this._progressText.text=this._cardObj.amount+"/"+Core.StringUtils.TEXT(60030):this._progressText.text=this._cardObj.amount+"/"+this._cardObj.maxAmount},e.prototype.setProgress=function(){this._expProgressBar.setProgress(this._cardObj.amount,this._cardObj.maxAmount),this._updateProgressText()},e.prototype.watchLevel=function(){this._card.watchLevel()},e.prototype.unwatchLevel=function(){this._card.unwatchLevel()},e.prototype.watchSkin=function(){this._card.watchSkin()},e.prototype.unwatchSkin=function(){this._card.unwatchSkin()},e.prototype.watchEquip=function(){this._card.watchEquip()},e.prototype.unwatchEquip=function(){this._card.unwatchEquip()},e.prototype.watchAmount=function(){this._card.watchProp(CardPool.Card.PropAmount,this._onPropAmountChange,this)},e.prototype.unwatchAmount=function(){this._card.unwatchProp(CardPool.Card.PropAmount)},e.prototype._onPropAmountChange=function(){this._expProgressBar.setProgress(this._cardObj.amount,this._cardObj.maxAmount),this._updateProgressText()},e.prototype.watchEnergy=function(){this._card.watchProp(CardPool.Card.PropEnergy,this._onPropEnergyChange,this)},e.prototype.unwatchEnergy=function(){this._card.unwatchProp(CardPool.Card.PropEnergy)},e.prototype._onPropEnergyChange=function(){},e.prototype.watch=function(){this.watchAmount(),this.watchEnergy(),this._card.watchLevel(),this._card.watchSkin()},e.prototype.unwatch=function(){this.unwatchAmount(),this.unwatchEnergy(),this._card.unwatchLevel(),this._card.unwatchSkin()},e.NormalState="normal",e.ForbidState="forbid",e.GuardState="guard",e.AttackState="attack",e.HideState="hide",e.campaignBanState="campaignBan",e}(fairygui.GComponent);t.BaseCardItem=e,__reflect(e.prototype,"UI.BaseCardItem",["UI.IHandItem"])}(UI||(UI={}));var War;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i._battle=e,i}return __extends(e,t),Object.defineProperty(e.prototype,"host",{get:function(){return this._battle},enumerable:!0,configurable:!0}),e}(t.WarStatusBase);t.BattleStatusBase=e,__reflect(e.prototype,"War.BattleStatusBase");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.BattleStatusName.ST_NORMAL},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return this.startHeartbeat(),t.WarMgr.inst.warView&&t.WarMgr.inst.warView.updateFightAndQuest(),t.WarMgr.inst.warView&&t.WarMgr.inst.warView.warTipPanel&&(e=t.WarMgr.inst.warView.warTipPanel,e.showTipNormal(),t.WarMgr.inst.warView.setCloseBtn(!0)),[2]})})},i.prototype.heartbeat=function(){this.remainTime>0&&(this.remainTime-=1,this.remainTime<0&&(this.remainTime=0))},i.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return this.stopHeartbeat(),t.WarMgr.inst.warView&&t.WarMgr.inst.warView.warTipPanel&&(e=t.WarMgr.inst.warView.warTipPanel,e.closeTip()),[2]})})},i}(e);t.BattleNormal=i,__reflect(i.prototype,"War.BattleNormal");var r=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.BattleStatusName.ST_PREPARE},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return this.startHeartbeat(),t.WarMgr.inst.warView&&t.WarMgr.inst.warView.updateFightAndQuest(),t.WarMgr.inst.warView&&t.WarMgr.inst.warView.warTipPanel&&(e=t.WarMgr.inst.warView.warTipPanel,e.showTipPrePare()),[2]})})},i.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return this.stopHeartbeat(),t.WarMgr.inst.warView&&t.WarMgr.inst.warView.warTipPanel&&(e=t.WarMgr.inst.warView.warTipPanel,e.closeTip()),[2]})})},i.prototype.heartbeat=function(){this.remainTime>0&&(this.remainTime-=1,this.remainTime<0&&(this.remainTime=0))},i}(e);t.BattlePrepare=r,__reflect(r.prototype,"War.BattlePrepare");var n=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.BattleStatusName.ST_DURING},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){return this.startHeartbeat(),t.WarMgr.inst.warView&&t.WarMgr.inst.warView.updateFightAndQuest(),t.WarMgr.inst.warView&&t.WarMgr.inst.warView.warTipPanel&&(e=t.WarMgr.inst.warView.warTipPanel,e.showTipInWar()),i=t.CityMgr.inst.getAllCities(),i.forEach(function(t){t.cityCom&&t.cityCom.setCityInWarMode(!0)}),[2]})})},i.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){return this.stopHeartbeat(),e=t.CityMgr.inst.getAllCities(),e.forEach(function(e){e.cityCom&&e.cityCom.setCityInWarMode(!1),e.changeStatus(t.CityStatusName.ST_NORMAL)}),t.WarMgr.inst.warView&&t.WarMgr.inst.warView.warTipPanel&&(i=t.WarMgr.inst.warView.warTipPanel,i.closeTip()),[2]})})},i.prototype.heartbeat=function(){this.remainTime>0&&(this.remainTime-=1,this.remainTime<0&&(this.remainTime=0))},i}(e);t.BattleDuring=n,__reflect(n.prototype,"War.BattleDuring");var o=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.BattleStatusName.ST_END},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,n=this;return __generator(this,function(o){switch(o.label){case 0:return i=e[0],this.startHeartbeat(),[4,Core.ViewManager.inst.open(ViewName.battleEndView,i,function(){n._battle.changeStatus(t.BattleStatusName.ST_NORMAL)})];case 1:return o.sent(),t.WarMgr.inst.warView&&t.WarMgr.inst.warView.updateFightAndQuest(),t.WarMgr.inst.warView&&t.WarMgr.inst.warView.warTipPanel&&(r=t.WarMgr.inst.warView.warTipPanel,r.showTipNormal(),t.WarMgr.inst.warView.setCloseBtn(!0)),[2]}})})},i.prototype.heartbeat=function(){this.remainTime>0&&(this.remainTime-=1,this.remainTime<0&&(this.remainTime=0))},i.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return this.stopHeartbeat(),t.WarMgr.inst.warView&&t.WarMgr.inst.warView.warTipPanel&&(e=t.WarMgr.inst.warView.warTipPanel,e.closeTip()),[2]})})},i}(e);t.BattleEnd=o,__reflect(o.prototype,"War.BattleEnd");var s=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.BattleStatusName.ST_UNIFIED},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return e=t[0],[4,Core.ViewManager.inst.open(ViewName.battleUnifiedView,e)];case 1:return i.sent(),[2]}})})},i}(e);t.BattleUnified=s,__reflect(s.prototype,"War.BattleUnified");var a=function(e){function s(){return null!==e&&e.apply(this,arguments)||this}return __extends(s,e),s.prototype.setDelegateHost=function(t){this._battle=t,e.prototype.setDelegateHost.call(this,t)},s.prototype.initStatus=function(){this._statusObjs.setValue(t.BattleStatusName.ST_NORMAL,new i(this._battle)),this._statusObjs.setValue(t.BattleStatusName.ST_PREPARE,new r(this._battle)),this._statusObjs.setValue(t.BattleStatusName.ST_DURING,new n(this._battle)),this._statusObjs.setValue(t.BattleStatusName.ST_END,new o(this._battle))},s.prototype.changeStatus=function(i,r){void 0===r&&(r=-1);for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return __awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(s){return this._curStatusObj.name==t.BattleStatusName.ST_PREPARE&&i==t.BattleStatusName.ST_DURING&&(o=fairygui.UIPackage.createObject(PkgName.war,"warBegin").asCom,o.y=fairygui.GRoot.inst.getDesignStageHeight()/2,Core.EffectUtil.showLeftToRight(o)),e.prototype.changeStatus.apply(this,[i,r].concat(n)),console.log("Battle Status change to ",i,r),[2]})})},s}(t.WarStatusDelegateBase);t.BattleStatusDelegate=a,__reflect(a.prototype,"War.BattleStatusDelegate")}(War||(War={}));var Battle;!function(t){var e=function(){function e(e){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];this._battleID=e.DeskId,this._isFirstPvp=e.IsFirstPvp,this._battleObs=new Collection.Dictionary,this._grids=[],this._curBout=0,this._fighter1=new t.Fighter(e.Fighter1,this),this._fighter2=new t.Fighter(e.Fighter2,this);for(var n=0;n<e.Grids.length;n++){var o=e.Grids[n],s=new t.GridObj(n,o,this);this._grids.push(s),this.addBattleObj(s)}this._fighter1.uid==Player.inst.uid?this._ownFighter=this._fighter1:this._fighter2.uid==Player.inst.uid?this._ownFighter=this._fighter2:this._ownFighter=this._fighter1}return Object.defineProperty(e.prototype,"battleID",{get:function(){return this._battleID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"battleType",{get:function(){return t.BattleType.PVP},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fighter1",{get:function(){return this._fighter1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fighter2",{get:function(){return this._fighter2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"curBout",{get:function(){return this._curBout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFirstHand",{get:function(){return this._isFirstHand},enumerable:!0,configurable:!0}),e.prototype.isPvp=function(){return this.battleType==t.BattleType.PVP?!0:!1},e.prototype.getFighter=function(t){return this._fighter1.uid==t?this._fighter1:this._fighter2},e.prototype.getOwnFighter=function(){return this._ownFighter},e.prototype.getEnemyFighter=function(){return this._ownFighter.uid!=this._fighter1.uid?this._fighter1:this._fighter2},e.prototype.getOtherFighter=function(t){return t!=this._fighter1.uid?this._fighter1:this._fighter2},e.prototype.addBattleObj=function(t){this._battleObs.setValue(t.objId,t)},e.prototype.getBattleObj=function(t){return this._battleObs.getValue(t)},e.prototype.delBattleObj=function(t){this._battleObs.remove(t)},e.prototype.getEndViewName=function(){return ViewName.pvpNewBattleEnd},e.prototype.boutBeginAni=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return e=Core.ViewManager.inst.getView(ViewName.battle),i=t==this._ownFighter.uid,0!=this._curBout?[3,2]:[4,e.playOffensiveAni(i)];case 1:r.sent(),r.label=2;case 2:return this._curBoutUid==t?[3,4]:[4,e.playTurnAni(i)];case 3:r.sent(),r.label=4;case 4:return[2]}})})},e.prototype.boutBegin=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o;return __generator(this,function(s){switch(s.label){case 0:return this._curBout++,i=this._curBoutUid,this._curBoutUid=e,r=Core.ViewManager.inst.getView(ViewName.battle),n=this.isMyBout(),1==this._curBout&&(n&&(this._isFirstHand=!0),Core.EventCenter.inst.dispatchEventWith(GameEvent.BattleBeginEv,!1,this.battleType)),o=this.getFighter(e),[4,r.boutBegin(o)];case 1:return s.sent(),this.battleType!=t.BattleType.VIDEO&&n&&o.getHandCardAmount()<=0&&this.playCard(0,0),this._isFirstPvp&&this.battleType==t.BattleType.PVP?[4,Guide.GuideMgr.inst.onNewbiePvpBattleBoutBegin(this.curBout)]:[3,3];case 2:s.sent(),s.label=3;case 3:return[2]}})})},e.prototype.boutEnd=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this._isFirstPvp&&this.battleType==t.BattleType.PVP?[4,Guide.GuideMgr.inst.onNewbiePvpBattleBoutEnd(this.curBout)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},e.prototype.isMyBout=function(){return this._curBoutUid==this._ownFighter.uid},e.prototype.playCard=function(e,i){return __awaiter(this,void 0,void 0,function(){var r,n,o;return __generator(this,function(s){switch(s.label){case 0:return r=this.getBattleObj(e),r&&!Guide.GuideMgr.inst.canPlayCard(r,i)?[2,!1]:[4,Net.rpcCall(pb.MessageID.C2S_FIGHT_BOUT_CMD,pb.FightBoutCmd.encode({UseCardObjID:e,TargetGridId:i}),!0,!1)];case 1:return n=s.sent(),0!=n.errcode?(100==n.errcode&&Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60188)),[2,!1]):(o=pb.FightBoutResult.decode(n.payload),Core.EventCenter.inst.dispatchEventWith(GameEvent.BattlePlayCardEv,!1,{card:r,gridIdx:i}),Core.ViewManager.inst.getView(ViewName.battle).onPlayBoutActions(),[4,t.BoutActionPlayer.inst.playCard(o.UseCardObjID,o.TargetGridId,o.CardNeedTalk,o.IsUseCardInFog,o.IsUseCardPublicEnemy)]);case 2:return s.sent(),[4,t.BoutActionPlayer.inst.playActions(o.Actions,o.WinUid)];case 3:return s.sent(),[4,fairygui.GTimers.inst.waitTime(100)];case 4:return s.sent(),[4,this.boutEnd()];case 5:return s.sent(),this.readyDone(),[2,!0]}})})},e.prototype.readyDone=function(){Net.rpcPush(pb.MessageID.C2S_FIGHT_BOUT_READY_DONE,null)},e.prototype.restoredDone=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return this._curBout=e-1,Net.rpcPush(pb.MessageID.C2S_FIGHT_BOUT_READY_DONE,null),[4,this.boutEnd()];case 1:return i.sent(),this.boutBegin(t),[2]}})})},e.prototype.endBattle=function(e,i){return void 0===i&&(i=!1),__awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(o){switch(o.label){case 0:return Guide.GuideMgr.inst.hideGuide(),Core.EventCenter.inst.addEventListener(Core.Event.CloseViewEvt,this._onBattleEnd,this),r=Core.ViewManager.inst.getView(ViewName.battle).endBattle(this,e,i),this.battleType!=t.BattleType.PVP||i||(n=e.WinUid==this.getOwnFighter().uid,n?TD.onPvpCompleted(this):TD.onPvpFailed(this)),[4,r];case 1:return o.sent(),Core.EventCenter.inst.dispatchEventWith(GameEvent.BattleEndEv),[2]}})})},e.prototype.getGridById=function(t){return 0>t||t>=this._grids.length?null:this._grids[t]},e.prototype.getCardByIdx=function(t){if(t>=1&&5>=t)return this.getOwnFighter().getHandCardByIdx(t-1);if(t>=15&&19>=t)return this.getEnemyFighter().getHandCardByIdx(t-15);if(t>=6&&14>=t){var e=this.getGridById(t-6);if(e)return e.inGridCard}return null},e.prototype.addDelayTips=function(t){this._delayTips||(this._delayTips=[]),this._delayTips.push(t)},e.prototype.isEnemyHandOpen=function(){return!1},e.prototype._onBattleEnd=function(t){if(t.data==this.getEndViewName()&&(Core.EventCenter.inst.removeEventListener(Core.Event.CloseViewEvt,this._onBattleEnd,this),this._delayTips))for(var e=0;e<this._delayTips.length;e++)Core.TipsUtils.alert(this._delayTips[e])},e}();t.Battle=e,__reflect(e.prototype,"Battle.Battle")}(Battle||(Battle={}));var CardPool;!function(t){var e=function(){function e(t){this._data=t,this._amount=0,this._energy=0}return Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this._skillIds=null,this._skill1Name="",this._skill2Name="",this._skill3Name="",this._skill4Name="",this._skillDesc=""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"collectCard",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cardId",{get:function(){return this._data.cardId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gcardId",{get:function(){return this._data.__id__},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rare",{get:function(){return this._data.rare},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"camp",{get:function(){return this._data.camp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return t.CardState.Alive},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"amount",{get:function(){return this._amount},set:function(t){this._amount=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"energy",{get:function(){return this._energy},set:function(t){this._energy=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxAmount",{get:function(){return this._data.levelupNum},enumerable:!0,configurable:!0}),e.prototype.getToLevelAmount=function(t){var e=0,i=0;if(this.rare==CardQuality.LIMITED)return[e,i];if(this.level<t){for(var r=t-this.level,n=0;r>n;n++)e+=Data.pool.get(this.gcardId+n).levelupNum,i+=Data.pool.get(this.gcardId+n).levelupGold;e-=this.amount}return[e,i]},e.prototype._countAmount=function(){},Object.defineProperty(e.prototype,"maxEnergy",{get:function(){return this._data.energy},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._data.name},enumerable:!0,configurable:!0}),e.prototype.getPower=function(t){switch(t){case WarMsType.Irrigation:return this._data.politics;case WarMsType.Trade:return this._data.intelligence;case WarMsType.Build:return this._data.force;default:return 0}},Object.defineProperty(e.prototype,"skin",{get:function(){return this._data.skin&&void 0!=this._data.skin||(this._data.skin=""),this._data.skin},set:function(t){this._data.skin=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"equip",{get:function(){return this._data.equip||(this._data.equip=null),this._data.equip},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"level",{get:function(){return this._data.level},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"order",{get:function(){return this._data.cardOrder},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skillIds",{get:function(){var e=this;if(this._skillIds)return this._skillIds;var i=[];this._skillIds=i;var r=this._data.skill;if(r){var n=r.split(";"),o=0;return this._skillDesc="",n.forEach(function(r){var n=parseInt(r),s=Data.skill.get(n);if(s&&(i.push(n),s.name&&(0==o?e._skill1Name=s.name:1==o?e._skill2Name=s.name:2==o?e._skill3Name=s.name:3==o&&(e._skill4Name=s.name),o++),s.desTra)){e._skillDesc+=t.CardPoolMgr.inst.formatSkillDesc(s,e.level)+"\n"
}}),i}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skill1Name",{get:function(){return this.skillIds,this._skill1Name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skill2Name",{get:function(){return this.skillIds,this._skill2Name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skill3Name",{get:function(){return this.skillIds,this._skill3Name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skill4Name",{get:function(){return this.skillIds,this._skill4Name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skillDesc",{get:function(){return this.skillIds,this._skillDesc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"icon",{get:function(){return this._data.icon},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"upNum",{get:function(){return this._data.up_l},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"downNum",{get:function(){return this._data.down_l},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftNum",{get:function(){return this._data.left_l},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightNum",{get:function(){return this._data.right_l},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"upNumOffset",{get:function(){return this._data.up_u-this._data.up_l},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"downNumOffset",{get:function(){return this._data.down_u-this._data.down_l},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftNumOffset",{get:function(){return this._data.left_u-this._data.left_l},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightNumOffset",{get:function(){return this._data.right_u-this._data.right_l},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weapon",{get:function(){return this._data.weaponEff},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sound",{get:function(){return this._data.sound},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isNew",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInCampaignMission",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInSeason",{get:function(){return!1},enumerable:!0,configurable:!0}),e}();t.BaseCard=e,__reflect(e.prototype,"CardPool.BaseCard",["UI.ICardObj"])}(CardPool||(CardPool={}));var Collection;!function(t){var e=function(){function e(e,i,r){void 0===r&&(r=!1),this.dict=new t.Dictionary(e),this.equalsF=i||t.defaultEquals,this.allowDuplicate=r}return e.prototype.getValue=function(e){var i=this.dict.getValue(e);return t.isUndefined(i)?[]:t.copy(i)},e.prototype.setValue=function(e,i){if(t.isUndefined(e)||t.isUndefined(i))return!1;var r=this.dict.getValue(e);return t.isUndefined(r)?(this.dict.setValue(e,[i]),!0):!this.allowDuplicate&&t.contains(r,i,this.equalsF)?!1:(r.push(i),!0)},e.prototype.remove=function(e,i){if(t.isUndefined(i)){var r=this.dict.remove(e);return!t.isUndefined(r)}var n=this.dict.getValue(e);return!t.isUndefined(n)&&t.remove(n,i,this.equalsF)?(0===n.length&&this.dict.remove(e),!0):!1},e.prototype.keys=function(){return this.dict.keys()},e.prototype.values=function(){for(var t=this.dict.values(),e=[],i=0,r=t;i<r.length;i++)for(var n=r[i],o=0,s=n;o<s.length;o++){var a=s[o];e.push(a)}return e},e.prototype.containsKey=function(t){return this.dict.containsKey(t)},e.prototype.clear=function(){this.dict.clear()},e.prototype.size=function(){return this.dict.size()},e.prototype.isEmpty=function(){return this.dict.isEmpty()},e}();t.MultiDictionary=e,__reflect(e.prototype,"Collection.MultiDictionary")}(Collection||(Collection={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var t=this;e.prototype.initUI.call(this),this.center(),this.modal=!0,this._cityObjWatchers=[],this._cityName=this.contentPane.getChild("cityName").asTextField,this._kingHead=this.contentPane.getChild("kingHead"),this._kingName=this.contentPane.getChild("kingName").asTextField,this._kingName.textParser=Core.StringUtils.parseColorText,this._skillDesc=this.contentPane.getChild("skillDesc").asRichTextField,this._allMemberBtn=this.contentPane.getChild("allMemberBtn").asButton,this._playerCnt=this._allMemberBtn.getChild("playerCnt").asTextField,this._emptyHint=this.contentPane.getChild("emptyHint").asTextField,this._defenceBar=this.contentPane.getChild("chengfang").asCom,this._agricultureBar=this.contentPane.getChild("nongye").asCom,this._businessBar=this.contentPane.getChild("shangye").asCom,this._gloryCom=this.contentPane.getChild("rongyu").asCom,this._forageCom=this.contentPane.getChild("liangcao").asCom,this._goldCom=this.contentPane.getChild("jinbi").asCom,this._campCom=this.contentPane.getChild("campCom").asCom,this._addGoldBtn=this.contentPane.getChild("addGoldBtn").asButton,this._noticeBtn=this.contentPane.getChild("noticeBtn").asButton,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._defenceBar.setIconUrl(Utils.warResType2Url(WarResType.Defense)),this._businessBar.setIconUrl(Utils.warResType2Url(WarResType.Business)),this._agricultureBar.setIconUrl(Utils.warResType2Url(WarResType.Agriculture)),this._gloryCom.setIconUrl(WarResType.Glory),this._forageCom.setIconUrl(WarResType.Forage),this._goldCom.setIconUrl(WarResType.Gold),this._defenceBar.openClick(WarResType.Defense),this._businessBar.openClick(WarResType.Business),this._agricultureBar.openClick(WarResType.Agriculture),this._goldCom.openClick(),this._forageCom.openClick(),this._gloryCom.openClick(),this._kingHead.addClickListener(this._onKingHead,this),this._allMemberBtn.addClickListener(this._onMemberBtn,this),this._addGoldBtn.addClickListener(this._onAddGoldBtn,this),this._noticeBtn.addClickListener(this._onNotice,this),this._closeBtn.addClickListener(this._onClose,this),this._skillDesc.addEventListener(egret.TextEvent.LINK,function(e){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return[4,htmlClickCallback(e)];case 1:return t=i.sent(),t&&(this.addChild(t),t.center(),t.y=this._skillDesc.y+this._skillDesc.height),[2]}})})},this)},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){return e.prototype.open.apply(this,i),this._country=null,r=t.CityMgr.inst.getCity(i[0]),this._city=r,0!=this._city.countryID&&(this._country=t.CountryMgr.inst.getCountry(this._city.countryID)),this._cityName.text=r.cityName,this.setCityDetails(),[2]})})},i.prototype.watchCityInfo=function(){this._city.watchProp(t.City.PropGold,this._updateGold,this),this._city.watchProp(t.City.PropForage,this._updateForage,this),this._city.watchProp(t.City.PropGlory,this._updateGlory,this),this._city.watchProp(t.City.PropBusiness,this._updateBusiness,this),this._city.watchProp(t.City.PropAgriculture,this._updateAgriculture,this),this._city.watchProp(t.City.PropDefence,this._updateDefence,this),this._city.watchProp(t.City.PropPlayerNum,this._updatePlayerNum,this),this._city.watchProp(t.City.PropCountry,this._updateCamp,this),this._city.watchProp(t.City.PropYouMajesty,this._updateKing,this)},i.prototype.unwatchCityInfo=function(){this._city.unwatchProp(t.City.PropGold,this._updateGold,this),this._city.unwatchProp(t.City.PropForage,this._updateForage,this),this._city.unwatchProp(t.City.PropGlory,this._updateGlory,this),this._city.unwatchProp(t.City.PropBusiness,this._updateBusiness,this),this._city.unwatchProp(t.City.PropAgriculture,this._updateAgriculture,this),this._city.unwatchProp(t.City.PropDefence,this._updateDefence,this),this._city.unwatchProp(t.City.PropPlayerNum,this._updatePlayerNum,this),this._city.unwatchProp(t.City.PropCountry,this._updateCamp,this),this._city.unwatchProp(t.City.PropYouMajesty,this._updateKing,this)},i.prototype.watchCountryInfo=function(){this._country&&(this._country.watchProp(t.Country.PropFlag,this._updateCampInfo,this),this._country.watchProp(t.Country.PropCampName,this._updateCampInfo,this))},i.prototype.unwatchCountryInfo=function(){this._country&&(this._country.unwatchProp(t.Country.PropFlag,this._updateCampInfo,this),this._country.unwatchProp(t.Country.PropCampName,this._updateCampInfo,this))},i.prototype.setCityDetails=function(){this.setCityBaseInfo(),this._updatePlayerNum(),this._updateGold(),this._updateGlory(),this._updateForage(),this._updateDefence(),this._updateBusiness(),this._updateAgriculture(),this._updateKing(),this._updateCamp()},i.prototype.setCityBaseInfo=function(){this._skillDesc.text=this._city.skillLinkText,this._updateAddGoldBtn()},i.prototype._updateAddGoldBtn=function(){t.MyWarPlayer.inst.isMyCity(this._city.cityID)?this._addGoldBtn.visible=!(0==this._city.countryID):this._addGoldBtn.visible=!1},i.prototype._updateCamp=function(){this.unwatchCountryInfo(),this._updateAddGoldBtn(),0==this._city.countryID?this._campCom.setCamp(null):(this._country=t.CountryMgr.inst.getCountry(this._city.countryID),this._campCom.setCamp(this._country),this.watchCountryInfo())},i.prototype._updateCampInfo=function(){this._campCom.setCamp(this._country)},i.prototype._updateGold=function(){this._goldCom.setNum(this._city.gold)},i.prototype._updateForage=function(){this._forageCom.setNum(this._city.forage)},i.prototype._updateGlory=function(){this._gloryCom.setNum(this._city.glory/10)},i.prototype._updateAgriculture=function(){this._agricultureBar.setProgress(this._city.agriculture,this._city.agricultureMax),this._agricultureBar.setProgress2(0,this._city.agricultureMax)},i.prototype._updateDefence=function(){this._defenceBar.setProgress(this._city.defence,this._city.defenceMax),this._defenceBar.setProgress2(0,this._city.defenceMax)},i.prototype._updateBusiness=function(){this._businessBar.setProgress(this._city.business,this._city.businessMax),this._businessBar.setProgress2(0,this._city.businessMax)},i.prototype._updateKing=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return this._kingHead.visible=!1,this._kingName.visible=!1,0!=this._city.countryID&&(t=this._city.yourMajesty,t&&(this._kingHead.visible=!0,this._kingName.visible=!0,this._kingHead.setAll(t.HeadImg,t.HeadFrame),this._kingName.text=t.Name)),[2]})})},i.prototype._updatePlayerNum=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._playerCnt.text=this._city.playerNum.toString(),[2]})})},i.prototype._onMemberBtn=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,t.WarMgr.inst.fetchCityMember(this._city.cityID,0)];case 1:return e=i.sent(),e&&Core.ViewManager.inst.open(ViewName.allMemberPanel,this._city,e),[2]}})})},i.prototype._onAddGoldBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.open(ViewName.addGoldWnd,this._city),[2]})})},i.prototype._onNotice=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return e={CityID:this._city.cityID},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_CITY_NOTICE,pb.TargetCity.encode(e))];case 1:return i=o.sent(),0==i.errcode&&(r=pb.CityNotice.decode(i.payload).Notice,n=this._city.cityID==t.MyWarPlayer.inst.cityID&&t.MyWarPlayer.inst.employee.canNotice(),Core.ViewManager.inst.open(ViewName.cityNoticeWnd,r,n)),[2]}})})},i.prototype._onKingHead=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return 0==this._city.countryID?[2]:(t=this._city.yourMajesty.Uid,[4,Social.FriendMgr.inst.fetchPlayerInfo(t)]);case 1:return e=i.sent(),e&&Core.ViewManager.inst.open(ViewName.friendInfo,t,e),[2]}})})},i.prototype._onClose=function(){Core.ViewManager.inst.closeView(this)},i.prototype.close=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return e.prototype.close.apply(this,i),t.WarMgr.inst.nowSelectCity=null,this._cityObjWatchers.forEach(function(t){t.unwatch()}),this._cityObjWatchers=[],t.WarMgr.inst.nowSelectCity=null,[2]})})},i}(Core.BaseWindow);t.BaseCityInfoWnd=e,__reflect(e.prototype,"War.BaseCityInfoWnd")}(War||(War={}));var War;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i._city=e,i}return __extends(e,t),Object.defineProperty(e.prototype,"host",{get:function(){return this._city},enumerable:!0,configurable:!0}),e}(t.WarStatusBase);t.CityStatusBase=e,__reflect(e.prototype,"War.CityStatusBase");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.CityStatusName.ST_NORMAL},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},i}(e);t.CityNormal=i,__reflect(i.prototype,"War.CityNormal");var r=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.CityStatusName.ST_ATTACKED},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._city.cityCom.setCityInAttackedMode(!0),[2]})})},i.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._city.cityCom.setCityInAttackedMode(!1),[2]})})},i}(e);t.CityAttacked=r,__reflect(r.prototype,"War.CityAttacked");var n=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.CityStatusName.ST_FALLEN},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,n,o;return __generator(this,function(s){return i=e[0],i&&(r=this._city.countryID,n=t.CountryMgr.inst.getCountry(r),n&&n.delCity(this._city),this._city.countryID=i,o=t.CountryMgr.inst.getCountry(i),o.addCity(this._city)),this._city.cityCom&&this._city.cityCom.setInFallenMode(!0),[2]})})},i.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._city.cityCom&&this._city.cityCom.setInFallenMode(!1),[2]})})},i}(e);t.CityFallen=n,__reflect(n.prototype,"War.CityFallen");var o=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.setDelegateHost=function(t){this._city=t,e.prototype.setDelegateHost.call(this,t)},o.prototype.initStatus=function(){this._statusObjs.setValue(t.CityStatusName.ST_NORMAL,new i(this._city)),this._statusObjs.setValue(t.CityStatusName.ST_ATTACKED,new r(this._city)),this._statusObjs.setValue(t.CityStatusName.ST_FALLEN,new n(this._city))},o.prototype.changeStatus=function(t,i){void 0===i&&(i=-1);for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return e.prototype.changeStatus.apply(this,[t,i].concat(r)),[2]})})},o}(t.WarStatusDelegateBase);t.CityStatusDelegate=o,__reflect(o.prototype,"War.CityStatusDelegate")}(War||(War={}));var War;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i._country=e,i}return __extends(e,t),Object.defineProperty(e.prototype,"host",{get:function(){return this._country},enumerable:!0,configurable:!0}),e}(t.WarStatusBase);t.CountryStatusBase=e,__reflect(e.prototype,"War.CountryStatusBase");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.CountryStatusName.ST_ALIVE},enumerable:!0,configurable:!0}),i}(e);t.CountryAlive=i,__reflect(i.prototype,"War.CountryAlive");var r=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.CountryStatusName.ST_DEFEAT},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t=this._country.countryName,Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format("#cr{0}#n势力被消灭",t)),[2]})})},i}(e);t.CountryDefeat=r,__reflect(r.prototype,"War.CountryDefeat");var n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.setDelegateHost=function(t){this._country=t,e.prototype.setDelegateHost.call(this,t)},n.prototype.initStatus=function(){this._statusObjs.setValue(t.CountryStatusName.ST_ALIVE,new i(this._country)),this._statusObjs.setValue(t.CountryStatusName.ST_DEFEAT,new r(this._country))},n.prototype.changeStatus=function(t,i){void 0===i&&(i=-1);for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return e.prototype.changeStatus.apply(this,[t,i].concat(r)),console.log("Country "+this._country.countryName+" Status change to ",t),[2]})})},n}(t.WarStatusDelegateBase);t.CountryStatusDelegate=n,__reflect(n.prototype,"War.CountryStatusDelegate")}(War||(War={}));var War;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i._player=e,i}return __extends(e,t),Object.defineProperty(e.prototype,"host",{get:function(){return this._player},enumerable:!0,configurable:!0}),e}(t.WarStatusBase);t.PlayerStatusBase=e,__reflect(e.prototype,"War.PlayerStatusBase");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.PlayerStatusName.ST_NORMAL},enumerable:!0,configurable:!0}),i}(e);t.PlayerNormal=i,__reflect(i.prototype,"War.PlayerNormal");var r=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.PlayerStatusName.ST_EXPEDITION},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){return e=t.WarTeamMgr.inst.myTeam,e&&(i=t.WarMgr.inst.warView.fightStatusPanel,i.visible=!0,e.inStatus(t.TeamStatusName.ST_CAN_ATT_CITY)||e.inStatus(t.TeamStatusName.ST_DEF_BATTLE_END)||e.inStatus(t.TeamStatusName.ST_FIELD_BATTLE_END)?i.updateContinueStatus():i.updateExpeditionStatus()),[2]})})},i.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=t.WarMgr.inst.warView.fightStatusPanel,e.closePanel(),[2]})})},i.prototype._updateAttackForUI=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=t.WarMgr.inst.warView.fightStatusPanel,e.updateAcctakCityStatus(),[2]})})},i}(e);t.PlayerExpedition=r,__reflect(r.prototype,"War.PlayerExpedition");var n=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.PlayerStatusName.ST_SUPPORT},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return t.WarTeamMgr.inst.myTeam&&(e=t.WarMgr.inst.warView.fightStatusPanel,e.visible=!0,e.updateSupportStatus()),[2]})})},i.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=t.WarMgr.inst.warView.fightStatusPanel,e.closePanel(),[2]})})},i}(e);t.PlayerSupport=n,__reflect(n.prototype,"War.PlayerSupport");var o=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.PlayerStatusName.ST_DEFEND},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){return e=t.WarMgr.inst.warView.fightStatusPanel,i=t.WarTeamMgr.inst.myTeam,i&&(i.inStatus(t.TeamStatusName.ST_CAN_ATT_CITY)||i.inStatus(t.TeamStatusName.ST_DEF_BATTLE_END)||i.inStatus(t.TeamStatusName.ST_FIELD_BATTLE_END)?e.updateContinueStatus():e.updateDefendStatus()),[2]})})},i.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=t.WarMgr.inst.warView.fightStatusPanel,e.closePanel(),[2]})})},i}(e);t.PlayerDefend=o,__reflect(o.prototype,"War.PlayerDefend");var s=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.PlayerStatusName.ST_ARREST},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=t.WarMgr.inst.warView.arrestPanel,e.showPanel(),[2]})})},i.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=t.WarMgr.inst.warView.arrestPanel,e.closePanel(),[2]})})},i}(e);t.PlayerArrest=s,__reflect(s.prototype,"War.PlayerArrest");var a=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.PlayerStatusName.ST_RECTIFY},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){return i=pb.CpStateLoadingArg.decode(e[0]),this.remainTime=i.RemainTime,console.log("Player begin rectify, remain "+i.RemainTime+"s, max "+i.MaxTime),this._maxTime=i.MaxTime,r=t.WarMgr.inst.warView.fightStatusPanel,r.visible=!0,this.startHeartbeat(),this._updateRectifyForUI(),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70364)),[2]})})},i.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return this.stopHeartbeat(),e=t.WarMgr.inst.warView.fightStatusPanel,e.visible=!1,[2]})})},i.prototype._updateRectifyForUI=function(){var e=t.WarMgr.inst.warView.fightStatusPanel;e.updateRectifyStatus(this.remainTime,this._maxTime)},i.prototype.heartbeat=function(){if(this.remainTime>0&&(this.remainTime-=1,this.remainTime<=0)){this.remainTime=0;var e=t.WarMgr.inst.warView.fightStatusPanel;e.updateContinueStatus()}this._updateRectifyForUI()},i}(e);t.PlayerRectify=a,__reflect(a.prototype,"War.PlayerRectify");var u=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.PlayerStatusName.ST_REST},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){return i=pb.CpStateLoadingArg.decode(e[0]),this.remainTime=i.RemainTime,this._maxTime=i.MaxTime,console.log("Player begin Rest, remain "+i.RemainTime+"s, max "+i.MaxTime),r=t.WarMgr.inst.warView.fightBtn,r.touchable=!1,r.getChild("time").visible=!0,t.WarMgr.inst.warView.setCloseBtn(!0),this.startHeartbeat(),this._updateRestForUI(),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70365)),[2]})})},i.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return this.stopHeartbeat(),e=t.WarMgr.inst.warView.fightBtn,e.touchable=!0,e.grayed=!1,e.getChild("time").visible=!1,[2]})})},i.prototype.heartbeat=function(){this.remainTime>0&&(this.remainTime-=1,this.remainTime<=0&&(this.remainTime=0)),this._updateRestForUI()},i.prototype._updateRestForUI=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=t.WarMgr.inst.warView.fightBtn,e.touchable=!1,e.grayed=!0,e.getChild("time").visible=!0,e.getChild("time").asTextField.text=Core.StringUtils.format(Core.StringUtils.TEXT(70366),this.remainTime),[2]})})},i}(e);t.PlayerRest=u,__reflect(u.prototype,"War.PlayerRest");var h=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.PlayerStatusName.ST_KICKOUT},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){return i=pb.CpStateKickOutArg.decode(e[0]),r=t.WarMgr.inst.warView.fightBtn,n=t.WarMgr.inst.warView.questBtn,r.touchable=!1,r.grayed=!0,n.touchable=!1,n.grayed=!0,[2]})})},i.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){return e=t.WarMgr.inst.warView.fightBtn,i=t.WarMgr.inst.warView.questBtn,e.touchable=!0,e.grayed=!1,i.touchable=!0,i.grayed=!1,[2]})})},i}(e);t.PlayerKickOut=h,__reflect(h.prototype,"War.PlayerKickOut");var l=function(e){function l(){return null!==e&&e.apply(this,arguments)||this}return __extends(l,e),l.prototype.setDelegateHost=function(t){this._player=t,e.prototype.setDelegateHost.call(this,t)},l.prototype.changeStatus=function(t,i){void 0===i&&(i=-1);for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return e.prototype.changeStatus.apply(this,[t,i].concat(r)),console.log("Player Status change to ",t),[2]})})},l.prototype.initStatus=function(){this._statusObjs.setValue(t.PlayerStatusName.ST_NORMAL,new i(this._player)),this._statusObjs.setValue(t.PlayerStatusName.ST_EXPEDITION,new r(this._player)),this._statusObjs.setValue(t.PlayerStatusName.ST_SUPPORT,new n(this._player)),this._statusObjs.setValue(t.PlayerStatusName.ST_DEFEND,new o(this._player)),this._statusObjs.setValue(t.PlayerStatusName.ST_ARREST,new s(this._player)),this._statusObjs.setValue(t.PlayerStatusName.ST_RECTIFY,new a(this._player)),this._statusObjs.setValue(t.PlayerStatusName.ST_REST,new u(this._player)),this._statusObjs.setValue(t.PlayerStatusName.ST_KICKOUT,new h(this._player))},l}(t.WarStatusDelegateBase);t.PlayerStatusDelegate=l,__reflect(l.prototype,"War.PlayerStatusDelegate")}(War||(War={}));var War;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i._team=e,i}return __extends(e,t),Object.defineProperty(e.prototype,"host",{get:function(){return this._team},enumerable:!0,configurable:!0}),e}(t.WarStatusBase);t.TeamStatusBase=e,__reflect(e.prototype,"War.TeamStatusBase");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.TeamStatusName.ST_NORMAL},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var e,e;return __generator(this,function(i){return this._team.resumeRun(!0),this._team.isMyTeam()&&(t.MyWarPlayer.inst.inStatus(t.PlayerStatusName.ST_EXPEDITION)?(e=t.WarMgr.inst.warView.fightStatusPanel,e.visible=!0,e.updateExpeditionStatus()):t.MyWarPlayer.inst.inStatus(t.PlayerStatusName.ST_SUPPORT)&&(e=t.WarMgr.inst.warView.fightStatusPanel,e.visible=!0,e.updateSupportStatus())),[2]})})},i.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._team.resumeRun(!1),[2]})})},i}(e);t.TeamNormal=i,__reflect(i.prototype,"War.TeamNormal");var r=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.TeamStatusName.ST_FIELD_BATTLE},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._team["char"]&&this._team["char"].setInFightMode(!0),[2]})})},i.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._team["char"]&&this._team["char"].setInFightMode(!1),[2]})})},i}(e);t.TeamFieldBattle=r,__reflect(r.prototype,"War.TeamFieldBattle");var n=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.TeamStatusName.ST_CAN_ATT_CITY},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return this._team.isMyTeam()&&(e=t.WarMgr.inst.warView.fightStatusPanel,e.updateContinueStatus()),[2]})})},i.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return this._team.isMyTeam()&&(e=t.WarMgr.inst.warView.fightStatusPanel,e.closePanel()),[2]})})},i}(e);t.TeamCanAttCity=n,__reflect(n.prototype,"War.TeamCanAttCity");var o=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.TeamStatusName.ST_ATTACKING_CITY},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return this._team["char"]&&this._team["char"].setInAttCityMode(!0,this._team),this._team.isMyTeam()&&(e=t.WarMgr.inst.warView.fightStatusPanel,e.visible=!0,e.updateExpeditionStatus()),[2]})})},i.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._team["char"]&&this._team["char"].setInAttCityMode(!1),[2]})})},i}(e);t.TeamAttackingCity=o,__reflect(o.prototype,"War.TeamAttackingCity");var s=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.TeamStatusName.ST_DISAPPEAR},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){return i=e[0],i&&this._team.isMyTeam()&&t.WarTeam.showTeamDisappearTipsByPayload(i,!0),this._team.isMyTeam()?t.WarTeamMgr.inst.cleanMyTeam():t.WarTeamMgr.inst.delOtherTeam(this._team.teamID),this._team.onDestroy(),[2]})})},i}(e);t.TeamDisappear=s,__reflect(s.prototype,"War.TeamDisappear");var a=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.TeamStatusName.ST_FIELD_BATTLE_END},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var e;
return __generator(this,function(i){return this._team.isMyTeam()&&(e=t.WarMgr.inst.warView.fightStatusPanel,e.updateContinueStatus()),[2]})})},i.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return this._team.isMyTeam()&&(e=t.WarMgr.inst.warView.fightStatusPanel,e.closePanel()),[2]})})},i}(e);t.TeamFieldBattleEnd=a,__reflect(a.prototype,"War.TeamFieldBattleEnd");var u=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.TeamStatusName.ST_ATT_CITY},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return this._team["char"]&&this._team["char"].setInFightMode(!0),this._team.isMyTeam()&&(e=t.WarMgr.inst.warView.fightStatusPanel,e.visible=!0,e.updateExpeditionStatus()),[2]})})},i.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._team["char"]&&this._team["char"].setInFightMode(!1),[2]})})},i}(e);t.TeamAttCity=u,__reflect(u.prototype,"War.TeamAttCity");var h=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.TeamStatusName.ST_DEF_CITY},enumerable:!0,configurable:!0}),i}(e);t.TeamDefCity=h,__reflect(h.prototype,"War.TeamDefCity");var l=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return t.TeamStatusName.ST_DEF_BATTLE_END},enumerable:!0,configurable:!0}),i.prototype.enter=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return this._team.isMyTeam()&&(e=t.WarMgr.inst.warView.fightStatusPanel,e.updateContinueStatus()),[2]})})},i.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return this._team.isMyTeam()&&(e=t.WarMgr.inst.warView.fightStatusPanel,e.closePanel()),[2]})})},i}(e);t.TeamDefBattleEnd=l,__reflect(l.prototype,"War.TeamDefBattleEnd");var c=function(e){function c(){return null!==e&&e.apply(this,arguments)||this}return __extends(c,e),c.prototype.setDelegateHost=function(t){this._team=t,e.prototype.setDelegateHost.call(this,t)},c.prototype.initStatus=function(){this._statusObjs.setValue(t.TeamStatusName.ST_NORMAL,new i(this._team)),this._statusObjs.setValue(t.TeamStatusName.ST_ATT_CITY,new u(this._team)),this._statusObjs.setValue(t.TeamStatusName.ST_ATTACKING_CITY,new o(this._team)),this._statusObjs.setValue(t.TeamStatusName.ST_CAN_ATT_CITY,new n(this._team)),this._statusObjs.setValue(t.TeamStatusName.ST_DEF_BATTLE_END,new l(this._team)),this._statusObjs.setValue(t.TeamStatusName.ST_DEF_CITY,new h(this._team)),this._statusObjs.setValue(t.TeamStatusName.ST_DISAPPEAR,new s(this._team)),this._statusObjs.setValue(t.TeamStatusName.ST_FIELD_BATTLE,new r(this._team)),this._statusObjs.setValue(t.TeamStatusName.ST_FIELD_BATTLE_END,new a(this._team))},c.prototype.isAttCity=function(){return this._team.inStatus(t.TeamStatusName.ST_ATT_CITY)||this._team.inStatus(t.TeamStatusName.ST_ATTACKING_CITY)||this._team.inStatus(t.TeamStatusName.ST_CAN_ATT_CITY)?!0:!1},c.prototype.changeStatus=function(i,r){void 0===r&&(r=-1);for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(o){switch(o.label){case 0:return i!=t.TeamStatusName.ST_DISAPPEAR&&i!=t.TeamStatusName.ST_DEF_CITY&&i!=t.TeamStatusName.ST_DEF_BATTLE_END&&this._team.genCharCom(),[4,e.prototype.changeStatus.apply(this,[i,r].concat(n))];case 1:return o.sent(),console.log("Team "+this._team.teamID+" Status change to ",i),[2]}})})},c}(t.WarStatusDelegateBase);t.TeamStatusDelegate=c,__reflect(c.prototype,"War.TeamStatusDelegate")}(War||(War={}));var Battle;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setData=function(t,e){this._oldCard=t,this._newCard=e,this._oldCard?this.cardObj=this._oldCard:this.cardObj=this._newCard,this.setProgress(),this._setSkin()},e.prototype._setSkin=function(){this._card.setOwnFront(),this._card.setCardImg(),this._card.setEquip(),this._card.setName(),this._card.setSkill(),this._card.setNumText(),this._card.setNumOffsetText(),this.cardObj.state==CardPool.CardState.Dead&&this._card.setGrey()},e.prototype.doAnimation=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return this._oldCard?(t=this._expProgressBar.doProgressAnimation(this._oldCard.amount,this._newCard.amount,this._newCard.maxAmount),[4,t]):[2];case 1:return i.sent(),e?[4,e]:[3,3];case 2:i.sent(),i.label=3;case 3:return this.cardObj=this._newCard,this._setSkin(),[2]}})})},e}(UI.BaseCardItem);t.RewardCardItem=e,__reflect(e.prototype,"Battle.RewardCardItem");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._resList=this.getChild("resList").asList},e.prototype.show=function(t){var e=this;this.visible=!0,t.forEach(function(t){var i=e._resList.addItem().asLabel;i.icon=Utils.resType2Icon(t.Type),i.title="x"+t.Amount}),this._resList.resizeToFit()},e.prototype.hide=function(){this.visible=!1,this._resList.removeChildren()},e}(fairygui.GLabel);t.RewardResBar=i,__reflect(i.prototype,"Battle.RewardResBar");var r=function(t){function e(){return t.call(this,Core.LayerManager.inst.topLayer)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this._resultCtrl=this.getController("result"),this.adjust(this.getChild("winBg")),this._resultCtrl.selectedPage="lose",this.adjust(this.getChild("loseBg")),this._resultCtrl.selectedPage="win"},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){switch(n.label){case 0:return t.prototype.open.apply(this,e),this._isClosing=!1,this.touchable=!1,i=e[0],r=e[2],[4,Core.PopUpUtils.addPopUp(this,5)];case 1:return n.sent(),this.touchable=!0,SoundMgr.inst.stopBgMusic(),i?SoundMgr.inst.playSoundAsync("win_mp3"):SoundMgr.inst.playSoundAsync("lose_mp3"),[2]}})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return Core.MaskUtils.showTransMask(),t.prototype.close.apply(this,e),this.displayObject.cacheAsBitmap=!0,[4,Core.PopUpUtils.removePopUp(this,6)];case 1:return i.sent(),this.displayObject.cacheAsBitmap=!1,Core.MaskUtils.hideTransMask(),Core.EventCenter.inst.dispatchEventWith(GameEvent.BattleEndEv),SoundMgr.inst.playBgMusic("bg_mp3"),[2]}})})},e.prototype._onBack=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._isClosing?[2]:(this._isClosing=!0,[4,Core.ViewManager.inst.close(ViewName.battle)]);case 1:return t.sent(),[4,Core.ViewManager.inst.closeView(this)];case 2:return t.sent(),[2]}})})},e.prototype.cardListDoAnimation=function(t,e){if(e){for(var i=!1,r=0,n=e;r<n.length;r++){var o=n[r];if(o.Old){var s=new CardPool.Card(CardPool.CardPoolMgr.inst.getCardData(o.New.CardId,o.New.Level));s.init(o.New);var a=new CardPool.Card(CardPool.CardPoolMgr.inst.getCardData(o.Old.CardId,o.Old.Level));a.init(o.Old);var u=t.addItem();u.setData(a,s),(s.level>a.level||s.amount>a.amount)&&(i=!0),u.displayObject.cacheAsBitmap=!0}}t.resizeToFit(),t.visible=!0,t.alpha=0;var h=this;egret.Tween.get(t).to({alpha:1},600).call(function(){return __awaiter(this,void 0,void 0,function(){var e,r,n;return __generator(this,function(o){switch(o.label){case 0:return[4,fairygui.GTimers.inst.waitTime(700)];case 1:if(o.sent(),!h.isShow())return[2];for(i&&(e=RES.getRes("addexp_mp3"),e&&e.play(0,1)),r=0;r<t.numItems;r++)n=t.getChildAt(r),n&&(n.displayObject.cacheAsBitmap=!1,n.doAnimation());return[2]}})})},this)}},e.prototype.renderResList=function(t,e){t.removeChildren(),t.visible=!0,e.sort(function(t,e){return Utils.resTypePriority(t.Type)<Utils.resTypePriority(e.Type)?-1:1}),e.forEach(function(e){var i=t.addItem().asLabel;i.icon=Utils.resType2Icon(e.Type),i.title="x"+e.Amount}),t.resizeToFit()},e.prototype.setRewardResBar=function(t,e){void 0===e&&(e=null);var i=this.getChild("rewardResBar"),r=this.getChild("rewardResBg");return t&&0!=t.length?(e&&(i.getChild("title").asTextField.text=e),r.visible=!0,i.visible=!0,void i.setData(t)):(i.visible=!1,void(r.visible=!1))},e}(Core.BaseView);t.BaseBattleEnd=r,__reflect(r.prototype,"Battle.BaseBattleEnd")}(Battle||(Battle={}));var CardPool;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i,"inst",{get:function(){return i._inst},enumerable:!0,configurable:!0}),i.prototype.initUI=function(){e.prototype.initUI.call(this),this._cardObjWatchers=[],this._isViewMode=!1,this.modal=!0,this.pivotX=.5,this.pivotY=.5;this.x,this.y;this.center(),this.adjust(this.contentPane.getChild("closeBg")),this._campText=this.contentPane.getChild("campText").asLoader,this._skillDescTexts=[];for(var t=0;3>t;t++)this._skillDescTexts.push(this.contentPane.getChild("skillDescText"+(t+1)).asRichTextField),this._skillDescTexts[t].addEventListener(egret.TextEvent.LINK,htmlClickCallback,this),window.gameGlobal.isMultiLan&&(LanguageMgr.inst.isChineseLocale()||(this._skillDescTexts[t].asRichTextField.leading=1));this.contentPane.getChild("campBottom").visible=!Home.FunctionMgr.inst.isEquipOpen(),this._campText.visible=!Home.FunctionMgr.inst.isEquipOpen(),this._card=this.contentPane.getChild("card").asCom,this._sayText=this.contentPane.getChild("say").asRichTextField,this.contentPane.getChild("closeBtn").asButton.addClickListener(this._onClose,this),this.contentPane.getChild("btnLevel1").asButton.addClickListener(function(){this._changeCurLevel(1)},this),this.contentPane.getChild("btnLevel2").asButton.addClickListener(function(){this._changeCurLevel(2)},this),this.contentPane.getChild("btnLevel3").asButton.addClickListener(function(){this._changeCurLevel(3)},this),this.contentPane.getChild("btnLevel4").asButton.addClickListener(function(){this._changeCurLevel(4)},this),this.contentPane.getChild("btnLevel5").asButton.addClickListener(function(){this._changeCurLevel(5)},this),this.contentPane.getChild("closeBg").addClickListener(this._onTouchEnd,this),LanguageMgr.inst.isChineseLocale()||(this._sayText.autoSize=fairygui.AutoSizeType.None,this._sayText.fontSize=16,this._sayText.leading=1,this._sayText.setSize(329,35)),this._typeCtrl=this.contentPane.getController("type"),Home.FunctionMgr.inst.isWorldWarOpen()?(this._politicsText=this.contentPane.getChild("politics").asRichTextField,this._intelligenceText=this.contentPane.getChild("intelligence").asRichTextField,this._forceText=this.contentPane.getChild("force").asRichTextField,this._commandText=this.contentPane.getChild("command").asRichTextField,this._politicsHintText=this.contentPane.getChild("politicsText").asRichTextField,this._intelligenceHintText=this.contentPane.getChild("intelligenceText").asRichTextField,this._forceHintText=this.contentPane.getChild("forceText").asRichTextField,this._commandHintText=this.contentPane.getChild("commandText").asRichTextField,this._politicsHintText.funcParser=Core.StringUtils.parseFuncText,this._politicsHintText.text="#fdesc,60285(政治)#e：",this._intelligenceHintText.funcParser=Core.StringUtils.parseFuncText,this._intelligenceHintText.text="#fdesc,60286(智力)#e：",this._forceHintText.funcParser=Core.StringUtils.parseFuncText,this._forceHintText.text="#fdesc,60287(武力)#e：",this._commandHintText.funcParser=Core.StringUtils.parseFuncText,this._commandHintText.text="#fdesc,60288(统帅)#e："):this._typeCtrl.setSelectedPage("common")},i.prototype.setViewMode=function(){console.log("view mode"),this._myParent=Core.LayerManager.inst.maskLayer,this.contentPane.height=570,this.contentPane.center(),this._isViewMode=!0},i.prototype.open=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return __awaiter(this,void 0,void 0,function(){var n,o,o,s,a,u=this;return __generator(this,function(h){switch(h.label){case 0:return this.battleChangeLayer(),i._inst=this,e.prototype.open.apply(this,r),this.touchable=!0,n=r[0],this._cardIndex=r[1],this._cardObj=n,this._card.cardObj=n,this._curCardViewLevel=n.level,this._campText.url=Utils.camp2Url(n.camp),this._updateLevelText(n),this._updateEnergyProgress(),this._updateCardInfo(n),this._changeCurLevel(n.level),n.rare==CardQuality.LIMITED?(this.contentPane.getChild("limitTips").visible=!0,this.contentPane.getChild("limitImg").visible=!0,o=this.contentPane.getChild("limitTips2"),o&&(o.visible=!0)):(this.contentPane.getChild("limitTips").visible=!1,this.contentPane.getChild("limitImg").visible=!1,o=this.contentPane.getChild("limitTips2"),o&&(o.visible=!1)),s=n.cardId,a=Data.hero_say.get(s),a?this._sayText.text=a.say:this._sayText.text="",this.contentPane.getChild("skillDescBg1").asGraph.visible=!1,this.contentPane.getChild("skillDescBg2").asGraph.visible=!1,this.contentPane.getChild("skillDescBg3").asGraph.visible=!1,this._cardObjWatchers.push(Core.Binding.bindHandler(n,[t.Card.PropEnergy],this._updateEnergyProgress,this)),this._cardObjWatchers.push(Core.Binding.bindHandler(n,[t.Card.PropState],this._refreshCard,this)),SoundMgr.inst.playSoundAsync("page_mp3"),this._isViewMode?[2]:(this.scaleX=.5,this.scaleY=.5,[4,new Promise(function(t){egret.Tween.get(u).to({scaleX:1,scaleY:1},300,egret.Ease.backOut).call(function(){t()})})]);case 1:return h.sent(),[2]}})})},i.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return this._isViewMode?(this._doClose(),[2]):[4,new Promise(function(e){egret.Tween.get(t).to({scaleX:0,scaleY:0},300,egret.Ease.backIn).call(function(){this._doClose(),this._card.unloadCardImg(),e()},t)})];case 1:return e.sent(),[2]}})})},i.prototype._doClose=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this._cardObjWatchers.forEach(function(t){t.unwatch()}),this._cardObjWatchers=[],e.prototype.close.apply(this,t)},i.prototype._onTouchEnd=function(t){(!Core.ViewManager.inst.getView("htmlCardView")||this._isViewMode)&&this._onClose()},i.prototype._refreshCard=function(){this._updateCardInfo(this._cardObj)},i.prototype._updateCardInfo=function(t){this._card.cardObj=t,Core.ViewManager.inst.getView("htmlCardView")||this._card.unloadCardImg(),this._card.setCardImg(),this._card.setEquip(),this._card.setName(),this._card.setSkill(),this._card.setNumText(),this._card.setNumOffsetText(),this._card.setBriefMode(!0),this._card.setDeskBackground(),this._updateCardWarInfo()},i.prototype._updateCardWarInfo=function(){if(Home.FunctionMgr.inst.isWorldWarOpen()){var t=this._card.cardObj.gcardId,e=Data.pool.get(t);this._politicsText.text=""+e.politics,this._intelligenceText.text=""+e.intelligence,this._forceText.text=""+e.force,this._commandText.text=""+e.command}},i.prototype._updateEnergyProgress=function(){},i.prototype._updateLevelText=function(t){for(var e=(t.skillDesc||"").split("\n").filter(function(t,e,i){return""!=t}),i=0;3>i;i++)if(e[i]){var r="";this._cardObj.skin&&""!=this._cardObj.skin&&(r=Data.skin_config.get(this._cardObj.skin).bind);var n=e[i].replace(/level/g,this._curCardViewLevel.toString());n=n.replace(/skin/g,r),this._skillDescTexts[i].text=n}else this._skillDescTexts[i].text=""},i.prototype._changeCurLevel=function(t){var e=this._cardObj.getLevelObj(t);if(e){this._curCardViewLevel=t;for(var i=1;5>=i;i++){this.contentPane.getChild("btnLevel"+i).asButton.selected=!1;var r=null!=this._cardObj.getLevelObj(i);this.contentPane.getChild("btnLevel"+i).asButton.enabled=r,util.setObjGray(this.contentPane.getChild("levelTxt"+i),!r)}this.contentPane.getChild("btnLevel"+e.level).asButton.selected=!0;var n=this.contentPane.getChild("curLevelImg");n.y=this.contentPane.getChild("btnLevel"+this._cardObj.level).asButton.y+11,this._updateCardInfo(e),this._updateLevelText(e)}},i.prototype._onClose=function(){this.touchable=!1,Core.ViewManager.inst.closeView(this)},i.prototype.playUplevelEffect=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n,o,s,a,u,h=this;return __generator(this,function(l){switch(l.label){case 0:if(Home.FunctionMgr.inst.isWorldWarOpen()&&this._typeCtrl.setSelectedPage("pvp"),t=this._cardObj.getLevelObj(this._cardObj.level),e=this._cardObj.getLevelObj(this._cardObj.level-1),!e)return[2];if(SoundMgr.inst.playSoundAsync("levelup_mp3"),(t.leftNum!=e.leftNum||t.leftNumOffset!=e.leftNumOffset)&&this._card.getChild("leftNum").asCom.getTransition("blink").play(),(t.rightNum!=e.rightNum||t.rightNumOffset!=e.rightNumOffset)&&this._card.getChild("rightNum").asCom.getTransition("blink").play(),(t.upNum!=e.upNum||t.upNumOffset!=e.upNumOffset)&&this._card.getChild("upNum").asCom.getTransition("blink").play(),(t.downNum!=e.downNum||t.downNumOffset!=e.downNumOffset)&&this._card.getChild("downNum").asCom.getTransition("blink").play(),i=t.skillIds,r=e.skillIds,n=1,this.contentPane.getChild("skillDescBg1").asGraph.visible=!0,this.contentPane.getChild("skillDescBg2").asGraph.visible=!0,this.contentPane.getChild("skillDescBg3").asGraph.visible=!0,i)for(o=0;o<i.length;o++)if(s=Data.skill.get(i[o]),s&&s.name){if(a=!1,r)for(u=0;u<r.length;u++)r[u]==i[o]&&(a=!0);a||this.contentPane.getTransition("skill"+n+"blink").play(),n++}return[4,new Promise(function(t){h.contentPane.getChild("btnLevel"+h._cardObj.level).asCom.getTransition("blink").play(t)})];case 1:return l.sent(),[4,new Promise(function(t){LanguageMgr.inst.isChineseLocale()?h.contentPane.getTransition("levelupTip").play(t):h.contentPane.getTransition("levelupTip2").play(t)})];case 2:return l.sent(),[2]}})})},i}(Core.BaseWindow);t.CardInfoWnd=e,__reflect(e.prototype,"CardPool.CardInfoWnd")}(CardPool||(CardPool={}));var Collection;!function(t){function e(e){return null===e?"COLLECTION_NULL":t.isUndefined(e)?"COLLECTION_UNDEFINED":t.isString(e)?"$s"+e:"$o"+e.toString()}t.defaultDictionaryToString=e;var i=function(){function i(t){this.table={},this.nElements=0,this.toStr=t||e}return i.prototype.getValue=function(e){var i=this.table["$"+this.toStr(e)];if(!t.isUndefined(i))return i.value},i.prototype.setValue=function(e,i){if(!t.isUndefined(e)&&!t.isUndefined(i)){var r,n="$"+this.toStr(e),o=this.table[n];return t.isUndefined(o)?(this.nElements++,r=void 0):r=o.value,this.table[n]={key:e,value:i},r}},i.prototype.remove=function(e){var i="$"+this.toStr(e),r=this.table[i];return t.isUndefined(r)?void 0:(delete this.table[i],this.nElements--,r.value)},i.prototype.keys=function(){var e=[];for(var i in this.table)if(t.has(this.table,i)){var r=this.table[i];e.push(r.key)}return e},i.prototype.values=function(){var e=[];for(var i in this.table)if(t.has(this.table,i)){var r=this.table[i];e.push(r.value)}return e},i.prototype.forEach=function(e){for(var i in this.table)if(t.has(this.table,i)){var r=this.table[i],n=e(r.key,r.value);if(n===!1)return}},i.prototype.containsKey=function(e){return!t.isUndefined(this.getValue(e))},i.prototype.clear=function(){this.table={},this.nElements=0},i.prototype.size=function(){return this.nElements},i.prototype.isEmpty=function(){return this.nElements<=0},i.prototype.toString=function(){var t="{";return this.forEach(function(e,i){t+="\n	"+e+" : "+i}),t+"\n}"},i}();t.Dictionary=i,__reflect(i.prototype,"Collection.Dictionary")}(Collection||(Collection={}));var UI;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._starImgs=[];for(var i=1;5>=i;++i){var r=this.getChild("star"+i);r&&this._starImgs.push(r.asLoader)}},e.prototype.setRare=function(t){t>CardQuality.BOOM&&(t=CardQuality.BOOM);for(var e=[],i=0;t>i;i++)this._starImgs[i].visible=!0,e.push(this._starImgs[i]);for(var r=t;r<this._starImgs.length;r++)this._starImgs[r].visible=!1;var n=e[0].width,o=e.length,s=1,a=(this.width-(o*n+(o-1)*s))/2;e.forEach(function(t){t.x=a,a+=n+s})},e}(fairygui.GComponent);t.CardRareCom=e,__reflect(e.prototype,"UI.CardRareCom");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._cardObjWatchers=new Collection.Dictionary,this._cardImg=this.getChild("cardImg").asImage,this._baseImg=this.getChild("baseImg").asLoader,this._frontImg=this.getChild("frontImg").asLoader,this._nameText=this.getChild("nameText").asTextField,this._nameText.textParser=Core.StringUtils.parseColorText,this._nameImg=this.getChild("nameImg").asLoader,this._imgUrl=null,this._skill1Text=this.getChild("skill1Text").asTextField,this._skill1Text.textParser=Core.StringUtils.parseColorText,this._skill1Bottom=this.getChild("skill1Bottom").asLoader,this._skill2Text=this.getChild("skill2Text").asTextField,this._skill2Text.textParser=Core.StringUtils.parseColorText,this._skill2Bottom=this.getChild("skill2Bottom").asLoader,this._skill3Text=this.getChild("skill3Text").asTextField,this._skill3Text.textParser=Core.StringUtils.parseColorText,this._skill3Bottom=this.getChild("skill3Bottom").asLoader,this._skill4Text=this.getChild("skill4Text").asTextField,this._skill4Text.textParser=Core.StringUtils.parseColorText,this._skill4Bottom=this.getChild("skill4Bottom").asLoader;var i=this.getChild("skillGroup").asGroup;this._skillStartPos=i.x,this._skillStartPosY=i.y,this._skillAreaWidth=i.width,this._skillAreaHeight=i.height,this._skillUnitWidth=this._skill1Bottom.width,this._skillUnitHeight=this._skill1Bottom.height;var r=this.getChild("equipBtn");r&&(this._equipBtn=r.asButton,this._equipBtn.visible=Home.FunctionMgr.inst.isEquipOpen()),this._upNum=this.getChild("upNum").asCom,this._downNum=this.getChild("downNum").asCom,this._downNum.getChild("img").asLoader.rotation=180,this._leftNum=this.getChild("leftNum").asCom,this._leftNum.getChild("img").asLoader.rotation=-90,this._rightNum=this.getChild("rightNum").asCom,this._rightNum.getChild("img").asLoader.rotation=90,this._upNumOffset=this.getChild("upNumOffset").asTextField,this._downNumOffset=this.getChild("downNumOffset").asTextField,this._leftNumOffset=this.getChild("leftNumOffset").asTextField,this._rightNumOffset=this.getChild("rightNumOffset").asTextField;var n=this.getChild("lightCircle");n&&(this._lightCircle=n.asLoader,this._lightCircle.visible=!1),this._skill1Text.visible=!1,this._skill1Bottom.visible=!1,this._skill2Text.visible=!1,this._skill2Bottom.visible=!1,this._skill3Text.visible=!1,this._skill3Bottom.visible=!1,this._skill4Text.visible=!1,this._skill4Bottom.visible=!1,this._nameText.visible=!1,this._upNum.visible=!1,this._downNum.visible=!1,this._leftNum.visible=!1,this._rightNum.visible=!1,this._upNumOffset.visible=!1,this._downNumOffset.visible=!1,this._leftNumOffset.visible=!1,this._rightNumOffset.visible=!1,this.getChild("rareCom")?(this._rareCom=this.getChild("rareCom").asCom,this._rareCom.visible=!1):this._rareCom=null,this._isBriefMode=!1,this._isQualityMode=!1,LanguageMgr.inst.isChineseLocale()||this._adjustWidgetByLocale()},Object.defineProperty(i.prototype,"cardObj",{get:function(){return this._cardObj},set:function(t){this._cardObj=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"inHandPoint",{get:function(){return this._inHandPoint},set:function(t){this._inHandPoint=t},enumerable:!0,configurable:!0}),i.prototype._getFrontUrl=function(){var t=this._cardObj.rare;return"smallCard"==this.packageItem.name?"cards_deck_s"+t+"_png":"cards_deck_m"+t+"_png"},i.prototype._getNameImgUrl=function(){var t=this._cardObj.rare;return t==CardQuality.LIMITED?"smallCard"==this.packageItem.name?"cards_name_s_ex_png":"cards_name_m_ex_png":"smallCard"==this.packageItem.name?"cards_name_s_png":"cards_name_m_png"},i.prototype._setNameStyle=function(){this._nameImg.url=this._getNameImgUrl()},i.prototype.setOppFront=function(){this._frontImg.visible=!0,this._frontImg.url=this._getFrontUrl(),this._nameImg.visible=!0,this._setNameStyle()},i.prototype.setOwnFront=function(){this._frontImg.visible=!0,this._frontImg.url=this._getFrontUrl(),this._nameImg.visible=!0,this._setNameStyle()},i.prototype.setOwnLockFront=function(){this._frontImg.visible=!0,this._frontImg.url=this._getFrontUrl(),this._nameImg.visible=!0,this._setNameStyle()},i.prototype.setOppBackground=function(){var t=this._cardObj.rare;Home.FunctionMgr.inst.isEquipOpen()&&(this._equipBtn.getChild("bg").asLoader.url="equip_equipWndEnemy_png");var e=function(e){return t==CardQuality.LIMITED?"cards_base2_"+e+"_ex_png":"cards_base2_"+e+"_png"};"smallCard"==this.packageItem.name?this._baseImg.url=e("s"):"middleCard"==this.packageItem.name?this._baseImg.url=e("m"):"middleCardBig"==this.packageItem.name?this._baseImg.url=e("b"):"bigCard"==this.packageItem.name&&(this._baseImg.url=e("b"))},i.prototype.setOwnBackground=function(){var t=this._cardObj.rare;Home.FunctionMgr.inst.isEquipOpen()&&(this._equipBtn.getChild("bg").asLoader.url="equip_equipWnd_png");var e=function(e){return t==CardQuality.LIMITED?"cards_base1_"+e+"_ex_png":"cards_base1_"+e+"_png"};"smallCard"==this.packageItem.name?this._baseImg.url=e("s"):"middleCard"==this.packageItem.name?this._baseImg.url=e("m"):"middleCardBig"==this.packageItem.name?this._baseImg.url=e("b"):"bigCard"==this.packageItem.name&&(this._baseImg.url=e("b"))},i.prototype.setDeskFront=function(){this._frontImg.visible=!0,this._frontImg.url=this._getFrontUrl(),this._nameImg.visible=!0,this._setNameStyle()},i.prototype.setDeskBackground=function(){var t=this._cardObj.rare,e=function(e){return t==CardQuality.LIMITED?"cards_back_"+e+"_ex_png":"cards_back_"+e+"_png"};"smallCard"==this.packageItem.name?this._baseImg.url=e("s"):"middleCard"==this.packageItem.name?this._baseImg.url=e("m"):this._baseImg.url=e("b")},i.prototype.setBriefMode=function(t){this._frontImg.visible=t,this._frontImg.url=this._getFrontUrl(),this._nameImg.visible=t,this._setNameStyle(),this._skill1Text.visible=!t,this._skill1Bottom.visible=!t,this._skill2Text.visible=!t,this._skill2Bottom.visible=!t,this._skill3Text.visible=!t,this._skill3Bottom.visible=!t,this._skill4Text.visible=!t,this._skill4Bottom.visible=!t,this._isBriefMode=t},i.prototype.setQualityMode=function(t){this.setBriefMode(t),this.setNumText(!t),this.setNumOffsetText(!t),this.visibleRareStars(t),this._isQualityMode=t},i.prototype.hideFront=function(){this._frontImg.visible=!1,this._nameImg.visible=!1},i.prototype.setCardImg=function(e){void 0===e&&(e=!1);var i=this._cardImg,r=null;"smallCard"==this.packageItem.name?r="m":"middleCard"==this.packageItem.name?r="m":"middleCardBig"==this.packageItem.name?r="b":"bigCard"==this.packageItem.name&&(r="b");var n=i.width,o=i.height,s=this;t.CardImgTextureMgr.inst.fetchTexture(this._cardObj.icon,this._cardObj.skin,e?"u":r,function(t,e,r){s._cardObj.icon==t&&(i.texture=e,i.width=n,i.height=o,s._imgUrl=r)}),this._cardImg.blendMode=egret.BlendMode.NORMAL},i.prototype.setEquip=function(){this._equipBtn&&Home.FunctionMgr.inst.isEquipOpen()&&(this._cardObj.equip&&""!=this._cardObj.equip?(this._equipBtn.visible=!0,this._equipBtn.getChild("icon").asLoader.url=Equip.EquipMgr.inst.getEquipData(this._cardObj.equip).equipIconSmall):(this._equipBtn.visible=!1,this._equipBtn.icon=""))},i.prototype.showEquipBtn=function(t){this._equipBtn&&Home.FunctionMgr.inst.isEquipOpen()&&(this._equipBtn.visible=t)},i.prototype.unloadCardImg=function(){this._imgUrl&&(RES.destroyRes(this._imgUrl),this._imgUrl=void 0,this._cardImg&&this._cardImg.texture&&(this._cardImg.texture.dispose(),this._cardImg.texture=null))},i.prototype.setLockCardImg=function(){this.setCardImg(!0),this._nameText.text="?"},i.prototype.setBackImg=function(t){var e=this;void 0===t&&(t="cards_opponent2_s_png");var i=this._cardImg.width,r=this._cardImg.height;RES.getResAsync(t).then(function(t){e._cardImg.texture=t,e._cardImg.width=i,e._cardImg.height=r})},i.prototype.setOwnBackImg=function(){this.setBackImg("cards_opponent1_s_png")},i.prototype.setWhile=function(){this._blackMask&&this._blackMask.parent&&this._blackMask.removeFromParent(),this._cardImg.filters=[],this._baseImg.filters=[]},i.prototype.setGrey=function(){this._blackMask&&this._blackMask.parent&&this._blackMask.removeFromParent();var t=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],e=new egret.ColorMatrixFilter(t);this._cardImg.filters=[e]},i.prototype.setBlack=function(){this._cardImg.filters=[],this._baseImg.filters=[],this._blackMask||(this._blackMask=new fairygui.GGraph,this._blackMask.width=this.width,this._blackMask.height=this.height,this._blackMask.drawRect(0,Core.TextColors.black,0,Core.TextColors.black,.5,[7])),this._blackMask.parent||this.addChild(this._blackMask)},i.prototype.setNumText=function(t){void 0===t&&(t=!0),this._isQualityMode&&(t=!1),t&&(this._upNum.getChild("value").asTextField.text=this._cardObj.upNum.toString(),this._downNum.getChild("value").asTextField.text=this._cardObj.downNum.toString(),this._leftNum.getChild("value").asTextField.text=this._cardObj.leftNum.toString(),this._rightNum.getChild("value").asTextField.text=this._cardObj.rightNum.toString()),this._upNum.visible=t,this._downNum.visible=t,this._leftNum.visible=t,this._rightNum.visible=t},i.prototype._setOneNumOffsetText=function(t,e,i){t.visible=!0,0>=e?t.visible=!1:1==e?t.text="+":i?t.text=e+"+":t.text="+"+e},i.prototype.setNumOffsetText=function(t){void 0===t&&(t=!0),this._isQualityMode&&(t=!1),t?(this._setOneNumOffsetText(this._upNumOffset,this._cardObj.upNumOffset,!1),this._setOneNumOffsetText(this._downNumOffset,this._cardObj.downNumOffset,!1),this._setOneNumOffsetText(this._leftNumOffset,this._cardObj.leftNumOffset,!1),this._setOneNumOffsetText(this._rightNumOffset,this._cardObj.rightNumOffset,!0)):(this._upNumOffset.visible=!1,this._downNumOffset.visible=!1,this._leftNumOffset.visible=!1,this._rightNumOffset.visible=!1)},i.prototype.setName=function(){if(this._nameText.visible=!0,this._nameText.text=this._cardObj.name,this._nameImg.visible=!0,!LanguageMgr.inst.isChineseLocale()){var t=this.getChild("levelFlagWnd");if(t){var e=t.asLoader;e.visible=!0,e.alpha=1;var i=this._cardObj.gcardId,r=Data.pool.get(i),n=r.level,o=this._cardObj.rare;o==CardQuality.LIMITED?e.url="cards_levelFlagLimited_png":e.url="cards_levelFlag"+n+"_png"}}},i.prototype.hideName=function(){this._nameText.visible=!1,this._nameImg.visible=!1},i.prototype.setSkill=function(){this.setSkillByName(this._cardObj.skill1Name,this._cardObj.skill2Name,this._cardObj.skill3Name,this._cardObj.skill4Name)},i.prototype.hideSkill=function(){this._skill1Text.visible=!1,this._skill1Bottom.visible=!1,this._skill2Text.visible=!1,this._skill2Bottom.visible=!1,this._skill3Text.visible=!1,this._skill3Bottom.visible=!1,this._skill4Text.visible=!1,this._skill4Bottom.visible=!1},i.prototype._adjustWidgetByLocale=function(){if(!LanguageMgr.inst.isChineseLocale()){var t=.65;if(this._skill1Bottom.alpha=t,this._skill2Bottom.alpha=t,this._skill3Bottom.alpha=t,this._skill4Bottom.alpha=t,"smallCard"==this.packageItem.name){this._skill1Bottom.setSize(44,18),this._skill2Bottom.setSize(44,18),this._skill3Bottom.setSize(44,18),this._skill4Bottom.setSize(44,18),this._skill1Bottom.setXY(22,21),this._skill2Bottom.setXY(22,40),this._skill3Bottom.setXY(22,59),this._skill4Bottom.setXY(22,78),this._skill1Text.fontSize=8,this._skill2Text.fontSize=8,this._skill3Text.fontSize=8,this._skill4Text.fontSize=8;
var e=this.getChild("skillGroup").asGroup;e.x=22,e.y=21,e.width=44,e.height=75,this._skillStartPos=e.x,this._skillStartPosY=e.y,this._skillAreaWidth=e.width,this._skillAreaHeight=e.height,this._skillUnitWidth=this._skill1Bottom.width,this._skillUnitHeight=this._skill1Bottom.height,this._nameImg.visible=!1,this._nameImg.alpha=0,this._nameText.visible=!1,this._nameText.alpha=0}else if("middleCard"==this.packageItem.name){this._skill1Bottom.setSize(66,20),this._skill2Bottom.setSize(66,20),this._skill3Bottom.setSize(66,20),this._skill4Bottom.setSize(66,20),this._skill1Bottom.setXY(29,49),this._skill2Bottom.setXY(29,71),this._skill3Bottom.setXY(29,93),this._skill4Bottom.setXY(29,115),this._skill1Text.fontSize=10,this._skill2Text.fontSize=10,this._skill3Text.fontSize=10,this._skill4Text.fontSize=10;var e=this.getChild("skillGroup").asGroup;e.x=29,e.y=49,e.width=66,e.height=86,this._skillStartPos=e.x,this._skillStartPosY=e.y,this._skillAreaWidth=e.width,this._skillAreaHeight=e.height,this._skillUnitWidth=this._skill1Bottom.width,this._skillUnitHeight=this._skill1Bottom.height,this._nameImg.visible=!1,this._nameImg.alpha=0,this._nameText.visible=!1,this._nameText.alpha=0}else"middleCardBig"==this.packageItem.name&&(this._skill1Bottom.alpha=0,this._skill2Bottom.alpha=0,this._skill3Bottom.alpha=0,this._skill4Bottom.alpha=0,this._skill1Text.alpha=0,this._skill2Text.alpha=0,this._skill3Text.alpha=0,this._skill4Text.alpha=0,this._nameImg.visible=!0,this._nameImg.alpha=1,this._nameText.visible=!0,this._nameText.alpha=1,this._nameImg.setXY(39,171),this._nameImg.setSize(114,30),this._nameText.setXY(39,171),this._nameText.setSize(114,30),this._nameText.autoSize=fairygui.AutoSizeType.Shrink)}},i.prototype._filterSkillNameByLocale=function(t){return LanguageMgr.inst.isChineseLocale()?t:t},i.prototype.setSkillByName=function(t,e,i,r){var n=this;if(!this._isBriefMode){var o=0,s=function(t,e,i){t.visible=i,e.visible=i},a=function(t,e,i){i&&""!=i?(o+=1,t.text=n._filterSkillNameByLocale(i),s(t,e,!0)):s(t,e,!1)},u=function(t,e,i){t.x=Math.round(e),isNaN(i)||(t.y=Math.round(i))};if(a(this._skill1Text,this._skill1Bottom,t),a(this._skill2Text,this._skill2Bottom,e),a(this._skill3Text,this._skill3Bottom,i),a(this._skill4Text,this._skill4Bottom,r),1==o){var h=0,l=0/0;LanguageMgr.inst.isChineseLocale()?h=(this._skillAreaWidth-this._skillUnitWidth)/2+this._skillStartPos:(h=this._skillStartPos,l=this._skillStartPosY+this._skillAreaHeight-this._skillUnitHeight),u(this._skill1Bottom,h,l)}else if(2==o)if(LanguageMgr.inst.isChineseLocale()){var c=(this._skillAreaWidth-2*this._skillUnitWidth)/3;u(this._skill1Bottom,c+this._skillStartPos),u(this._skill2Bottom,2*c+this._skillUnitWidth+this._skillStartPos)}else{var d=(this._skillAreaHeight-4*this._skillUnitHeight)/3,h=this._skillStartPos,l=this._skillStartPosY+2*(this._skillUnitHeight+d);u(this._skill1Bottom,h,l),u(this._skill2Bottom,h,l+this._skillUnitHeight+d)}else if(3==o)if(LanguageMgr.inst.isChineseLocale()){var c=(this._skillAreaWidth-3*this._skillUnitWidth)/4;u(this._skill1Bottom,c+this._skillStartPos),u(this._skill2Bottom,2*c+this._skillUnitWidth+this._skillStartPos),u(this._skill3Bottom,3*c+2*this._skillUnitWidth+this._skillStartPos)}else{var d=(this._skillAreaHeight-4*this._skillUnitHeight)/3,h=this._skillStartPos,l=this._skillStartPosY+(this._skillUnitHeight+d);u(this._skill1Bottom,h,l),u(this._skill2Bottom,h,l+d+this._skillUnitHeight),u(this._skill3Bottom,h,l+2*(d+this._skillUnitHeight))}else if(4==o)if(LanguageMgr.inst.isChineseLocale()){var c=(this._skillAreaWidth-4*this._skillUnitWidth)/5;u(this._skill1Bottom,c+this._skillStartPos),u(this._skill2Bottom,2*c+this._skillUnitWidth+this._skillStartPos),u(this._skill3Bottom,3*c+2*this._skillUnitWidth+this._skillStartPos),u(this._skill4Bottom,4*c+3*this._skillUnitWidth+this._skillStartPos)}else{var d=(this._skillAreaHeight-4*this._skillUnitHeight)/3,h=this._skillStartPos,l=this._skillStartPosY;u(this._skill1Bottom,h,l),u(this._skill2Bottom,h,l+d+this._skillUnitHeight),u(this._skill3Bottom,h,l+2*(d+this._skillUnitHeight)),u(this._skill4Bottom,h,l+3*(d+this._skillUnitHeight))}}},i.prototype.setLockNameAndSkill=function(t){this._nameText.visible=t,this._nameText.text=this._cardObj.name,this._skill1Text.visible=!t,this._skill1Bottom.visible=!t,this._skill2Text.visible=!t,this._skill2Bottom.visible=!t,this._skill3Text.visible=!t,this._skill3Bottom.visible=!t,this._skill4Text.visible=!t,this._skill4Bottom.visible=!t},i.prototype.visibleLightCircle=function(t){this._lightCircle&&(this._lightCircle.visible=t)},i.prototype.visibleRareStars=function(t){this._rareCom&&(this._rareCom.visible=t,this._rareCom.setRare(this._cardObj.rare))},i.prototype.watchProp=function(t,e,i){var r=this._cardObj.collectCard;r&&(this._cardObjWatchers.containsKey(t)||this._cardObjWatchers.setValue(t,Core.Binding.bindHandler(r,[t],e,i)))},i.prototype.unwatchProp=function(t){var e=this._cardObjWatchers.getValue(t);e&&(e.unwatch(),this._cardObjWatchers.remove(t))},i.prototype.watchLevel=function(){this.watchProp(CardPool.Card.PropLevel,this._onPropLevelChange,this)},i.prototype._onPropLevelChange=function(){this.setName(),this.setSkill(),this.setNumText(),this.setNumOffsetText()},i.prototype.unwatchLevel=function(){this.unwatchProp(CardPool.Card.PropLevel)},i.prototype.watchSkin=function(){this.watchProp(CardPool.Card.PropSkin,this._onPropSkinChange,this)},i.prototype._onPropSkinChange=function(){this.setCardImg()},i.prototype.unwatchSkin=function(){this.unwatchProp(CardPool.Card.PropSkin)},i.prototype.watchEquip=function(){this.watchProp(CardPool.Card.PropEquip,this._onPropEquipChange,this)},i.prototype.unwatchEquip=function(){this.unwatchProp(CardPool.Card.PropEquip)},i.prototype._onPropEquipChange=function(){this.setEquip()},i.prototype.watch=function(){this.watchLevel(),this.watchSkin(),this.watchEquip()},i.prototype.unwatch=function(){this.unwatchLevel(),this.unwatchSkin(),this.unwatchEquip()},i}(fairygui.GComponent);t.CardCom=i,__reflect(i.prototype,"UI.CardCom",["UI.IHandItem"])}(UI||(UI={}));var UI;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this.getChild("levelUpHint").asLoader.visible=!1,this.getChild("levelUpHint2").asLoader.visible=!1,this.getChild("newHint").asLoader.visible=!1},i.prototype.setData=function(t,e,i){this.cardObj=t,this._needEnergyProgress=e,this._needExpProgress=i,this._refreshState()},Object.defineProperty(i.prototype,"selected",{get:function(){return this._selected},set:function(t){this.displayObject.cacheAsBitmap=!1,this.setSelected(t),this.displayObject.cacheAsBitmap=!0},enumerable:!0,configurable:!0}),i.prototype.watch=function(){this._refreshExecutor&&(this._refreshExecutor.execute(),this._refreshExecutor=null),this._card.watchProp(CardPool.Card.PropLevel,this._onPropLevelChange,this),this.watchAmount(),this._needEnergyProgress&&this.watchEnergy(),this._card.watchProp(CardPool.Card.PropState,this._refreshState,this),this._card.watchSkin(),this._card.watchEquip()},i.prototype._onPropAmountChange=function(){this.displayObject.cacheAsBitmap=!1,e.prototype._onPropAmountChange.call(this),this.displayObject.cacheAsBitmap=!0},i.prototype._onPropEnergyChange=function(){this.displayObject.cacheAsBitmap=!1,e.prototype._onPropEnergyChange.call(this),this.displayObject.cacheAsBitmap=!0},i.prototype._onPropLevelChange=function(){this.displayObject.cacheAsBitmap=!1,this._card.setName(),this._card.setSkill(),this._card.setNumText(),this._card.setNumOffsetText(),this.displayObject.cacheAsBitmap=!0},i.prototype.unwatch=function(){this.unwatchLevel(),this.unwatchAmount(),this._needEnergyProgress&&this.unwatchEnergy(),this._card.unwatchProp(CardPool.Card.PropState),this._card.unwatchSkin(),this._card.unwatchEquip()},i.prototype._frameSetNormalSkin=function(){this.displayObject.cacheAsBitmap=!1,this._card.setCardImg(),this._card.setEquip(),this.visibleEnergyProgress(this._needEnergyProgress),this.setProgress()},i.prototype._frameSetStateSkin=function(){this.displayObject.cacheAsBitmap=!1,this._cardObj.state==CardPool.CardState.Dead?this._card.setGrey():this.state==t.BaseCardItem.NormalState?this._card.setWhile():this._card.setBlack(),this.displayObject.cacheAsBitmap=!0},i.prototype._frameSetNameAndSkill=function(){this.displayObject.cacheAsBitmap=!1,this._card.setName(),this._card.setSkill()},i.prototype._frameSetNumText=function(){this.displayObject.cacheAsBitmap=!1,this._card.setNumText()},i.prototype._frameSetNumOffsetText=function(){this.displayObject.cacheAsBitmap=!1,this._card.setNumOffsetText()},i.prototype._frameRefreshState=function(){this._refreshExecutor=new Core.FrameExecutor,this._refreshExecutor.regist(this._frameSetNormalSkin,this),this._refreshExecutor.regist(this._frameSetNameAndSkill,this),this._refreshExecutor.regist(this._frameSetNumText,this),this._refreshExecutor.regist(this._frameSetNumOffsetText,this),this._refreshExecutor.regist(this._frameSetStateSkin,this),this._refreshExecutor.execute()},i.prototype._refreshState=function(){this.displayObject.cacheAsBitmap=!1,this._card.setNumText(),this._card.setNumOffsetText(),this._card.setCardImg(),this._card.setEquip(),this._card.setName(),this._card.setSkill(),this._card.setOwnFront(),this._card.setDeskBackground(),this.visibleEnergyProgress(this._needEnergyProgress),this.visibleExpProgress(this._needExpProgress),this._expProgressBar.visible=!0,this.setProgress(),this._cardObj.state==CardPool.CardState.Dead?this._card.setGrey():this.state==t.BaseCardItem.NormalState?this._card.setWhile():this._card.setBlack(),this.displayObject.cacheAsBitmap=!0},i}(t.BaseCardItem);t.ChoiceCardItem=e,__reflect(e.prototype,"UI.ChoiceCardItem")}(UI||(UI={}));var Core;!function(t){function e(t){console.log("callJS:"+t);var e=JSON.parse(t),i=e.msg,r=n.inst.getListeners(i);r&&r.forEach(function(t,i){t.callback&&(t.thisArg?t.callback.apply(t.thisArg,[e.args]):t.callback(e.args),t.resolve&&t.resolve(e.args))})}t.callJS=e;var i=function(){function t(){}return t.INIT_SDK="initSDK",t.INIT_SDK_DONE="initSDKDone",t.LOGIN="login",t.LOGIN_DONE="loginDone",t.ON_START="onStart",t.ON_STOP="onStop",t.USE_NATIVE_SOUND="useNativeSound",t.PLAY_SOUND="playSound",t.PLAY_MUSIC="playMusic",t.STOP_MUSIC="stopMusic",t.SET_MUSIC_VOLUME="setMusicVolume",t.ON_ENTER_GAME="onEnterGame",t.ON_CREATE_ROLE="onCreateRole",t.ON_LEVEL_UP="onLevelUp",t.GET_TD_CHANNEL_ID="getTDChannelID",t.START_RECORD="startRecord",t.STOP_RECORD="stopRecord",t.START_RECORD_COMPLETE="startRecordComplete",t.ADS_INIT="initAds",t.ADS_SHOW_RWD="showRwdAds",t.ADS_FINISH_RWD="finishRwdAds",t.ADS_IS_READY="adsIsReady",t.ADS_READY="adsReady",t.ON_START_MATCH="onStartMatch",t.SAVE_TO_PHOTO="saveToPhoto",t.SHARE_VIDEO="shareVideo",t.SHARE_LINK="shareLink",t.SHARE_LINK_COMPLETE="shareLinkComplete",t.INIT_APPSTORE_PAY="initAppstorePay",t.APPSTORE_REQ_PRODUCTS="appstoreRequestProducts",t.APPSTORE_GET_PRODUCTS="appstoreGetProducts",t.START_PAY="startPay",t.FINISH_PAY="finishPay",t.SET_SUPPORT_RECORD="setSupportRecord",t.OPEN_APP_COMMENT="openAppComment",t.ON_SHOW_LOADING="onShowLoading",t.SHARE_APP2WECHAT="shareApp2Wechat",t.SHARE_APP2WECHATTIMELINE="shareApp2Wechat",t.LOGIN_GAME_CENTER="loginGameCenter",t.SCORE_TO_GAME_CENTER="scoreToGameCenter",t.SHOW_GAME_CENTER_RANK="showGameCenterRank",t.CREATE_NOTIFY="createNotify",t.REMOVE_NOTIFY="removeNotify",t.SET_LOADING_PERCENT="setLoadingPercent",t.GOOGLEPLAY_REQ_PRODUCTS="googleplayReqProducts",t.GOOGLEPLAY_GET_PRODUCTS="googleplayGetProducts",t.TD_ACCOUNT="td_Account",t.TD_ONPAGELEAVE="td_onPageLeave",t.TD_ONMISSIONBEGIN="td_onMissionBegin",t.TD_ONMISSIONCOMPLETED="td_onMissionCompleted",t.TD_ONMISSIONFAILED="td_onMissionFailed",t.TD_ONITEMPURCHASE="td_onItemPurchase",t.TD_ONITEMUSE="td_onItemUse",t.TD_ONEVENT="td_onEvent",t.TD_SETLEVEL="td_setLevel",t.GET_LOCALE="getLocale",t.APPSTORE_CHECK_VERSION="appStoreCheckVersion",t}();t.NativeMessage=i,__reflect(i.prototype,"Core.NativeMessage");var r=function(){function t(){}return t}();t.ListenerItem=r,__reflect(r.prototype,"Core.ListenerItem");var n=function(){function e(){this._listeners=new Collection.Dictionary,egret.ExternalInterface.addCallback("callJS",t.callJS)}return Object.defineProperty(e,"inst",{get:function(){return e._inst||(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),e.prototype.getListeners=function(t){return this._listeners.getValue(t)},e.prototype.addListener=function(t,e,i){var n=new r;n.callback=e,n.thisArg=i,n.resolve=null,this._listeners.containsKey(t)||this._listeners.setValue(t,new Collection.Dictionary);var o=this._listeners.getValue(t);return o.setValue(n,!0),n},e.prototype.removeListener=function(t,e,i){var r=this._listeners.getValue(t);if(r){var n=Array();r.forEach(function(t,r){t.callback==e&&t.thisArg==i&&n.push(t)}),n.forEach(function(t){r.remove(t)})}},e.prototype.callNative=function(t,e){void 0===e&&(e={});var i={msg:t,args:e},r=JSON.stringify(i);egret.ExternalInterface.call("callNative",r);try{null!=callNative&&callNative(r)}catch(n){console.error("callNative error ",n)}},e.prototype._waitMessageCallback=function(t){},e.prototype.sendAndWaitNativeMessage=function(t,e,i){return __awaiter(this,void 0,void 0,function(){var r,n,o=this;return __generator(this,function(s){switch(s.label){case 0:return r=this.addListener(e,this._waitMessageCallback,this),[4,new Promise(function(e){r.resolve=e,o.callNative(t,i)})];case 1:return n=s.sent(),this.removeListener(e,this._waitMessageCallback,this),[2,n]}})})},e._inst=null,e}();t.NativeMsgCenter=n,__reflect(n.prototype,"Core.NativeMsgCenter")}(Core||(Core={}));var Net;!function(t){var e;!function(t){t[t.MsgReq=1]="MsgReq",t[t.MsgReply=2]="MsgReply",t[t.MsgPush=3]="MsgPush",t[t.MsgErr=4]="MsgErr",t[t.MsgPing=5]="MsgPing",t[t.MsgPong=6]="MsgPong"}(e=t.MessageType||(t.MessageType={}));var i=function(){function t(){this.msgID=0,this.msgType=0,this.seq=0,this.errcode=0}return t}();t.Packet=i,__reflect(i.prototype,"Net.Packet")}(Net||(Net={}));var Net;!function(t){function e(t,e,i){var r=a.getValue(t);return null==r?void console.debug("handleRequest no handler, msgId=%d",t):void r.handle(e,i)}function i(t,e,i){0!=t&&console.debug("errcode = "+t);var r=u.remove(e);return null==r?void console.debug("late response "+e):void r.done(t,i)}function r(r){console.debug("onSocketData msgType=%d, msgID=%d, errcode=%d",r.msgType,r.msgID,r.errcode);var n;n=r.payload?r.payload.bytes:new Uint8Array(0),r.msgType==t.MessageType.MsgReq||r.msgType==t.MessageType.MsgPush?e(r.msgID,r.seq,n):i(r.errcode,r.seq,n)}function n(t,e){a.setValue(t,new l(t,e))}function o(e,i,r,n){void 0===r&&(r=!0),void 0===n&&(n=!0),r&&Core.MaskUtils.showNetMask(),h+=1;var o=new t.Packet;return o.seq=h,o.msgID=e,o.msgType=t.MessageType.MsgReq,null!=i&&(o.payload=new egret.ByteArray(i.finish())),new Promise(function(i){var s=new c(o.seq,function(t){r&&Core.MaskUtils.hideNetMask(),0!=t.errcode&&window.gameGlobal.debug&&n&&Core.TipsUtils.showTipsFromCenter("#cr"+e+" code "+t.errcode+"#n"),i(t)});u.setValue(h,s),t.SConn.inst.writePacket(o)})}function s(e,i){var r=new t.Packet;r.msgID=e,r.msgType=t.MessageType.MsgPush,null!=i&&(r.payload=new egret.ByteArray(i.finish())),t.SConn.inst.writePacket(r)}var a=new Collection.Dictionary,u=new Collection.Dictionary,h=0,l=function(){function t(t,e){this.msgId=t,this.f=e}return t.prototype.handle=function(t,e){this.f(new d(t),e)},t}();__reflect(l.prototype,"RpcHandler");var c=function(){function t(t,e){this.seq=t,this.callback=e}return t.prototype.done=function(t,e){this.callback(new p(t,e))},t}();__reflect(c.prototype,"RpcCaller");var d=function(){function e(t){this.seq=t}return e.prototype.response=function(e){var i=new t.Packet;i.msgType=t.MessageType.MsgReply,i.seq=this.seq,null!=e&&(i.payload=new egret.ByteArray(e.finish())),t.SConn.inst.writePacket(i)},e.prototype.errResponse=function(e){var i=new t.Packet;i.msgType=t.MessageType.MsgErr,i.seq=this.seq,i.errcode=e,t.SConn.inst.writePacket(i)},e.prototype.okResponse=function(){this.errResponse(0)},e}();t.RemoteProxy=d,__reflect(d.prototype,"Net.RemoteProxy");var p=function(){function t(t,e){this._errcode=t,this._payload=e}return Object.defineProperty(t.prototype,"errcode",{get:function(){return this._errcode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"payload",{get:function(){return this._payload},enumerable:!0,configurable:!0}),t}();t.RpcResult=p,__reflect(p.prototype,"Net.RpcResult"),t.onSocketData=r,t.registerRpcHandler=n,t.rpcCall=o,t.rpcPush=s}(Net||(Net={}));var Net;!function(t){var e;!function(t){t[t._RECV_PAYLOAD_LENGTH=1]="_RECV_PAYLOAD_LENGTH",t[t._RECV_PAYLOAD=2]="_RECV_PAYLOAD",t[t.SeqSize=4]="SeqSize",t[t.MsgIDSize=4]="MsgIDSize",t[t.MsgTypeSize=1]="MsgTypeSize",t[t.ErrcodeSize=4]="ErrcodeSize",t[t.PktSizeSize=4]="PktSizeSize"}(e=t.NetPacketConsts||(t.NetPacketConsts={}));var i=function(){function t(t,e){this.data=t,this.next=e}return t}();__reflect(i.prototype,"RereadData");var r=function(){function t(){this.count=0,this._head=null,this._tail=null}return t.prototype.pull=function(t){var e=0;if(this._head){var i=this._head.data;e+=i.readAvailable,i.readBytes(t,t.readAvailable),this._head=this._head.next,null==this._head&&(this._tail=null),this.count-=e}return e},t.prototype.reread=function(t,e){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(o){switch(o.label){case 0:return r=new egret.ByteArray,[4,t.readFull(r,e)];case 1:return o.sent(),n=new i(r,null),this._head?this._tail.next=n:this._head=n,this._tail=n,this.count+=r.readAvailable,[2]}})})},t}();__reflect(r.prototype,"Rereader");var n=function(){function t(){this._data=new egret.ByteArray(new ArrayBuffer(102400)),this._head=0,this._length=0}return Object.defineProperty(t.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),t.prototype.push=function(t){if(t.readAvailable>=this._data.buffer.byteLength)return t.position=t.readAvailable-this._data.buffer.byteLength,t.readBytes(this._data,0,this._data.buffer.byteLength),this._head=0,void(this._length=this._data.buffer.byteLength);var e=this._data.buffer.byteLength-this._head;e=e>t.readAvailable?t.readAvailable:e,t.readBytes(this._data,this._head,e),0==t.readAvailable?(this._head+=e,this._head==this._data.buffer.byteLength&&(this._head=0),this._length!=this._data.buffer.byteLength&&(this._length+=e)):(this._head=t.readAvailable,t.readBytes(this._data,0),this._length!=this._data.buffer.byteLength&&(this._length=this._data.buffer.byteLength))},t.prototype.rewrite=function(t,e,i){var r=e-i;if(0==r)return!0;if(0>r||r>this._length)return!1;if(r<=this._head)return t.writeBytes(new egret.ByteArray(this._data.buffer.slice(this._head-r,this._head))),!0;var n=this._head-r+this._data.buffer.byteLength;return t.writeBytes(new egret.ByteArray(this._data.buffer.slice(n))),t.writeBytes(new egret.ByteArray(this._data.buffer.slice(0,this._head))),!0},t}();__reflect(n.prototype,"Rewriter");var o=function(){function t(){this._curServerIndex=0,this._servers=null,this._message="",this._status=1}return Object.defineProperty(t.prototype,"list",{get:function(){if(this._servers)return this._servers;var t=RES.getRes("serverlist_json");return t?(this._servers=t.servers,this._status=t.status,this._message=t.message):this._servers=[],this._servers},enumerable:!0,configurable:!0}),t.prototype.isMaintain=function(){var t=this.list,e=!t||0==t.length||0!=this._status;return[e,this._message]},t.prototype.refresh=function(){this._curServerIndex=Core.RandomUtils.randInt(this.list.length)},t.prototype.getCurServer=function(){var t=this.list;return t[this._curServerIndex%t.length]},t.prototype.getNextServer=function(){this._curServerIndex++;var t=this.list;return t[this._curServerIndex%t.length]},t}();__reflect(o.prototype,"Serverlist");var s=function(){function i(){this._closed=!0,this._init()}return Object.defineProperty(i,"inst",{get:function(){return i._inst||(i._inst=new i),i._inst},enumerable:!0,configurable:!0}),i.prototype._init=function(){this._reconnectTimes=0,this._readCount=0,this._writeCount=0,this._rereader=new r,this._rewriter=new n,this._recvBuf=new egret.ByteArray,this._recvStatus=e._RECV_PAYLOAD_LENGTH,this._recvPayloadLen=0,this._sendBuf=new egret.ByteArray(new ArrayBuffer(1048576)),this._sendBuf.position=e.PktSizeSize,this._serverlist=new o},i.prototype.isMaintain=function(){return this._serverlist.isMaintain()},i.prototype.setAddress=function(t,e){this._host||(this._host=t,this._port=e)},i.prototype.setWssAddress=function(t,e){this._wsshost||(this._wsshost=t,this._wssport=e)},i.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(r){switch(r.label){case 0:this._serverlist.refresh(),r.label=1;case 1:this._webSocket&&(this._webSocket.close(),this._webSocket=null),r.label=2;case 2:return r.trys.push([2,4,,6]),[4,this.dial(this._serverlist.getNextServer())];case 3:return r.sent(),[3,6];case 4:return t=r.sent(),console.error("connect dial ",t),[4,fairygui.GTimers.inst.waitTime(700)];case 5:return r.sent(),[3,1];case 6:e=new egret.ByteArray(new ArrayBuffer(12)),e.writeUnsignedInt(0),e.writeUnsignedInt(0),e.writeUnsignedInt(0),this._webSocket.writeBytes(e),e.clear(),r.label=7;case 7:return r.trys.push([7,9,,10]),[4,this._webSocket.readFull(e,4)];case 8:return r.sent(),[3,10];case 9:return i=r.sent(),console.error("connect read ",i),[3,1];case 10:return this._connID=e.readUnsignedInt(),[3,11];case 11:return[2]}})})},i.prototype.close=function(){if(!this._closed){this._closed=!0,this._webSocket&&(this._webSocket.close(),this._webSocket=null);var t=new i;t.setAddress(this._host,this._port),i._inst=t}},i.prototype.closeWebSocket=function(){this._webSocket&&this._webSocket.close()},i.prototype.start=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._closed?(this._closed=!1,[4,this.connect()]):[2];case 1:return t.sent(),this.readLoop(),[2]}})})},i.prototype.connectServer=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return t.SConn.inst.setAddress(window.gameGlobal.serverHost,window.gameGlobal.serverPort),t.SConn.inst.setWssAddress(window.gameGlobal.serverHost,window.gameGlobal.serverWssPort),[4,t.SConn.inst.start()];case 1:return e.sent(),[2]}})})},i.prototype.readLoop=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return this._closed?[3,8]:(t=this._rereader.pull(this._recvBuf),t>0?(this._readCount+=t,this._tryReceivePacket(),[3,0]):this._connecting?[4,this._connecting]:[3,2]);case 1:i.sent(),i.label=2;case 2:if(this._closed)return[2];i.label=3;case 3:return i.trys.push([3,5,,7]),[4,this._webSocket.read(this._recvBuf)];case 4:return t=i.sent(),[3,7];case 5:return e=i.sent(),console.error("readLoop ",e),[4,this._tryReconn()];case 6:return i.sent(),[3,0];case 7:return this._closed?[2]:(this._readCount+=t,this._tryReceivePacket(),[3,0]);case 8:return[2]}})})},i.prototype._tryReceivePacket=function(){if(this._recvStatus==e._RECV_PAYLOAD_LENGTH){if(this._recvBuf.readAvailable<e.PktSizeSize)return;this._recvPayloadLen=this._recvBuf.readUnsignedInt(),console.debug("package size %d",this._recvPayloadLen),this._recvStatus=e._RECV_PAYLOAD}var t=this._recvBuf.readAvailable;if(console.debug("package size %d, now data size %d",this._recvPayloadLen,t),!(t<this._recvPayloadLen)){var i=new egret.ByteArray;if(this._recvBuf.readBytes(i,0,this._recvPayloadLen),this._recvPayloadLen==t)this._recvBuf.clear();else{var r=new egret.ByteArray;this._recvBuf.readBytes(r,0),this._recvBuf=r}this._recvStatus=e._RECV_PAYLOAD_LENGTH,this._recvPayloadLen=0,this._onReceivePacket(i),this._tryReceivePacket()}},i.prototype._onReceivePacket=function(e){var i=e.readByte();if(console.debug("msgType %d",i),i!=t.MessageType.MsgPong&&i!=t.MessageType.MsgPing){var r=new t.Packet;if(r.msgType=i,i==t.MessageType.MsgErr)return r.errcode=e.readInt(),r.seq=e.readUnsignedInt(),void t.onSocketData(r);if(i==t.MessageType.MsgPush||i==t.MessageType.MsgReq)r.msgID=e.readInt(),i==t.MessageType.MsgReq&&(r.seq=e.readUnsignedInt());else{if(i!=t.MessageType.MsgReply)return void console.debug("error msgType %d",i);r.seq=e.readUnsignedInt()}e.readAvailable>0&&(r.payload=new egret.ByteArray,e.readBytes(r.payload,0,e.readAvailable)),t.onSocketData(r)}},i.prototype._sendPacket=function(){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(r){switch(r.label){case 0:return t=this._sendBuf.position-e.PktSizeSize,i=this._sendBuf.position,this._sendBuf.dataView.setUint32(0,t,!1),this._rewriter.push(new egret.ByteArray(this._sendBuf.buffer.slice(0,i))),this._writeCount+=i,this._webSocket.write(this._sendBuf,0,i)?[3,2]:this._closed?[2]:[4,this._tryReconn()];case 1:return r.sent(),[2];case 2:return this._sendBuf.clear(),this._sendBuf.position=e.PktSizeSize,[2]}})})},i.prototype.writePacket=function(e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return i=this._connID,this._connecting?[4,this._connecting]:[3,2];case 1:if(r.sent(),i!=this._connID)return[2];r.label=2;case 2:return this._closed?[2]:(this._sendBuf.writeByte(e.msgType),e.msgType==t.MessageType.MsgPing||e.msgType==t.MessageType.MsgPong?(this._sendPacket(),[2]):e.msgType==t.MessageType.MsgErr?(this._sendBuf.writeInt(e.errcode),this._sendBuf.writeUnsignedShort(e.seq),this._sendPacket(),[2]):(e.msgType==t.MessageType.MsgPush||e.msgType==t.MessageType.MsgReq?(this._sendBuf.writeInt(e.msgID),e.msgType==t.MessageType.MsgReq&&this._sendBuf.writeUnsignedInt(e.seq)):this._sendBuf.writeUnsignedInt(e.seq),null!=e.payload&&this._sendBuf.writeBytes(e.payload,0,e.payload.readAvailable),this._sendPacket(),[2]))}})})},i.prototype._tryReconn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._closed?[2]:this._connecting?[4,this._connecting]:[3,2];case 1:return t.sent(),[2];case 2:return this._connecting=this._doReconn(),[4,this._connecting];case 3:return t.sent(),this._connecting=null,[2]}})})},i.prototype._relogin=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._closed?[2]:[4,this.connect()];case 1:return t.sent(),this._closed?[2]:(this._init(),Core.EventCenter.inst.dispatchEventWith(Core.Event.ReLoginEv),[2])}})})},i.prototype._doReconn=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n,o,s;return __generator(this,function(a){switch(a.label){case 0:Core.MaskUtils.showNetMask(),t=new egret.ByteArray(new ArrayBuffer(12)),t.writeUnsignedInt(this._connID),t.writeUnsignedInt(this._writeCount),t.writeUnsignedInt(this._readCount+this._rereader.count),this._reconnectTimes=0,a.label=1;case 1:return this._closed?[3,20]:(this._reconnectTimes++,this._reconnectTimes>=2?[4,this._relogin()]:[3,3]);case 2:return a.sent(),[3,20];case 3:this._webSocket&&(this._webSocket.close(),this._webSocket=null),a.label=4;case 4:return a.trys.push([4,6,,8]),[4,this.dial(this._serverlist.getCurServer())];case 5:return a.sent(),[3,8];case 6:return e=a.sent(),console.error("_tryReconn dial ",e),[4,fairygui.GTimers.inst.waitTime(1e3)];case 7:return a.sent(),this._reconnectTimes--,[3,1];case 8:return this._closed?[3,20]:(i=this._webSocket.write(t))?[3,10]:(console.error("_tryReconn write 1"),[4,fairygui.GTimers.inst.waitTime(1e3)]);case 9:return a.sent(),[3,1];case 10:r=new egret.ByteArray,a.label=11;case 11:return a.trys.push([11,13,,15]),[4,this._webSocket.readFull(r,8)];case 12:return a.sent(),[3,15];case 13:return n=a.sent(),console.error("_tryReconn read1 ",n),[4,fairygui.GTimers.inst.waitTime(1e3)];case 14:return a.sent(),[3,1];case 15:return this._closed?[3,20]:(o=r.readUnsignedInt(),s=r.readUnsignedInt(),[4,this._handleReconn(o,s)]);case 16:return(i=a.sent())?(fairygui.GTimers.inst.callLater(function(){Core.EventCenter.inst.dispatchEventWith(Core.Event.ReConnectEv)},this),[3,20]):[3,17];case 17:return[4,this._relogin()];case 18:return a.sent(),[3,20];case 19:return[3,1];case 20:return Core.MaskUtils.hideNetMask(),[2]}})})},i.prototype._handleReconn=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){switch(n.label){case 0:if(t<this._readCount)return console.error("writeCount < c.readCount"),[2,!1];if(this._writeCount<e)return console.error("c.writeCount < readCount"),[2,!1];if(this._writeCount-e>this._rewriter.length)return console.error("c.writeCount - readCount > len(c.rewriter.data)"),[2,!1];if(t!=this._readCount&&(i=this._rereader.reread(this._webSocket,t-this._readCount)),this._writeCount!=e&&!this._rewriter.rewrite(this._webSocket,this._writeCount,e))return console.error("rewrite failed"),[2,!1];if(!i)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,i];case 2:return n.sent(),[3,4];case 3:return r=n.sent(),console.error("reread failed ",r),[2,!1];case 4:return[2,!0]}})})},i.prototype.dial=function(e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return[4,t.dialWebSocket(e.host,e.port,e.host,e.wssport)];case 1:return i=r.sent(),this._webSocket=i,[2]}})})},i.prototype.ping=function(){var e=new t.Packet;e.msgType=t.MessageType.MsgPing,this.writePacket(e)},i}();t.SConn=s,__reflect(s.prototype,"Net.SConn")}(Net||(Net={}));var Net;!function(t){function e(t,e,i,n){return __awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(s){switch(s.label){case 0:return o=new r,[4,o.dial(t,e,i,n)];case 1:return s.sent(),[2,o]}})})}var i;!function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.CLOSING=2]="CLOSING",t[t.CLOSED=3]="CLOSED"}(i||(i={})),t.dialWebSocket=e;var r=function(t){function e(){var e=t.call(this)||this;return e._state=i.CLOSED,e.type=egret.WebSocket.TYPE_BINARY,e._recvBuf=new egret.ByteArray,e.addEventListener(egret.Event.CONNECT,e._onConnected,e),e.addEventListener(egret.ProgressEvent.SOCKET_DATA,e._onSocketData,e),e.addEventListener(egret.IOErrorEvent.IO_ERROR,e._onIOError,e),e.addEventListener(egret.Event.CLOSE,e._onClosed,e),e}return __extends(e,t),e.prototype._onConnected=function(t){console.debug("WebSocket onConnected"),this._state=i.CONNECTED,this._conecting&&(this._conecting[0](),this._conecting=null)},e.prototype._onSocketData=function(t){if(this._reading){var e=this._reading[2],i=e.readAvailable;this._recvBuf.readAvailable>0&&this._recvBuf.readBytes(e,e.readAvailable),this.readBytes(e,e.readAvailable),this._reading[0](e.readAvailable-i),this._reading=null}else this.readBytes(this._recvBuf,this._recvBuf.readAvailable)},e.prototype._onIOError=function(t){console.error("WebSocket onIOError"),this._state=i.CLOSED,this._conecting&&(this._conecting[1]("_onIOError"),this._conecting=null),this._reading&&(this._reading[1]("_onIOError"),this._reading=null)},e.prototype._onClosed=function(t){console.error("WebSocket onClosed"),this._state=i.CLOSED,this._conecting&&(this._conecting[1]("_onClosed"),this._conecting=null),this._reading&&(this._reading[1]("_onClosed"),this._reading=null)},e.prototype.dial=function(t,e,r,n){return __awaiter(this,void 0,void 0,function(){var o=this;return __generator(this,function(s){switch(s.label){case 0:return this._state=i.CONNECTING,[4,new Promise(function(i,s){o._conecting=[i,s],Core.DeviceUtils.isWXGame()||"https:"==document.location.protocol?o.connectByUrl("wss://"+r+":"+n):o.connectByUrl("ws://"+t+":"+e)})];case 1:return s.sent(),[2]}})})},e.prototype.read=function(t){return __awaiter(this,void 0,void 0,function(){var e,r=this;return __generator(this,function(n){switch(n.label){case 0:return this._recvBuf.readAvailable>0?(e=this._recvBuf.readAvailable,this._recvBuf.readBytes(t,t.readAvailable),this._recvBuf.clear(),[2,e]):[4,new Promise(function(e,n){r._state!=i.CONNECTED&&n("read not CONNECTED"),r._reading=[e,n,t]
})];case 1:return[2,n.sent()]}})})},e.prototype.readFull=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return t.readAvailable<e?[4,this.read(t)]:[3,2];case 1:return i.sent(),[3,0];case 2:return[2]}})})},e.prototype.write=function(t,e,r){return this._state!=i.CONNECTED?!1:(this.writeBytes(t,e,r),!0)},e}(egret.WebSocket);t.WebSocket=r,__reflect(r.prototype,"Net.WebSocket")}(Net||(Net={}));var Core;!function(t){var e=function(){function t(){}return t.isHtml5=function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB},t.isNative=function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE},t.isWXGame=function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WXGAME},t.isMobile=function(){return egret.Capabilities.isMobile},t.isPC=function(){return!egret.Capabilities.isMobile},t.isAndroid=function(){return"Android"==egret.Capabilities.os},t.isiOS=function(){return"iOS"==egret.Capabilities.os},t}();t.DeviceUtils=e,__reflect(e.prototype,"Core.DeviceUtils")}(Core||(Core={}));var Core;!function(t){var e=function(){function t(t){this.x=t.stageX,this.y=t.stageY,this.lastx=this.x,this.lasty=this.y,this.id=t.touchPointID}return t.prototype.updateCoord=function(t){this.lastx=this.x,this.lasty=this.y,this.x=t.stageX,this.y=t.stageY},Object.defineProperty(t.prototype,"dx",{get:function(){return this.x-this.lastx},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dy",{get:function(){return this.y-this.lasty},enumerable:!0,configurable:!0}),t}();__reflect(e.prototype,"TouchInfo");var i=function(){function t(){this._host=null,this._checkBoundFunc=null,this._onDragFunc=null,this._maxScale=5,this._minScale=.1,this._detectType=t.T_DRAG,this._activeTouchInfo1=null,this._activeTouchInfo2=null}return t.prototype.registerTouch=function(t,e,i){this._host=t,i.minScale&&(this._minScale=i.minScale),i.maxScale&&(this._maxScale=i.maxScale),i.checkBoundCb&&(this._checkBoundFunc=i.checkBoundCb),i.onDropCb&&(this._onDragFunc=i.onDropCb),this._detectType=e,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onTouchBegin,this),t.addEventListener(egret.TouchEvent.TOUCH_MOVE,this._onDrag,this),t.addEventListener(egret.TouchEvent.TOUCH_END,this._onTouchEnd,this)},t.prototype.unregisterTouch=function(t){t.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onTouchBegin,this),t.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this._onDrag,this),t.removeEventListener(egret.TouchEvent.TOUCH_END,this._onTouchEnd,this),this._checkBoundFunc=null,this._onDragFunc=null,this._host=null,this._activeTouchInfo1=null,this._activeTouchInfo2=null},t.prototype._onTouchBegin=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._host?[2]:[2]})})},t.prototype._onDrag=function(i){return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a,u,h,l,c,d,p,_,g,f,m,y,C,v,T,n;return __generator(this,function(w){return r=i.touchPointID,this._activeTouchInfo1?this._activeTouchInfo1.id==r?this._activeTouchInfo1.updateCoord(i):this._activeTouchInfo2?this._activeTouchInfo2.id==r&&this._activeTouchInfo2.updateCoord(i):this._activeTouchInfo2=new e(i):this._activeTouchInfo1=new e(i),this._activeTouchInfo1&&!this._activeTouchInfo2?(n=this._checkBound(this._host.x+this._activeTouchInfo1.dx,this._host.y+this._activeTouchInfo1.dy),this._host.x=n.x,this._host.y=n.y):this._detectType==t.T_ZOOM&&this._activeTouchInfo1&&this._activeTouchInfo2&&this._activeTouchInfo2.id==r&&(o=this._activeTouchInfo1,s=this._activeTouchInfo2,a=new egret.Point(o.x,o.y),u=new egret.Point(s.x,s.y),h=new egret.Point(o.lastx,o.lasty),l=new egret.Point(s.lastx,s.lasty),c=new egret.Point((h.x+l.x)/2,(h.y+l.y)/2),d=new egret.Point((a.x+u.x)/2,(a.y+u.y)/2),p=d.x-c.x,_=d.y-c.y,g=Math.max(1,egret.Point.distance(h,l)),f=Math.max(1,egret.Point.distance(a,u)),m=this._host.scaleX*f/g,m=Math.max(this._minScale,Math.min(this._maxScale,m)),y=this._host.globalToLocal(d.x,d.y),C=this._host.scaleX,v=p-y.x*(m-C),T=_-y.y*(m-C),n=this._checkBound(this._host.x+v,this._host.y+T),this._host.x=n.x,this._host.y=n.y,this._host.scaleX=m,this._host.scaleY=m),this._onDragFunc&&this._onDragFunc(),[2]})})},t.prototype._onTouchEnd=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._activeTouchInfo1=null,this._activeTouchInfo2=null,[2]})})},t.prototype._checkBound=function(t,e){return this._checkBoundFunc?this._checkBoundFunc(t,e):this._defaultCheckBound(t,e)},t.prototype._defaultCheckBound=function(t,e){if(!this._host)return{x:0,y:0};var i=fairygui.GRoot.inst,r=t;if(i.getDesignStageWidth()==this._host.width*this._host.scaleX)r=this._host.parent.width/2-this._host.width*this._host.scaleX/2;else{var n=(this._host.parent.width-i.getDesignStageWidth())/2;r=Math.min(n,r),r=Math.max(this._host.parent.width-this._host.width*this._host.scaleX-n,r)}var o=e;if(i.getDesignStageHeight()==this._host.height*this._host.scaleY)o=this._host.parent.height/2-this._host.height*this._host.scaleY/2;else{var s=(this._host.parent.height-i.getDesignStageHeight())/2;o=Math.min(s,o),o=Math.max(this._host.parent.height-this._host.height*this._host.scaleY-s,o)}return{x:r,y:o}},t.T_DRAG=1,t.T_ZOOM=2,t}();t.DragDetector=i,__reflect(i.prototype,"Core.DragDetector")}(Core||(Core={}));var Core;!function(t){var e=function(){function e(){}return e.rotationEffect=function(t,e){if(void 0===e&&(e=1e3),null==this.rotationSet&&(this.rotationSet=new Collection.Set),!this.rotationSet.contains(t.hashCode)){this.rotationSet.add(t.hashCode);var i=function(){this.rotationSet.contains(t.hashCode)&&(t.rotation=0,egret.Tween.get(t).to({rotation:360},e).call(i,this))};t.rotation=0,egret.Tween.get(t).to({rotation:360},e).call(i,this)}},e.removeRotationEffect=function(t){null==this.rotationSet&&(this.rotationSet=new Collection.Set),this.rotationSet.remove(t.hashCode)},e.showLeftToRight=function(e){var i=this;return null==e.parent&&t.LayerManager.inst.maskLayer.addChild(e),e.alpha=0,new Promise(function(t){e.y=fairygui.GRoot.inst.height/2-e.height/2,e.x=-e.width,egret.Tween.get(e).to({x:fairygui.GRoot.inst.width/2-e.width/2-50,alpha:1},300,egret.Ease.sineInOut),fairygui.GTimers.inst.add(580,1,function(){egret.Tween.get(e).to({x:e.x+100},800).to({x:fairygui.GRoot.inst.width},300,egret.Ease.sineIn).call(function(){null!=e.parent&&e.parent.removeChild(e),t()},i)},i)})},e.showFromCenter=function(e,i,r,n){var o=this;return void 0===i&&(i=350),void 0===r&&(r=900),void 0===n&&(n=400),null==e.parent&&(t.LayerManager.inst.maskLayer.addChild(e),e.y=fairygui.GRoot.inst.height/2,e.x=fairygui.GRoot.inst.width/2),e.alpha=0,e.setPivot(.5,.5,!0),e.setScale(0,0),new Promise(function(t){egret.Tween.get(e).to({scaleX:1,scaleY:1,alpha:1},i).wait(r).to({alpha:0},n).call(function(){e.removeFromParent(),t()},o)})},e.blink=function(e,i){return void 0===i&&(i=t.TextColors.white),__awaiter(this,void 0,void 0,function(){var t,r=this;return __generator(this,function(n){switch(n.label){case 0:return t=new fairygui.GGraph,t.width=e.width,t.height=e.height,t.drawRect(0,i,0,i,.8,[7]),e.addChild(t),[4,new Promise(function(i){egret.Tween.get(t).to({alpha:.4},110).wait(35).call(function(){e.removeChild(t)},null).wait(263).call(function(){i()},r)})];case 1:return n.sent(),[2]}})})},e}();t.EffectUtil=e,__reflect(e.prototype,"Core.EffectUtil")}(Core||(Core={}));var Core;!function(t){var e=function(){function t(t){void 0===t&&(t=1),this._delayFrame=t,this._functions=[]}return t.prototype.regist=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];this._functions.push([t,e,i])},t.prototype.cancel=function(){this._isCancel=!0},t.prototype.execute=function(){if(!this._isCancel){if(this._functions.length){var t=this._functions.shift();(e=t[0]).call.apply(e,[t[1]].concat(t[2])),fairygui.GTimers.inst.add(fairygui.GTimers.FPS30,1,this.execute,this)}var e}},t}();t.FrameExecutor=e,__reflect(e.prototype,"Core.FrameExecutor")}(Core||(Core={}));var Core;!function(t){var e=function(){function t(){}return t.getQueryVariable=function(t){for(var e=window.location.search.substring(1),i=e.split("&"),r=0;r<i.length;r++){var n=i[r].split("=");if(n[0]==t)return n[1]}return null},t.post=function(t,e){var i=this;void 0===e&&(e=null);var r=new egret.HttpRequest;r.responseType=egret.HttpResponseType.TEXT,r.open(t,egret.HttpMethod.POST),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var n="";if(e){var o=[];e.forEach(function(t,e){o.push(t+"="+e)}),n=o.join("&")}return r.send(n),new Promise(function(t,e){r.once(egret.Event.COMPLETE,function(e){var i=e.currentTarget;t(i.response)},i),r.once(egret.IOErrorEvent.IO_ERROR,function(t){e("get error : "+t.data)},i)})},t}();t.HttpUtils=e,__reflect(e.prototype,"Core.HttpUtils")}(Core||(Core={}));var Core;!function(t){var e=function(){function e(){this._factorys=new Collection.MultiDictionary,this._mcFactorys=new Collection.Dictionary,this._maxId=1}return Object.defineProperty(e,"inst",{get:function(){return e._inst||(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),e.prototype.getMovieClip=function(e,i){var r=e+">"+i,n=this._factorys.getValue(r);if(n.length>0){var o=n[0];return this._factorys.remove(r,o),o}var s=this._mcFactorys.getValue(e);if(!s){var a=RES.getRes("effect_"+e+"_mc_json"),u=RES.getRes("effect_"+e+"_tex_png");if(!a||!u)return null;s=new egret.MovieClipDataFactory(a,u)}var h=s.generateMovieClipData(i);if(h.mcData){var l=new egret.MovieClip(h),o=new t.EMovieClip(l);return o.key=r,o._fid=this._maxId,this._maxId++,o}return null},e.prototype.revertMovieClip=function(t){if(t){t.parent&&t.parent.removeChild(t);var e=t.displayObject;e.destroy()}},e}();t.MCFactory=e,__reflect(e.prototype,"Core.MCFactory")}(Core||(Core={}));var Core;!function(t){var e=function(){function e(){}return e.showTransMask=function(){e.transMask||(e.transMask=new fairygui.GGraph,e.transMask.graphics.clear(),e.transMask.graphics.beginFill(0,0),e.transMask.graphics.drawRect(0,0,fairygui.GRoot.inst.width,fairygui.GRoot.inst.height),e.transMask.graphics.endFill(),e.transMask.width=fairygui.GRoot.inst.getDesignStageWidth(),e.transMask.height=fairygui.GRoot.inst.getDesignStageHeight(),e.transMask.x=fairygui.GRoot.inst.width/2-e.transMask.width/2,e.transMask.y=fairygui.GRoot.inst.height/2-e.transMask.height/2,e.transMask.touchable=!0,e.transMask.visible=!0),e.transMask.parent||t.LayerManager.inst.topLayer.addChild(e.transMask)},e.hideTransMask=function(){e.transMask&&e.transMask.parent&&e.transMask.parent.removeChild(e.transMask)},e.registerNetMask=function(t){e.netMask=t,e.netMask.initUI()},e.showNetMask=function(){e.netMask&&(e.netMask.open(),t.DeviceUtils.isWXGame()&&!this._forbidTimeout&&(e._timeoutHdr&&fairygui.GTimers.inst.remove(this._timeoutHdr,this),this._timeoutHdr=function(){e._netTimeoutAlert()},fairygui.GTimers.inst.add(1e4,1,this._timeoutHdr,this)))},e.hideNetMask=function(){e.netMask&&(t.DeviceUtils.isWXGame()&&e._timeoutHdr&&(fairygui.GTimers.inst.remove(this._timeoutHdr,this),e._timeoutHdr=null),e.netMask.close())},e._netTimeoutAlert=function(){t.DeviceUtils.isWXGame()&&(e._timeoutHdr=null,t.TipsUtils.alert(t.StringUtils.TEXT(60216),function(){WXGame.WXGameMgr.inst.exitGame()},this,t.StringUtils.TEXT(60024)))},e.forbidTimeout=function(t){this._forbidTimeout=t,t&&e._timeoutHdr&&(fairygui.GTimers.inst.remove(this._timeoutHdr,this),e._timeoutHdr=null)},e._timeoutHdr=null,e._forbidTimeout=!0,e}();t.MaskUtils=e,__reflect(e.prototype,"Core.MaskUtils")}(Core||(Core={}));var Core;!function(t){var e=function(){function e(){}return e.addPopUp=function(i,r,n,o,s){return void 0===r&&(r=0),void 0===n&&(n=!1),void 0===o&&(o=0),void 0===s&&(s=0),__awaiter(this,void 0,void 0,function(){var a,u,h=this;return __generator(this,function(l){switch(l.label){case 0:return i.parent||fairygui.GRoot.inst.addChild(i),i.scaleX=1,i.scaleY=1,i.alpha=1,n&&(e._darkSprite||(e._darkSprite=new fairygui.GGraph,e._darkSprite.graphics.clear(),e._darkSprite.graphics.beginFill(0,.3),e._darkSprite.graphics.drawRect(0,0,fairygui.GRoot.inst.width,fairygui.GRoot.inst.height),e._darkSprite.graphics.endFill(),e._darkSprite.width=fairygui.GRoot.inst.width,e._darkSprite.height=fairygui.GRoot.inst.height),e._darkSprite.parent||t.LayerManager.inst.maskLayer.addChild(e._darkSprite),e._darkSprite.touchable=!0,e._darkSprite.visible=!0,egret.Tween.get(e._darkSprite).to({alpha:1},150)),0!=o?(i.x=fairygui.GRoot.inst.width/2-i.width/2,i.y=fairygui.GRoot.inst.height/2-i.height/2):(o=i.width,s=i.height),a=fairygui.GRoot.inst.width/2-o/2,u=fairygui.GRoot.inst.height/2-s/2,[4,new Promise(function(t){var e=function(){t()};switch(r){case 0:e();break;case 1:i.alpha=0,i.scaleX=.5,i.scaleY=.5,i.x=i.x+o/4,i.y=i.y+s/4,egret.Tween.get(i).to({alpha:1,scaleX:1,scaleY:1,x:i.x-o/4,y:i.y-s/4},300,egret.Ease.backOut).call(e,h);break;case 2:i.alpha=0,i.scaleX=.5,i.scaleY=.5,i.x=i.x+o/4,i.y=i.y+s/4,egret.Tween.get(i).to({alpha:1,scaleX:1,scaleY:1,x:i.x-o/4,y:i.y-s/4},600,egret.Ease.elasticOut).call(e,h);break;case 3:i.x=-o,egret.Tween.get(i).to({x:a},500,egret.Ease.cubicOut).call(e,h);break;case 4:i.x=o,egret.Tween.get(i).to({x:a},500,egret.Ease.cubicOut).call(e,h);break;case 5:i.y=-s,egret.Tween.get(i).to({y:u},500).call(e,h);break;case 6:i.y=fairygui.GRoot.inst.height,egret.Tween.get(i).to({y:u},500,egret.Ease.cubicOut).call(e,h);break;case 7:i.scaleX=.5,i.scaleY=.5,egret.Tween.get(i).to({scaleX:1,scaleY:1},300,egret.Ease.backOut).call(e,h);break;default:e()}})];case 1:return l.sent(),[2]}})})},e.removePopUp=function(t,i){return void 0===i&&(i=0),__awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(o){switch(o.label){case 0:switch(e._darkSprite&&e._darkSprite.parent&&egret.Tween.get(e._darkSprite).to({alpha:0},100).call(function(){e._darkSprite&&e._darkSprite.removeFromParent()},this),i){case 0:break;case 1:egret.Tween.get(t).to({alpha:0,scaleX:0,scaleY:0,x:t.x+t.width/2,y:t.y+t.height/2},300);break;case 2:break;case 3:egret.Tween.get(t).to({x:t.width},500,egret.Ease.cubicOut);break;case 4:egret.Tween.get(t).to({x:-t.width},500,egret.Ease.cubicOut);break;case 5:egret.Tween.get(t).to({y:t.height},500,egret.Ease.cubicOut);break;case 6:egret.Tween.get(t).to({y:-t.height},500,egret.Ease.cubicOut);break;case 7:egret.Tween.get(t).to({scaleX:0,scaleY:0},300,egret.Ease.backIn)}return r=500,0==i&&(r=0),[4,new Promise(function(e){fairygui.GTimers.inst.callDelay(r,function(){t.removeFromParent(),e()},n)})];case 1:return o.sent(),[2]}})})},e}();t.PopUpUtils=e,__reflect(e.prototype,"Core.PopUpUtils")}(Core||(Core={}));var Core;!function(t){var e=function(){function t(){}return t.randInt=function(t){return 0>=t?0:Math.floor(Math.random()*t)},t.shuffle=function(e){for(var i=e.length;i>=2;){var r=t.randInt(i),n=e[r];e[r]=e[i-1],e[i-1]=n,--i}return e},t}();t.RandomUtils=e,__reflect(e.prototype,"Core.RandomUtils")}(Core||(Core={}));var Core;!function(t){var e=function(){function t(t){this.stream=[],this._isDone=!0,this._isHead=!0,this._id=t}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDone",{get:function(){return this._isDone},set:function(t){this._isDone=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isHead",{get:function(){return this._isHead},enumerable:!0,configurable:!0}),t.prototype.toTextElement=function(){return{text:this.stream.join("")}},t.prototype.addChar=function(t){this.stream.push(t)},t.prototype.getBaseText=function(){return this.stream.join("")},t}();__reflect(e.prototype,"TextToken");var i=function(e){function i(t,i,r,n){var o=e.call(this,t)||this;return o._color=i,o._rgbColor=r,o._isHead=n,o._isDone=!1,o}return __extends(i,e),Object.defineProperty(i.prototype,"color",{get:function(){return this._color},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rgbColor",{get:function(){return this._rgbColor},enumerable:!0,configurable:!0}),i.prototype.toTextElement=function(){var t=this.stream.join("");return this._isDone?{text:t,style:{textColor:this.rgbColor}}:this._isHead?{text:"#c"+this._color+t}:{text:t}},i.getRgbColor=function(e){return 1==e.length?t.ColorsCode[e]:parseInt(e,16)},i}(e);__reflect(i.prototype,"ColorTextToken");var r=function(){function r(){}return r.TEXT=function(t){if(!r.textGameData)return"";var e=r.textGameData.get(t);if(!e){if(!r.textGameData2)return"";if(e=r.textGameData2.get(t),!e)return""}var i=e[LanguageMgr.inst.cur];return i?i.indexOf("$GAME_NAME")>=0?i.replace("$GAME_NAME",Home.getGameName()):i:""},r.parseColorText=function(r){for(var n,o=[],s=[],a=[],u=0,h=r.length,l=0,c=0;h>c;){var d=r[c];if(0==l){if("#"==d&&"c"==r[c+1]){var p=r[c+2],_=i.getRgbColor(p);if(_||(p=r.slice(c+2,c+8),_=i.getRgbColor(p)),_){null!=n&&a.push(n),n=new i(u,p,_,!0),u+=1,c+=p.length+2,l=1;continue}}c+=1,null==n&&(n=new e(u),u+=1),n.addChar(d)}else{if("#"==d){if("n"==r[c+1]){if(c+=2,n.isDone=!0,a.push(n),!n.isHead)for(;s.length>0&&(n=s.pop(),n.isDone=!0,a.push(n),!n.isHead););if(s.length>0){var g=s[s.length-1];n=new i(u,g.color,g.rgbColor,!1),u+=1}else n=null,l=0;continue}if("c"==r[c+1]){var p=r[c+2],_=i.getRgbColor(p);if(_||(p=r.slice(c+2,c+8),_=i.getRgbColor(p)),_){s.push(n),n=new i(u,r[c+2],t.ColorsCode[r[c+2]],!0),u+=1,c+=3,l=1;continue}}}c+=1,n.addChar(d)}}return null!=n&&a.push(n),s.forEach(function(t){a.push(t)}),a.sort(function(t,e){return t.id>e.id?1:-1}),a.forEach(function(t){o.push(t.toTextElement())}),o},r.parseFuncText=function(t,e){function i(t){return t?JSON.parse(JSON.stringify(t)):{}}var n=t.text,o=[];e||(e=r.parseColorText(n));var s=!1;return e.forEach(function(e){var n=e.text,a=null;e.style&&(a=e.style);for(var u=[],h=n.indexOf("#f");h>=0;){var l=n.substr(0,h);u.push({text:l,style:i(a)}),n=n.substr(h+2,n.length-h-2);var c=n.indexOf("#e");if(0>c)break;var d=n.substr(0,c);n=n.substr(c+2,n.length-c-2);var p="(",_=")";d=d.replace("（",p),d=d.replace("）",_);var g=d.indexOf(p),f=d.indexOf(_);if(0>g&&0>f)break;var m=d.substr(g+p.length,f-g-p.length),y=r._assembleEventElement(t,d.substr(0,g),m,a);y&&(u.push(y),y.style&&y.style.href&&(s=!0)),h=n.indexOf("#f")}u.forEach(function(t){o.push(t)}),n.length>0&&(e.text=n,o.push(e))}),s&&(t.touchable=!0,t.addEventListener(egret.TextEvent.LINK,r._handleFuncEvent,t.displayObject)),o},r._assembleEventElement=function(e,i,r,n){n||(n={});var o=JSON.parse(JSON.stringify(n));i=i.replace("，",",");var s=i.split(",");if(s.length<2)return null;var a=s[0];if("img"==a){r=r.replace("，",",");var u=r.split(",");if(u.length<2)return null;var h=parseInt(u[0]),l=parseInt(u[1]);if(!h||!l)return null;var c=s[1],d=Math.max(h,l);o.size=d,o.drawParam="img,"+c+","+h+","+l,o.drawThis=e,o.drawCallback=t.StringUtils._handleTextDraw,r="   "}else if("com"==a){r=r.replace("，",",");var u=r.split(",");if(u.length<2)return null;var h=parseInt(u[0]),l=parseInt(u[1]);if(!h||!l)return null;var p=s[1],d=Math.max(h,l);o.size=d,o.drawParam="com,"+p+","+h+","+l,o.drawThis=e,o.drawCallback=t.StringUtils._handleTextDraw,r="   "}else o.href="event:"+i,o.underline=!0,o.bold=!0;return{text:r,style:o}},r._handleTextDraw=function(e,i,r,n,o){return __awaiter(this,void 0,void 0,function(){var e,s,a,u,h,l,c,d,u,h,p,_,g,f;return __generator(this,function(m){switch(m.label){case 0:return e=n.split(","),s=e[0],"img"!=s?[3,1]:(a=e[1],u=parseInt(e[2]),h=parseInt(e[3]),l=o,c=new fairygui.GLoader,c.url=a,c.width=u,c.height=h,c.autoSize=!1,c.fill=fairygui.LoaderFillType.ScaleFree,c.x=i+l.x,c.y=r+l.y-h/2,l.parent.addChild(c),[3,3]);case 1:return"com"!=s?[3,3]:(d=e[1],u=parseInt(e[2]),h=parseInt(e[3]),p=o,_=fairygui.UIPackage.createObject(PkgName.pvp,"videoItem",Pvp.VideoShareItemCom).asCom,g=t.StringUtils.stringToLong(d),[4,Pvp.VideoCenter.inst.getVideoById(g)]);case 2:f=m.sent(),_.setVideo(f,null),_.x=i+p.x,_.y=r+p.y-h/2-10,p.parent.addChild(_),m.label=3;case 3:return[2]}})})},r._handleFuncEvent=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a,u,h,l,c,d,p;return __generator(this,function(_){switch(_.label){case 0:return i=e.text,console.log("!!!!!!! ",i),r=",",i.indexOf(r)<0&&(r="，"),n=i.split(r),n.length<2?[2]:(o=n[0],s=n[1],"video"!=o?[3,1]:(a=t.StringUtils.stringToLong(s),Pvp.VideoCenter.inst.playVideoById(a),[3,4]));case 1:return"user"!=o?[3,3]:(u=t.StringUtils.stringToLong(s),[4,Social.FriendMgr.inst.fetchPlayerInfo(u)]);case 2:return h=_.sent(),h&&t.ViewManager.inst.open(ViewName.friendInfo,u,h),[3,4];case 3:"card"==o?(l=parseInt(s),l&&(c=Data.pool.get(l),d=new CardPool.Card(c),d.level=c.level,t.ViewManager.inst.open(ViewName.cardInfoOther,d))):"desc"==o&&(p=s,t.ViewManager.inst.openPopup(ViewName.descTipsWnd,p)),_.label=4;case 4:return[2]}})})},r.getZhNumber=function(e){if(window.gameGlobal.isMultiLan&&!LanguageMgr.inst.isChineseLocale())return e.toString();switch(e){case 0:return t.StringUtils.TEXT(60016);case 1:return t.StringUtils.TEXT(60001);case 2:return t.StringUtils.TEXT(60005);case 3:return t.StringUtils.TEXT(60003);case 4:return t.StringUtils.TEXT(60009);case 5:return t.StringUtils.TEXT(60006);case 6:return t.StringUtils.TEXT(60014);case 7:return t.StringUtils.TEXT(60002);case 8:return t.StringUtils.TEXT(60013);case 9:return t.StringUtils.TEXT(60010);default:console.debug("default case")}},r.secToString=function(e,i){var r=Math.round((e-1800)/3600),n=Math.round((e-30)/60)%60,o=e%60;if("hms"==i.toLowerCase())return r>0?t.StringUtils.format(t.StringUtils.TEXT(60128),r,n,o):n>0?t.StringUtils.format(t.StringUtils.TEXT(60070),n,o):t.StringUtils.format(t.StringUtils.TEXT(60021),o);if("hm"==i.toLowerCase())return r>0?n>0?t.StringUtils.format(t.StringUtils.TEXT(60112),r,n):t.StringUtils.format(t.StringUtils.TEXT(60058),r):0>=n?t.StringUtils.format(t.StringUtils.TEXT(60021),o):o>0?t.StringUtils.format(t.StringUtils.TEXT(60070),n,o):t.StringUtils.format(t.StringUtils.TEXT(60055),n);if("dhm"==i.toLowerCase()){var s=Math.round((e-1800)/3600),a=Math.floor(s/24),u=Math.round((e-30)/60)%60;return a>0?t.StringUtils.format(t.StringUtils.TEXT(60032),a):s>0?t.StringUtils.format(t.StringUtils.TEXT(60058),s):u>0?t.StringUtils.format(t.StringUtils.TEXT(60055),u):t.StringUtils.TEXT(60042)}if("dhms"==i.toLowerCase()){var h=Math.round((e-1800)/3600),a=Math.floor(h/24);h%=24;var l=Math.round((e-30)/60)%60;return t.StringUtils.format(t.StringUtils.TEXT(70124),a,h,l)}return t.StringUtils.format(t.StringUtils.TEXT(60021),o)},r.secToDate=function(e,i){var r=new Date(1e3*e),n=r.getFullYear(),o=r.getMonth()+1,s=r.getDate(),a=r.getHours(),u=r.getMinutes(),h=r.getSeconds();return"ymdhms"==i.toLowerCase()?t.StringUtils.format(t.StringUtils.TEXT(60206),n,o,s,a,u,h):"ymd"==i.toLowerCase()?t.StringUtils.format(t.StringUtils.TEXT(60115),n,o,s):"mdh"==i.toLowerCase()?t.StringUtils.format(t.StringUtils.TEXT(60121),o,s,a):t.StringUtils.format(t.StringUtils.TEXT(60183),o,s,a,u,h)},r.stringToLong=function(t){var e=protobuf.Writer.create().uint64(t).finish();return protobuf.Reader.create(e).uint64()},r.utf8ArrayToString=function(t){var e,i,r,n,o,s;for(e="",r=t.length,i=0;r>i;)switch(n=t[i++],n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(n);break;case 12:case 13:o=t[i++],e+=String.fromCharCode((31&n)<<6|63&o);break;case 14:o=t[i++],s=t[i++],e+=String.fromCharCode((15&n)<<12|(63&o)<<6|(63&s)<<0)}return e},r.format=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return t.replace(/{(\d+)}/g,function(t,i){return"undefined"!=typeof e[i]?e[i]:t})},r.utf8Length=function(t){var e=0,i=t.length;if(!t)return 0;for(var r=0;i>r;r++)e+=t.charCodeAt(r)>255?2:1;return e},r}();t.StringUtils=r,__reflect(r.prototype,"Core.StringUtils")}(Core||(Core={}));var Core;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.show=function(e){var i=this;return this.textParser=t.StringUtils.parseColorText,this.color=t.TextColors.red,this.text=e,this.fontSize=t.UIConfig.defaultFontSize,this.align=fairygui.AlignType.Center,this.verticalAlign=fairygui.VertAlignType.Middle,this.font=t.UIConfig.defaultFont,this.bold=!0,this.stroke=2,this.alpha=0,this.visible=!0,this.width>400&&(this.autoSize=fairygui.AutoSizeType.Height,this.width=400,this.text=e),this.y=fairygui.GRoot.inst.height/2,this.x=fairygui.GRoot.inst.width/2-this.width/2,new Promise(function(t){egret.Tween.get(i).to({y:i.y-120,alpha:1},800,egret.Ease.backOut).wait(100).to({alpha:0},600).call(function(){t()},i)})},i}(fairygui.GTextField);__reflect(e.prototype,"DefTipsCom",["Core.ITipsCom"]);var i=function(){function i(){}return i.showTipsFromCenter=function(r){var n;n=i.newTipsCom?i.newTipsCom():new e,t.LayerManager.inst.maskLayer.addChild(n),n.show(r).then(function(){n.removeFromParent()})},i.registerConfirmPanel=function(e){i._confirmPanel||(i._confirmPanel=new fairygui.Window),i._confirmPanel.contentPane=e,i._confirmPanel.modal=!0,e.getTitle().funcParser=t.StringUtils.parseFuncText},i.registerAlertPanel=function(e){i._alertPanel||(i._alertPanel=new fairygui.Window),i._alertPanel.contentPane=e,i._alertPanel.modal=!0,e.getTitle().funcParser=t.StringUtils.parseFuncText},i.registerPrivPanel=function(t){i._privPanel||(i._privPanel=new fairygui.Window),i._privPanel.contentPane=t},i.registerFlagPanel=function(t){i._flagTips||(i._flagTips=new fairygui.Window),i._flagTips.contentPane=t},i.privTips=function(e){if(i._privPanel){var r=i._privPanel.contentPane;r.showTip(e);t.LayerManager.inst.topLayer.root.showWindow(i._privPanel)}},i.closePrivTips=function(){t.LayerManager.inst.topLayer.root.hideWindow(i._privPanel)},i.closeFlagTips=function(){t.LayerManager.inst.topLayer.root.hideWindow(i._flagTips)},i.flagTips=function(e,r){if(i._flagTips){var n=i._flagTips.contentPane;n.showTip(e,r),t.LayerManager.inst.topLayer.root.showWindow(i._flagTips)}},i.closeConfirmPanel=function(){i._confirmPanel&&i._confirmPanel.visible&&t.LayerManager.inst.topLayer.root.hideWindow(i._confirmPanel)},i.closeAlertPanel=function(){i._alertPanel&&i._alertPanel.visible&&t.LayerManager.inst.topLayer.root.hideWindow(i._alertPanel)},i.confirm=function(e,r,n,o,s,a,u){function h(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return c.getAcceptBtn().removeClickListener(h,this),c.getCancelBtn().removeClickListener(l,this),r&&r.apply(o),fairygui.GRoot.inst.hideWindow(i._confirmPanel),[2]})})}function l(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return c.getAcceptBtn().removeClickListener(h,this),c.getCancelBtn().removeClickListener(l,this),n&&n.apply(o),t.LayerManager.inst.topLayer.root.hideWindow(i._confirmPanel),[2]})})}if(void 0===e&&(e=""),void 0===r&&(r=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===s&&(s=t.StringUtils.TEXT(60047)),void 0===a&&(a=t.StringUtils.TEXT(60046)),void 0===u&&(u=1),i._confirmPanel){var c=i._confirmPanel.contentPane,d=c.getAcceptBtn();d.title=s,d.addClickListener(h,this);var p=c.getCancelBtn();p.title=a,p.addClickListener(l,this),c.getTitle().text=e,t.LayerManager.inst.topLayer.root.showWindow(i._confirmPanel),i._confirmPanel.center(),t.PopUpUtils.addPopUp(i._confirmPanel,u)}},i.alert=function(e,r,n,o,s){function a(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return u.getAcceptBtn().removeClickListener(a,this),r&&r.apply(n),t.LayerManager.inst.topLayer.root.hideWindow(i._alertPanel),[2]})})}if(void 0===e&&(e=""),void 0===r&&(r=null),void 0===n&&(n=null),void 0===o&&(o=t.StringUtils.TEXT(60047)),void 0===s&&(s=1),i._alertPanel){var u=i._alertPanel.contentPane,h=u.getAcceptBtn();return h.title=o,h.addClickListener(a,this),u.getTitle().text=e,t.LayerManager.inst.topLayer.root.showWindow(i._alertPanel),i._alertPanel.center(),t.PopUpUtils.addPopUp(i._alertPanel,s),i._alertPanel}},i.showTipsFromTarget=function(t,e,i){switch(void 0===e&&(e=1),void 0===i&&(i=null),egret.Tween.removeTweens(t),fairygui.GRoot.inst.showPopup(t,i),e){case 0:t.alpha=0,egret.Tween.get(t).to({alpha:1},300);break;case 1:t.alpha=0,t.y+=t.height,egret.Tween.get(t).to({alpha:1,y:t.y-t.height},500,egret.Ease.backOut);break;case 2:t.alpha=0,t.x-=t.width,egret.Tween.get(t).to({alpha:1,x:t.x+t.width},500,egret.Ease.backOut);break;case 3:t.alpha=0,t.x+=t.width,egret.Tween.get(t).to({alpha:1,x:t.x-t.width},500,egret.Ease.backOut)}},i}();t.TipsUtils=i,__reflect(i.prototype,"Core.TipsUtils")}(Core||(Core={}));var Core;!function(t){var e=function(){function t(){this._data=new Collection.Dictionary,this.isEnd=!1}return t.prototype.getChild=function(t){return this._data.getValue(t)},t.prototype.addChild=function(e){var i=new t;return this._data.setValue(e,i),i.value=e,i.parent=this,i},t.prototype.getFullWord=function(){for(var t=this.value,e=this.parent;e;)t=e.value+t,e=e.parent;return t},Object.defineProperty(t.prototype,"isLeaf",{get:function(){return this._data.size()<=0},enumerable:!0,configurable:!0}),t}();__reflect(e.prototype,"TreeNode");var i=function(){function t(){}return Object.defineProperty(t,"inst",{get:function(){return this._inst||(this._inst=new t),this._inst},enumerable:!0,configurable:!0}),t.prototype.registerWords=function(t){this._treeRoot=new e,this._treeRoot.value="";for(var i=0,r=t;i<r.length;i++){for(var n=r[i],o=n.length,s=this._treeRoot,a=0;o>a;a++){var u=n.charAt(a),h=s.getChild(u);s=h?h:s.addChild(u)}s.isEnd=!0}},t.prototype.containsDirtyWords=function(t){for(var e,i,r=this._treeRoot,n=0,o=-1;n<t.length;)if(e=t.charAt(n),i=r.getChild(e)){if(i.isEnd)return!0;-1==o&&(o=n),r=i,n++}else r!=this._treeRoot&&(n=o,o=-1),r=this._treeRoot,n++;return!1},t}();t.WordFilter=i,__reflect(i.prototype,"Core.WordFilter")}(Core||(Core={}));var Core;!function(t){function e(e){for(var i=e[0],r=i instanceof t.Watcher?i.getValue():i,n=e.length,o=1;n>o;o++){var s=e[o];s instanceof t.Watcher&&(s=s.getValue()),r+=s}return r}var i=function(){function i(){}return i.bindProperty=function(e,i,r,n){var o=t.Watcher.watch(e,i,null,null);if(o){var s=function(t){r[n]=t};o.setHandler(s,null),s(o.getValue())}return o},i.bindHandler=function(e,i,r,n){var o=t.Watcher.watch(e,i,r,n);return o},i.$bindProperties=function(r,n,o,s,a){if(1==n.length&&1==o.length)return i.bindProperty(r,n[0].split("."),s,a);for(var u,h=function(){s[a]=e(n)},l=o.length,c=0;l>c;c++){var d=o[c],p=n[d].split(".");u=t.Watcher.watch(r,p,null,null),u&&(n[d]=u,u.setHandler(h,null))}return h(),u},i}();t.Binding=i,__reflect(i.prototype,"Core.Binding")}(Core||(Core={}));var Main=function(t){function e(){var e=t.call(this)||this;return egret.MainContext.instance.stage.maxTouches=2,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),Core.NativeMsgCenter.inst.addListener(Core.NativeMessage.ON_START,function(){console.log("native onStart"),egret.lifecycle.onResume()},null),Core.NativeMsgCenter.inst.addListener(Core.NativeMessage.ON_STOP,function(){console.log("native onStop"),egret.lifecycle.onPause()},null),Core.NativeMsgCenter.inst.addListener(Core.NativeMessage.USE_NATIVE_SOUND,function(){window.support.nativeSound=!0,console.log("native useNativeSound"),fairygui.GRoot.inst.playSoundAsync=function(t,e){void 0===e&&(e=1);var i=this._volumeScale*e;NativeSoundApi.playSound(t,i)}},null),Core.NativeMsgCenter.inst.addListener(Core.NativeMessage.SET_SUPPORT_RECORD,function(t){window.support.record=t.support,window.support.topMargin=t.topMargin,window.support.bottomMargin=t.bottomMargin},null),Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.USE_NATIVE_SOUND),Core.NativeMsgCenter.inst.addListener(Core.NativeMessage.GET_TD_CHANNEL_ID,function(t){window.gameGlobal.tdChannel=t.tdChannelID,t["native"]&&TD.initNativeTD(),console.log("tdChannel "+window.gameGlobal.tdChannel+" "+t["native"])},null),Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.GET_TD_CHANNEL_ID),e}return __extends(e,t),e.prototype.onAddToStage=function(t){console.log("runGame"),egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){TD.onPageLeave(),Home.HomeMgr.inst.stopBgSound(!1),console.log("game onPause")
},egret.lifecycle.onResume=function(){TD.Account(),SoundMgr.inst.playSoundAsync("click_mp3",.01),Home.HomeMgr.inst.playBgSound(),SoundMgr.inst.cleanSoundTimerRecords(),console.log("game onResume")},Core.DeviceUtils.isWXGame()?RES.setMaxLoadingThread(8):RES.setMaxLoadingThread(8),RES.setMaxRetryTimes(8),window.gameGlobal.isMultiLan||(egret.TextField.default_fontFamily="AaKaiTi"),this.runGame()["catch"](function(t){console.log(t)})},e.prototype._cleanText=function(t){for(var e=t.$children,i=e.length,r=0;i>r;++r){var n=e[r];if(n.$children&&n.$children.length)this._cleanText(n);else if(n.$renderNode){var o=void 0;n.$renderNode instanceof egret.sys.TextNode?o=n.$renderNode:n.$renderNode instanceof egret.sys.GroupNode&&n.$renderNode.drawData[0]instanceof egret.sys.TextNode&&(o=n.$renderNode.drawData[0]),o&&o.clean()}}},e.prototype.refreshTextRender=function(){Core.DeviceUtils.isWXGame()&&(wx.triggerGC(),console.log("triggerGC"))},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return window.gameGlobal.isPC?(Core.UIConfig.defaultFontSize=40,this.stage.orientation=egret.OrientationMode.LANDSCAPE):(Core.DeviceUtils.isMobile()||Core.DeviceUtils.isWXGame())&&(this.stage.orientation=egret.OrientationMode.PORTRAIT),window.support.bottomMargin||(window.support.bottomMargin=0),window.support.topMargin||(window.support.topMargin=0),Core.DeviceUtils.isWXGame()?[4,this.loadResourceWX()]:[3,2];case 1:return t.sent(),[3,4];case 2:return[4,this.loadResource()];case 3:t.sent(),t.label=4;case 4:return fairygui.GTextField.textLocaler=function(t){return Core.StringUtils.TEXT(t)},genPlatformProxy(),genAdsPlatformProxy(),[4,this.createGameScene()];case 5:return t.sent(),[2]}})})},e.prototype.loadJson=function(){console.log("loadJson");var t=/#TEXT_(\d+)/g,e=function(){function e(t){if(this._data=RES.getRes(t),this._keys=[],!this._data)return void console.error("loading json "+t+" failed");for(var e in this._data)isNaN(Number(e))?this._keys.push(e):this._keys.push(Number(e))}return e.prototype.get=function(e){e=e.toString();var i=this._data[e];if(i&&!i.__ischecked__){for(var r in i){var n=i[r];if("string"==typeof n&&n.match(t))i[r]=n.replace(t,function(t,e){return Core.StringUtils.TEXT(parseInt(e))});else if("object"==typeof n){var o=[];for(var s in n){var a=n[s];"string"==typeof a&&a.match(t)?o[s]=a.replace(t,function(t,e){return Core.StringUtils.TEXT(parseInt(e))}):o[s]=a}i[r]=o}}i.__ischecked__=!0,this._data[e]=i}return i},Object.defineProperty(e.prototype,"keys",{get:function(){return this._keys},enumerable:!0,configurable:!0}),e}(),i=RES.getRes("start_json");window.Data={},console.log(""+i);for(var r=function(t){!function(i){i[t]=new e(t+"_json")}(Data)},n=0,o=i;n<o.length;n++){var s=o[n];r(s)}Core.StringUtils.textGameData=Data.text,Core.StringUtils.textGameData2=Data.text2,console.log("loadJson done"),console.log(""+Data.rank.get(5).title)},e.prototype.loadJSScript=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o,s,a,u,h;return __generator(this,function(l){switch(l.label){case 0:return e=0,i=0,window.Data={},r={window:window,Core:Core,Data:Data,dofile_async:null},n={},o=!1,s=!1,u=function(h){var l=this;i++,console.log("loading "+h+" "+e),RES.getResAsync(h).then(function(u){if(e++,console.log("loading "+h+" done "+e),"text_json"==h||"text2_json"==h||"start_json"==h||o&&s?(jsjs.run(u,r),console.log("execute "+h+" done"),"text_json"==h&&(o=!0),"text2_json"==h&&(s=!0)):n[h]=u,e==i&&"start_json"!=h){for(var l in n)jsjs.run(n[l],r),console.log("execute "+l+" done");n=null,a(),a=null}t&&t.onProgress(e,5>i?100:i,null)})["catch"](function(t){console.log("loading "+h+" error:"+t),fairygui.GTimers.inst.callDelay(50,function(){u(h)},l,null)})},r.dofile_async=u,h=new Promise(function(t){a=t,u("start_json")}),[4,h];case 1:return l.sent(),[2]}})})},e.prototype.loadDefaultConfig=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r=this;return __generator(this,function(n){switch(n.label){case 0:t=function(){var t,i,n,o,s,n,a,u;return __generator(this,function(h){switch(h.label){case 0:return h.trys.push([0,11,,13]),t="resource/default.res.json?v=",i="resource/",window.gameGlobal.isPC?(t="resource_pc/default.res.json?v=",i="resource_pc/",[3,6]):[3,1];case 1:return window.gameGlobal.isMultiLan?window.gameGlobal.isFbAdvert?(n=navigator.language,LanguageMgr.inst.initLocale("hk",n),[3,5]):[3,2]:[3,6];case 2:return Core.DeviceUtils.isMobile()?[4,Core.NativeMsgCenter.inst.sendAndWaitNativeMessage(Core.NativeMessage.GET_LOCALE,Core.NativeMessage.GET_LOCALE)]:[3,4];case 3:return o=h.sent(),s=o.country,n=o.language,LanguageMgr.inst.initLocale(s,n),[3,5];case 4:LanguageMgr.inst.initLocale("hk","zh-Hant-HK"),h.label=5;case 5:LanguageMgr.inst.initTextField(),t=i+"/default.res."+LanguageMgr.inst.cur+".json?v=",h.label=6;case 6:return Core.DeviceUtils.isWXGame()?[3,8]:[4,RES.loadConfig(t+Math.random(),i)];case 7:return h.sent(),[3,10];case 8:return a=WXGame.WXGameMgr.getWebClientHost()+"/resource/",console.log(a),[4,RES.loadConfig("default.res.json",a)];case 9:h.sent(),window.gameGlobal.version=RES.config.getResourceVersion(),console.log("++++++++ set resource version: ",window.gameGlobal.version),WXGame.WXGroupLoader.inst.isNewbieLoader?fairygui.GTimers.inst.callDelay(3e4,function(){loadWXFont(a+"fonts/AaKaiTi.ttf",function(){r._cleanText(r.stage)})},e):loadWXFont(a+"fonts/AaKaiTi.ttf",function(){r._cleanText(r.stage)}),fairygui.GTimers.inst.callDelay(3e5,function(){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._cleanText(this.stage),[4,fairygui.GTimers.inst.waitTime(3e5)];case 1:return t.sent(),[3,0];case 2:return[2]}})})},e),h.label=10;case 10:return[2,{value:void 0}];case 11:return u=h.sent(),console.log("load default resource config fail, waiting retry"),[4,fairygui.GTimers.inst.waitTime(100)];case 12:return h.sent(),[2,"continue"];case 13:return[2]}})},e=this,n.label=1;case 1:return[5,t()];case 2:return i=n.sent(),"object"==typeof i?[2,i.value]:[3,1];case 3:return[2]}})})},e.prototype.loadResourceWX=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n,o,s,a,u,h,l,c=this;return __generator(this,function(d){switch(d.label){case 0:return d.trys.push([0,10,,11]),t=(new Date).getTime(),[4,WXGame.initLoaders()];case 1:return d.sent(),[4,WXGame.WXGroupLoader.inst.loadZip("init_wx.zip",null,null)];case 2:return d.sent(),e=(new Date).getTime(),[4,this.loadDefaultConfig()];case 3:return d.sent(),console.log("download init_wx.zip success"),[4,RES.loadGroup("init_wx",0)["catch"](function(t){console.log(t)})];case 4:return d.sent(),console.log("load init_wx success"),i=(new Date).getTime(),Core.LayerManager.setDesignSize(this.stage.stageWidth,this.stage.stageHeight),fairygui.GTimers.inst.add(6e4,-1,this.refreshTextRender,this),Core.init(),fairygui.UIPackage.addPackage(PkgName.loading),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.loading,"loadingProgressBar"),UI.MaskProgressBar),this._loadingView=fairygui.UIPackage.createObject(PkgName.loading,ViewName.loading,LoadingView),this._loadingView.initUI(),this._loadingView.addToParent(),r=WXGame.WXShareType.SHARE_GAME,n=18,o=WXGame.WXGameMgr.getWebClientHost()+"/resource/king_ui/assets/society/shareVideo2.png?"+Date.now(),s=WXGame.WXGameMgr.inst.getBaseWXShareQuery()+("&act="+r+"&shareId="+n),window.sharePlatform.enableShareMenu(!0,"九格棋盘，重拾童年欢乐！",o,s),Core.loadTD(),console.log("download zip"),a=new LoadingReporter(this._loadingView,"loadjs"),WXGame.WXGroupLoader.inst.isNewbieLoader?[4,Promise.all([WXGame.WXGroupLoader.inst.loadGroup("preload_wx",new LoadingReporter(this._loadingView,"preload_wx.zip"),new LoadingReporter(this._loadingView,"preload_wx")),function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,WXGame.WXGroupLoader.inst.loadZip("json_wx.zip",new LoadingReporter(this._loadingView,"json_wx.zip"),!0)];case 1:return t.sent(),[4,RES.loadGroup("json_wx",0,a)];case 2:return t.sent(),[4,this.loadJson()];case 3:return t.sent(),[2]}})})}(),WXGame.WXGroupLoader.inst.loadZip("guide_fight_wx.zip",new LoadingReporter(this._loadingView,"guide_fight_wx.zip"),!0),WXGame.WXGroupLoader.inst.loadZip("fight_effect_wx.zip",new LoadingReporter(this._loadingView,"fight_effect_wx.zip"),!0)])]:[3,6];case 5:d.sent(),d.label=6;case 6:return console.log("download zip success"),u=(new Date).getTime(),WXGame.WXGroupLoader.inst.isNewbieLoader?[3,9]:[3,7];case 7:return[4,Promise.all([RES.loadGroup("json_wx",0,a),RES.loadGroup("preload",0,new LoadingReporter(this._loadingView,"preload"))])];case 8:d.sent(),console.log("load preload success"),this.loadJson(),d.label=9;case 9:return h=(new Date).getTime(),console.log("loading time: init="+(e-t)+" loading="+(i-e)+" json,preload="+(u-i)+" execute="+(h-u)+" total="+(h-t)),[3,11];case 10:return l=d.sent(),console.error(l),[3,11];case 11:return[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),[4,this.loadDefaultConfig()];case 1:return e.sent(),[4,RES.loadGroup("loading",0)["catch"](function(t){egret.log(t)})];case 2:return e.sent(),this.stage.scaleMode=egret.StageScaleMode.NO_SCALE,window.gameGlobal.isPC?Core.LayerManager.setDesignSize(1920,1080):Core.LayerManager.setDesignSize(480,800),Core.init(),fairygui.UIPackage.addPackage(PkgName.loading),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.loading,"loadingProgressBar"),UI.MaskProgressBar),this._loadingView=fairygui.UIPackage.createObject(PkgName.loading,ViewName.loading,LoadingView),this._loadingView.initUI(),this._loadingView.addToParent(),IOS_EXAMINE_VERSION||Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.ON_SHOW_LOADING),Core.loadTD(),[4,Promise.all([RES.loadGroup("json_wx",0,new LoadingReporter(this._loadingView,"json_wx")),RES.loadGroup("preload",0,new LoadingReporter(this._loadingView,"preload"))])];case 3:return e.sent(),this.loadJson(),[3,5];case 4:return t=e.sent(),console.error(t),[3,5];case 5:return[2]}})})},e.prototype.createGameScene=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n,o,s,a,u,h,l,c,d,p,_,g,f,m,y,C,v;return __generator(this,function(T){switch(T.label){case 0:return t=(new Date).getTime(),UI.setPackageItemExtension(),e=fairygui.UIPackage.createObject(PkgName.loading,"netWaiting",Core.WaitPanel),i=fairygui.UIPackage.createObject(PkgName.common,"alertPanel",Core.AlertPanel),r=fairygui.UIPackage.createObject(PkgName.common,"confirmPanel",Core.ConfirmPanel),n=fairygui.UIPackage.createObject(PkgName.common,"PrivShowPanel",Core.PrivShowPanel),o=fairygui.UIPackage.createObject(PkgName.common,"winFlagAni",Core.FlagShowPanel),Core.MaskUtils.registerNetMask(e),Core.TipsUtils.registerAlertPanel(i),Core.TipsUtils.registerConfirmPanel(r),Core.TipsUtils.registerPrivPanel(n),Core.TipsUtils.registerFlagPanel(o),Core.TipsUtils.newTipsCom=function(){return fairygui.UIPackage.createObject(PkgName.common,"tips",UI.TipsCom)},s=Net.SConn.inst.isMaintain(),a=s[0],u=s[1],a?(u&&""!=u?(h=parseInt(u),isNaN(h)||(u=Core.StringUtils.TEXT(h))):u=Core.StringUtils.TEXT(60243),Core.TipsUtils.alert(u),[2]):(l=(new Date).getTime(),Guide.init(),Home.init(),Level.init(),Battle.init(),CardPool.init(),Pvp.init(),Treasure.init(),Social.init(),Shop.init(),TD.init(),Quest.init(),Equip.init(),War.init(),c=(new Date).getTime(),Core.DeviceUtils.isWXGame()&&WXGame.init(),d=null,Core.DeviceUtils.isWXGame()&&WXGame.WXGroupLoader.inst.isNewbieLoader?[3,4]:[3,1]);case 1:return this._loadingView.clear(),_=(p=Promise).all,[4,RES.loadGroup("common",0,new LoadingReporter(this._loadingView,"common"))];case 2:return g=[T.sent()],[4,RES.loadGroup("card",0,new LoadingReporter(this._loadingView,"card"))];case 3:d=_.apply(p,[g.concat([T.sent()])]),T.label=4;case 4:return this._loadingView.hideProgress(!0),Core.DeviceUtils.isWXGame()?[3,8]:[4,platform.init()];case 5:return T.sent(),[4,Net.SConn.inst.connectServer()];case 6:return T.sent(),[4,Home.HomeMgr.inst.enterLogin(this._loadingView)];case 7:return T.sent(),[3,15];case 8:return[4,platform.init()];case 9:return T.sent(),[4,platform.login()];case 10:return T.sent(),[4,Net.SConn.inst.connectServer()];case 11:return T.sent(),[4,Home.HomeMgr.inst.enterLogin(this._loadingView)];case 12:return T.sent(),this._loadingView.hideProgress(!1),this._loadingView.clear(),Core.DeviceUtils.isWXGame()&&WXGame.WXGroupLoader.inst.isNewbieLoader?[4,Promise.all([RES.loadGroup("fight_effect_wx",0,new LoadingReporter(this._loadingView,"fight_effect_wx")),RES.loadGroup("guide_fight_wx",0,new LoadingReporter(this._loadingView,"guide_fight_wx"))])]:[3,14];case 13:T.sent(),T.label=14;case 14:this._loadingView.hideProgress(!0),T.label=15;case 15:return f=(new Date).getTime(),m=(new Date).getTime(),[4,sharePlatform.init()];case 16:return T.sent(),[4,adsPlatform.init()];case 17:return T.sent(),Payment.init(),y=null,C=Home.HomeMgr.inst.needNewbieGuideHome(),window.gameGlobal.isSDKLogin&&(this._loadingView.visible=!1,Core.ViewManager.inst.close(ViewName.login),y=Home.HomeMgr.inst.checkNewbieGuideHome(),this._loadingView.visible=!0),C&&y?[4,y]:[3,19];case 18:T.sent(),T.label=19;case 19:return window.gameGlobal.isSDKLogin?(Core.DeviceUtils.isWXGame(),[4,Home.HomeMgr.inst.onLoginDone()]):[3,21];case 20:T.sent(),Core.DeviceUtils.isWXGame(),T.label=21;case 21:return Core.DeviceUtils.isWXGame()&&WXGame.WXGameMgr.inst.tryHandleLaunchOptions(),[4,d];case 22:return T.sent(),this._loadingView.removeFromParent(),this._loadingView.destroy(),this._loadingView=null,v=(new Date).getTime(),console.log("createScene: "+(v-t)+" = "+(l-t)+" + "+(c-l)+" + "+(f-c)+" + "+(m-f)+" + "+(v-m)),[2]}})})},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Core;!function(t){var e;!function(t){t[t.NO_BORDER=0]="NO_BORDER",t[t.EXACT_FIT=1]="EXACT_FIT",t[t.EXCEPT_MARGIN=2]="EXCEPT_MARGIN"}(e=t.AdjustType||(t.AdjustType={}))}(Core||(Core={}));var Core;!function(t){var e=function(){function e(){var t=egret.MainContext.instance.stage;this._mainLayer=fairygui.GRoot.inst,this._maskLayer=new fairygui.GRoot,this._topLayer=new fairygui.GRoot,e._designWidth&&e._designHeight&&(this._mainLayer.setDesignSize(e._designWidth,e._designHeight),this._maskLayer.setDesignSize(e._designWidth,e._designHeight),this._topLayer.setDesignSize(e._designWidth,e._designHeight)),t.addChild(this._mainLayer.displayObject),t.addChild(this._maskLayer.displayObject),t.addChild(this._topLayer.displayObject),this._layers=[this._mainLayer,this._topLayer]}return Object.defineProperty(e,"inst",{get:function(){return e._inst||(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),e.setDesignSize=function(t,i){e._designWidth=t,e._designHeight=i,e._inst&&(e._inst._mainLayer.setDesignSize(e._designWidth,e._designHeight),e._inst._maskLayer.setDesignSize(e._designWidth,e._designHeight),e._inst._topLayer.setDesignSize(e._designWidth,e._designHeight))},Object.defineProperty(e.prototype,"mainLayer",{get:function(){return this._mainLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maskLayer",{get:function(){return this._maskLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLayer",{get:function(){return this._topLayer},enumerable:!0,configurable:!0}),e.prototype.getTopView=function(){for(var e=this._layers.length-1;e>=0;e--)for(var i=this._layers[e],r=i.numChildren,n=r-1;n>=0;n--){var o=i.getChildAt(n);if(o instanceof t.BaseView)return o;if(o instanceof t.BaseWindow)return o}return null},e}();t.LayerManager=e,__reflect(e.prototype,"Core.LayerManager")}(Core||(Core={}));var Core;!function(t){var e=function(){function e(t){this._view=t}return e.prototype.adjust=function(e,i){if(void 0===i&&(i=t.AdjustType.EXACT_FIT),t.DeviceUtils.isMobile()||window.gameGlobal.isPC){if(t.DeviceUtils.isWXGame())return void this._doAdjust(e,i);this._adjustObjs||(this._adjustObjs=new Array,fairygui.GRoot.inst.displayObject.stage.addEventListener(egret.Event.RESIZE,this._onResize,this)),this._adjustObjs.push([e,i]),this._doAdjust(e,i)}},e.prototype._onResize=function(){var t=this;this._adjustObjs.forEach(function(e){t._doAdjust(e[0],e[1])})},e.prototype._doAdjust=function(e,i){void 0===i&&(i=t.AdjustType.EXACT_FIT);var r=fairygui.GRoot.inst;if(i==t.AdjustType.NO_BORDER){var n=r.getDesignStageWidth()/this._view.width,o=r.getDesignStageHeight()/this._view.height,s=n>o?n:o;e.width=e.initWidth*s,e.height=e.initHeight*s}else{var a=void 0;if(e instanceof fairygui.GComponent&&(a=e.getChild("adjustContext")),e.width=r.getDesignStageWidth(),e.height=r.getDesignStageHeight(),a){var n=r.getDesignStageWidth()/this._view.width,o=r.getDesignStageHeight()/this._view.height,s=n>o?n:o;a.width=a.initWidth*s,a.height=a.initHeight*s}}console.log(e.width+","+window.support.topMargin),e.x=this._view.width/2-e.width/2,e.y=this._view.height/2-e.height/2,t.DeviceUtils.isWXGame()&&(this._view.y=-e.y)},e.prototype.destroy=function(){this._adjustObjs&&(fairygui.GRoot.inst.displayObject.stage.removeEventListener(egret.Event.RESIZE,this._onResize,this),this._adjustObjs=null),this._view=null},e.prototype.getSubNode=function(t,e,i){var r=t.getChild(e);if(r)return r;for(var n=t.numChildren,o=0;n>o;o++){var s=t.getChildAt(o);if(!s)break;s instanceof fairygui.GComponent&&i.push(s)}return null},e.prototype.getNode=function(t){var e=[],i=this.getSubNode(this._view,t,e);if(i)return i;for(var r=0;r<e.length;r++)if(i=this.getSubNode(e[r],t,e))return i;return null},e}();t.ViewCommon=e,__reflect(e.prototype,"Core.ViewCommon")}(Core||(Core={}));var Core;!function(t){var e=function(){function t(t){this.__constructor=t}return t.prototype.call=function(){return this.__constructor()},t}();t.UIConstructor=e,__reflect(e.prototype,"Core.UIConstructor");var i=function(){function i(){this._views=new Collection.Dictionary,this._opens=new Collection.Set,this._opening=new Collection.Dictionary,this._closing=new Collection.Dictionary,this._viewConstructors=new Collection.Dictionary,this._viewPreload=new Collection.Dictionary,this._registerViews=[]}return Object.defineProperty(i,"inst",{get:function(){return i._inst||(i._inst=new i),i._inst},enumerable:!0,configurable:!0}),i.prototype.register=function(t,e){return null==e?void console.log("UI_"+t+" is null!"):this._views.getValue(t)?void console.log("UI_"+t+" is registered!"):(e.name=t,void this._views.setValue(t,e))},i.prototype.unregister=function(t){this._views.remove(t)},i.prototype.registerConstructor=function(t,i,r){void 0===r&&(r=null),this._viewConstructors.containsKey(t)&&this._viewConstructors.remove(t),this._viewPreload.containsKey(t)&&this._viewPreload.remove(t),this._viewConstructors.setValue(t,new e(i)),this._viewPreload.setValue(t,r),this._registerViews.push(t)},i.prototype.registerView=function(e,i){t.DeviceUtils.isWXGame()?this.registerConstructor(e,i):this.register(e,i())},i.prototype.destroy=function(t){var e=this.getView(t);e&&(this.unregister(t),e.destroy(),e=null)},i.prototype.createAllView=function(){var t=this;this._registerViews.forEach(function(e,i,r){t.tryCreateView(e)})},i.prototype.tryCreateView=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return this._views.getValue(t)?[2]:(e=null,i=this._viewConstructors.getValue(t),console.log("create view "+t),r=this._viewPreload.getValue(t),null!=i?[3,1]:(console.log("UI_"+t+" not exist"),[2]));case 1:return r?[4,r()]:[3,3];case 2:n.sent(),n.label=3;case 3:try{e=i.call(),e.setVisible(!1),e.initUI(),this.register(t,e)}catch(o){console.error("create view error",t,o)}n.label=4;case 4:return[2]}})})},i.prototype.open=function(e){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,n,o,s;return __generator(this,function(a){switch(a.label){case 0:return[4,this.tryCreateView(e)];case 1:return a.sent(),r=this.getView(e),null==r?[2]:(n=this._opening.getValue(e),n?[4,n]:[3,3]);case 2:return a.sent(),[2];case 3:return r.setVisible(!0),r.isInit()?(r.addToParent(),o=r.open.apply(r,i),this._opening.setValue(e,o),[4,o]):[3,5];case 4:return a.sent(),this._opening.remove(e),[3,7];case 5:return r.addToParent(),r.initUI(),s=r.open.apply(r,i),this._opening.setValue(e,s),[4,s];case 6:a.sent(),this._opening.remove(e),a.label=7;case 7:return this._opens.add(e),t.EventCenter.inst.dispatchEventWith(t.Event.OpenViewEvt,!1,e),[2]}})})},i.prototype.openPopup=function(e){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a,u,h;return __generator(this,function(l){switch(l.label){case 0:return[4,this.tryCreateView(e)];case 1:return l.sent(),r=this.getView(e),null==r?[2]:(n=this._opening.getValue(e),n?[4,n]:[3,3]);case 2:return l.sent(),[2];case 3:return r.setVisible(!0),r instanceof t.BaseWindow?(o=r,o.isInit()?(s=o.open.apply(o,i),this._opening.setValue(e,s),[4,s]):[3,5]):[3,8];case 4:return l.sent(),this._opening.remove(e),[3,7];case 5:return o.initUI(),a=o.open.apply(o,i),this._opening.setValue(e,a),[4,a];case 6:l.sent(),this._opening.remove(e),l.label=7;case 7:return u=o.x,h=o.y,fairygui.GRoot.inst.showPopup(o),o.x=u,o.y=h,this._opens.add(e),t.EventCenter.inst.dispatchEventWith(t.Event.OpenViewEvt,!1,e),[3,10];case 8:return[4,this.open.apply(this,[e].concat(i))];case 9:l.sent(),l.label=10;case 10:return[2]}})})},i.prototype.close=function(e){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(o){switch(o.label){case 0:return this.isShow(e)?(r=this.getView(e),null==r?[2]:(n=this._closing.getValue(e),n?[4,n]:[3,2])):[2];case 1:return o.sent(),[2];case 2:return n=new Promise(function(t){r.close.apply(r,i).then(function(){r.removeFromParent(),t()})}),this._closing.setValue(e,n),[4,n];case 3:return o.sent(),this._closing.remove(e),this._opens.remove(e),this._viewConstructors.containsKey(e),t.EventCenter.inst.dispatchEventWith(t.Event.CloseViewEvt,!1,e),[2]}})})},i.prototype.openView=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.open.apply(this,[t.name].concat(e))];case 1:return i.sent(),[2]}})})},i.prototype.closeView=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.close.apply(this,[t.name].concat(e))];case 1:return i.sent(),[2]}})})},i.prototype.getView=function(t){return this._views.getValue(t)},i.prototype.closeAll=function(){var t=this;this._opens.toArray().forEach(function(e){t.close(e)})},i.prototype.isShow=function(t){return this._opens.contains(t)},i}();t.ViewManager=i,__reflect(i.prototype,"Core.ViewManager")}(Core||(Core={}));var Core;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(i){e.prototype.constructFromXML.call(this,i),this.getChild("title").asTextField.funcParser=t.StringUtils.parseFuncText},i.prototype.getAcceptBtn=function(){return this.getChild("acceptBtn").asButton},i.prototype.getTitle=function(){return this.getChild("title").asTextField},i}(fairygui.GComponent);t.AlertPanel=e,__reflect(e.prototype,"Core.AlertPanel",["Core.IAlertPanel"]);var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(i){e.prototype.constructFromXML.call(this,i),this.getChild("title").asTextField.funcParser=t.StringUtils.parseFuncText},i.prototype.getAcceptBtn=function(){return this.getChild("acceptBtn").asButton},i.prototype.getCancelBtn=function(){return this.getChild("cancelBtn").asButton},i.prototype.getTitle=function(){return this.getChild("title").asTextField},i}(fairygui.GComponent);t.ConfirmPanel=i,__reflect(i.prototype,"Core.ConfirmPanel",["Core.IConfirmPanel","Core.IAlertPanel"]);var r=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._privList=this.getChild("privList").asList},i.prototype.getPrivList=function(){return this._privList},i.prototype.showTip=function(e){this._time=2;var i=this._privList.addItemFromPool().asCom,r="",n=0;if(e==Priv.VIP_PRIV){var o=Payment.PayMgr.inst.getProducts(),s=o.getValue("advip");r="shop_"+s.icon+"_png",n=10700}else{var a=e,s=Data.priv_config.get(a);r="reborn_"+s.icon+"_png",n=Utils.priv2descText(e)}i.getChild("icon").asLoader.url=r,i.getChild("text").asTextField.textParser=t.StringUtils.parseColorText,i.getChild("text").asTextField.text=t.StringUtils.TEXT(n),i.getTransition("t0").play(),fairygui.GTimers.inst.remove(this._privTimer,this),fairygui.GTimers.inst.add(1e3,-1,this._privTimer,this)},i.prototype._privTimer=function(){this._time-=1,this._time<=0&&(fairygui.GTimers.inst.remove(this._privTimer,this),this._privList.removeChildrenToPool(),t.TipsUtils.closePrivTips())},i}(fairygui.GComponent);t.PrivShowPanel=r,__reflect(r.prototype,"Core.PrivShowPanel");var n=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this.touchable=!1,this._flagNumText=this.getChild("text").asTextField},i.prototype.showTip=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){switch(n.label){case 0:return this._modify=e-t,this._fromNum=t,this._toNum=e,this.y=300,i=20,r=50,this._stepNum=this._modify/i,this._flagNumText.text=t.toString(),this._modify>0?[4,this._playWinTransotion()]:[3,2];case 1:return n.sent(),[3,4];case 2:return[4,this._playLoseTransotion()];case 3:n.sent(),n.label=4;case 4:return fairygui.GTimers.inst.remove(this._flagTimer,this),fairygui.GTimers.inst.add(r,i,this._flagTimer,this),[2]}})})},i.prototype._playWinTransotion=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){t.getTransition("win").play(function(){e()},t)})];case 1:return e.sent(),[2]}})})},i.prototype._playLoseTransotion=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){t.getTransition("lose").play(function(){e()},t)})];case 1:return e.sent(),[2]}})})},i.prototype._flagTimer=function(){return __awaiter(this,void 0,void 0,function(){var e,i=this;return __generator(this,function(r){return this._fromNum+=this._stepNum,e=Math.round(this._fromNum),this._flagNumText.text=e.toString(),e==this._toNum&&window.setTimeout(function(){fairygui.GTimers.inst.remove(i._flagTimer,i),t.TipsUtils.closeFlagTips()},1e3),[2]})})},i}(fairygui.GComponent);t.FlagShowPanel=n,__reflect(n.prototype,"Core.FlagShowPanel")}(Core||(Core={}));var Core;!function(t){var e=function(t){function e(e){var i=t.call(this)||this;return i._movieClip=e,i._movieClip.$owner=i,i._movieClip.touchEnabled=!1,i.setDisplayObject(i._movieClip),i}return __extends(e,t),Object.defineProperty(e.prototype,"totalFrames",{get:function(){return this._movieClip.totalFrames},enumerable:!0,configurable:!0}),e.prototype.gotoAndPlay=function(t,e){this._movieClip.gotoAndPlay(t,e)},e.prototype.gotoAndStop=function(t){this._movieClip.gotoAndStop(t)},e.prototype.stop=function(){this._movieClip.stop()},e.prototype.once=function(t,e,i,r,n){this._movieClip.once(t,e,i,r,n)},e.prototype.addFrameEvent=function(t,e){this._movieClip.movieClipData.events[t]=e},e}(fairygui.GObject);t.EMovieClip=e,__reflect(e.prototype,"Core.EMovieClip")}(Core||(Core={}));var Core;!function(t){var e=function(e){function i(){return e.call(this,t.LayerManager.inst.maskLayer)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this._waitImg=this.getChild("loadingCircle").asLoader},i.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.parent?[2]:(this.addToParent(),this._waitImg.visible=!1,fairygui.GTimers.inst.add(800,1,this.rotationWaitImg,this),[2])})})},i.prototype.rotationWaitImg=function(){this._waitImg.visible=!0,t.EffectUtil.rotationEffect(this._waitImg,1e3)},i.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.parent?(this.parent.removeChild(this),fairygui.GTimers.inst.remove(this.rotationWaitImg,this),t.EffectUtil.removeRotationEffect(this._waitImg),[2]):[2]})})},i}(t.BaseView);t.WaitPanel=e,__reflect(e.prototype,"Core.WaitPanel")}(Core||(Core={}));var ResType;!function(t){t[t.T_WEAP=1]="T_WEAP",t[t.T_HORSE=2]="T_HORSE",t[t.T_MAT=3]="T_MAT",t[t.T_GOLD=4]="T_GOLD",t[t.T_FORAGE=5]="T_FORAGE",t[t.T_MED=6]="T_MED",t[t.T_BAN=7]="T_BAN",t[t.T_WINE=8]="T_WINE",t[t.T_BOOK=9]="T_BOOK",t[t.T_JADE=11]="T_JADE",t[t.T_FEAT=12]="T_FEAT",t[t.T_FAME=13]="T_FAME",t[t.T_EQUIP=14]="T_EQUIP",t[t.T_BOWLDER=15]="T_BOWLDER",t[t.T_SCORE=100]="T_SCORE",t[t.T_GUIDE_PRO=101]="T_GUIDE_PRO",t[t.T_MAX_SCORE=102]="T_MAX_SCORE",t[t.T_ACC_TREASURE_CNT=103]="T_ACC_TREASURE_CNT",t[t.T_NO_SUB_STAR_CNT=104]="T_NO_SUB_STAR_CNT",t[t.PvpTreasureCnt=105]="PvpTreasureCnt",t[t.PvpGoldCnt=106]="PvpGoldCnt",t[t.SeasonWinDiff=107]="SeasonWinDiff"}(ResType||(ResType={}));var Priv;!function(t){t[t.VIP_PRIV=0]="VIP_PRIV",t[t.TREASURE_ADD_CARD=1]="TREASURE_ADD_CARD",t[t.TREASURE_ADD_GOLD=2]="TREASURE_ADD_GOLD",t[t.REWARD_ADD_TREASURE=3]="REWARD_ADD_TREASURE",t[t.TREASURE_ADD_ACC_CNT=4]="TREASURE_ADD_ACC_CNT",t[t.DAILY_ADD_CARD=5]="DAILY_ADD_CARD",t[t.TREASURE_SUB_TIME=6]="TREASURE_SUB_TIME",t[t.BATTLE_ADD_GOLD=7]="BATTLE_ADD_GOLD",t[t.BATTLE_ADD_STAR=8]="BATTLE_ADD_STAR",t[t.BATTLE_NOT_SUB_STAR=9]="BATTLE_NOT_SUB_STAR"}(Priv||(Priv={}));var Camp;!function(t){t[t.WEI=1]="WEI",t[t.SHU=2]="SHU",t[t.WU=3]="WU",t[t.HEROS=4]="HEROS"}(Camp||(Camp={}));var Job;!function(t){t[t.UnknowJob=0]="UnknowJob",t[t.YourMajesty=1]="YourMajesty",t[t.Counsellor=2]="Counsellor",t[t.General=3]="General",t[t.Prefect=4]="Prefect",t[t.DuWei=5]="DuWei",t[t.FieldOfficer=6]="FieldOfficer"}(Job||(Job={}));var JobType;!function(t){t[t.Null=0]="Null",t[t.CityJob=1]="CityJob",t[t.CountryJob=2]="CountryJob"}(JobType||(JobType={}));var WarResType;!function(t){t[t.Gold=0]="Gold",t[t.Defense=1]="Defense",t[t.Agriculture=2]="Agriculture",t[t.Business=3]="Business",t[t.Forage=4]="Forage",t[t.Glory=5]="Glory",t[t.Contribution=100]="Contribution"}(WarResType||(WarResType={}));var WarMsType;!function(t){t[t.UnknowMsType=0]="UnknowMsType",t[t.Irrigation=1]="Irrigation",t[t.Trade=2]="Trade",t[t.Build=3]="Build",t[t.Transport=4]="Transport",t[t.Dispatch=5]="Dispatch"}(WarMsType||(WarMsType={}));var WarTranType;!function(t){t[t.Gold=0]="Gold",t[t.Forage=1]="Forage"}(WarTranType||(WarTranType={}));var RewardType;!function(t){t[t.REWARD=0]="REWARD",t[t.DAILY=1]="DAILY"}(RewardType||(RewardType={}));var CardQuality;!function(t){t[t.NORMAL=1]="NORMAL",t[t.RARE=2]="RARE",t[t.EPIC=3]="EPIC",t[t.LEGENDARY=4]="LEGENDARY",t[t.BOOM=5]="BOOM",t[t.LIMITED=99]="LIMITED"}(CardQuality||(CardQuality={}));var CardJade;!function(t){t[t.NORMAL=3]="NORMAL",t[t.RARE=4]="RARE",t[t.EPIC=5]="EPIC",t[t.LEGENDARY=6]="LEGENDARY",t[t.BOOM=7]="BOOM",t[t.LIMITED=0]="LIMITED"}(CardJade||(CardJade={}));var IOS_EXAMINE_VERSION=!1,Util;!function(t){function e(t,e){for(var i=new Array,n=t.vertexNum,o=0;n>o;o++){var s=new r;s.path=[e,o],s.value=t.arc[e][o],i.push(s)
}i[e].value=0,i[e].visit=!0;for(var a=1;n>a;a++){for(var u=0,h=Number.MAX_VALUE,o=0;n>o;o++)!i[o].visit&&i[o].value<h&&(h=i[o].value,u=o);i[u].visit=!0;for(var o=0;n>o;o++)!i[o].visit&&t.arc[u][o]!=Number.MAX_VALUE&&i[u].value+t.arc[u][o]<i[o].value&&(i[o].value=i[u].value+t.arc[u][o],i[o].path=i[u].path.concat([o]))}return i}var i=function(){function t(t){this._arc=new Array,this._vertexNum=t;for(var e=0;t>e;e++){for(var i=new Array,r=0;t>r;r++)i.push(Number.MAX_VALUE);this._arc.push(i)}this._initialized=!1}return Object.defineProperty(t.prototype,"vertexNum",{get:function(){return this._vertexNum},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"arc",{get:function(){return this._arc},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initialized",{get:function(){return this._initialized},enumerable:!0,configurable:!0}),t.prototype.addAdjacentPoint=function(t,e,i){return 0>t||t>=this._vertexNum||0>e||e>=this._vertexNum?!1:(this._arc[t][e]=i,this._arc[e][t]=i,this._initialized=!0,!0)},t.prototype.reset=function(){for(var t=0;t<this._vertexNum;t++)for(var e=0;e<this._vertexNum;e++)this._arc[t][e]=Number.MAX_VALUE;this._initialized=!1},t}();t.DjAdjacencyMatrix=i,__reflect(i.prototype,"Util.DjAdjacencyMatrix");var r=function(){function t(){this.path=new Array,this.value=0,this.visit=!1}return t}();t.DjDistance=r,__reflect(r.prototype,"Util.DjDistance"),t.Dijkstra=e}(Util||(Util={}));var GameEvent=function(){function t(){}return t.CampaignSwitchTypeEv="CampaignSwitchTypeEv",t.CampaignExchangeCardEv="CampaignExchangeCardEv",t.BattleBeginEv="BattleBeginEv",t.BattleEndEv="BattleEndEv",t.BattlePlayCardEv="BattlePlayCardEv",t.OpenHomeEv="OpenHomeEv",t.ClearLevelEv="ClearLevelEv",t.BeginDragGuideEv="BeginDragGuideEv",t.PvpLevelChangeEv="PvpLevelChangeEv",t.FightPoolUpdateCardEv="FightPoolUpdateCardEv",t.ModifyNameEv="ModifyNameEv",t.ModifyAvatarEv="ModifyAvatarEv",t.ModifyFrameEv="ModifyFrameEv",t.MatchStopEv="MatchStopEv",t.AddFriend="AddFriend",t.DelFriend="DelFriend",t.DeletedByFriend="BeDeleted",t.ChannelChatEv="ChannelChatEv",t.PrivateChat="PrivateChat",t.PrivateChatHintEv="PrivateChatHintEv",t.ApplyFriendHintEv="ApplyFriendHintEv",t.BeInviteBattleEv="BeInviteBattleEv",t.InviteBattleResEv="InviteBattleResEv",t.WXInviteBattleResEv="WXInviteBattleResEv",t.LoadConfigDoneEv="LoadConfigDoneEv",t.AddLimitedCardEv="AddLimitedCardEv",t.RefreshLimitGiftEv="RefreshLimitGiftEv",t.LimitGiftSoldOutEv="LimitGiftSoldOutEv",t.RefreshSoldTreasureEv="RefreshLimitGiftEv",t.RefreshSoldGoldEv="RefreshSoldGoldEv",t.ShopFreeAvailableEv="ShopFreeAvailableEv",t.ShopFreeUnavailableEv="ShopFreeUnavailableEv",t.UpTreasureRareEv="UpTreasureRareEv",t.AddTreasureCardEv="AddTreasureCardEv",t.SDKRechargeSuccessEv="WXRechargeSuccessEv",t.VideoDataToBattle="VideoDataToBattle",t.ShareIOSOK="ShareIOSOK",t.UpdateSeasonTime="UpdateSeasonTime",t.SeasonBegin="SeasonBegin",t.SeasonEnd="SeasonEnd",t.BuyRebornGoods="BuyRebornGoods",t.RankCardUpdate="RankCardUpdate",t.ShowRankCard="ShowRankCard",t.CardDelEv="CardDelEv",t.CardInCampaignMsEv="CardInCampaignMsEv",t.UnSubscribeChatEv="UnSubscribeChatEv",t}();__reflect(GameEvent.prototype,"GameEvent");var Utils=function(){function t(){}return t.camp2Text=function(t){switch(t){case Camp.WEI:return Core.StringUtils.TEXT(70194);case Camp.SHU:return Core.StringUtils.TEXT(70195);case Camp.WU:return Core.StringUtils.TEXT(70196);case Camp.HEROS:return Core.StringUtils.TEXT(70197);default:return""}},t.job2Color=function(t){switch(t){case Job.UnknowJob:return"";case Job.YourMajesty:return"#cfce75c";case Job.Counsellor:return"#cfc5c5c";case Job.General:return"#cfc855c";case Job.Prefect:return"#cc95cfc";case Job.DuWei:return"#c5ca4fc";case Job.FieldOfficer:return"#c5cfc60";default:return""}},t.job2Text=function(e,i){switch(void 0===i&&(i=!1),e){case Job.UnknowJob:return"";case Job.YourMajesty:return i?t.job2Color(e)+Core.StringUtils.TEXT(70346)+"#n":Core.StringUtils.TEXT(70346);case Job.Counsellor:return i?t.job2Color(e)+Core.StringUtils.TEXT(70347)+"#n":Core.StringUtils.TEXT(70347);case Job.General:return i?t.job2Color(e)+Core.StringUtils.TEXT(70348)+"#n":Core.StringUtils.TEXT(70348);case Job.Prefect:return i?t.job2Color(e)+Core.StringUtils.TEXT(70349)+"#n":Core.StringUtils.TEXT(70349);case Job.DuWei:return i?t.job2Color(e)+Core.StringUtils.TEXT(70350)+"#n":Core.StringUtils.TEXT(70350);case Job.FieldOfficer:return i?t.job2Color(e)+Core.StringUtils.TEXT(70351)+"#n":Core.StringUtils.TEXT(70351);default:return""}},t.job2TextDesc=function(e,i){switch(void 0===i&&(i=!1),e){case Job.UnknowJob:return"";case Job.YourMajesty:return i?t.job2Color(e)+Core.StringUtils.format("#fdesc,70208({0})#e",Core.StringUtils.TEXT(70346))+"#n":Core.StringUtils.format("#fdesc,70208({0})#e",Core.StringUtils.TEXT(70346));case Job.Counsellor:return i?t.job2Color(e)+Core.StringUtils.format("#fdesc,70209({0})#e",Core.StringUtils.TEXT(70347))+"#n":Core.StringUtils.format("#fdesc,70209({0})#e",Core.StringUtils.TEXT(70347));case Job.General:return i?t.job2Color(e)+Core.StringUtils.format("#fdesc,70210({0})#e",Core.StringUtils.TEXT(70348))+"#n":Core.StringUtils.format("#fdesc,70210({0})#e",Core.StringUtils.TEXT(70348));case Job.Prefect:return i?t.job2Color(e)+Core.StringUtils.format("#fdesc,70211({0})#e",Core.StringUtils.TEXT(70349))+"#n":Core.StringUtils.format("#fdesc,70211({0})#e",Core.StringUtils.TEXT(70349));case Job.DuWei:return i?t.job2Color(e)+Core.StringUtils.format("#fdesc,70212({0})#e",Core.StringUtils.TEXT(70350))+"#n":Core.StringUtils.format("#fdesc,70212({0})#e",Core.StringUtils.TEXT(70350));case Job.FieldOfficer:return i?t.job2Color(e)+Core.StringUtils.format("#fdesc,70213({0})#e",Core.StringUtils.TEXT(70351))+"#n":Core.StringUtils.format("#fdesc,70213({0})#e",Core.StringUtils.TEXT(70351));default:return""}},t.doubleJob=function(e,i,r){void 0===r&&(r=!1);var n="";return n=e!=Job.UnknowJob&&i!=Job.UnknowJob?t.job2TextDesc(e,r)+" "+t.job2TextDesc(i,r):""+t.job2TextDesc(e,r)+t.job2TextDesc(i,r)},t.job2descText=function(t){switch(t){case Job.UnknowJob:return"";case Job.YourMajesty:return Core.StringUtils.TEXT(70208);case Job.Counsellor:return Core.StringUtils.TEXT(70209);case Job.General:return Core.StringUtils.TEXT(70210);case Job.Prefect:return Core.StringUtils.TEXT(70211);case Job.DuWei:return Core.StringUtils.TEXT(70212);case Job.FieldOfficer:return Core.StringUtils.TEXT(70213)}},t.job2Type=function(t){switch(t){case Job.UnknowJob:return JobType.Null;case Job.YourMajesty:return JobType.CountryJob;case Job.Counsellor:return JobType.CountryJob;case Job.General:return JobType.CountryJob;case Job.Prefect:return JobType.CityJob;case Job.DuWei:return JobType.CityJob;case Job.FieldOfficer:return JobType.CityJob}},t.warResType2Url=function(t){switch(t){case WarResType.Gold:return"common_goldIcon_png";case WarResType.Defense:return"war_cityHpIcon_png";case WarResType.Agriculture:return"war_foodBagIcon_png";case WarResType.Business:return"war_goldBagIcon_png";case WarResType.Forage:return"war_foodIcon_png";case WarResType.Glory:return"war_honorIcon_png";case WarResType.Contribution:return"war_fightIcon_png"}},t.warResType2desc=function(t){switch(t){case WarResType.Gold:return Core.StringUtils.TEXT(70207);case WarResType.Defense:return Core.StringUtils.TEXT(70202);case WarResType.Agriculture:return Core.StringUtils.format(Core.StringUtils.TEXT(70203),Data.parameter.get("forage_conversion").para_value[0]);case WarResType.Business:return Core.StringUtils.format(Core.StringUtils.TEXT(70204),Data.parameter.get("gold_conversion").para_value[0]);case WarResType.Forage:return Core.StringUtils.TEXT(70206);case WarResType.Glory:return Core.StringUtils.TEXT(70205)}},t.warMsType2Url=function(t){switch(t){case WarMsType.Build:return"war_cityHpIcon_png";case WarMsType.Irrigation:return"war_foodBagIcon_png";case WarMsType.Trade:return"war_goldBagIcon_png";default:return"common_goldIcon_png"}},t.warMsType2WarResType=function(t){switch(t){case WarMsType.Build:return WarResType.Defense;case WarMsType.Trade:return WarResType.Business;case WarMsType.Irrigation:return WarResType.Agriculture;default:return null}},t.warMsTextType2Url=function(t){switch(t){case WarMsType.Build:return"war_buildHpText_png";case WarMsType.Irrigation:return"war_buildFoodText_png";case WarMsType.Trade:return"war_buildGoldText_png";case WarMsType.Transport:return"";default:return""}},t.warMsBgType2Url=function(t){switch(t){case WarMsType.Build:return"war_buildHpBg_png";case WarMsType.Irrigation:return"war_buildFoodBg_png";case WarMsType.Trade:return"war_buildGoldBg_png";case WarMsType.Transport:return"war_buildTransBg_png";default:return"war_buildAddBg_png"}},t.warMsType2text=function(t){switch(t){case WarMsType.Irrigation:return Core.StringUtils.TEXT(70352);case WarMsType.Trade:return Core.StringUtils.TEXT(70353);case WarMsType.Build:return Core.StringUtils.TEXT(70354);case WarMsType.Transport:return Core.StringUtils.TEXT(70355);case WarMsType.Dispatch:return Core.StringUtils.TEXT(70356);default:return Core.StringUtils.TEXT(70269)}},t.warMsDesc2text=function(t){switch(t){case WarMsType.Irrigation:return Core.StringUtils.TEXT(70357);case WarMsType.Trade:return Core.StringUtils.TEXT(70358);case WarMsType.Build:return Core.StringUtils.TEXT(70359);case WarMsType.Transport:return Core.StringUtils.TEXT(70360);case WarMsType.Dispatch:return Core.StringUtils.TEXT(70361);default:return Core.StringUtils.TEXT(70269)}},t.warTranType2textUrl=function(t){switch(t){case pb.TransportTypeEnum.GoldTT:return"war_buildAddBg_png";case pb.TransportTypeEnum.ForageTT:return"war_buildAddBg_png";default:return""}},t.warTranType2text=function(t){switch(t){case pb.TransportTypeEnum.GoldTT:return Core.StringUtils.TEXT(70362);case pb.TransportTypeEnum.ForageTT:return Core.StringUtils.TEXT(70363);default:return""}},t.warMsType2time=function(t){switch(t){case WarMsType.Irrigation:return 3600*Data.parameter.get("irrigation_time").para_value[0];case WarMsType.Trade:return 3600*Data.parameter.get("trade_time").para_value[0];case WarMsType.Build:return 3600*Data.parameter.get("build_time").para_value[0];case WarMsType.Transport:return 3600*Data.parameter.get("march_speed").para_value[0];default:return 0}},t.rankChangeType2Text=function(t){switch(t){case pb.FetchSeasonHandCardReply.ChangeTypeEnum.Fight:return[70174,70177];case pb.FetchSeasonHandCardReply.ChangeTypeEnum.Win:return[70172,70175];case pb.FetchSeasonHandCardReply.ChangeTypeEnum.Lose:return[70173,70176]}},t.camp2Url=function(t){switch(t){case Camp.WEI:return"cardpool_weiFlag_png";case Camp.SHU:return"cardpool_shuFlag_png";case Camp.WU:return"cardpool_wuFlag_png";case Camp.HEROS:return"cardpool_qunFlag_png";default:return"cardpool_weiFlag_png"}},t.resType2Text=function(t){switch(t){case ResType.T_WEAP:return"武器";case ResType.T_HORSE:return"马匹";case ResType.T_MAT:return"辎重";case ResType.T_GOLD:return"金币";case ResType.T_FORAGE:return"粮草";case ResType.T_MED:return"桃";case ResType.T_BAN:return"绷带";case ResType.T_WINE:return"酒";case ResType.T_BOOK:return"书";default:return""}},t.priv2descText=function(t){switch(t){case Priv.VIP_PRIV:return 10700;case Priv.TREASURE_ADD_CARD:return 10701;case Priv.TREASURE_ADD_GOLD:return 10702;case Priv.REWARD_ADD_TREASURE:return 10703;case Priv.TREASURE_ADD_ACC_CNT:return 10704;case Priv.DAILY_ADD_CARD:return 10705;case Priv.TREASURE_SUB_TIME:return 10706;case Priv.BATTLE_ADD_GOLD:return 10707;case Priv.BATTLE_ADD_STAR:return 10708;case Priv.BATTLE_NOT_SUB_STAR:return 10709}},t.resType2Icon=function(t){switch(t){case ResType.T_BAN:return"common_ban_png";case ResType.T_BOOK:return"common_book_png";case ResType.T_FORAGE:return"common_forage_png";case ResType.T_GOLD:return"common_goldIcon_png";case ResType.T_JADE:return"common_jadeIcon_png";case ResType.T_BOWLDER:return"common_bowlderIcon_png";case ResType.T_HORSE:return"common_horse_png";case ResType.T_MAT:return"common_mat_png";case ResType.T_MED:return"common_med_png";case ResType.T_WEAP:return"common_weap_png";case ResType.T_WINE:return"common_wine_png";default:return"common_book_png"}},t.resType2Texture=function(e){return RES.getRes(t.resType2Icon(e))},t.resTypePriority=function(t){switch(t){case ResType.T_WEAP:return 1;case ResType.T_HORSE:return 0;case ResType.T_MAT:return 2;case ResType.T_GOLD:return 6;case ResType.T_FORAGE:return 4;case ResType.T_MED:return 4;case ResType.T_BAN:return 5;case ResType.T_WINE:return 7;case ResType.T_BOOK:return 8;default:return 9}},t.str2num=function(t){t=t.trim();var e=parseInt(t);return isNaN(e)||t.length<=0||t.length!=e.toString().length?!1:e},t.setImageUrlPicture=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){switch(o.label){case 0:return[4,Social.SocialMgr.inst.getTextureByResUrl(e)];case 1:return i=o.sent(),i&&(r=t.width,n=t.height,t.texture=i,t.width=r,t.height=n),[2]}})})},t.getResolutionDistance=function(){return fairygui.GRoot.inst.getDesignStageHeight()-800-window.support.topMargin-window.support.bottomMargin},t}();__reflect(Utils.prototype,"Utils");var PkgName=function(){function t(){}return t.loading="loading",t.common="common",t.bmpfont="bmpfont",t.login="login",t.home="home",t.level="level",t.card_b="card_b",t.card_m="card_m",t.card_s="card_s",t.card_u="card_u",t.cards="cards",t.cardpool="cardpool",t.pvp="pvp",t.social="society",t.campign="campign",t.battle="battle",t.diy="diy",t.guide="guide",t.treasure="treasure",t.shop="shop",t.reborn="reborn",t.equip="equip",t.war="war",t}();__reflect(PkgName.prototype,"PkgName");var ViewName=function(){function t(){}return t.loading="loading",t.login="loginNew",t.facebookLogin="loginFacebook",t.noticeView="noticePanel",t.connectView="connectCircle",t.descTipsWnd="descTip",t.home="home",t.newHome="newHome",t.level="level",t.cardpool="cardpool",t.cardInfo="cardInfo",t.skillInfo="skillInfo",t.match="match",t.videoHall="videoHall",t.videoRecord="videoSelf",t.videoSearch="videoSearch",t.videoUpload="videoUpload",t.videoDiscuss="videoDiscuss",t.team="newMatch",t.choiceFightCard="choiceFightCard",t.choiceCamp="choiceCamp",t.attackCastle="attackCastle",t.matching="matching",t.battle="battle",t.cardDetail="cardDetail",t.bigCard="bigCard",t.pvpBattleEnd="pvpBattleEnd",t.levelBattleEnd="levelBattleEnd",t.levelTreasureInfo="levelTreasureInfo",t.levelHelpWnd="appeal",t.diy="diy",t.diySkillPanel="diySkillPanel",t.campignBattleEnd="campignBattleEnd",t.cmdWnd="cmdWnd",t.switchLanWnd="languageChange",t.videoBattleEnd="videoBattleEnd",t.archive="archive",t.defCampignBattleEnd="defCampignBattleEnd",t.treasureInfo="treasureInfoNormal",t.shareRewardTreasure="shareReward",t.shareGetTreasure="getShareReward",t.dailyTreasureInfo="dailyTreasureInfo",t.dailyTreasureDouble="dailyTreasureAdvert",t.advertAddTreasureCardWnd="cardMoreAdvert",t.treasureRewardInfo="openAni",t.treasureRewardResult="openResult",t.pvpNewBattleEnd="pvpNewBattleEnd",t.levelNewBattleEnd="levelNewBattleEnd",t.friendBattleEnd="friendBattleEnd",t.guideHome="InitialDeck",t.rankRewardView="rankList",t.pvpVs="vsAni",t.rankListWnd="rankingList",t.rankUpTips="rankUpTips",t.rankUpRewardTips="rankUpReward",t.cardInfoOther="cardInfoOther",t.skillFaq="skillFaq",t.emojiChoiceWnd="emojiChoice",t.advertUpTreasureWnd="TreasureUpAdvert",t.loginAcount="loginAcount",t.loginRegister="loginRegister",t.modifyName="modifyName",t.survey="survey",t.social="society",t.friendInfo="friendInfo",t.selfInfo="selfInfo",t.applyInfo="friendApply",t.friendSearch="friendSearch",t.friendOption="friendOption",t.friendOptionList="friendOptListWnd",t.privateChatWnd="privateChatWnd",t.inviteWaiting="friendMatching",t.avatarChangeWnd="headChange",t.wxgameFriendRankView="wechatRank",t.shopView="shop",t.shopGoldInfoWnd="shopGoldInfo",t.advipInfo="advipInfo",t.minivipInfo="minivipInfo",t.freeGoldInfoWnd="freeGoldInfo",t.freeJadeInfoWnd="freeJadeInfo",t.shopTreasureInfoWnd="shopTreasureInfo",t.freeTreasureInfoWnd="freeTreasureInfo",t.freeTreasureInfoFacebookWnd="freeTreasureInfoFacebook",t.resourceGetView="getResourceAni",t.questView="quest",t.wechatPlatform="wechatPlatform",t.questTipView="questTip",t.inviteRewardWnd="inviteReward",t.getRewardWnd="getReward",t.mail="mail",t.mailInfo="mailInfo",t.videoFunction="videoFunction",t.levelVideo="levelVideo",t.shareReward="shareReward",t.shareFacebookReward="facebookShareReward",t.rankSeason="rankSeason",t.rankSeasonTreasureInfo="rankSeasonTreasureInfo",t.skinView="skinView",t.rebornShopView="rebornShop",t.featCardInfo="featCardInfo",t.privInfo="privInfo",t.rebornEquipInfo="equipInfo",t.buySkinInfo="skinInfo",t.rebornWnd="rebornPanel",t.refineWnd="refinePanel",t.refineInfoWnd="refineInfo",t.videoShareOption="videoShareOption",t.privPanelWnd="privPanel",t.privView="privView",t.rankSeasonRandomCard="rankSeasonRandomCard",t.rankSeasonHandCard="rankSeasonHandCard",t.equipBag="equipBag",t.equipPanel="equipPanel",t.equipItemWnd="equipView",t.cardUpWnd="cardUp",t.warHome="warHome",t.enterWarAni="enterAni",t.cityInfoPanel="cityInfoPanel",t.warQuestPanel="questPanel",t.cityManagePanel="cityManagePanel",t.addGoldWnd="addGold",t.setFoodPriceWnd="setFoodPrice",t.allMemberPanel="allMemberPanel",t.allCityPanel="allCityPanel",t.warNoticePanel="noticeChatPanel",t.questChooseCardWnd="questChooseCard",t.emperorApplyWnd="emperorApply",t.independentWnd="independent",t.appointChooseWnd="appointChoose",t.questReleaseWnd="questRelease",t.questTransReleaseWnd="questTransRelease",t.questMigrateReleaseWnd="questMigrateRelease",t.modifyCampFlagWnd="modifyCampFlag",t.modifyCampNameWnd="modifyCampName",t.countryAppointPanel="countryAppointPanel",t.cityAppointPanel="cityAppointPanel",t.addGoldRecordPanel="addGoldRecordPanel",t.cityNoticeWnd="cityNotice",t.cityInfoWarPanel="cityInfoWarPanel",t.battleEndView="dailyWarOver",t.battleUnifiedView="warOver",t.cityManageFightWnd="cityManageFightPanel",t.questAttackReleaseWnd="questAttackRelease",t.questMoveReleaseWnd="questMoveRelease",t.questDefenseReleaseWnd="questDefenseRelease",t.questFightPanel="questFightPanel",t.choiceFightCardWnd="warChoiceFightCard",t.warShopView="warShop",t}();__reflect(ViewName.prototype,"ViewName");var GameAccount=function(){function t(){}return Object.defineProperty(t,"inst",{get:function(){return t._inst||(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype.login=function(t,e,i){this._accountName=t,this._isTouristLogin=e,this._loginChannel=i},t.prototype.loginPlayer=function(t){this._archiveID=t},Object.defineProperty(t.prototype,"accountName",{get:function(){return this._accountName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTouristLogin",{get:function(){return this._isTouristLogin},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loginChannel",{get:function(){return this._loginChannel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"archiveID",{get:function(){return this._archiveID},enumerable:!0,configurable:!0}),t.prototype.getPassword=function(t){var e=egret.localStorage.getItem("pwd:"+t);return e?e:""},t.prototype.md5hashPassword=function(t){return(new md5).hex_md5("kc_1"+t)},t.prototype.setPassword=function(t,e){egret.localStorage.setItem("pwd:"+t,e)},t}();__reflect(GameAccount.prototype,"GameAccount");var LanguageMgr=function(){function t(){this._countryCode="cn",this._supportedLanguage={},this._supportedLanguage.cn="简体中文",this._supportedLanguage.tw="繁體中文",this._supportedLanguage.en="English",this._supportedLanguage.id="Bahasa indonesia",this._supportedLanguage.th="ไทย"}return Object.defineProperty(t,"inst",{get:function(){return this._inst||(this._inst=new t),this._inst},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"supportedLanguage",{get:function(){return this._supportedLanguage},enumerable:!0,configurable:!0}),t.prototype.getLanguageDescription=function(t){return this._supportedLanguage[t]},t.prototype._filterLan=function(t){return this._supportedLanguage[t]?t:"en"},Object.defineProperty(t.prototype,"default",{get:function(){return this._default||(this._default=window.gameGlobal.locale),this._default},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cur",{get:function(){if(!this._cur){var t=egret.localStorage.getItem("curLanguage");t?this._cur=t:this._cur=this["default"]}return this._cur},set:function(t){t=this._filterLan(t),this._cur=t,egret.localStorage.setItem("curLanguage",t)},enumerable:!0,configurable:!0}),t.prototype.isChineseLocale=function(){return window.gameGlobal.isMultiLan?"cn"==this.cur||"tw"==this.cur:!0},Object.defineProperty(t.prototype,"countryCode",{get:function(){return this._countryCode},enumerable:!0,configurable:!0}),t.prototype.setCountryFlagImg=function(t,e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return e||(e=this._countryCode),i="flags_"+e+"_png",[4,Utils.setImageUrlPicture(t,i)];case 1:return r.sent(),[2]}})})},t.prototype.initTextField=function(){this.isChineseLocale()||(fairygui.GTextField.wordWrap=!0)},t.prototype.getCardItemTemplateName=function(){return this.isChineseLocale()?"cardItem":"cardItem2"},t.prototype.initLocale=function(t,e){if(!Core.DeviceUtils.isWXGame()&&window.gameGlobal.isMultiLan){this._countryCode=t.toLowerCase();var i=t.toLowerCase();i.indexOf("cn")>=0?window.gameGlobal.locale="cn":i.indexOf("hk")>=0||i.indexOf("tw")>=0||i.indexOf("mo")>=0?window.gameGlobal.locale="tw":window.gameGlobal.locale=this._filterLan(i),egret.log("initLocale: ",window.gameGlobal.locale),egret.log("country: ",this._countryCode)}},t}();__reflect(LanguageMgr.prototype,"LanguageMgr");var Player=function(t){function e(){var e=t.call(this)||this;return e._hasGetVipExperience=!1,e._resources=new Collection.Dictionary,e._skins=new Collection.Dictionary,Core.EventCenter.inst.addEventListener(GameEvent.ModifyNameEv,function(t){e._name=t.data},e),e._vipTime=0,e._miniVipTime=0,Core.EventCenter.inst.addEventListener(GameEvent.SeasonBegin,e._seasonBegin,e),e}return __extends(e,t),Object.defineProperty(e,"inst",{get:function(){return e._inst||(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nameWithNoColor",{get:function(){return 0==this._name.indexOf("#")?this._name.substr(8,this._name.length-10):this.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"accountType",{set:function(t){this._accountType=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"seaonTime",{set:function(t){this._seasonPvpLimitTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"avatarUrl",{get:function(){return this._avatarUrl},set:function(t){this._avatarUrl=t,Core.DeviceUtils.isWXGame()||Core.EventCenter.inst.dispatchEventWith(GameEvent.ModifyAvatarEv,!1,t)},enumerable:!0,configurable:!0}),e.prototype.saveAvatarUrl=function(t){Net.rpcCall(pb.MessageID.C2S_UPDATE_HEADIMG,pb.UpdateHeadImgArg.encode({HeadImg:t})),this.avatarUrl=t},Object.defineProperty(e.prototype,"frameID",{get:function(){return this._frameID&&""!=this._frameID||(this._frameID="1"),this._frameID},set:function(t){this._frameID=t,Core.EventCenter.inst.dispatchEventWith(GameEvent.ModifyFrameEv,!1,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameUrl",{get:function(){return this._frameID&&""!=this._frameID||(this._frameID="1"),"headframe_"+this._frameID+"_png"},enumerable:!0,configurable:!0}),e.prototype.saveFrameUrl=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return Net.rpcCall(pb.MessageID.C2S_UPDATE_HEAD_FRAME,pb.UpdateHeadFrameArg.encode({HeadFrame:t})),this.frameID=t,[2]})})},Object.defineProperty(e.prototype,"guideCamp",{get:function(){return this._guideCamp},set:function(t){this._guideCamp=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serverID",{get:function(){return this._serverID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isIOSShared",{get:function(){return this._isIOSShared},set:function(t){this._isIOSShared=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSeason",{get:function(){var t=Pvp.PvpMgr.inst.getPvpLevel(),e=Pvp.Config.inst.getPvpTeam(t);return e>=Data.season_config.get(1).team?this._seasonPvpLimitTime>0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"privileges",{get:function(){return this._privileges},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVip",{get:function(){return this._vipTime>0||-1==this._vipTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMiniVip",{get:function(){return this._miniVipTime>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vipTime",{get:function(){return this._vipTime},set:function(t){this._vipTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"miniVipTime",{get:function(){return this._miniVipTime},set:function(t){this._miniVipTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasGetVipExperience",{get:function(){return this._hasGetVipExperience},set:function(t){this._hasGetVipExperience=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSeasonPvpChooseCard",{get:function(){return this._isSeasonPvpChooseCard},set:function(t){this._isSeasonPvpChooseCard=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"winDiff",{get:function(){return this._winDiff},set:function(t){this._winDiff=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"oldFlag",{get:function(){return this._oldFlag},set:function(t){this._oldFlag=t},enumerable:!0,configurable:!0}),e.prototype.login=function(t,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return this._uid=t.Uid,this._serverID=t.ServerID,this._name=t.Name,this._guideCamp=t.GuideCamp,this._avatarUrl=t.HeadImg,this._frameID=t.HeadFrame,this._cumulativePay=t.CumulativePay,this._isIOSShared=t.IsIosShared,this._seasonPvpLimitTime=t.SeasonPvpLimitTime,this._vipTime=t.VipRemainTime,this._privileges=t.Privileges,this._isSeasonPvpChooseCard=t.IsSeasonPvpChooseCard,this.updateResource(t.Res),[4,Equip.EquipMgr.inst.fetchEquip()];case 1:return i.sent(),CardPool.CardPoolMgr.inst.onLogin(t.Cards),CardPool.CardSkinMgr.inst.updateMySkins(t.CardSkins),[4,Level.LevelMgr.inst.fetchLevelData(!1)];case 2:return i.sent(),[4,Social.EmojiMgr.inst.initEmojis()];case 3:return i.sent(),this.dispatchEventWith(e.LoginEvt),TD.Account(),this._startHeartBeat(),Core.EventCenter.inst.dispatchEventWith(GameEvent.SeasonBegin,!1,this._seasonPvpLimitTime),[2]}})})},e.prototype.logout=function(){this._stopHeartBeat(),this.dispatchEventWith(e.LogoutEvt)},e.prototype.getResource=function(t){var e=this._resources.getValue(t);return e?e:0},Object.defineProperty(e.prototype,"cumulativePay",{get:function(){return this._cumulativePay},enumerable:!0,configurable:!0}),e.prototype.hasEnoughGold=function(t){return this.getResource(ResType.T_GOLD)>=t},e.prototype.hasEnoughJade=function(t){return this.getResource(ResType.T_JADE)>=t},e.prototype.hasEnoughBowlder=function(t,e){return void 0===e&&(e=!1),e?this.getResource(ResType.T_BOWLDER)+this.getResource(ResType.T_JADE)>=t:this.getResource(ResType.T_BOWLDER)>=t},e.prototype.askSubBowlder=function(t,e){return void 0===e&&(e=!0),__awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(r){switch(r.label){case 0:return this.hasEnoughBowlder(t)?[2,!0]:[3,1];case 1:return e?[3,2]:[2,!1];case 2:return this.hasEnoughBowlder(t,!0)?[4,new Promise(function(e){var r=t-i.getResource(ResType.T_BOWLDER),n=Core.StringUtils.format(Core.StringUtils.TEXT(60277),r);Core.TipsUtils.confirm(n,function(){e(!0)},function(){e(!1)})})]:[2,!1];case 3:return[2,r.sent()]}})})},e.prototype.hasEnoughFeat=function(t){return this.getResource(ResType.T_FEAT)>=t},e.prototype.hasEnoughFame=function(t){return this.getResource(ResType.T_FAME)>=t},e.prototype.hasEnoughEquipMoney=function(){return this.getResource(ResType.T_EQUIP)>0},e.prototype.getSkipAdvertResType=function(){return"lzd_handjoy"==window.gameGlobal.channel?ResType.T_BOWLDER:ResType.T_JADE},e.prototype.getSkipAdvertResIcon=function(){return Utils.resType2Icon(this.getSkipAdvertResType())},e.prototype.askSubRes=function(t,i,r){return void 0===r&&(r=!0),__awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return t!=ResType.T_JADE?[3,1]:e.inst.hasEnoughJade(i)?[2,!0]:(r&&Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60085)),[2,!1]);case 1:return[4,e.inst.askSubBowlder(i)];case 2:if(n.sent())return[2,!0];r&&Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60278)),n.label=3;case 3:return[2]}})})},e.prototype.hasEnoughResToSkipAdvert=function(){if(this.isVip)return!0;return"lzd_handjoy"==window.gameGlobal.channel?this.hasEnoughBowlder(3,!0):this.hasEnoughJade(3)},e.prototype.askSubSkipAdvertRes=function(t){return void 0===t&&(t=!0),__awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return e=this.getSkipAdvertResType(),[4,this.askSubRes(e,3,t)];case 1:return[2,i.sent()]}})})},e.prototype.addPrivilege=function(t){this.hasPrivilege(t)||this._privileges.push(t)},e.prototype.hasPrivilege=function(t){return-1!=this._privileges.indexOf(t)},e.prototype.updateResource=function(t,i){var r=this;void 0===i&&(i=!1),t&&t.length>0&&(t.forEach(function(t){if(i){var n=r._resources.getValue(t.Type);n=n?n:0;var o=t.Amount-n;o>0?TD.onResAdd(t.Type,o):0>o&&TD.onResSub(t.Type,-o)}if(t.Type==ResType.SeasonWinDiff){var n=r._resources.getValue(t.Type);null!=n&&(r._oldFlag=n)}r._resources.setValue(t.Type,t.Amount),t.Type==ResType.T_SCORE?(r.dispatchEventWith(e.PvpScoreChangeEvt),r._accountType==pb.AccountTypeEnum.Ios&&r._scoreToGameCenter()):t.Type==ResType.T_MAX_SCORE&&r.dispatchEventWith(e.PvpMaxScoreChangeEvt)}),this.dispatchEventWith(e.ResUpdateEvt))},e.getNewbieNamePrefix=function(){return window.gameGlobal.isMultiLan?"guest":"新兵"},e.prototype.getVipTime=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_FETCH_VIP_REMAIN_TIME,null)];case 1:return t=i.sent(),0==t.errcode&&(e=pb.VipRemainTime.decode(t.payload),this.vipTime=e.RemainTime),[2,this._vipTime]}})})},e.prototype.isNewbieName=function(t){return 0==t.indexOf(e.getNewbieNamePrefix())},e.prototype.exchangeRes=function(t,e){Net.rpcPush(pb.MessageID.C2S_EXCHANGE_RESOURCE,pb.Resource.encode({Type:t,Amount:e}))},e.prototype._scoreToGameCenter=function(){this._accountType==pb.AccountTypeEnum.Ios&&Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.SCORE_TO_GAME_CENTER,{score:this.getResource(ResType.T_SCORE)})},e.prototype.getAdvertCnt=function(){return"lzd_handjoy"!=window.gameGlobal.channel||this.isVip?Core.DeviceUtils.isWXGame()?this.getResource(ResType.T_ACC_TREASURE_CNT)-10:this.getResource(ResType.T_ACC_TREASURE_CNT):0},e.prototype.getAccTreasureCnt=function(){return"lzd_handjoy"!=window.gameGlobal.channel||this.isVip?this.getResource(ResType.T_ACC_TREASURE_CNT):0},e.prototype.canSkipAdvertForTreasure=function(){return"lzd_handjoy"==window.gameGlobal.channel?!1:this.isVip},e.prototype._updateTime=function(){return this._seasonPvpLimitTime-=1,this._seasonPvpLimitTime<=0?(Core.EventCenter.inst.dispatchEventWith(GameEvent.SeasonEnd),void fairygui.GTimers.inst.remove(this._updateTime,this)):void Core.EventCenter.inst.dispatchEventWith(GameEvent.UpdateSeasonTime,!1,this._seasonPvpLimitTime)},e.prototype._seasonBegin=function(t){this._seasonPvpLimitTime=t.data,fairygui.GTimers.inst.remove(this._updateTime,this);var e=Pvp.PvpMgr.inst.getPvpLevel(),i=Pvp.Config.inst.getPvpTeam(e);
i>=6&&fairygui.GTimers.inst.add(1e3,this._seasonPvpLimitTime,this._updateTime,this)},e.prototype._stopHeartBeat=function(){fairygui.GTimers.inst.remove(this._heartBeat,this)},e.prototype._startHeartBeat=function(){fairygui.GTimers.inst.add(1e3,-1,this._heartBeat,this)},e.prototype._heartBeat=function(){this._vipTime>0&&(this._vipTime=Math.max(0,this._vipTime-1)),this._miniVipTime>0&&(this._miniVipTime=Math.max(0,this._miniVipTime-1))},e.ResUpdateEvt="ResUpdateEvt",e.PvpScoreChangeEvt="PvpScoreChangeEvt",e.PvpMaxScoreChangeEvt="PvpMaxScoreChangeEvt",e.LoginEvt="LoginEvt",e.LogoutEvt="LogoutEvt",e}(egret.EventDispatcher);__reflect(Player.prototype,"Player");var SoundAction=function(t){function e(e,i){var r=t.call(this)||this;return r._soundRes=null,r._isAsync=!1,r._soundRes=e,r._isAsync=i,r}return __extends(e,t),e.prototype.enter=function(t){this._isAsync?SoundMgr.inst.playSoundAsync(this._soundRes):SoundMgr.inst.playSound(this._soundRes)},e}(fairygui.ControllerAction);__reflect(SoundAction.prototype,"SoundAction");var NativeSoundApi=function(){function t(){}return t.playSound=function(t,e){Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.PLAY_SOUND,{sound:t.replace("_mp3",""),volume:e})},t.playMusic=function(t,e){Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.PLAY_MUSIC,{sound:t.replace("_mp3",""),volume:e})},t.setMusicVolume=function(t){Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.SET_MUSIC_VOLUME,{volume:t})},t.stopMusic=function(){Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.STOP_MUSIC,{})},t}();__reflect(NativeSoundApi.prototype,"NativeSoundApi");var WXGameSoundApi=function(){function t(){}return t.playSound=function(t,e){WXGame.WXSoundMgr.inst.playSound(t,e)},t.playSoundAsync=function(t,e){WXGame.WXSoundMgr.inst.playSoundAsync(t,e)},t.playMusic=function(t,e){WXGame.WXSoundMgr.inst.playMusic(t,e)},t.setMusicVolume=function(t){WXGame.WXSoundMgr.inst.setMusicVolume(t)},t.stopMusic=function(){WXGame.WXSoundMgr.inst.stopMusic()},t}();__reflect(WXGameSoundApi.prototype,"WXGameSoundApi");var SoundMgr=function(){function t(){this.soundTimer={},this._soundLevel=3,this._musicLevel=3,this.useNativeSound=!1;var t=egret.localStorage.getItem("soundLevel"),e=egret.localStorage.getItem("musicLevel");t=t?Number(t):3,e=e?Number(e):3,this.soundLevel=t,this.musicLevel=e}return Object.defineProperty(t.prototype,"soundLevel",{get:function(){return this._soundLevel},set:function(t){t=Math.floor(t),0>t&&(t=0),t>3&&(t=3),this._soundLevel=t,this.soundVolume=t/3,fairygui.GRoot.inst.volumeScale=this.soundVolume,egret.localStorage.setItem("soundLevel",t.toString())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"musicLevel",{get:function(){return this._musicLevel},set:function(t){t=Math.floor(t),0>t&&(t=0),t>3&&(t=3),this._musicLevel=t,this.setMusicVolume(t/3),egret.localStorage.setItem("musicLevel",t.toString())},enumerable:!0,configurable:!0}),Object.defineProperty(t,"inst",{get:function(){return t._inst||(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype.recordSoundTimer=function(t){this.soundTimer[t]=egret.getTimer()},t.prototype.cleanSoundTimerRecords=function(){this.soundTimer={}},t.prototype.checkSound=function(t){var e=this.soundTimer[t];return e?egret.getTimer()-e>200?!0:!1:!0},t.prototype.playSound=function(t,e){if(this.checkSound(t)&&0!=e&&0!=this.soundVolume){if(this.recordSoundTimer(t),window.support.nativeSound)return void NativeSoundApi.playSound(t,e||this.soundVolume);var i=RES.getRes(t);if(i){var r=i.play(0,1);return void 0!=e?r.volume=e:r.volume=this.soundVolume,r}}},t.prototype.playSoundAction=function(t,e){return void 0===e&&(e=!1),new SoundAction(t,e)},t.prototype.playSoundAsync=function(t,e){try{if(!this.checkSound(t))return;if(e||(e=this.soundVolume),0==e)return;if(this.recordSoundTimer(t),window.support.nativeSound)return void NativeSoundApi.playSound(t,e);RES.getResAsync(t).then(function(t){var i=t.play(0,1);i.volume=e})}catch(i){console.error(i)}},t.prototype.setSoundVolume=function(t){this.soundVolume=t},t.prototype._setMusicVolume=function(t){return window.support.nativeSound?void NativeSoundApi.setMusicVolume(t):void(this.musicChannel&&(this.musicChannel.volume=t,Core.DeviceUtils.isWXGame()&&0==t&&this.stopBgMusic()))},t.prototype.setMusicVolume=function(t){this.musicVolume=t,this._setMusicVolume(t)},t.prototype.muteMusic=function(t){console.log("muteMusic",t),t?this._setMusicVolume(0):this._setMusicVolume(this.musicVolume)},t.prototype.fadeoutSound=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:this._fadeMusicChannel=t,e=1,i.label=1;case 1:if(!(e>=0))return[3,4];if(!this._fadeMusicChannel)return[2];try{this._fadeMusicChannel.volume=this.musicVolume*e}catch(r){return this._fadeMusicChannel=null,[2]}return[4,fairygui.GTimers.inst.waitTime(100)];case 2:i.sent(),i.label=3;case 3:return e-=.1,[3,1];case 4:try{this._fadeMusicChannel&&this._fadeMusicChannel.stop()}catch(r){}return this._fadeMusicChannel=null,[2]}})})},t.prototype.stopBgMusic=function(t){return void 0===t&&(t=!0),window.support.nativeSound?void NativeSoundApi.stopMusic():(t=!1,void(this.musicChannel&&(t?this.fadeoutSound(this.musicChannel):this.musicChannel.stop(),this.musicChannel=null)))},t.prototype.playBgMusic=function(t){var e=this;if(0!=this.musicVolume){if(window.support.nativeSound)return void NativeSoundApi.playMusic(t,this.musicVolume);try{RES.getResAsync(t).then(function(t){e.stopBgMusic(),e.musicChannel=t.play(),e.musicChannel.volume=e.musicVolume})["catch"](function(e){console.log("err when loading music ",t,e)})}catch(i){console.error(i)}}},t}();__reflect(SoundMgr.prototype,"SoundMgr");var Core;!function(t){var e=function(t){function e(e,i,r,n){var o=t.call(this,e,i,r)||this;return o.property=n,o}return __extends(e,t),e.dispatchPropertyEvent=function(t,i,r){if(!t.hasEventListener(i))return!0;var n=egret.Event.create(e,i);n.property=r;var o=t.dispatchEvent(n);return egret.Event.release(n),o},e.PROPERTY_CHANGE="propertyChange",e}(egret.Event);t.PropertyEvent=e,__reflect(e.prototype,"Core.PropertyEvent")}(Core||(Core={}));var Battle;!function(t){function e(){r.inst.onLogout()}function i(){t.initRpc(),Player.inst.addEventListener(Player.LogoutEvt,e,null);var i=Core.ViewManager.inst.registerView.bind(Core.ViewManager.inst),r=fairygui.UIPackage.createObject;i(ViewName.battle,function(){return r(PkgName.battle,ViewName.battle,t.BattleView)}),i(ViewName.videoFunction,function(){return r(PkgName.battle,ViewName.videoFunction,t.VideoFunctionView)}),i(ViewName.pvpVs,function(){return r(PkgName.battle,ViewName.pvpVs,t.PvpVsView)});var n=r(PkgName.battle,ViewName.emojiChoiceWnd).asCom,o=new t.EmojiChoiceWnd;o.contentPane=n,Core.ViewManager.inst.register(ViewName.emojiChoiceWnd,o),i(ViewName.pvpNewBattleEnd,function(){return r(PkgName.battle,ViewName.pvpNewBattleEnd,t.PvpNewBattleEnd)}),i(ViewName.levelNewBattleEnd,function(){return r(PkgName.battle,ViewName.levelNewBattleEnd,t.LevelNewBattleEnd)}),i(ViewName.friendBattleEnd,function(){return r(PkgName.battle,ViewName.friendBattleEnd,t.FriendBattleEnd)}),i(ViewName.bigCard,function(){return r(PkgName.cards,"bigCardView",t.CardBigWnd)}),i(ViewName.cardDetail,function(){return r(PkgName.cards,"bigCard",t.CardDetailWnd)}),i(ViewName.advertUpTreasureWnd,function(){var e=new t.AdvertUpTreasureWnd;return e.contentPane=r(PkgName.common,ViewName.advertUpTreasureWnd).asCom,e})}var r=function(){function e(){}return Object.defineProperty(e,"inst",{get:function(){return e._inst||(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),e.prototype._initSkillData=function(){var t=this;this._group2Skill=new Collection.MultiDictionary,Data.skill.keys.forEach(function(e){var i=Data.skill.get(e);i.skillGroup&&""!=i.skillGroup&&t._group2Skill.setValue(i.skillGroup,i)})},e.prototype.getGroupSkills=function(t){return this._group2Skill.getValue(t)},e.prototype.onLogout=function(){this._battle=null},Object.defineProperty(e.prototype,"battle",{get:function(){return this._battle},enumerable:!0,configurable:!0}),e.prototype.beginBattle=function(e,i){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:switch(this._battle&&console.error("i am already in battle"),this._group2Skill||this._initSkillData(),i){case t.BattleType.PVP:this._battle=new(t.Battle.bind.apply(t.Battle,[void 0,e].concat(r))),TD.onPvpBegin(this._battle);break;case t.BattleType.LEVEL:TD.onLevelBegin(r[0]),this._battle=new(t.LevelBattle.bind.apply(t.LevelBattle,[void 0,e].concat(r)));break;case t.BattleType.LevelHelp:TD.onLevelBegin(r[0]),this._battle=new(t.LevelHelpBattle.bind.apply(t.LevelHelpBattle,[void 0,e].concat(r)));break;case t.BattleType.Guide:this._battle=new(t.GuideBattle.bind.apply(t.GuideBattle,[void 0,e].concat(r)));break;case t.BattleType.VIDEO:this._battle=new(t.VideoBattle.bind.apply(t.VideoBattle,[void 0,e].concat(r)));break;case t.BattleType.Friend:this._battle=new(t.FriendBattle.bind.apply(t.FriendBattle,[void 0,e].concat(r)));break;case t.BattleType.Campaign:this._battle=new(t.CampaignBattle.bind.apply(t.CampaignBattle,[void 0,e].concat(r)))}return this._battle?(t.BoutActionPlayer.createInst(),[4,Core.ViewManager.inst.close(ViewName.battle)]):(console.debug("create battle error %d",i),[2]);case 1:return n.sent(),[4,Core.ViewManager.inst.open(ViewName.battle,this._battle)];case 2:return n.sent(),this._battle.isPvp()||i==t.BattleType.Guide?[4,fairygui.GTimers.inst.waitTime(1e3)]:[3,5];case 3:return n.sent(),[4,Core.ViewManager.inst.open(ViewName.pvpVs,this._battle)];case 4:n.sent(),Core.ViewManager.inst.close(ViewName.pvpVs),n.label=5;case 5:return this._battle.readyDone(),[2]}})})},e.prototype.endBattle=function(e,i){return void 0===i&&(i=!1),__awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return this._battle?[4,t.BoutActionPlayer.inst.waitActionComplete()]:[2];case 1:return r.sent(),[4,fairygui.GTimers.inst.waitTime(300)];case 2:return r.sent(),[4,this._battle.endBattle(e,i)];case 3:return r.sent(),Core.DeviceUtils.isWXGame()&&WXGame.WXGameMgr.inst.onBattleEnd(),this._battle=null,[2]}})})},e.prototype.restoredBattle=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){switch(o.label){case 0:if(this._battle)return console.debug("restoredBattle error, i am already in battle"),[2];if(!e.Desk)return[2];switch(this._group2Skill||this._initSkillData(),i=e.Desk.Type){case t.BattleType.PVP:this._battle=new t.Battle(e.Desk);break;case t.BattleType.LEVEL:r=new t.LevelBattle(e,e.LevelID),r.isBeginFight=!0,this._battle=r;break;case t.BattleType.LevelHelp:n=new t.LevelHelpBattle(e,e.LevelID),n.isBeginFight=!0,this._battle=n;break;case t.BattleType.Guide:this._battle=new t.GuideBattle(e.Desk);break;case t.BattleType.Friend:this._battle=new t.FriendBattle(e.Desk);break;case t.BattleType.Campaign:this._battle=new t.CampaignBattle(e.Desk)}return this._battle?(t.BoutActionPlayer.createInst(),[4,Core.ViewManager.inst.close(ViewName.battle)]):(console.debug("restoredBattle error %d",i),[2]);case 1:return o.sent(),[4,Core.ViewManager.inst.open(ViewName.battle,this._battle)];case 2:return o.sent(),this._battle.restoredDone(e.CurBoutUid,e.CurBout),Core.EventCenter.inst.dispatchEventWith(GameEvent.BattleBeginEv),[2]}})})},e.prototype.loadBattle=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return t?(e=!1,Core.DeviceUtils.isWXGame()&&(e=WXGame.WXGameMgr.inst.hasLaunchActionToHandle()),i={IsIgnorePve:e},[4,Net.rpcCall(pb.MessageID.C2S_LOAD_FIGHT,pb.C2SLoadFightArg.encode(i),!0,!1)]):[2];case 1:return r=n.sent(),0==r.errcode&&r.payload?[4,this.restoredBattle(pb.RestoredFightDesk.decode(r.payload))]:[2];case 2:return n.sent(),[2]}})})},e.prototype.levelBattleReadyDone=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return this._battle&&this._battle instanceof t.LevelBattle?[4,this._battle.levelBattleReadyDone()]:[3,2];case 1:return e=i.sent(),[2,e];case 2:return[2,!1]}})})},e.prototype.surrender=function(){Net.rpcPush(pb.MessageID.C2S_FIGHT_SURRENDER,null)},e.prototype.gmWin=function(){Net.rpcPush(pb.MessageID.C2S_FIGHT_GM_WIN,null)},e.prototype.exitVideo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,t.VideoPlayer.inst.stop()];case 1:return e.sent(),[4,Core.ViewManager.inst.close(ViewName.battle)];case 2:return e.sent(),Core.EventCenter.inst.dispatchEventWith(GameEvent.BattleEndEv),this._battle=null,[2]}})})},e.prototype.exitLevel=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,Core.ViewManager.inst.close(ViewName.battle)];case 1:return t.sent(),Level.LevelMgr.inst.onEnterLevel(),this._battle=null,[2]}})})},e.prototype.sendEmoji=function(t){if(this._battle&&this._battle.isPvp()){var e=Core.ViewManager.inst.getView(ViewName.battle);e.isShow()&&e.showSelfEmoji(t)&&Net.rpcPush(pb.MessageID.C2S_SEND_EMOJI,pb.SendEmojiArg.encode({EmojiID:t}))}},e}();t.BattleMgr=r,__reflect(r.prototype,"Battle.BattleMgr"),t.init=i}(Battle||(Battle={}));var Battle;!function(t){var e;!function(t){t[t.Attack=1]="Attack",t[t.TurnOver=2]="TurnOver",t[t.Skill=3]="Skill",t[t.TauntDel=4]="TauntDel",t[t.SkillPrepare=5]="SkillPrepare",t[t.SkillStatusMovie=6]="SkillStatusMovie",t[t.SkillValue=7]="SkillValue",t[t.SkillOth=8]="SkillOth",t[t.SkillTextMovie=9]="SkillTextMovie",t[t.SkillMovie=10]="SkillMovie",t[t.SkillKing=11]="SkillKing",t[t.Bonus=12]="Bonus",t[t.SkillSwitchPos=13]="SkillSwitchPos",t[t.SkillDisCard=14]="SkillDisCard",t[t.SkillHandShow=15]="SkillHandShow",t[t.SkillSummon=16]="SkillSummon",t[t.SkillDestroy=17]="SkillDestroy",t[t.SkillReturn=18]="SkillReturn",t[t.ModifySkill=19]="ModifySkill",t[t.PlayCard=1e3]="PlayCard",t[t.Move=1001]="Move",t[t.BattleEnd=1002]="BattleEnd"}(e||(e={}));var i=function(){function e(){e._actions||(e._actions=new Collection.Dictionary,e._actions.setValue(pb.ClientAction.ActionID.PlayCard,new r),e._actions.setValue(pb.ClientAction.ActionID.Attack,new n),e._actions.setValue(pb.ClientAction.ActionID.TurnOver,new s),e._actions.setValue(pb.ClientAction.ActionID.Move,new o),e._actions.setValue(pb.ClientAction.ActionID.Skill,new d),e._actions.setValue(pb.ClientAction.ActionID.TextMovie,new h),e._actions.setValue(pb.ClientAction.ActionID.Movie,new u),e._actions.setValue(pb.ClientAction.ActionID.ModifyValue,new l),e._actions.setValue(pb.ClientAction.ActionID.SkillStatusMovie,new p),e._actions.setValue(pb.ClientAction.ActionID.Bonus,new _),e._actions.setValue(pb.ClientAction.ActionID.BattleEnd,new g),e._actions.setValue(pb.ClientAction.ActionID.SwitchPos,new f),e._actions.setValue(pb.ClientAction.ActionID.HandShow,new c),e._actions.setValue(pb.ClientAction.ActionID.Guanxing,new m),e._actions.setValue(pb.ClientAction.ActionID.Summon,new y),e._actions.setValue(pb.ClientAction.ActionID.Destroy,new C),e._actions.setValue(pb.ClientAction.ActionID.Return,new v),e._actions.setValue(pb.ClientAction.ActionID.AddSkill,new w),e._actions.setValue(pb.ClientAction.ActionID.DelSkill,new b),e._actions.setValue(pb.ClientAction.ActionID.Copy,new P),e._actions.setValue(pb.ClientAction.ActionID.EnterFog,new I),e._actions.setValue(pb.ClientAction.ActionID.LeaveFog,new S),e._actions.setValue(pb.ClientAction.ActionID.GoldGob,new x))}return Object.defineProperty(e,"inst",{get:function(){return e._inst||(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),e.createInst=function(){e._inst=new e},e.prototype.getAction=function(t){return e._actions.getValue(t)},e.prototype.waitActionComplete=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return null==this._playing?[3,2]:[4,this._playing];case 1:t.sent(),t.label=2;case 2:return[2]}})})},e.prototype.playActions=function(i,r){return __awaiter(this,void 0,void 0,function(){var n,o;return __generator(this,function(s){switch(s.label){case 0:return null==this._playing?[3,2]:[4,this._playing];case 1:s.sent(),this._playing=null,s.label=2;case 2:if(n=t.BattleMgr.inst.battle,!n)return console.debug("playActions no battle"),[2];if(i)return[3,7];if(!r)return[3,6];s.label=3;case 3:return s.trys.push([3,5,,6]),[4,e._actions.getValue(pb.ClientAction.ActionID.BattleEnd).playAction(null)];case 4:return s.sent(),[3,6];case 5:return o=s.sent(),console.debug(o),[3,6];case 6:return[2];case 7:return this._playing=this._playActions(i,r),[4,this._playing];case 8:return s.sent(),this._playing=null,[2]}})})},e.prototype._playActions=function(t,i){return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a,u,h,l,c;return __generator(this,function(d){switch(d.label){case 0:r=Boolean(i),n=!1,s=0,d.label=1;case 1:if(!(s<t.length))return[3,11];if(a=t[s],u=e._actions.getValue(a.ID),!u)return[3,10];d.label=2;case 2:return d.trys.push([2,9,,10]),a.ID==pb.ClientAction.ActionID.Bonus&&r?(r=!1,a.Data.winUid=i,[3,5]):[3,3];case 3:return a.ID==pb.ClientAction.ActionID.SkillStatusMovie?[3,5]:n?a.ID==pb.ClientAction.ActionID.AddSkill||a.ID==pb.ClientAction.ActionID.DelSkill?[3,5]:(n=!1,[4,Promise.all(o)]):[3,5];case 4:d.sent(),d.label=5;case 5:return h=u.playAction(a.Data),a.ID!=pb.ClientAction.ActionID.SkillStatusMovie?[3,6]:(n||(n=!0,o=[]),o.push(h),[3,8]);case 6:return[4,h];case 7:d.sent(),d.label=8;case 8:return[3,10];case 9:return l=d.sent(),console.debug(l),[3,10];case 10:return s++,[3,1];case 11:if(!r)return[3,15];d.label=12;case 12:return d.trys.push([12,14,,15]),[4,e._actions.getValue(pb.ClientAction.ActionID.BattleEnd).playAction(i)];case 13:return d.sent(),[3,15];case 14:return c=d.sent(),console.debug(c),[3,15];case 15:return[2]}})})},e.prototype.playCard=function(i,r,n,o,s){return __awaiter(this,void 0,void 0,function(){var a,u;return __generator(this,function(h){switch(h.label){case 0:return null==this._playing?[3,2]:[4,this._playing];case 1:h.sent(),this._playing=null,h.label=2;case 2:if(a=t.BattleMgr.inst.battle,!a)return console.debug("playCard no battle"),[2];h.label=3;case 3:return h.trys.push([3,5,,6]),[4,e._actions.getValue(pb.ClientAction.ActionID.PlayCard).playAction({useCardObjId:i,targetGridId:r,needTalk:n,isUseCardInFog:o,isUseCardPublicEnemy:s})];case 4:return h.sent(),[3,6];case 5:return u=h.sent(),console.debug(u),[3,6];case 6:return[2]}})})},e}();t.BoutActionPlayer=i,__reflect(i.prototype,"Battle.BoutActionPlayer");var r=function(){function e(){}return e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a;return __generator(this,function(u){switch(u.label){case 0:return i=e.useCardObjId,r=e.targetGridId,n=e.needTalk,(o=t.BattleMgr.inst.battle)&&(s=o.getBattleObj(i))?(s.isInFog=e.isUseCardInFog,s.isPublicEnemy=e.isUseCardPublicEnemy,a=o.getGridById(r),[4,s.playCard(a,n)]):[2];case 1:return u.sent(),s.owner.handView.handVisibleLightCircle(!1),Core.ViewManager.inst.getView(ViewName.battle).stopTimerProgress(),[4,fairygui.GTimers.inst.waitTime(350)];case 2:return u.sent(),[2]}})})},e}();__reflect(r.prototype,"PlayCardAction",["IAction"]);var n=function(){function e(){}return e.prototype._blink=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return e.WinEffect?[4,t.view.blink()]:[2];case 1:return i.sent(),[2]}})})},e.prototype._attack=function(e,r){return __awaiter(this,void 0,void 0,function(){var n,o,s,a,u,h,l;return __generator(this,function(c){switch(c.label){case 0:return r.WinActs&&(n=t.BattleMgr.inst.battle)?(o=[],r.WinActs.forEach(function(i){var s=n.getBattleObj(i.BeAttacker);if(s){var a,u=null,h="",l=t.CardNumPos.NONE;if(null!=r.MoveActs){for(var c=-1,d=0;d<r.MoveActs.length;d++){var p=!1;if(s.objId==r.MoveActs[d].Target?(a=s,p=!0):e.objId==r.MoveActs[d].Target&&(a=e,p=!0),p){c=d;var _=r.MoveActs[d].TargetGrid;if(u=n.getBattleObj(_),h=r.MoveActs[d].MovieID,l=r.MoveActs[d].MovePos,r.MoveActs[d].TargetGrid>=0)break}}c>=0&&r.MoveActs.splice(c,1)}var g=n instanceof t.GuideBattle&&n.canAttactGuide(),f=e.attackAndMoveTarget(s,i.WinPos,i.LosePos,a,u,h,l,g,r.IsArrow);null!=f&&o.push(f)}}),s=i.inst.getAction(pb.ClientAction.ActionID.Move).playAction(r.MoveActs),o.length>0?[4,Promise.all(o)]:[3,3]):[2];case 1:return c.sent(),[4,fairygui.GTimers.inst.wait30FpsFrame(5)];case 2:c.sent(),c.label=3;case 3:return s?[4,s]:[3,5];case 4:c.sent(),c.label=5;case 5:if(!r.AfterMoveActs)return[3,10];for(o=[],a=[],u=0,h=r.AfterMoveActs;u<h.length;u++)l=h[u],l.ID==pb.ClientAction.ActionID.TextMovie?(s=i.inst.getAction(pb.ClientAction.ActionID.TextMovie).playAction(l.Data),s&&o.push(s)):a.push(l);return o.length>0?[4,Promise.all(o)]:[3,7];case 6:c.sent(),c.label=7;case 7:return o=[],a.forEach(function(t){s=i.inst.getAction(t.ID).playAction(t.Data),s&&o.push(s)}),o.length>0?[4,Promise.all(o)]:[3,10];case 8:return c.sent(),[4,fairygui.GTimers.inst.wait30FpsFrame(5)];case 9:c.sent(),c.label=10;case 10:return[2]}})})},e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){switch(o.label){case 0:return i=pb.AttackAct.decode(e),(r=t.BattleMgr.inst.battle)?(n=r.getBattleObj(i.Attacker),n?[4,this._attack(n,i)]:[2]):[2];case 1:return o.sent(),[2]}})})},e}();__reflect(n.prototype,"AttackAction",["IAction"]);var o=function(){function e(){}return e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){switch(o.label){case 0:return e&&(i=t.BattleMgr.inst.battle)?(r=e,n=[],r.forEach(function(t){var e,r=i.getBattleObj(t.Target);if(r){var o=i.getBattleObj(t.TargetGrid),s=t.MovieID,a=t.MovePos;e=r.moveToGrid(o,s,a),null!=e&&n.push(e)}}),n.length>0?[4,Promise.all(n)]:[3,2]):[2];case 1:o.sent(),o.label=2;case 2:return[2]}})})},e}();__reflect(o.prototype,"MoveAction",["IAction"]);var s=function(){function e(){}return e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){switch(o.label){case 0:return i=pb.TurnOverAct.decode(e),i.BeTurners&&(r=t.BattleMgr.inst.battle)?(n=[],i.BeTurners.forEach(function(t){var e=r.getBattleObj(t);if(e){var i=e.changeSide();n.push(i)}}),n.length>0?[4,Promise.all(n)]:[3,2]):[2];case 1:o.sent(),o.label=2;case 2:return[2]}})})},e}();__reflect(s.prototype,"TurnOverAction",["IAction"]);var a=function(){function e(){}return e.prototype.playMovie=function(e,i,r,n,o,s){return __awaiter(this,void 0,void 0,function(){var a,u;return __generator(this,function(h){switch(h.label){case 0:return e&&(a=t.BattleMgr.inst.battle)?(u=[],e.forEach(function(e){var h=a.getBattleObj(e);if(h){var l=!0;if(h instanceof t.FightCard){var c=a.getBattleObj(r);if(c&&c instanceof t.FightCard){var d=c;l=!d.isShowFogUI()}}var p=h.playEffect(i,n,l,o,s);null!=p&&u.push(p)}}),u.length>0?[4,Promise.all(u)]:[3,2]):[2];case 1:h.sent(),h.label=2;case 2:return[2]}})})},e}();__reflect(a.prototype,"MovieAction");var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return i=pb.MovieAct.decode(e),[4,t.prototype.playMovie.call(this,i.Targets,i.MovieID,i.OwnerObjID,i.PlayType,0,0)];case 1:return r.sent(),[2]}})})},e}(a);__reflect(u.prototype,"McMovieAction",["IAction"]);var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return i=pb.TextMovieAct.decode(e),[4,t.prototype.playMovie.call(this,i.Targets,i.MovieID,i.OwnerObjID,i.PlayType,i.TargetCount,i.Value)];case 1:return r.sent(),[2]}})})},e}(a);__reflect(h.prototype,"TextMovieAction",["IAction"]);var l=function(){function e(){}return e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){return i=pb.ModifyValueAct.decode(e),i.Targets&&(r=t.BattleMgr.inst.battle)?(i.Targets.forEach(function(t){var e=r.getBattleObj(t);e&&e.modifyValue(i.Value,i.ModifyType)}),[2]):[2]})})},e}();__reflect(l.prototype,"ModifyValueAction",["IAction"]);var c=function(){function e(){}return e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){return i=pb.HandShowAct.decode(e),(r=t.BattleMgr.inst.battle)?(n=r.getFighter(i.Uid),n.handView.show(),[2]):[2]})})},e}();__reflect(c.prototype,"HandShowAction",["IAction"]);var d=function(){function e(){}return e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a,u,h,l,c,d;return __generator(this,function(p){switch(p.label){case 0:return r=pb.SkillAct.decode(e),n=[],(o=t.BattleMgr.inst.battle)?(s=[],a=o.getBattleObj(r.Owner),a?[4,a.triggerSkill(r.SkillID,r.IsEquip)]:[3,2]):[2];case 1:p.sent(),p.label=2;case 2:return u=i.inst.getAction(pb.ClientAction.ActionID.Move).playAction(r.MoveActs),null!=r.Actions||null!=r.AfterMoveActs?[3,4]:[4,u];case 3:return p.sent(),[2];case 4:n.push(u),p.label=5;case 5:return null==r.Actions&&(r.Actions=[]),null!=r.AfterMoveActs&&(r.Actions=r.Actions.concat(r.AfterMoveActs)),r.Actions.forEach(function(e){if(e.ID==pb.ClientAction.ActionID.Movie||e.ID==pb.ClientAction.ActionID.TextMovie)u=i.inst.getAction(e.ID).playAction(e.Data),u&&n.push(u);else if(e.ID==pb.ClientAction.ActionID.DrawCard){var r=pb.DrawCardAct.decode(e.Data),a=o.getFighter(r.Uid);a.kingAddHandCard(r.Cards);for(var h=0,l=r.Cards;h<l.length;h++){var c=l[h],d=o.getBattleObj(c.ObjId);s.push(d),d.isShadow||(d.view.visible=!1);var p=!0,_=o.getBattleObj(r.OwnerObjID);if(_&&_ instanceof t.FightCard){var g=_;p=!g.isShowFogUI()}u=d.playEffect(r.MovieID,1,p),u&&n.push(u)}}else if(e.ID==pb.ClientAction.ActionID.DisCard){var r=pb.DisCardAct.decode(e.Data),a=o.getFighter(r.Uid);a.disHandCard(r.CardObjIDs)}}),n.length>0?[4,Promise.all(n)]:[3,7];case 6:p.sent(),s.forEach(function(t){t.view.visible=!0,t.view.alpha=1,t.isShadow=!1}),p.label=7;case 7:h=0,l=r.Actions,p.label=8;case 8:return h<l.length?(c=l[h],c.ID==pb.ClientAction.ActionID.Movie||c.ID==pb.ClientAction.ActionID.TextMovie||c.ID==pb.ClientAction.ActionID.DrawCard||c.ID==pb.ClientAction.ActionID.DisCard?[3,10]:(d=i.inst.getAction(c.ID),null==d?[3,10]:[4,d.playAction(c.Data)])):[3,11];case 9:p.sent(),p.label=10;case 10:return h++,[3,8];case 11:return[2]}})})},e}();__reflect(d.prototype,"SkillAction",["IAction"]);var p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return i=pb.MovieAct.decode(e),[4,t.prototype.playMovie.call(this,i.Targets,i.MovieID,i.OwnerObjID,i.PlayType,0,0)];case 1:return r.sent(),[2]}})})},e}(a);__reflect(p.prototype,"SkillStatusMovieAction",["IAction"]);var _=function(){function e(){}return e.prototype._showBonus=function(e,i){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return r=fairygui.UIPackage.createObject(PkgName.battle,"bonus",t.BonusTips),[4,r.show(e,i)];case 1:return n.sent(),[2]}})})},e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a,u,h,l,c,d,p,_,g,f;return __generator(this,function(m){switch(m.label){case 0:if(r=e.winUid,n=pb.BonusAct.decode(e),!n)return[2];if(o=t.BattleMgr.inst.battle,!o)return[2];s=[],a=0,u=n.Rewards,m.label=1;case 1:if(!(a<u.length))return[3,4];if(h=u[a],h.Uid!=o.getOwnFighter().uid)return[3,3];if(l=Data.bonus.get(h.BonusID),!l)return[3,3];if(c=!0,r)for(d=0;d<l["function"].length;d++)if(p=l["function"][0],"opp==9"==p||"front==9"==p){s.push({bonusName:l.name,resChange:h.Res}),c=!1;break}return c?[4,this._showBonus(l.name,h.Res)]:[3,3];case 2:m.sent(),m.label=3;case 3:return a++,[3,1];case 4:return r?[4,i.inst.getAction(pb.ClientAction.ActionID.BattleEnd).playAction(r)]:[3,6];case 5:m.sent(),m.label=6;case 6:_=0,g=s,m.label=7;case 7:return _<g.length?(f=g[_],[4,this._showBonus(f.bonusName,f.resChange)]):[3,10];case 8:m.sent(),m.label=9;case 9:return _++,[3,7];case 10:return[2]}})})},e}();__reflect(_.prototype,"BonusAction",["IAction"]);var g=function(){function e(){}return e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a,u,h,l,c,d,p,_,g,f,m,y;return __generator(this,function(C){switch(C.label){case 0:if(i=e,r=t.BattleMgr.inst.battle,!r)return[2];for(n=[],SoundMgr.inst.stopBgMusic(),o=0,s=0,a=0;9>a;a++)u=r.getGridById(a),u&&u.inGridCard&&(u.inGridCard.owner.uid==r.getOwnFighter().uid?o++:s++);h=r.battleType==t.BattleType.Guide?[r.getOwnFighter(),r.getEnemyFighter()]:[r.getOwnFighter()],d=function(e){var a,u,h,d,_,g;return __generator(this,function(f){switch(f.label){case 0:a=i==e.uid,u=e==r.getOwnFighter(),h=0,d=u?o:s,_=function(i){var o,s;return __generator(this,function(_){switch(_.label){case 0:return o=r.getGridById(i),o&&o.inGridCard&&o.inGridCard.owner.uid==e.uid?(h++,u&&1==h?[4,fairygui.GTimers.inst.waitTime(450)]:[3,2]):[3,7];case 1:return _.sent(),[3,6];case 2:return r.battleType!=t.BattleType.Guide?[3,4]:[4,fairygui.GTimers.inst.waitTime(208)];case 3:return _.sent(),[3,6];case 4:return[4,fairygui.GTimers.inst.waitTime(150)];case 5:_.sent(),_.label=6;case 6:r.battleType==t.BattleType.Guide&&o.inGridCard.view.showNewbieCountNum(h,u),s=o.inGridCard.view.blink(Core.TextColors.white),n.push(s),r.battleType==t.BattleType.Guide&&(h!=d?fairygui.GTimers.inst.add(207,1,function(){o.inGridCard.view.hideNewbieCountNum()},p):a?l=o.inGridCard.view:c=o.inGridCard.view),n.push(new Promise(function(t){a?SoundMgr.inst.playSoundAsync("count"+h+"_mp3"):SoundMgr.inst.playSoundAsync("count"+(d-h+1)+"_mp3"),t()})),_.label=7;case 7:return[2]}})},g=0,f.label=1;case 1:return 9>g?[5,_(g)]:[3,4];case 2:f.sent(),f.label=3;case 3:return g++,[3,1];case 4:return n.length>0?[4,Promise.all(n)]:[3,6];case 5:f.sent(),f.label=6;case 6:return r.battleType!=t.BattleType.Guide?[3,8]:[4,fairygui.GTimers.inst.waitTime(120)];case 7:return f.sent(),[3,10];case 8:return[4,fairygui.GTimers.inst.waitTime(100)];case 9:f.sent(),f.label=10;case 10:return[2]}})},p=this,_=0,g=h,C.label=1;case 1:return _<g.length?(f=g[_],[5,d(f)]):[3,4];case 2:C.sent(),C.label=3;case 3:return _++,[3,1];case 4:return l||c?(l&&(m=fairygui.UIPackage.createObject(PkgName.battle,"numResultAni"),l.addChild(m)),c&&(y=fairygui.UIPackage.createObject(PkgName.battle,"numResultAni").asCom,y.getChild("result").asLoader.url="battle_numLose_png",c.addChild(y)),[4,fairygui.GTimers.inst.waitTime(120)]):[3,6];case 5:C.sent(),C.label=6;case 6:return[4,fairygui.GTimers.inst.waitTime(80)];case 7:return C.sent(),[2]}})})},e}();__reflect(g.prototype,"BattleEndAction",["IAction"]);var f=function(){function e(){}return e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o;return __generator(this,function(s){switch(s.label){case 0:return i=pb.SwitchPosAct.decode(e),(r=t.BattleMgr.inst.battle)?(n=r.getBattleObj(i.Target),o=r.getBattleObj(i.SwitchTarget),n&&o?[4,n.switchPos(o)]:[2]):[2];case 1:return s.sent(),[2]}})})},e}();__reflect(f.prototype,"SwitchPosAction",["IAction"]);var m=function(){function e(){}return e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a;return __generator(this,function(u){if(i=pb.GuanxingAct.decode(e),r=t.BattleMgr.inst.battle,!r)return[2];for(n=!1,o=0,s=i.Uids;o<s.length;o++)if(a=s[o],r.getOwnFighter().uid==a){n=!0;break
}return n?(r.fighter1.handShow(i.SitOneDrawCards),r.fighter2.handShow(i.SitTwoDrawCards),[2]):[2]})})},e}();__reflect(m.prototype,"GuanxingAction",["IAction"]);var y=function(){function e(){}return e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a,u,h;return __generator(this,function(l){switch(l.label){case 0:return i=pb.SummonAct.decode(e),(r=t.BattleMgr.inst.battle)?(n=r.getFighter(i.Uid),o=new t.FightCard(i.Card,n),o.isInFog=i.IsInFog,o.isPublicEnemy=i.IsPublicEnemy,r.addBattleObj(o),s=r.getBattleObj(i.GridObjID),o._moveToGrid(s),a=s.view.addCard(o,2),u=a[0],h=a[1],h?[4,h]:[3,2]):[2];case 1:l.sent(),l.label=2;case 2:return[2]}})})},e}();__reflect(y.prototype,"SummonAction",["IAction"]);var C=function(){function e(){}return e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){return i=pb.DestroyAct.decode(e),(r=t.BattleMgr.inst.battle)?(i.Targets.forEach(function(t){var e=r.getBattleObj(t);e&&(e.gridObj?(e.gridObj.view.clear(),e.gridObj.inGridCard=null):e.owner.disHandCard([t]),e.view.clearEffect(),r.delBattleObj(t))}),[2]):[2]})})},e}();__reflect(C.prototype,"DestroyAction",["IAction"]);var v=function(){function e(){}return e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s;return __generator(this,function(a){switch(a.label){case 0:return i=pb.ReturnAct.decode(e),(r=t.BattleMgr.inst.battle)?(n=r.getBattleObj(i.CardObjID),n&&n.gridObj?(o=r.getFighter(i.Uid),n.view.clearEffect(),s=o.returnHandCard(i.Card),[4,n.view.moveToHand(o.handView,s)]):[2]):[2];case 1:return a.sent(),n.gridObj.view.clear(),n.gridObj.inGridCard=null,o.handView.refresh(),r.delBattleObj(i.CardObjID),[2]}})})},e}();__reflect(v.prototype,"ReturnAction",["IAction"]);var T=function(){function e(){}return e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){return i=pb.ModifySkillAct.decode(e),(r=t.BattleMgr.inst.battle)&&(n=r.getBattleObj(i.CardObjID))?(this.modifySkill(n,i.SkillID,i.IsEquip),n.gridObj?n.view.refleshSkill():n.initOwner.handView.isShow&&n.view.refleshSkill(),[2]):[2]})})},e.prototype.modifySkill=function(t,e,i){},e}();__reflect(T.prototype,"ModifySkillAction",["IAction"]);var w=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.modifySkill=function(t,e,i){t.addSkill(e)},e}(T);__reflect(w.prototype,"AddSkillAction");var b=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.modifySkill=function(t,e,i){t.delSkill(e,i)},e}(T);__reflect(b.prototype,"DelSkillAction");var P=function(){function e(){}return e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){switch(o.label){case 0:return(i=t.BattleMgr.inst.battle)?(r=pb.CopyAct.decode(e),n=i.getBattleObj(r.Target),n?[4,n.toBeCopy(r.CopyCard,r.OwnerUid)]:[2]):[2];case 1:return o.sent(),[2]}})})},e}();__reflect(P.prototype,"CopyAction",["IAction"]);var I=function(){function e(){}return e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){return(i=t.BattleMgr.inst.battle)?(r=pb.EnterFogAct.decode(e),(n=i.getBattleObj(r.Target))?(n.enterFog(r.IsPublicEnemy),[2]):[2]):[2]})})},e}();__reflect(I.prototype,"EnterFogAction",["IAction"]);var S=function(){function e(){}return e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){switch(o.label){case 0:return(i=t.BattleMgr.inst.battle)?(r=pb.LeaveFogAct.decode(e),n=[],r.Targets.forEach(function(t){var e=i.getBattleObj(t);e&&n.push(e.leaveFog())}),[4,Promise.all(n)]):[2];case 1:return o.sent(),[2]}})})},e}();__reflect(S.prototype,"LeaveFogAction",["IAction"]);var x=function(){function e(){}return e.prototype.playAction=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){switch(o.label){case 0:return(i=t.BattleMgr.inst.battle)?(r=pb.GoldGobAct.decode(e),0==r.Gold?[2]:i.getOwnFighter().uid!=r.Uid?[2]:(n=Core.ViewManager.inst.getView(ViewName.battle),[4,n.showGoldGob(r.Gold,r.IsLadder)])):[2];case 1:return o.sent(),[2]}})})},e}();__reflect(x.prototype,"GoldGobAction",["IAction"])}(Battle||(Battle={}));var Battle;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"battleType",{get:function(){return t.BattleType.Campaign},enumerable:!0,configurable:!0}),i.prototype.getEndViewName=function(){return ViewName.friendBattleEnd},i.prototype.isPvp=function(){return!0},i.prototype.endBattle=function(t,i){return void 0===i&&(i=!1),__awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,e.prototype.endBattle.call(this,t,i)];case 1:return r.sent(),[2]}})})},i.prototype._onBattleEnd=function(t){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return e.prototype._onBattleEnd.call(this,t),t.data!=this.getEndViewName()?[2]:[4,War.WarMgr.inst.openWarHome()];case 1:return r.sent(),i=Core.ViewManager.inst.getView(ViewName.enterWarAni),i?[4,i.dismiss()]:[3,3];case 2:r.sent(),Core.ViewManager.inst.close(ViewName.enterWarAni),r.label=3;case 3:return[2]}})})},i}(t.Battle);t.CampaignBattle=e,__reflect(e.prototype,"Battle.CampaignBattle")}(Battle||(Battle={}));var Battle;!function(t){var e;!function(t){t[t.PVP=1]="PVP",t[t.LEVEL=2]="LEVEL",t[t.CAMPAIGN_DEF=4]="CAMPAIGN_DEF",t[t.Training=5]="Training",t[t.Guide=6]="Guide",t[t.Friend=13]="Friend",t[t.LevelHelp=14]="LevelHelp",t[t.Campaign=15]="Campaign",t[t.VIDEO=100]="VIDEO"}(e=t.BattleType||(t.BattleType={}));var i;!function(t){t[t.OWN=0]="OWN",t[t.ENEMY=1]="ENEMY"}(i=t.Side||(t.Side={}));var r;!function(t){t[t.NONE=-1]="NONE",t[t.UP=1]="UP",t[t.DOWN=2]="DOWN",t[t.LEFT=3]="LEFT",t[t.RIGHT=4]="RIGHT"}(r=t.CardNumPos||(t.CardNumPos={}))}(Battle||(Battle={}));var Battle;!function(t){var e=function(){function e(e,i){this._equipID=e.EquipID,this._owner=i,this._skills=t.SkillGroup.getGroupsFromSkillIDs(e.Skills,!0,this._owner.level)}return Object.defineProperty(e.prototype,"equipID",{get:function(){return this._equipID},enumerable:!0,configurable:!0}),e.prototype.triggerSkill=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:e=0,i=this._skills,n.label=1;case 1:return e<i.length?(r=i[e],r.isEffective&&r.isSkillInGroup(t)?[4,this._owner.view.equipBlink()]:[3,3]):[3,4];case 2:return n.sent(),[2];case 3:return e++,[3,1];case 4:return[2]}})})},e.prototype.getSkillDesc=function(){for(var t=0,e=this._skills;t<e.length;t++){var i=e[t],r=i.desc;if(r&&""!=r)return r}return""},e}();t.Equip=e,__reflect(e.prototype,"Battle.Equip")}(Battle||(Battle={}));var Battle;!function(t){var e=[1191,1192,1194,1195,1453],i=function(){function e(e,i,r){if(this._group=e,this._isEquip=i,this._ownerLevel=r,this._skills=new Collection.Dictionary,""!=e)for(var n=t.BattleMgr.inst.getGroupSkills(e),o=0,s=n;o<s.length;o++){var a=s[o];a.name&&""!=a.name&&(this._name=a.name),this._isEquip&&a.desTra&&""!=a.desTra&&(this._desc=CardPool.CardPoolMgr.inst.formatSkillDesc(a,r)),this.setSkillEffective(a.__id__,!1)}}return e.getGroupsFromSkillIDs=function(t,i,r){if(!t)return[];var n=[];return t.forEach(function(t){var o=Data.skill.get(t);if(o){for(var s=0,a=n;s<a.length;s++){var u=a[s];if(u.isSkillInGroup(t))return void u.setSkillEffective(t,!0)}var h=new e(o.skillGroup,i,r);h.setSkillEffective(t,!0),n.push(h)}}),n},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"desc",{get:function(){return this.isEffective?this._desc:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEffective",{get:function(){if(!this._name||""==this._name)return!1;var t=!1;return this._skills.forEach(function(e,i){!t&&i&&(t=i)}),t},enumerable:!0,configurable:!0}),e.prototype.setSkillEffective=function(t,e){if(e&&(!this._name||""==this._name)){var i=Data.skill.get(t);i&&(this._name=i.name,this._isEquip&&i.desTra&&""!=i.desTra&&(this._desc="<font strokecolor=0x000000 stroke=2><b><i>"+i.name+":</i> </b></font>"+parse2html(i.desTra,1)))}this._skills.setValue(t,e)},e.prototype.setAllSkillUnEffective=function(){var t=this;this._skills.keys().forEach(function(e){t._skills.setValue(e,!1)})},e.prototype.isSkillInGroup=function(t){return this._skills.containsKey(t)},e}();t.SkillGroup=i,__reflect(i.prototype,"Battle.SkillGroup");var r=function(){function r(e,r){if(this._initEffects=e.Effect,this._level=1,Diy.DiyMgr.inst.isDiyCard(e.Id)){var n=Diy.DiyMgr.inst.getDiyCard(e.Id);this._baseCardObj=n?n:new Diy.DiyCard(e.DiyInfo)}else{var o=Data.pool.get(e.Id);if(!o)return;this._skin=e.Skin;var s=CardPool.CardPoolMgr.inst.getCollectCard(o.cardId);if(r.uid==Player.inst.uid&&!CardPool.CardPoolMgr.inst.isSystemCard(o)&&s&&s.gcardId==e.Id)this._baseCardObj=s,this._level=s.level;else{var a=new CardPool.BaseCard(o);this._baseCardObj=a,this._level=a.level}}this._gcardId=this._baseCardObj.gcardId,this._name=this._baseCardObj.name,this._skill1Name=this._baseCardObj.skill1Name,this._skill2Name=this._baseCardObj.skill2Name,this._skill3Name=this._baseCardObj.skill3Name,this._skill4Name=this._baseCardObj.skill4Name,this._skillDesc=this._baseCardObj.skillDesc,this._owner=r,this._initOwner=r,this._objId=e.ObjId,this._upNum=e.Up,this._downNum=e.Down,this._leftNum=e.Left,this._rightNum=e.Right,this._isInFog=e.IsInFog,this._isPublicEnemy=e.IsPublicEnemy,this._skills=i.getGroupsFromSkillIDs(e.Skills,!1,this._level),e.Equip&&(this._equip=new t.Equip(e.Equip,this))}return Object.defineProperty(r.prototype,"initEffects",{get:function(){return this._initEffects},enumerable:!0,configurable:!0}),r.prototype.clearInitEffects=function(){this._initEffects=null},Object.defineProperty(r.prototype,"objId",{get:function(){return this._objId},enumerable:!0,configurable:!0}),r.prototype.playEffect=function(t,e,i,r,n){return void 0===i&&(i=!0),this._view.playEffect(t,e,i,r,n)},Object.defineProperty(r.prototype,"side",{get:function(){var e=t.BattleMgr.inst.battle;return e&&this._owner.uid==e.getOwnFighter().uid?t.Side.OWN:t.Side.ENEMY},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"owner",{get:function(){return this._owner},set:function(t){this._owner=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"initOwner",{get:function(){return this._initOwner},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"collectCard",{get:function(){return this._baseCardObj.collectCard},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"upNum",{get:function(){return this._upNum},set:function(t){this._upNum=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"downNum",{get:function(){return this._downNum},set:function(t){this._downNum=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"leftNum",{get:function(){return this._leftNum},set:function(t){this._leftNum=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rightNum",{get:function(){return this._rightNum},set:function(t){this._rightNum=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cardId",{get:function(){return this._baseCardObj.cardId},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"gcardId",{get:function(){return this._gcardId},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"state",{get:function(){return this._baseCardObj.state},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"amount",{get:function(){return this._baseCardObj.amount},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxAmount",{get:function(){return this._baseCardObj.maxAmount},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"energy",{get:function(){return this._baseCardObj.energy},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxEnergy",{get:function(){return this._baseCardObj.energy},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rare",{get:function(){return this._baseCardObj.rare},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"skill1Name",{get:function(){return this._skill1Name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"skill2Name",{get:function(){return this._skill2Name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"skill3Name",{get:function(){return this._skill3Name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"skill4Name",{get:function(){return this._skill4Name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"skillDesc",{get:function(){return this._skillDesc},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"skillIds",{get:function(){return this._baseCardObj.skillIds},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"icon",{get:function(){t.BattleMgr.inst.battle;return this.isShowFogUI()?311:this._baseCardObj.icon},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"skin",{get:function(){t.BattleMgr.inst.battle;return this.isShowFogUI()?null:this._skin},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"equip",{get:function(){t.BattleMgr.inst.battle;return!this._equip||this.isShowFogUI()?null:this._equip.equipID},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"upNumOffset",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"downNumOffset",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"leftNumOffset",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rightNumOffset",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isNew",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"weapon",{get:function(){return this._baseCardObj.weapon},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"sound",{get:function(){return this._baseCardObj.sound},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"weaponRedFrame",{get:function(){if(!this._weaponRedFrame){this._weaponRedFrame=2;for(var t=this.weapon,e=0,i=Data.redframe.keys;e<i.length;e++){var r=i[e],n=Data.redframe.get(r);if(n.weapon==t){this._weaponRedFrame=n.frame,this._weaponRedFrame=this._weaponRedFrame<=1?2:this._weaponRedFrame;break}}}return this._weaponRedFrame},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"view",{get:function(){return this._view},set:function(t){this._view=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"gridObj",{get:function(){return this._gridObj},set:function(t){this._gridObj=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isShadow",{get:function(){return this._isShadow},set:function(t){this._isShadow=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isPublicEnemy",{get:function(){return this._isPublicEnemy},set:function(t){this._isPublicEnemy=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isInFog",{get:function(){return this._isInFog},set:function(t){this._isInFog=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isEnemy",{get:function(){return this.side!=t.Side.OWN||this._isPublicEnemy},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"equipment",{get:function(){return this._equip},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"level",{get:function(){return this._level},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isInCampaignMission",{get:function(){return this._baseCardObj.isInCampaignMission},enumerable:!0,configurable:!0}),r.prototype.getEffectiveSkill=function(){var t=[];return this._skills.forEach(function(e){e.isEffective&&t.push(e)}),t},r.prototype.triggerSkill=function(t,i){return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a,u;return __generator(this,function(h){switch(h.label){case 0:for(r=0,n=e;r<n.length;r++)if(o=n[r],t==o)return[2];return i?this._equip?[4,this._equip.triggerSkill(t)]:[3,2]:[3,3];case 1:h.sent(),h.label=2;case 2:return[2];case 3:s=0,a=this._skills,h.label=4;case 4:return s<a.length?(u=a[s],u.isEffective&&u.isSkillInGroup(t)?[4,this._view.skillBlink(u.name)]:[3,6]):[3,7];case 5:return h.sent(),[2];case 6:return s++,[3,4];case 7:return[2]}})})},r.prototype.addSkill=function(t){var e=Data.skill.get(t);if(e){for(var r=0,n=this._skills;r<n.length;r++){var o=n[r];if(o.isSkillInGroup(t))return void o.setSkillEffective(t,!0)}var s=new i(e.skillGroup,!1,this._level);s.setSkillEffective(t,!0),this._skills.push(s)}},r.prototype.delSkill=function(t,e){if(!e)for(var i=0,r=this._skills;i<r.length;i++){var n=r[i];if(0>t)n.setAllSkillUnEffective();else if(n.isSkillInGroup(t))return void n.setSkillEffective(t,!1)}},r.prototype.playCard=function(e,i){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return this._moveToGrid(e),r=this._owner.delHandCard(this),r||t.BattleMgr.inst.battle.getOtherFighter(this._owner.uid).delHandCard(this),[4,this._view.moveAndAddToGrid(e.view,i)];case 1:return n.sent(),[2]}})})},r.prototype._moveToGrid=function(t){t&&(this._gridObj&&(this._gridObj.inGridCard=null),this._gridObj=t,t.inGridCard=this)},r.prototype.moveToGrid=function(t,e,i){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return this._moveToGrid(t),t&&(r=t.view),[4,this._view.moveToGrid(r,e,i)];case 1:return n.sent(),[2]}})})},r.prototype.attackAndMoveTarget=function(t,e,i,r,n,o,s,a,u){return __awaiter(this,void 0,void 0,function(){var h,l;return __generator(this,function(c){switch(c.label){case 0:return r&&n&&r._moveToGrid(n),n&&(h=n.view),r&&(l=r.view),[4,this._view.attackAndMoveTarget(t.view,e,i,l,h,o,s,a,u)];case 1:return c.sent(),[2]}})})},r.prototype.changeSide=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return e=t.BattleMgr.inst.battle.fighter1,e.uid==this._owner.uid?this._owner=t.BattleMgr.inst.battle.fighter2:this._owner=e,[4,this._view.changeSide()];case 1:return i.sent(),[2]}})})},r.prototype.modifyValue=function(t,e){var i=0;if(1==e){i=1;var r=this.upNum;this.downNum<r&&(i=2,r=this.downNum),this.leftNum<r&&(i=3,r=this.leftNum),this.rightNum<r&&(i=4,r=this.rightNum)}if(0==i||1==i){var n=0;n=2==e?t:this.upNum+t,n=0>n?0:n,this.upNum=n}if(0==i||2==i){var o=0;o=2==e?t:this.downNum+t,o=0>o?0:o,this.downNum=o}if(0==i||3==i){var s=0;s=2==e?t:this.leftNum+t,s=0>s?0:s,this.leftNum=s}if(0==i||4==i){var a=0;a=2==e?t:this.rightNum+t,a=0>a?0:a,this.rightNum=a}this._view.setNumText()},r.prototype.switchPos=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){switch(o.label){case 0:return i=this.gridObj,r=this.moveToGrid(e.gridObj,"",t.CardNumPos.NONE),n=e.moveToGrid(i,"",t.CardNumPos.NONE),e.gridObj.inGridCard=e,this.gridObj.inGridCard=this,[4,r];case 1:return o.sent(),[4,n];case 2:return o.sent(),[2]}})})},r.prototype.toBeCopy=function(e,i){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(o){switch(o.label){case 0:return n=new r(e,t.BattleMgr.inst.battle.getFighter(i)),t.BattleMgr.inst.battle.addBattleObj(n),this._gridObj?[4,this._view.blink(Core.TextColors.white)]:[3,2];case 1:return o.sent(),this._view.toBeCopy(n),this._gridObj.inGridCardToBeCopy(n),n.gridObj=this._gridObj,this._view.setFrontSkin(),[3,3];case 2:this.owner.handCardToBeCopy(n),o.label=3;case 3:return[2]}})})},r.prototype.enterFog=function(t){this._isInFog=!0,this._isPublicEnemy=t,this.gridObj?this.view.setFrontSkin():this.view.hand.refresh(!0),this.view.effectPlayer&&this.isEnemy&&this.view.effectPlayer.setVisible(!1)},r.prototype.leaveFog=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._isInFog=!1,this.gridObj?[4,this.view.leaveFog()]:[3,2];case 1:return t.sent(),[3,3];case 2:this.view.hand.refresh(!0),t.label=3;case 3:return this.view.effectPlayer&&this.view.effectPlayer.setVisible(!0),[2]}})})},r.prototype.isShowFogUI=function(){var e=t.BattleMgr.inst.battle;return this.isInFog&&this.isEnemy&&e&&e.battleType!=t.BattleType.VIDEO},r}();t.FightCard=r,__reflect(r.prototype,"Battle.FightCard",["UI.ICardObj","Battle.IBattleObj"])}(Battle||(Battle={}));var Battle;!function(t){var e=function(){function e(e,i){if(this._objId=e.ObjId,this._uid=e.Uid,this._name=e.Name,e.NameText>0&&(this._name=Core.StringUtils.TEXT(e.NameText)),this._camp=e.Camp,this._pvpScore=e.PvpScore,this._headIcon=e.HeadImgUrl,this._frameIcon=e.HeadFrame,this._handCard=[null,null,null,null,null],this._initHandCard=[],e.Hand)for(var r=0;r<e.Hand.length;r++)this._handCard[r]=new t.FightCard(e.Hand[r],this),this._initHandCard.push(this._handCard[r]),i.addBattleObj(this._handCard[r]);if(this._casterSkill=e.CasterSkills,!this._headIcon||""==this._headIcon)for(var n=0,o=this._handCard;n<o.length;n++){var s=o[n];if(s){var a=s.gcardId,u=Data.pool.get(a);if(u)return void(this._headIcon="avatar_"+u.cardId+"_png")}}}return Object.defineProperty(e.prototype,"handView",{get:function(){return this._handView},set:function(t){this._handView=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"camp",{get:function(){return this._camp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pvpScore",{get:function(){return this._pvpScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objId",{get:function(){return this._objId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isGuard",{get:function(){return this._isGuard},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"casterSkill",{get:function(){return this._casterSkill},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"handCard",{get:function(){return this._handCard},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"initHandCard",{get:function(){return this._initHandCard},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"headIcon",{get:function(){return this._headIcon},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameIcon",{get:function(){return this._frameIcon&&""!=this._frameIcon||(this._frameIcon="1"),"headframe_"+this._frameIcon+"_png"},enumerable:!0,configurable:!0}),e.prototype.getHandCardByIdx=function(t){return 0>t||t>=this._handCard.length?null:this._handCard[t]},e.prototype.providerHandItemData=function(t){return this._handCard[t]},e.prototype.delHandCard=function(t){for(var e=0;e<this._handCard.length;e++)if(this._handCard[e]&&this._handCard[e].objId==t.objId)return this._handCard[e]=null,!0;return!1},e.prototype.kingAddHandCard=function(e){var i=this,r=t.BattleMgr.inst.battle;e.forEach(function(e){for(var n=-1,o=!1,s=0;s<i._handCard.length;s++)if(i._handCard[s]){if(i._handCard[s].isShadow){if(i._handCard[s].gcardId==e.Id){n=s,o=!0;break}0>n&&(n=s)}}else n=s;n>=0&&(o||(i._handCard[n]=new t.FightCard(e,i)),r.addBattleObj(i._handCard[n]))}),this._handView.refresh()},e.prototype.returnHandCard=function(e){for(var i=t.BattleMgr.inst.battle,r=-1,n=!1,o=this._handCard.length-1;o>=0;o--)if(this._handCard[o]&&this._handCard[o].isShadow)0>r&&(r=o,n=!0);else if(!this._handCard[o]){r=o,n=!1;break}return r>=0&&(n&&i.delBattleObj(this._handCard[r].objId),this._handCard[r]=new t.FightCard(e,this),i.addBattleObj(this._handCard[r])),r},e.prototype.disHandCard=function(e){for(var i=(t.BattleMgr.inst.battle,0);i<this._handCard.length;i++){var r=this._handCard[i];if(r){for(var n=!1,o=0,s=e;o<s.length;o++){var a=s[o];r.objId==a&&(n=!0)}n&&(this._handCard[i]=null)}}this._handView.refresh()},e.prototype.replaceHandCard=function(t){this._handCard=t},e.prototype.getHandCardAmount=function(){var t=0;return this._handCard.forEach(function(e){e&&t++}),t},e.prototype.updateHandCard=function(t,e){for(var i=0;i<this._handCard.length;i++)if(this._handCard[i]==t)return this._handCard[i]=e,void this._handView.refresh()},e.prototype.handShow=function(e){var i=this;e&&e.forEach(function(e){for(var r=0;r<i._handCard.length;r++)if(i._handCard[r]&&e.Id==i._handCard[r].gcardId)return;for(var r=0;r<i._handCard.length;r++)if(!i._handCard[r])return i._handCard[r]=new t.FightCard(e,i),void(i._handCard[r].isShadow=!0)}),this._handView.refresh(),this._handView.show()},e.prototype.handCardToBeCopy=function(t){for(var e=0;e<this._handCard.length;e++)if(this._handCard[e]&&t.objId==this._handCard[e].objId)return this._handCard[e]=t,void this._handView.refresh()},e}();t.Fighter=e,__reflect(e.prototype,"Battle.Fighter",["UI.IHandItemDataProvider"])}(Battle||(Battle={}));var Battle;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"battleType",{get:function(){return t.BattleType.Friend},enumerable:!0,configurable:!0}),i.prototype.getEndViewName=function(){return ViewName.friendBattleEnd},i.prototype.isPvp=function(){return!0},i}(t.Battle);t.FriendBattle=e,__reflect(e.prototype,"Battle.FriendBattle")}(Battle||(Battle={}));var Battle;!function(t){var e=function(){function e(e,i,r){if(this._objId=i.ObjId,this._id=e,i.InGridCard){var n=new t.FightCard(i.InGridCard,r.getFighter(i.Owner));this._inGridCard=n,r.addBattleObj(n)}this._initEffects=i.Effect}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objId",{get:function(){return this._objId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inGridCard",{get:function(){return this._inGridCard},set:function(t){this._inGridCard=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this._view},set:function(t){this._view=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"initEffects",{get:function(){return this._initEffects},enumerable:!0,configurable:!0}),e.prototype.playEffect=function(t,e,i,r,n){return this._view.playEffect(t,e,!0,r,n)},e.prototype.inGridCardToBeCopy=function(t){this._inGridCard=t,this.view.inGridCardToBeCopy(t.view)},e}();t.GridObj=e,__reflect(e.prototype,"Battle.GridObj",["Battle.IBattleObj"])}(Battle||(Battle={}));var Battle;!function(t){var e=function(e){function i(t){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];var n=e.call(this,t)||this;return n._guideBattleID=Player.inst.getResource(ResType.T_GUIDE_PRO)+1,n._canAttactGuide=!0,n}return __extends(i,e),Object.defineProperty(i.prototype,"battleType",{get:function(){return t.BattleType.Guide},enumerable:!0,configurable:!0}),i.prototype.getEndViewName=function(){return ViewName.pvpNewBattleEnd},i.prototype.boutBegin=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,e.prototype.boutBegin.call(this,t)];case 1:return i.sent(),[4,Guide.GuideMgr.inst.onGuideBattleBoutBegin(this._guideBattleID,this.curBout)];case 2:return i.sent(),[2]}})})},i.prototype.boutEnd=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,Guide.GuideMgr.inst.onGuideBattleBoutEnd(this._guideBattleID,this.curBout)];case 1:return t.sent(),[2]}})})},i.prototype.canAttactGuide=function(){var t=1==this._guideBattleID&&this._canAttactGuide;return t&&(this._canAttactGuide=!1),t},i.prototype.restoredDone=function(t,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return this._canAttactGuide=!1,[4,e.prototype.restoredDone.call(this,t,i)];case 1:return r.sent(),[2]}})})},i}(t.Battle);t.GuideBattle=e,__reflect(e.prototype,"Battle.GuideBattle")}(Battle||(Battle={}));var Battle;!function(t){var e=function(e){function i(i){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=e.apply(this,[i.Desk].concat(r))||this;if(o._isBeginFight=!1,o._levelId=r[0],o._needChoiceCardNum=i.NeedChooseNum,i.ChoiceCards){o._choiceCardPool=new Collection.Dictionary,o._choiceCards=[null,null,null,null,null];var s=o.getOwnFighter();i.ChoiceCards.forEach(function(e){var i=new t.FightCard(e,s);o.addBattleObj(i),o._choiceCardPool.setValue(i.cardId,i)}),o._initHandCards=s.handCard.concat()}return o}return __extends(i,e),Object.defineProperty(i.prototype,"levelName",{get:function(){return Level.LevelMgr.inst.getLevel(this._levelId).name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"battleType",{get:function(){return t.BattleType.LEVEL},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isBeginFight",{get:function(){return this._isBeginFight},set:function(t){this._isBeginFight=t},enumerable:!0,configurable:!0}),i.prototype.levelBattleReadyDone=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return t=[],this._choiceCards&&this._choiceCards.forEach(function(e){e&&t.push(e.gcardId)}),t.length<this._needChoiceCardNum?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(60214),this._needChoiceCardNum)),[2,!1]):[4,Net.rpcCall(pb.MessageID.C2S_LEVEL_READY_DONE,pb.LevelChooseCard.encode({Cards:t}))];case 1:return e=i.sent(),0==e.errcode?(this._isBeginFight=!0,[2,!0]):[2,!1]}})})},i.prototype.getEndViewName=function(){return ViewName.levelNewBattleEnd},i.prototype.readyDone=function(){this._isBeginFight&&e.prototype.readyDone.call(this)},i.prototype.boutBegin=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,e.prototype.boutBegin.call(this,t)];case 1:return i.sent(),Guide.GuideMgr.inst.onLevelBattleBoutBegin(this._levelId,this.curBout),[2]}})})},i.prototype.boutEnd=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,Guide.GuideMgr.inst.onLevelBattleBoutEnd(this._levelId,this.curBout)];case 1:return t.sent(),[2]}})})},i.prototype.endBattle=function(t){return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){switch(n.label){case 0:return i=e.prototype.endBattle.call(this,t),r=t.WinUid==this.getOwnFighter().uid,r?TD.onLevelCompleted(this._levelId):TD.onLevelFailed(this._levelId),[4,i];case 1:return n.sent(),[2]}})})},i.prototype.isEnemyHandOpen=function(){return!0},i.prototype.getCamps=function(){return[Camp.WEI,Camp.SHU,Camp.WU,Camp.HEROS]},i.prototype.getTitleCamps=function(){var t=Data.level.get(this._levelId);return t?t.nation.length<=0?[Camp.WEI,Camp.SHU,Camp.WU,Camp.HEROS]:t.nation:[Camp.WEI,Camp.SHU,Camp.WU,Camp.HEROS]},i.prototype.getCardState=function(t){return this._choiceCardPool.containsKey(t.cardId)?t.isInCampaignMission?UI.BaseCardItem.campaignBanState:UI.BaseCardItem.NormalState:UI.BaseCardItem.ForbidState},i.prototype.getChoiceCard=function(){return this._choiceCards.concat()},i.prototype.getMaxAmount=function(){return this._needChoiceCardNum},i.prototype.onConfirm=function(t,e){return __awaiter(this,void 0,void 0,function(){var e,i,r,n;
return __generator(this,function(o){for(this._choiceCards=t,e=this._initHandCards.concat(),i=0,r=0;r<this._needChoiceCardNum;r++)this._choiceCards[r]&&(e[e.length-this._needChoiceCardNum+i]=this._choiceCardPool.getValue(this._choiceCards[r].cardId),i++);return n=this.getOwnFighter(),n.replaceHandCard(e),n.getHandCardAmount()>=5&&Core.ViewManager.inst.getView(ViewName.battle).visibleBeginBtn(!0,!1),[2,!0]})})},i.prototype.needDiyCard=function(){return!1},i.prototype.getMinAmount=function(){return 0},i.prototype.visableCampaign=function(){return!1},i.prototype.needEnergyProgress=function(){return!1},i.prototype.needExpProgress=function(){return!1},i.prototype.updateFightCard=function(e){var i=this.getOwnFighter(),r=new t.FightCard(e,i),n=this._choiceCardPool.getValue(r.cardId);n&&(this.addBattleObj(r),this._choiceCardPool.setValue(r.cardId,r),i.updateHandCard(n,r))},i}(t.Battle);t.LevelBattle=e,__reflect(e.prototype,"Battle.LevelBattle",["UI.IChoiceCardCtrl"]);var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"battleType",{get:function(){return t.BattleType.LevelHelp},enumerable:!0,configurable:!0}),i}(e);t.LevelHelpBattle=i,__reflect(i.prototype,"Battle.LevelHelpBattle")}(Battle||(Battle={}));var Battle;!function(t){function e(e,i){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(r){switch(r.label){case 0:return e=pb.FightDesk.decode(i),[4,t.BattleMgr.inst.beginBattle(e,e.Type)];case 1:return r.sent(),e.Type==t.BattleType.Campaign&&Core.ViewManager.inst.close(ViewName.warHome),[2]}})})}function i(e,i){return __awaiter(this,void 0,void 0,function(){var e,r,n;return __generator(this,function(o){switch(o.label){case 0:return(e=t.BattleMgr.inst.battle)?(r=pb.FightBoutBegin.decode(i),n=e.getFighter(r.BoutUid),Core.ViewManager.inst.getView(ViewName.battle).beginBoutTimer(n,r.BoutTimeout),[4,e.boutBeginAni(r.BoutUid)]):[3,4];case 1:return o.sent(),[4,t.BoutActionPlayer.inst.playActions(r.Actions,null)];case 2:return o.sent(),[4,e.boutBegin(r.BoutUid)];case 3:o.sent(),o.label=4;case 4:return[2]}})})}function r(e,i){return __awaiter(this,void 0,void 0,function(){var e,r;return __generator(this,function(n){switch(n.label){case 0:return e=t.BattleMgr.inst.battle,e?e.battleType==t.BattleType.PVP?[3,2]:[4,Guide.GuideMgr.inst.waitGuideComplete()]:[2];case 1:n.sent(),n.label=2;case 2:return r=pb.FightBoutResult.decode(i),Core.ViewManager.inst.getView(ViewName.battle).onPlayBoutActions(),[4,t.BoutActionPlayer.inst.playCard(r.UseCardObjID,r.TargetGridId,r.CardNeedTalk,r.IsUseCardInFog,r.IsUseCardPublicEnemy)];case 3:return n.sent(),[4,t.BoutActionPlayer.inst.playActions(r.Actions,r.WinUid)];case 4:return n.sent(),[4,fairygui.GTimers.inst.waitTime(100)];case 5:return n.sent(),[4,e.boutEnd()];case 6:return n.sent(),e.readyDone(),[2]}})})}function n(e,i){t.BattleMgr.inst.endBattle(pb.BattleResult.decode(i))}function o(e,i){var r=t.BattleMgr.inst.battle;r&&r instanceof t.LevelBattle&&r.updateFightCard(pb.Card.decode(i))}function s(e,i){if(t.BattleMgr.inst.battle&&t.BattleMgr.inst.battle.isPvp()){var r=pb.SendEmojiArg.decode(i),n=Core.ViewManager.inst.getView(ViewName.battle);n.isShow()&&n.showEnemyEmoji(r.EmojiID)}}function a(e,i){var r=pb.LevelBattle.decode(i);t.BattleMgr.inst.beginBattle(r,r.Desk.Type,r.LevelID)}function u(){Net.registerRpcHandler(pb.MessageID.S2C_READY_FIGHT,e),Net.registerRpcHandler(pb.MessageID.S2C_FIGHT_BOUT_BEGIN,i),Net.registerRpcHandler(pb.MessageID.S2C_FIGHT_BOUT_RESULT,r),Net.registerRpcHandler(pb.MessageID.S2C_BATTLE_END,n),Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_FIGHT_CARD,o),Net.registerRpcHandler(pb.MessageID.S2C_SYNC_EMOJI,s),Net.registerRpcHandler(pb.MessageID.S2C_READY_LEVEL_FIGHT,a)}t.initRpc=u}(Battle||(Battle={}));var Battle;!function(t){var e=function(e){function i(t){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];var n=e.apply(this,[t].concat(i))||this;if(n._isFirstPvp=!1,n._fighter1.uid==Player.inst.uid)n._ownFighter=n._fighter1;else if(n._fighter2.uid==Player.inst.uid)n._ownFighter=n._fighter2;else if(n._ownFighter=n._fighter1,i.length>0){var o=i[0];n._fighter1.uid==o?n._ownFighter=n._fighter1:n._fighter2.uid==o&&(n._ownFighter=n._fighter2)}return n}return __extends(i,e),Object.defineProperty(i.prototype,"battleType",{get:function(){return t.BattleType.VIDEO},enumerable:!0,configurable:!0}),i.prototype.getEndViewName=function(){return ViewName.levelNewBattleEnd},i.prototype.isEnemyHandOpen=function(){return!0},i.prototype.endBattle=function(t,i){return void 0===i&&(i=!1),__awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return r=e.prototype.endBattle.call(this,t,i),Quest.QuestMgr.inst.onWatchVideo(),[4,r];case 1:return n.sent(),[2]}})})},i}(t.Battle);t.VideoBattle=e,__reflect(e.prototype,"Battle.VideoBattle")}(Battle||(Battle={}));var Battle;!function(t){var e=function(){function e(){}return Object.defineProperty(e,"inst",{get:function(){return e._inst||(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPlaying",{get:function(){return this._isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recordStartSuccess",{get:function(){return this._recordStartSuccess},enumerable:!0,configurable:!0}),e.prototype.playById=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return e={VideoID:t},[4,Net.rpcCall(pb.MessageID.C2S_WATCH_VIDEO,pb.WatchVideoArg.encode(e))];case 1:return i=n.sent(),0!=i.errcode?[3,3]:(r=pb.WatchVideoResp.decode(i.payload),[4,this.play(r.VideoData)]);case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.startRecord=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return window.support.record?(this._isAskingRecordScreen=!0,this._recordStartSuccess=!1,[4,Core.NativeMsgCenter.inst.sendAndWaitNativeMessage(Core.NativeMessage.START_RECORD,Core.NativeMessage.START_RECORD_COMPLETE)]):[3,2];case 1:t=i.sent(),this._recordStartSuccess=t.success,this._isAskingRecordScreen=!1,e=Core.ViewManager.inst.getView(ViewName.battle),this._recordStartSuccess&&e.setRecordMode(!0),i.label=2;case 2:return[2]}})})},e.prototype.play=function(e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){return e.Actions.length<2?[2]:(this._data=e,i=pb.FightDesk.decode(e.Actions[0].Data),t.BattleMgr.inst.beginBattle(i,t.BattleType.VIDEO,e.ShareUid),t.BattleMgr.inst.battle?(this._recordStartSuccess=!1,this.playBattle(),[2]):[2])})})},e.prototype.playBattle=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o,s,a,u;return __generator(this,function(h){switch(h.label){case 0:h.trys.push([0,18,,19]),this._isPlaying=!0,e=1,h.label=1;case 1:if(!(e<this._data.Actions.length))return[3,17];h.label=2;case 2:return this._isAskingRecordScreen?[4,fairygui.GTimers.inst.waitTime(30)]:[3,4];case 3:return h.sent(),[3,2];case 4:return this._waitStop?(this._isPlaying=!1,this._waitStop(),this._waitStop=null,[2]):(i=t.BattleMgr.inst.battle,i?[4,fairygui.GTimers.inst.waitTime(400)]:(this._isPlaying=!1,[2]));case 5:switch(h.sent(),r=this._data.Actions[e],n=r.ID){case pb.VideoAction.ActionID.BoutBegin:return[3,6];case pb.VideoAction.ActionID.BoutAction:return[3,11];case pb.VideoAction.ActionID.End:return[3,14]}return[3,15];case 6:return o=pb.FightBoutBegin.decode(r.Data),[4,i.boutBeginAni(o.BoutUid)];case 7:return h.sent(),[4,t.BoutActionPlayer.inst.playActions(o.Actions,null)];case 8:return h.sent(),[4,i.boutBegin(o.BoutUid)];case 9:return h.sent(),[4,fairygui.GTimers.inst.waitTime(600)];case 10:return h.sent(),[3,16];case 11:return s=pb.FightBoutResult.decode(r.Data),[4,t.BoutActionPlayer.inst.playCard(s.UseCardObjID,s.TargetGridId,s.CardNeedTalk,s.IsUseCardInFog,s.IsUseCardPublicEnemy)];case 12:return h.sent(),[4,t.BoutActionPlayer.inst.playActions(s.Actions,s.WinUid)];case 13:return h.sent(),[3,16];case 14:return a=pb.BattleResult.decode(r.Data),t.BattleMgr.inst.endBattle(a,!0),this._isPlaying=!1,this.stopRecord(),[2];case 15:return[3,16];case 16:return e++,[3,1];case 17:return[3,19];case 18:return u=h.sent(),console.log(u),[3,19];case 19:return this._isPlaying=!1,this._waitStop&&this._waitStop(),this._waitStop=null,this.stopRecord(),[2]}})})},e.prototype.stopRecord=function(){if(window.support.record&&this._recordStartSuccess){Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.STOP_RECORD);var t=Core.ViewManager.inst.getView(ViewName.battle);t&&t.setRecordMode(!1)}},e.prototype.stop=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return this._isPlaying?[4,new Promise(function(e){t._waitStop=e})]:[2];case 1:return e.sent(),[2]}})})},e}();t.VideoPlayer=e,__reflect(e.prototype,"Battle.VideoPlayer")}(Battle||(Battle={}));var Core;!function(t){function e(t,i){var r=Object.getOwnPropertyDescriptor(t,i);if(r)return r;var n=Object.getPrototypeOf(t);return n?e(n,i):null}function i(t,e){for(var i=t[r],n=i.length,o=0;n>o;o+=2){var s=i[o],a=i[o+1];s.call(a,e)}}var r="__listeners__",n="__bindables__",o=0,s=function(){function s(t,e,i,r){this.isExecuting=!1,this.property=t,this.handler=e,this.next=r,this.thisObject=i}return s.watch=function(t,e,i,r){if(e.length>0){var n=e.shift(),o=s.watch(null,e,i,r),a=new s(n,i,r,o);return a.reset(t),a}return null},s.checkBindable=function(s,a){var u=s[n];if(u&&-1!=u.indexOf(a))return!0;var h=egret.is(s,"egret.IEventDispatcher");h||s[r]||(s[r]=[]);var l=e(s,a);if(l&&l.set&&l.get){var c=l.set;l.set=function(e){this[a]!=e&&(c.call(this,e),h?t.PropertyEvent.dispatchPropertyEvent(this,t.PropertyEvent.PROPERTY_CHANGE,a):i(this,a))}}else{if(l&&(l.get||l.set))return!1;o++;var d="_"+o+a;s[d]=l?l.value:null,l={enumerable:!0,configurable:!0},l.get=function(){return this[d]},l.set=function(e){this[d]!=e&&(this[d]=e,h?t.PropertyEvent.dispatchPropertyEvent(this,t.PropertyEvent.PROPERTY_CHANGE,a):i(this,a))}}Object.defineProperty(s,a,l),t.registerBindable(s,a)},s.prototype.unwatch=function(){this.reset(null),this.handler=null,this.next&&(this.next.handler=null)},s.prototype.getValue=function(){return this.next?this.next.getValue():this.getHostPropertyValue()},s.prototype.setHandler=function(t,e){this.handler=t,this.thisObject=e,this.next&&this.next.setHandler(t,e)},s.prototype.reset=function(e){var i=this.host;if(i)if(egret.is(i,"egret.IEventDispatcher"))i.removeEventListener(t.PropertyEvent.PROPERTY_CHANGE,this.wrapHandler,this);else{var n=i[r],o=n.indexOf(this);n.splice(o-1,2)}if(this.host=e,e)if(s.checkBindable(e,this.property),egret.is(e,"egret.IEventDispatcher"))e.addEventListener(t.PropertyEvent.PROPERTY_CHANGE,this.wrapHandler,this,!1,100);else{var n=e[r];n.push(this.onPropertyChange),n.push(this)}this.next&&this.next.reset(this.getHostPropertyValue())},s.prototype.getHostPropertyValue=function(){return this.host?this.host[this.property]:null},s.prototype.wrapHandler=function(t){this.onPropertyChange(t.property)},s.prototype.onPropertyChange=function(t){if(t==this.property&&!this.isExecuting)try{this.isExecuting=!0,this.next&&this.next.reset(this.getHostPropertyValue()),this.handler.call(this.thisObject,this.getValue())}finally{this.isExecuting=!1}},s}();t.Watcher=s,__reflect(s.prototype,"Core.Watcher")}(Core||(Core={}));var CardPool;!function(t){var e;!function(t){t[t.Lock=1]="Lock",t[t.Alive=2]="Alive",t[t.Dead=3]="Dead",t[t.Unlock=4]="Unlock"}(e=t.CardState||(t.CardState={}));var i=function(i){function r(t){var r=i.call(this,t)||this;return r._state=e.Lock,r._level=t.level,r._isNew=!1,r._hasSkins=[""],r}return __extends(r,i),r.prototype.init=function(i){this.level=i.Level,this.skin=i.Skin,this.equip=i.Equip;var r=t.CardPoolMgr.inst.getCardData(i.CardId,i.Level);return r?(this._data=r,this._state=e.Alive,this._energy=i.Energy,this._amount=i.Amount,this._isInCampaignMission=i.State==pb.CardState.InCampaignMs,void(this._isInSeason=i.State==pb.CardState.InSeasonPvp)):void console.debug("collect card init, no card data %d %d",i.CardId,i.Level)},r.prototype.update=function(i){var r=this.amount,n=this.maxAmount,o=this.isMaxLevel();if(this._state==e.Dead)this.state=e.Alive,!this.isMaxLevel()&&this.amount>=this.maxAmount&&t.CardPoolMgr.inst.modifyCampCardHintNum(this.camp,1);else if(0==i.Level){if(this.state==e.Alive){var s=t.CardPoolMgr.inst.getCardData(i.CardId,1);if(!s)return void console.debug("collect card del, no card data %d %d",i.CardId,1);Core.EventCenter.inst.dispatchEventWith(GameEvent.CardDelEv,!1,this),this.data=s,this.level=1,this._isNew=!1;this.equip;this.equip=null,this.state=e.Lock}}else if(this._level!=i.Level||this._state==e.Lock||this._state==e.Unlock){var s=t.CardPoolMgr.inst.getCardData(i.CardId,i.Level);if(!s)return void console.debug("collect card update, no card data %d %d",i.CardId,i.Level);this.data=s,this.level=i.Level,(this._state==e.Lock||this._state==e.Unlock)&&(this.state=e.Alive)}var a=this.isInCampaignMission;this.isInCampaignMission=i.State==pb.CardState.InCampaignMs,!a&&this.isInCampaignMission&&Core.EventCenter.inst.dispatchEventWith(GameEvent.CardInCampaignMsEv,!1,this),this._isInSeason=i.State==pb.CardState.InSeasonPvp,this.skin=i.Skin,this.equip=i.Equip,this.amount=i.Amount,this.energy=i.Energy,o||(this._tryAddCardHintNum(r,n),this._trySubCardHintNum(r,n,o))},r.prototype._tryAddCardHintNum=function(e,i){this.isMaxLevel()&&this.rare!=CardQuality.LIMITED||this.order<=0||(0>=e&&this.amount>0&&this.level<=1&&(this.isNew=!0),this.rare!=CardQuality.LIMITED&&i>e&&this.amount>=this.maxAmount&&t.CardPoolMgr.inst.modifyCampCardHintNum(this.camp,1))},r.prototype._trySubCardHintNum=function(e,i,r){this.order<=0||this.rare!=CardQuality.LIMITED&&e>=i&&(this.isMaxLevel()||this.amount<this.maxAmount)&&t.CardPoolMgr.inst.modifyCampCardHintNum(this.camp,-1)},Object.defineProperty(r.prototype,"collectCard",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isNew",{get:function(){return this._isNew},set:function(e){if(this._isNew&&!e)t.CardPoolMgr.inst.modifyCampCardHintNum(this.camp,-1),t.CardPoolMgr.inst.setCardNew(this.cardId,!1);else if(!this._isNew&&e&&(t.CardPoolMgr.inst.modifyCampCardHintNum(this.camp,1),t.CardPoolMgr.inst.setCardNew(this.cardId,!0),!Core.DeviceUtils.isWXGame())){if(""==Player.inst.avatarUrl){var i=this.cardId;Player.inst.saveAvatarUrl("avatar_"+i+"_png")}t.CardPoolMgr.inst.setAvatarNew(this.cardId,!0)}this._isNew=e},enumerable:!0,configurable:!0}),r.prototype.initIsNew=function(t){this._isNew=t},Object.defineProperty(r.prototype,"level",{get:function(){return this._level},set:function(t){this._level=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"skin",{get:function(){return this._skin},set:function(t){this._skin=t},enumerable:!0,configurable:!0}),r.prototype.addSkin=function(t){this._hasSkins.push(t)},Object.defineProperty(r.prototype,"hasSkins",{get:function(){return this._hasSkins},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"equip",{get:function(){return this._equip},set:function(t){this._equip=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"state",{get:function(){return this._state},set:function(t){this._state=t},enumerable:!0,configurable:!0}),r.prototype.getLevelObj=function(e){if(0>=e)return null;if(e==this.level)return this;var i=t.CardPoolMgr.inst.getCardData(this.cardId,e);if(!i)return null;var n=new r(i);return n.skin=this.skin,n},r.prototype.copyObj=function(t){null==t&&(t=this.level);var e=this.getLevelObj(t);return e&&(e.state=this._state,e.amount=this._amount),e},r.prototype.isMaxLevel=function(){return this.maxAmount<=0},r.prototype.canLevelUp=function(){return this.amount>=this.maxAmount&&!this.isMaxLevel()},Object.defineProperty(r.prototype,"isInCampaignMission",{get:function(){return this._isInCampaignMission},set:function(t){this._isInCampaignMission=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isInSeason",{get:function(){return this._isInSeason},set:function(t){this._isInSeason=t},enumerable:!0,configurable:!0}),r.PropAmount="amount",r.PropEnergy="energy",r.PropLevel="level",r.PropState="state",r.PropIsNew="isNew",r.PropSkin="skin",r.PropEquip="equip",r}(t.BaseCard);t.Card=i,__reflect(i.prototype,"CardPool.Card")}(CardPool||(CardPool={}));var CardPool;!function(t){function e(){r.inst.initData()}function i(){t.initRpc(),Player.inst.addEventListener(Player.LogoutEvt,e,null);var i=Core.ViewManager.inst.registerView.bind(Core.ViewManager.inst),r=fairygui.UIPackage.createObject;i(ViewName.cardInfo,function(){var e=new t.MyCardInfoWnd;return e.contentPane=r(PkgName.cardpool,ViewName.cardInfo).asCom,e}),i(ViewName.cardpool,function(){return r(PkgName.cardpool,ViewName.cardpool,t.CardPoolView)}),i(ViewName.cardInfoOther,function(){var e=new t.OtherCardInfo;return e.contentPane=r(PkgName.cardpool,ViewName.cardInfoOther).asCom,e}),i(ViewName.skillFaq,function(){var e=new t.SkillFaqWnd;return e.contentPane=r(PkgName.cardpool,ViewName.skillFaq).asCom,e}),i(ViewName.skinView,function(){var e=new t.SkinWnd;return e.contentPane=r(PkgName.cards,ViewName.skinView).asCom,e}),i(ViewName.cardUpWnd,function(){var e=new t.CardUpWnd;return e.contentPane=r(PkgName.cards,ViewName.cardUpWnd).asCom,e})}var r=function(){function e(){this._STORE_KEY="hintNums",this.initData()}return Object.defineProperty(e,"inst",{get:function(){return e._inst||(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),e.prototype.initData=function(){var e=this;this._upLevelWnd&&this._upLevelWnd.hide(),this._cardId2CardData=new Collection.Dictionary,this._camp2Cards=new Collection.Dictionary,this._collectCards=new Collection.Dictionary;var i=Data.pool.keys;i.sort(function(t,e){var i=Data.pool.get(t),r=Data.pool.get(e);return i.cardOrder>r.cardOrder?1:-1}),i.forEach(function(i){var r=Data.pool.get(i);if(!e.isSystemCard(r)){var n=e._cardId2CardData.getValue(r.cardId);if(n||(n=new Collection.Dictionary,e._cardId2CardData.setValue(r.cardId,n)),n.setValue(r.level,r),!e._collectCards.containsKey(r.cardId)&&1==r.level){var o=new t.Card(r);e._collectCards.setValue(r.cardId,o);var s=e._camp2Cards.getValue(o.camp);s||(s=[],e._camp2Cards.setValue(o.camp,s)),s.push(o)}}})},e.prototype.isSystemCard=function(t){return 0==t.cardId||1==t.campaign},e.prototype.onLogin=function(t){var e=this;t&&(t.forEach(function(t){var i=e.getCollectCard(t.CardId);return i?void i.init(t):void console.error("onLogin no card %d %d",t.CardId,t.Level)}),this._loadCardHintNumData())},e.prototype.updateCollectCards=function(t){var e=this;t&&t.forEach(function(t){var i=e.getCollectCard(t.CardId);if(!i)return void console.debug("updateCollectCards no card %d %d",t.CardId,t.Level);var r=i.amount;if(i.update(t),t.Level>0){var n=i.amount;i.rare==CardQuality.LIMITED&&0>=r&&n>0&&Core.EventCenter.inst.dispatchEventWith(GameEvent.AddLimitedCardEv,!1,i.camp)}})},e.prototype.getCardData=function(t,e){e=0>=e?1:e;var i=this._cardId2CardData.getValue(t);return i?i.getValue(e):null},e.prototype.getCollectCardsByCamp=function(t,e){if(void 0===e&&(e=!0),e)return this._camp2Cards.getValue(t);var i=this._camp2Cards.getValue(t),r=[];return i.forEach(function(t){t.order>0&&(t.rare==CardQuality.LIMITED?t.amount>0&&r.push(t):r.push(t))}),r},e.prototype.getHasCollectCardsByCamp=function(t){var e=this._camp2Cards.getValue(t),i=[];return e.forEach(function(t){t.order>0&&(t.rare==CardQuality.LIMITED?t.amount>0&&i.push(t):(t.amount>0||t.level>1)&&i.push(t))}),i},e.prototype.getCollectCard=function(t){return this._collectCards.getValue(t)},e.prototype.onEnterCardPool=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=Core.ViewManager.inst,[4,t.open(ViewName.cardpool)];case 1:return e.sent(),[2]}})})},e.prototype.treatCard=function(t){Net.rpcCall(pb.MessageID.C2S_CARD_TREAT,pb.TargetCard.encode({CardId:t}))},e.prototype.reliveCard=function(t){Net.rpcCall(pb.MessageID.C2S_CARD_RELIVE,pb.TargetCard.encode({CardId:t}))},e.prototype.upLevelCard=function(e,i){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_UPLEVEL_CARD,pb.UpLevelCardArg.encode({CardId:e,IsConsumeJade:i}))];case 1:return r=n.sent(),0!=r.errcode?[2,!1]:(fairygui.GTimers.inst.callDelay(100,t.CardInfoWnd.inst.playUplevelEffect,t.CardInfoWnd.inst,null),[2,!0])}})})},e.prototype._loadCardHintNumData=function(){var t=this,e=egret.localStorage.getItem(this._STORE_KEY);e&&""!=e||(e="{}"),this._camp2CardHintNums=JSON.parse(e);var i=""+Player.inst.uid;this._camp2CardHintNums[i]||(this._camp2CardHintNums[i]={newCards:{},newAvatars:{}}),this._camp2CardHintNums[i].campNums={},[Camp.WEI,Camp.SHU,Camp.WU,Camp.HEROS].forEach(function(e){t._camp2CardHintNums[i].campNums[""+e]=0});for(var r=this._collectCards.keys(),n=0,o=r;n<o.length;n++){var s=o[n],a=this._collectCards.getValue(s);if(!a.isMaxLevel()&&a.amount>=a.maxAmount&&a.order>0&&a.rare!=CardQuality.LIMITED){var u=a.camp,h=this._camp2CardHintNums[i].campNums[""+u];this._camp2CardHintNums[i].campNums[""+u]=h+1}}console.debug("====================== "+JSON.stringify(this._camp2CardHintNums[i])),this._camp2CardHintNums[i].newCards||(this._camp2CardHintNums[i].newCards={},this._saveCardHintNumData()),this._camp2CardHintNums[i].newAvatars||(this._camp2CardHintNums[i].newAvatars={},this._saveCardHintNumData());var l=this._camp2CardHintNums[i].newCards;for(var c in l){var s=parseInt(c),a=this.getCollectCard(s);if(a)if(a.amount>0){if(a.initIsNew(l[""+s]),l[""+s]){var u=a.camp,h=this._camp2CardHintNums[i].campNums[""+u];this._camp2CardHintNums[i].campNums[""+u]=h+1}}else l[""+s]=!1,a.initIsNew(!1)}this._avatarHintNum=0;var d=this._camp2CardHintNums[i].newAvatars;for(var c in d)d[c]&&++this._avatarHintNum},e.prototype._saveCardHintNumData=function(){var t=JSON.stringify(this._camp2CardHintNums);egret.localStorage.setItem(this._STORE_KEY,t)},e.prototype.getCampCardHintNum=function(t){var e=this;if(void 0===t&&(t=0),0==t){var i=0;return[Camp.WEI,Camp.SHU,Camp.WU,Camp.HEROS].forEach(function(t){i+=e._camp2CardHintNums[""+Player.inst.uid].campNums[""+t]}),i}return this._camp2CardHintNums[""+Player.inst.uid].campNums[""+t]},e.prototype.modifyCampCardHintNum=function(t,e){var i=this._camp2CardHintNums[""+Player.inst.uid].campNums[""+t];i=0>e+i?0:e+i,this._camp2CardHintNums[""+Player.inst.uid].campNums[""+t]=i,Core.EventCenter.inst.dispatchEventWith(Core.Event.CardHintNumChangeEv,!1,t)},e.prototype.isCardNew=function(t){var e=""+Player.inst.uid;return 1==this._camp2CardHintNums[e].newCards[""+t]},e.prototype.isAvatarNew=function(t){var e=""+Player.inst.uid;return 1==this._camp2CardHintNums[e].newAvatars[""+t]},e.prototype.setCardNew=function(t,e){var i=""+Player.inst.uid,r=this._camp2CardHintNums[i].newCards[""+t];null==r&&(r=!1),e&&r||(this._camp2CardHintNums[i].newCards[""+t]=e,this._saveCardHintNumData())},e.prototype.setAvatarNew=function(t,e){var i=""+Player.inst.uid,r=this._camp2CardHintNums[i].newAvatars[""+t];null==r&&(r=!1),e&&r||(this._camp2CardHintNums[i].newAvatars[""+t]=e,this._saveCardHintNumData(),e?this._setAvatarHintNum(this._avatarHintNum+1):this._setAvatarHintNum(Math.max(0,this._avatarHintNum-1)))},e.prototype._setAvatarHintNum=function(t){this._avatarHintNum=t,Core.EventCenter.inst.dispatchEventWith(Core.Event.AvatarHintNumChangeEv)},e.prototype.clearAvatarHintNum=function(){this._avatarHintNum=0,this._camp2CardHintNums[""+Player.inst.uid].newAvatars={},this._saveCardHintNumData(),Core.EventCenter.inst.dispatchEventWith(Core.Event.AvatarHintNumChangeEv)},Object.defineProperty(e.prototype,"avatarHintNum",{get:function(){return this._avatarHintNum},enumerable:!0,configurable:!0}),e.prototype.formatSkillDesc=function(t,e){return"<font strokecolor=0x000000 stroke=2><b><i>"+t.name+":</i> </b></font>"+parse2html(t.desTra,e)},e}();t.CardPoolMgr=r,__reflect(r.prototype,"CardPool.CardPoolMgr"),t.init=i}(CardPool||(CardPool={}));var CardPool;!function(t){var e=function(){function e(){this._allSkins=new Collection.Dictionary,this._mySkins=new Collection.Dictionary,this._init()}return Object.defineProperty(e,"inst",{get:function(){return e._inst||(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),e.prototype._init=function(){var t=this;if("lzd_handjoy"==window.gameGlobal.channel){var e=Data.skin_config_handjoy.keys;e.forEach(function(e){var i=Data.skin_config_handjoy.get(e),r=i.general;t._allSkins.containsKey(r)||t._allSkins.setValue(r,[""]),t._allSkins.getValue(r).push(e.toString())})}else{var e=Data.skin_config.keys;e.forEach(function(e){var i=Data.skin_config.get(e),r=i.general;t._allSkins.containsKey(r)||t._allSkins.setValue(r,[""]),t._allSkins.getValue(r).push(e.toString())})}},e.prototype.newSkins=function(t,e){t.containsKey(e)||t.setValue(e,[""])},e.prototype.getSkinConf=function(t){return"lzd_handjoy"==window.gameGlobal.channel?Data.skin_config_handjoy.get(t):Data.skin_config.get(t)},e.prototype.updateMySkins=function(e){var i=this;this._allSkinArr=e,e.forEach(function(e){if(e=e.trim(),""!=e){var r=i.getSkinConf(e),n=r.general;i.newSkins(i._mySkins,n),i._mySkins.getValue(n).push(e.toString());var o=t.CardPoolMgr.inst.getCollectCard(n);o.addSkin(e)}})},e.prototype.getAllSkins=function(t){return this.newSkins(this._allSkins,t),this._allSkins.getValue(t)},e.prototype.addMySkin=function(e){var i=this.getSkinConf(e),r=i.general;this.newSkins(this._mySkins,r),this._mySkins.getValue(r).push(e);var n=t.CardPoolMgr.inst.getCollectCard(r);n.addSkin(e)},e.prototype.getMySkins=function(t){return this.newSkins(this._mySkins,t),this._mySkins.getValue(t)},e.prototype.hasSkin=function(t,e){this.newSkins(this._mySkins,t);var i=!1;return this._mySkins.getValue(t).forEach(function(t){t==e&&(i=!0)}),i},Object.defineProperty(e.prototype,"mySkinIds",{get:function(){return this._allSkinArr},enumerable:!0,configurable:!0}),e}();t.CardSkinMgr=e,__reflect(e.prototype,"CardPool.CardSkinMgr")}(CardPool||(CardPool={}));var CardPool;!function(t){function e(e,i){var r=pb.CardDatas.decode(i);t.CardPoolMgr.inst.updateCollectCards(r.Cards),Diy.DiyMgr.inst.updateDiyCards(r.DiyCards)}function i(e,i){var r=pb.AddCardSkinArg.decode(i);t.CardSkinMgr.inst.addMySkin(r.Skin)}function r(t,e){var i=pb.TargetEquip.decode(e);Equip.EquipMgr.inst.addEquip(i.EquipID)}function n(){Net.registerRpcHandler(pb.MessageID.S2C_SYNC_CARD_INFO,e),Net.registerRpcHandler(pb.MessageID.S2C_ADD_CARD_SKIN,i),Net.registerRpcHandler(pb.MessageID.S2C_ADD_EQUIP,r)}t.initRpc=n}(CardPool||(CardPool={}));var Diy;!function(t){var e=function(){function e(t){this._data=t}return Object.defineProperty(e.prototype,"collectCard",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sound",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skillIds",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cardId",{get:function(){return this._data.CardId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gcardId",{get:function(){return this._data.CardId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"camp",{get:function(){return Camp.HEROS},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return CardPool.CardState.Alive},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"amount",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxAmount",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"energy",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxEnergy",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rare",{get:function(){return CardQuality.NORMAL},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){var t=this.getLevel(),e="#cg";return t>=5?e="#cp":t>=3&&(e="#cb"),e+this._data.Name+"#n"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skill1Name",{get:function(){return this._skill1Name||(this._skill1Name=t.DiyMgr.inst.getDiySkillName(this._data.DiySkillId1)),this._skill1Name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skill2Name",{get:function(){return this._skill2Name||(this._skill2Name=t.DiyMgr.inst.getDiySkillName(this._data.DiySkillId2)),this._skill2Name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skill3Name",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skill4Name",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skillDesc",{get:function(){return this._skillDesc||(this._skillDesc=t.DiyMgr.inst.getDiySkillDesc(this._data.DiySkillId1),this._skillDesc+="\n"+t.DiyMgr.inst.getDiySkillDesc(this._data.DiySkillId2)),this._skillDesc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"icon",{get:function(){return this.cardId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skin",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"equip",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"upNum",{get:function(){return this._data.MinUp},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"downNum",{get:function(){return this._data.MinDown},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftNum",{get:function(){return this._data.MinLeft},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightNum",{get:function(){return this._data.MinRight},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"upNumOffset",{get:function(){return this._data.MaxUp-this._data.MinUp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"downNumOffset",{get:function(){return this._data.MaxDown-this._data.MinDown},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftNumOffset",{get:function(){return this._data.MaxLeft-this._data.MinLeft},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightNumOffset",{get:function(){return this._data.MaxRight-this._data.MinRight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weapon",{get:function(){return this._data.Weapon?this._data.Weapon:"gun"},enumerable:!0,configurable:!0}),e.prototype.update=function(t){this._data=t,this._skill1Name=null,this._skill2Name=null,this._skillDesc=null},Object.defineProperty(e.prototype,"level",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isNew",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.getLevel=function(){var t=Data.diy.get(this._data.DiySkillId1),e=0;t||(e=t.level);var i=Data.diy.get(this._data.DiySkillId2),r=0;return i||(r=i.level),e>r?e:r},Object.defineProperty(e.prototype,"isInCampaignMission",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInSeason",{get:function(){return!1},enumerable:!0,configurable:!0}),e}();t.DiyCard=e,__reflect(e.prototype,"Diy.DiyCard",["UI.ICardObj"])}(Diy||(Diy={}));var Diy;!function(t){function e(){r.inst.initData()}function i(){Player.inst.addEventListener(Player.LogoutEvt,e,null);var i=fairygui.UIPackage.createObject(PkgName.diy,ViewName.diy,t.DiyView);Core.ViewManager.inst.register(ViewName.diy,i);var r=fairygui.UIPackage.createObject(PkgName.diy,ViewName.diySkillPanel,t.DiySkillPanel);
Core.ViewManager.inst.register(ViewName.diySkillPanel,r)}var r=function(){function e(){this.initData()}return e.prototype.initData=function(){var t=this;this._allDiySkills=new Collection.MultiDictionary,this._id2DiyCards=new Collection.Dictionary,this._allDiyCards=[],this._maxLevel=0,Data.diy.keys.forEach(function(e){var i=Data.diy.get(e);if(null!=i){var r=i.level;r>t._maxLevel&&(t._maxLevel=r),t._allDiySkills.setValue(r,i)}}),this._allDiyCards.sort(function(t,e){return t.cardId-e.cardId})},Object.defineProperty(e,"inst",{get:function(){return e._inst||(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),e.prototype.onLogin=function(e){var i=this;e&&e.forEach(function(e){var r=new t.DiyCard(e);i._id2DiyCards.setValue(r.cardId,r),i._allDiyCards.push(r)})},e.prototype.getDiyCard=function(t){return this._id2DiyCards.getValue(t)},e.prototype.getAllCards=function(){return this._allDiyCards},e.prototype.isDiyCard=function(t){return t>=1e6},e.prototype.updateDiyCards=function(e){var i=this;e&&e.forEach(function(e){var r=i._id2DiyCards.getValue(e.CardId);if(r)!e.DiySkillId1||e.DiySkillId1<=0?(i._id2DiyCards.remove(e.CardId),Collection.remove(i._allDiyCards,r)):r.update(e);else{var n=new t.DiyCard(e);i._id2DiyCards.setValue(n.cardId,n),i._allDiyCards.push(n)}})},Object.defineProperty(e.prototype,"maxLevel",{get:function(){return this._maxLevel},enumerable:!0,configurable:!0}),e.prototype.getLevelDiySkills=function(t){return this._allDiySkills.getValue(t)},e.prototype.getDiySkillName=function(t){var e=Data.diy.get(t);if(!e)return"";for(var i=0;i<e.skill.length;i++){var r=Data.skill.get(e.skill[i]);if(r&&r.name)return r.name}return""},e.prototype.getDiySkillDesc=function(t){var e=Data.diy.get(t);if(!e)return"";for(var i=0;i<e.skill.length;i++){var r=Data.skill.get(e.skill[i]);if(r&&r.desTra)return r.desTra}return""},e.prototype.doDiy=function(t,e,i,r,n){return __awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(s){switch(s.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_DIY_CARD,pb.DiyCardArg.encode({Name:t,DiySkillId1:e,DiySkillId2:i,Weapon:r,Img:n}))];case 1:return o=s.sent(),0!=o.errcode?[2,null]:[2,pb.DiyCardReply.decode(o.payload)]}})})},e.prototype.doAgainDiy=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_DIY_CARD_AGAIN,pb.TargetCard.encode({CardId:t}))];case 1:return e=i.sent(),0!=e.errcode?[2,null]:[2,pb.DiyCardReply.decode(e.payload)]}})})},e}();t.DiyMgr=r,__reflect(r.prototype,"Diy.DiyMgr"),t.init=i}(Diy||(Diy={}));var Equip;!function(t){function e(t){var e=t.data,i=e.equip;if(i&&""!=i){var r=n.inst.getEquipData(i);r&&(r.ownerCardID=0)}}function i(){var i=Core.ViewManager.inst.registerView.bind(Core.ViewManager.inst),r=fairygui.UIPackage.createObject;i(ViewName.equipBag,function(){var e=new t.EquipBagWnd;return e.contentPane=r(PkgName.equip,ViewName.equipBag).asCom,e}),i(ViewName.equipItemWnd,function(){var e=new t.EquipItemWnd;return e.contentPane=r(PkgName.equip,ViewName.equipItemWnd).asCom,e}),i(ViewName.equipPanel,function(){var e=new t.EquipSwitchWnd;return e.contentPane=r(PkgName.equip,ViewName.equipPanel).asCom,e}),n.inst.initEquip(),Core.EventCenter.inst.addEventListener(GameEvent.CardDelEv,e,null)}var r=function(){function t(t){this._equipID=t,this._ownerCardID=0,this._hasEquip=!1,this.setEquip(t)}return t.prototype.setEquip=function(t){var e=this;this._equipData=Data.item.get(t),this._skillArray=this._equipData.skill,this._skillDescArray=new Array,this._skillNameArray=new Array,this._skillArray.forEach(function(t){var i=Data.skill.get(t);i.name&&e._skillNameArray.push(i.name),i.desTra&&e._skillDescArray.push(i.desTra)})},Object.defineProperty(t.prototype,"equipID",{get:function(){return this._equipID},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ownerCardID",{get:function(){return this._ownerCardID},set:function(t){this._ownerCardID=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"equipName",{get:function(){return this._equipData.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"equipIcon",{get:function(){return"equip_"+this._equipData.icon+"_png"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"equipIconSmall",{get:function(){return"equip_"+this._equipData.iconSmall+"_png"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skillName",{get:function(){return this._skillNameArray},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skillDescs",{get:function(){return this._skillDescArray},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skillDesc",{get:function(){var t="";return this._skillDescArray.forEach(function(e){t+=e}),t},enumerable:!0,configurable:!0}),t.prototype.getSkillDesc=function(){var t=parse2html(this.skillDesc).toString();return t&&""!=t?t:""},Object.defineProperty(t.prototype,"hasEquip",{get:function(){return this._hasEquip},set:function(t){this._hasEquip=!0},enumerable:!0,configurable:!0}),t}();t.EquipData=r,__reflect(r.prototype,"Equip.EquipData");var n=function(){function t(){}return Object.defineProperty(t,"inst",{get:function(){return t._inst||(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype.initEquip=function(){var t=this;this._equipList=new Collection.Dictionary;var e=Data.item.keys;e.forEach(function(e){var i=e.toString(),n=new r(i.toString());t._equipList.setValue(i,n)},this)},t.prototype.openEquipSwitchWnd=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,this.fetchEquip()];case 1:return e=i.sent(),e&&Core.ViewManager.inst.open(ViewName.equipPanel,t.equip,t.cardId),[2]}})})},t.prototype.openEquipBagWnd=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.fetchEquip()];case 1:return t=e.sent(),t&&Core.ViewManager.inst.open(ViewName.equipBag),[2]}})})},t.prototype.fetchEquip=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i=this;return __generator(this,function(r){switch(r.label){case 0:return this._myequipList?[2,!0]:[4,Net.rpcCall(pb.MessageID.C2S_FETCH_EQUIP,null)];case 1:return t=r.sent(),0==t.errcode?(e=pb.EquipData.decode(t.payload),this._myequipList=new Collection.Dictionary,this._myequipIds=new Array,e.Equips.forEach(function(t){var e=i._equipList.getValue(t.EquipID);i._myequipIds.push(t.EquipID),e.hasEquip=!0,e.ownerCardID=t.OwnerCardID,i._myequipList.setValue(t.EquipID,e)}),[2,!0]):[2,!1]}})})},t.prototype.addEquip=function(t){if(this._equipList.containsKey(t)){var e=this._equipList.getValue(t);e.hasEquip=!0,this._myequipIds.push(t),this._myequipList.setValue(t,e)}},t.prototype.hasEquip=function(t){return this._myequipList.containsKey(t)},t.prototype.getEquipData=function(t){return this._equipList.containsKey(t)?this._equipList.getValue(t):null},Object.defineProperty(t.prototype,"allEquip",{get:function(){return this._equipList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"myEquip",{get:function(){return this._myequipList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"myEquipIds",{get:function(){var t=this;return this._myequipIds.sort(function(e,i){var r=t._myequipList.getValue(e),n=t._myequipList.getValue(i);return 0==r.ownerCardID?0!=n.ownerCardID?-1:e>i?1:-1:0!=n.ownerCardID?e>i?1:-1:1}),this._myequipIds},enumerable:!0,configurable:!0}),t}();t.EquipMgr=n,__reflect(n.prototype,"Equip.EquipMgr"),t.init=i}(Equip||(Equip={}));var Guide;!function(t){function e(t){for(var e=[],l=0,c=t;l<c.length;l++){var d=c[l],p=d[0];switch(p){case i.PASS_LEVEL:e.push(new r(d));break;case i.PASS_CAMPAIGN:e.push(new n(d));break;case i.ViewShow:e.push(new s(d));break;case i.CardUnhealthy:e.push(new o);break;case i.GuideBattlePro:e.push(new a(d));break;case i.GuideCamp:e.push(new u(d));break;case i.GuideFinish:e.push(new h(d))}}return e}var i=function(){function t(){}return t.PASS_LEVEL="1",t.PASS_CAMPAIGN="2",t.ViewShow="3",t.CardUnhealthy="4",t.GuideBattlePro="GuideBattlePro",t.GuideCamp="guideCamp",t.GuideFinish="GuideFinish",t}();__reflect(i.prototype,"ConditionType");var r=function(){function t(t){this._levelId=parseInt(t[1])}return t.prototype.check=function(){var t=Level.LevelMgr.inst.getLevel(this._levelId);return t&&t.state==Level.LevelState.Clear?!0:!1},t}();__reflect(r.prototype,"PassLevelCondition",["ICondition"]);var n=function(){function t(t){this._type=parseInt(t[1]),this._level=parseInt(t[2])}return t.prototype.check=function(){return!1},t}();__reflect(n.prototype,"PassCampaignCondition",["ICondition"]);var o=function(){function t(){}return t.prototype.check=function(){return!1},t}();__reflect(o.prototype,"CardUnhealthyCondition",["ICondition"]);var s=function(){function t(t){this._viewName=t[1]}return t.prototype.check=function(){var t=Core.ViewManager.inst.getView(this._viewName);return t&&t.isShow()},t}();__reflect(s.prototype,"ViewShowCondition",["ICondition"]);var a=function(){function t(t){this._pro=parseInt(t[1])}return t.prototype.check=function(){return Player.inst.getResource(ResType.T_GUIDE_PRO)>=this._pro},t}();__reflect(a.prototype,"GuideBattleProCondition",["ICondition"]);var u=function(){function t(t){this._camp=parseInt(t[1])}return t.prototype.check=function(){return Player.inst.guideCamp==this._camp},t}();__reflect(u.prototype,"GuideCampCondition",["ICondition"]);var h=function(){function e(t){this._guideID=parseInt(t[1])}return e.prototype.check=function(){return t.GuideMgr.inst.isGuideFinish(this._guideID)},e}();__reflect(h.prototype,"GuideFinishCondition",["ICondition"]);var l=function(){function i(i,r,n,o){this._guideId=i,this._viewName=r,this._conditions=e(o),this._isBattle=!1,this._isBanGuide=!1;for(var s=0,a=n;s<a.length;s++){var u=a[s];if(u[0]==t.GuideTriggerType.LevelFight||u[0]==t.GuideTriggerType.GuideBattle){this._isBattle=!0;break}if(u[0]==t.GuideTriggerType.RefreshCampaignFort){this._isBanGuide=!0;break}}}return i.prototype.onBegin=function(){TD.onGuideBegin(this.getGuideId())},i.prototype.onFinish=function(){TD.onGuideFinish(this.getGuideId())},i.prototype.getNext=function(){return this._next},i.prototype.setNext=function(t){this.isBattleType&&(t.isBattleType=!0),this._next?this._next.setNext(t):this._next=t},i.prototype.getGuideId=function(){return this._guideId},i.prototype.getGroupId=function(){var e=Data.guide.get(this.getGuideId());return t.calcGuideGroup(e.group)},i.prototype.addOnFinishListener=function(t,e){this._finishCallback=t,this._thisArg=e},i.prototype.finish=function(){if(this._finishCallback){var t=this._finishCallback;this._finishCallback=null,t.apply(this._thisArg)}},i.prototype.getViewName=function(){return this._viewName},i.prototype.getView=function(){var t=Core.ViewManager.inst.getView(this._viewName);return t&&t.isShow()?this._isBanGuide&&Core.LayerManager.inst.getTopView()!==t?null:t:null},i.prototype.canTrigger=function(){if(this._isBattle&&!Battle.BattleMgr.inst.battle)return!1;if(!this.getView())return!1;if(!this._conditions||this._conditions.length<=0)return!0;for(var t=0,e=this._conditions;t<e.length;t++){var i=e[t];if(!i.check())return!1}return!0},i.prototype.canPlayCard=function(t,e){return!1},i.prototype.onPlayCard=function(t,e){},Object.defineProperty(i.prototype,"isBattleType",{get:function(){return this._isBattle},set:function(t){this._isBattle=t},enumerable:!0,configurable:!0}),i}();__reflect(l.prototype,"BaseGuide");var c=function(t){function e(e){var i=t.call(this,e.__id__,e.view,e.triggerOpp,e.condition)||this;return i._talkTargetName=e.whoTalk,i._texts=e.text,e.textPoint&&3==e.textPoint.length&&(i._x=e.textPoint[0],i._y=e.textPoint[1],i._width=e.textPoint[2]),i}return __extends(e,t),e.prototype.begin=function(t){var e=this.getView();if(!e)return!1;var i;return this._talkTargetName&&""!=this._talkTargetName&&(i=e.getNode(this._talkTargetName),!i)?!1:!this._texts||this._texts.length<=0?!1:(this.onBegin(),this.showTalk(t,i,0),!0)},e.prototype.showTalk=function(t,e,i){var r=this;t.setTalkData(e,this._texts[i],this._x,this._y,this._width),t.once(egret.TouchEvent.TOUCH_TAP,function(){i>=r._texts.length-1?r.finish():(i++,r.showTalk(t,e,i))},this)},e}(l);t.TalkGuide=c,__reflect(c.prototype,"Guide.TalkGuide",["Guide.IGuide"]);var d=function(t){function e(e){var i=t.call(this,e.__id__,e.view,e.triggerOpp,e.condition)||this;return i._cardIdx=e.dragCard[0],i._gridIdx=e.dragCard[1],i._talkTargetName=e.whoTalk,i._texts=e.text,e.textPoint&&3==e.textPoint.length&&(i._x=e.textPoint[0],i._y=e.textPoint[1],i._width=e.textPoint[2]),i}return __extends(e,t),e.prototype.begin=function(t){var e=Battle.BattleMgr.inst.battle;if(!e)return!1;var i=e.getCardByIdx(this._cardIdx),r=e.getGridById(this._gridIdx);if(!i||!r||r.inGridCard||!i.view||!r.view)return!1;this.onBegin();var n,o=Core.ViewManager.inst.getView(ViewName.battle);this._talkTargetName&&""!=this._talkTargetName&&(n=o.getNode(this._talkTargetName));var s;return this._texts&&this._texts.length>0&&(s=this._texts[0]),this._card=i,t.setDragCardData(i.view,r.view,n,s,this._x,this._y,this._width),Core.EventCenter.inst.dispatchEventWith(GameEvent.BeginDragGuideEv,!1,i.view),!0},e.prototype.canPlayCard=function(t,e){return t==this._card&&e==this._gridIdx?!0:!1},e.prototype.onPlayCard=function(t,e){t==this._card&&e==this._gridIdx&&this.finish()},e}(l);t.DragCardGuide=d,__reflect(d.prototype,"Guide.DragCardGuide",["Guide.IGuide"]);var p=function(t){function e(e){var i=t.call(this,e.__id__,e.view,e.triggerOpp,e.condition)||this;return i._nodeName=e.click,e.text&&""!=e.text&&(i._texts=e.text),e.textPoint&&3==e.textPoint.length&&(i._x=e.textPoint[0],i._y=e.textPoint[1],i._width=e.textPoint[2]),i}return __extends(e,t),e.prototype.begin=function(t){var e=this.getView();if(!e)return!1;if(this._clickNode=e.getNode(this._nodeName),!this._clickNode)return!1;this.onBegin();var i=this,r=0,n=function(){var e="";i._texts&&r<=i._texts.length-1&&(e=i._texts[r]),t.setClickData(i._clickNode,e,i._x,i._y,i._width),t.addTargetClickListener(function(){!i._texts||r>=i._texts.length-1?(i._clickNode.dispatchEventWith(egret.TouchEvent.TOUCH_BEGIN),fairygui.GRoot.inst.nativeStage.dispatchEventWith(egret.TouchEvent.TOUCH_END),i._clickNode.dispatchEventWith(egret.TouchEvent.TOUCH_TAP),i.finish()):n()},i)};return n(),!0},e}(l);t.ClickGuide=p,__reflect(p.prototype,"Guide.ClickGuide",["Guide.IGuide"]);var _=function(t){function e(e){var i=t.call(this,e)||this;return i._timeout=e.timeout,i}return __extends(e,t),e.prototype.showTalk=function(t,e,i){var r=this;t.setTalkData(e,this._texts[i],this._x,this._y,this._width),fairygui.GTimers.inst.add(this._timeout,1,function(){r.finish()},this)},e}(c);t.TimeoutGuide=_,__reflect(_.prototype,"Guide.TimeoutGuide")}(Guide||(Guide={}));var Guide;!function(t){function e(t){var e=10*Math.floor(t/10);return 0==e&&(e=h),e}function i(t){return t>0&&t!=h}function r(){c.inst.removeEvent(),n()}function n(){return __awaiter(this,void 0,void 0,function(){var t,i,r,n,o,s;return __generator(this,function(a){switch(a.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_FETCH_CUR_GUIDE_GROUP,null)];case 1:return t=a.sent(),0==t.errcode&&(c.inst.curGuideGroupId=pb.GuideGroup.decode(t.payload).GroupID),i=egret.localStorage.getItem("guide"),i&&""!=i&&(r=JSON.parse(i),n=""+Player.inst.uid,r[n]&&(r[n]==h||c.inst.curGuideGroupId<r[n])&&(c.inst.curGuideGroupId=r[n])),egret.log("curGuideGroup: "+c.inst.curGuideGroupId),[4,Net.rpcCall(pb.MessageID.C2S_FETCH_GUIDE,null)];case 2:return s=a.sent(),0==s.errcode?(o=pb.AllFinishGuide.decode(s.payload).GuideIDs,o||(o=[])):o=[],c.inst.listenEvent(),c.inst.init(o),Data.guide.keys.forEach(function(t){var i=Data.guide.get(t);o.indexOf(t)>=0&&c.inst.curGuideGroupId!=e(i.group)||c.inst.addGuide(i)}),[2]}})})}function o(){c.inst.onLogout()}function s(){Player.inst.addEventListener(Player.LoginEvt,n,null),Player.inst.addEventListener(Player.LogoutEvt,o,null)}var a=function(){function t(){}return t.LevelFight="1",t.OpenView="2",t.CloseView="3",t.RefreshCampaignFort="4",t.GuideNextStep="5",t.GuideBattle="6",t.HomeChanged="HomeChanged",t.NewbiePvpBattle="newbiePvp",t}();t.GuideTriggerType=a,__reflect(a.prototype,"Guide.GuideTriggerType");var u=function(){function t(){}return t.BOUT_BEGIN="1",t.BOUT_END="2",t}();__reflect(u.prototype,"BattleTrigger");var h=9999;t.calcGuideGroup=e,t.MaxGuideProgress=5;var l=function(){function t(t){this._firstGuide=null,this._lastGuides=new Collection.Set,this._groupId=t}return Object.defineProperty(t.prototype,"firstGuide",{get:function(){return this._firstGuide},set:function(t){this._firstGuide=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastGuides",{get:function(){return this._lastGuides},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextGroupId",{get:function(){return this._nextGroupId},enumerable:!0,configurable:!0}),t.prototype.addGuide=function(t){this._firstGuide||(this._firstGuide=t);var e=t.getGuideId(),i=Data.guide.get(e),r=i.group,n=t.getGroupId();Math.floor(r/10)==Math.floor(n/10)&&r-n==1&&this._lastGuides.add(t.getGuideId()),this._nextGroupId=i.groupDep},t}();__reflect(l.prototype,"GuideGroup");var c=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return __extends(n,r),Object.defineProperty(n,"inst",{get:function(){return n._inst||(n._inst=new n),n._inst},enumerable:!0,configurable:!0}),n.prototype.init=function(t){var i=this;this._finishGuideIds=new Collection.Set,this._allGuides=new Collection.MultiDictionary,this._isInGuide=!1,t.forEach(function(t){var r=Data.guide.get(t);r&&n.inst.curGuideGroupId!=e(r.group)&&i._finishGuideIds.add(t)}),this._guideGroups=new Collection.Dictionary},Object.defineProperty(n.prototype,"isInGuide",{get:function(){return this._isInGuide},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"curGuideGroupId",{get:function(){return this._curGuideGroupId},set:function(t){this._curGuideGroupId=t},enumerable:!0,configurable:!0}),n.prototype.onLogout=function(){this.removeEvent(),this._view&&(this._view.hide(),this._view=null),this._curGuideItem=null,this._isInGuide=!1,this._curGuideGroupId=0},n.prototype._saveCurrentGroupId=function(){Net.rpcPush(pb.MessageID.C2S_RECORD_CUR_GUIDE_GROUP,pb.GuideGroup.encode({GroupID:this._curGuideGroupId}));var t=""+Player.inst.uid,e={};e[t]=this._curGuideGroupId,egret.localStorage.setItem("guide",JSON.stringify(e)),console.debug("forward current group id to "+this._curGuideGroupId)},n.prototype._finishGuide=function(t){if(t.getViewName()==ViewName.cardDetail&&Core.ViewManager.inst.close(ViewName.cardDetail),!t.isBattleType&&!this._finishGuideIds.contains(t.getGuideId())){this._finishGuideIds.add(t.getGuideId()),Net.rpcPush(pb.MessageID.C2S_FINISH_GUIDE,pb.FinishGuide.encode({GuideID:t.getGuideId()})),t.onFinish();var e=t.getGroupId(),r=t.getGuideId();if(i(e))if(console.debug("current guide group id: "+e),this._curGuideGroupId!=e)console.error("skip guide which is expected to be ignored "+r);else{var n=this._guideGroups.getValue(this._curGuideGroupId);n?(console.debug("group "+this._curGuideGroupId+" last guides: ",JSON.stringify(n.lastGuides)),n.lastGuides.contains(r)?(this._curGuideGroupId=n.nextGroupId,this._saveCurrentGroupId()):console.debug("not last finish in group "+this._curGuideGroupId+", guideId = "+r)):console.error("no group obj found "+this._curGuideGroupId)}}},n.prototype._runGuide=function(e){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(o){switch(o.label){case 0:if(r=e.getGroupId(),i(r)){if(0==this._curGuideGroupId&&(this._curGuideGroupId=r,Net.rpcPush(pb.MessageID.C2S_RECORD_CUR_GUIDE_GROUP,pb.GuideGroup.encode({GroupID:this._curGuideGroupId})),console.debug("record current group id "+this._curGuideGroupId)),r!=this._curGuideGroupId)return console.error("running guide with groupId "+r+", but cur: "+this._curGuideGroupId),[2,!0];console.debug("running guide with group id "+r+", guideId "+e.getGuideId())}this._view||(this._view=new t.GuideView),o.label=1;case 1:return e?[4,fairygui.GTimers.inst.waitTime(100)]:[3,4];case 2:return o.sent(),e.begin(this._view)?(this._curGuideItem=e,this._isInGuide=!0,e instanceof t.TimeoutGuide&&this._finishGuide(e),[4,new Promise(function(t){try{n._view.show(),e.addOnFinishListener(function(){n._view&&(n._view.hide(),n._curGuideItem=null,n._finishGuide(e),t())},n)}catch(i){console.error("exec guide error: ",i)}})]):(e=e.getNext(),[3,1]);case 3:return o.sent(),this._view?(e=e.getNext(),[3,1]):[2,!1];case 4:return[2,!0]}})})},n.prototype._tryTriggerGuide=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,o,s;return __generator(this,function(a){switch(a.label){case 0:if(a.trys.push([0,5,,6]),!this._allGuides)return[2];if(e=this._allGuides.getValue(t),!e||e.length<=0)return[2];i=0,r=e,a.label=1;case 1:return i<r.length?(o=r[i],this._allGuides?this._finishGuideIds.contains(o.getGuideId())?[3,3]:o.canTrigger()?[4,this._runGuide(o)]:[3,3]:[2]):[3,4];case 2:if(!a.sent())return[3,4];a.label=3;case 3:return i++,[3,1];case 4:return[3,6];case 5:return s=a.sent(),console.error(s),[3,6];case 6:return this._isInGuide&&(this._isInGuide=!1,this.dispatchEventWith(n.GUIDE_COMPLETE_EV)),[2]}})})},n.prototype.isGuideFinish=function(t){return this._finishGuideIds.contains(t)},n.prototype._genTriggerKey=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];switch(t){case a.LevelFight:case a.GuideBattle:case a.NewbiePvpBattle:return t+"_"+i[0]+"_"+i[1]+"_"+i[2];case a.OpenView:return t+"_"+e;case a.CloseView:case a.HomeChanged:return t+"_"+i[0];default:return t}},n.prototype.listenEvent=function(){Core.EventCenter.inst.addEventListener(Core.Event.OpenViewEvt,this._onOpenView,this),Core.EventCenter.inst.addEventListener(Core.Event.CloseViewEvt,this._onCloseView,this),Core.EventCenter.inst.addEventListener(GameEvent.CampaignSwitchTypeEv,this._onCampaignSwitchType,this),Core.EventCenter.inst.addEventListener(GameEvent.BattlePlayCardEv,this.onPlayCard,this),Core.EventCenter.inst.addEventListener(GameEvent.OpenHomeEv,this._onHomeChanged,this)},n.prototype.removeEvent=function(){Core.EventCenter.inst.removeEventListener(Core.Event.OpenViewEvt,this._onOpenView,this),Core.EventCenter.inst.removeEventListener(Core.Event.CloseViewEvt,this._onCloseView,this),Core.EventCenter.inst.removeEventListener(GameEvent.CampaignSwitchTypeEv,this._onCampaignSwitchType,this),Core.EventCenter.inst.removeEventListener(GameEvent.BattlePlayCardEv,this.onPlayCard,this),Core.EventCenter.inst.removeEventListener(GameEvent.OpenHomeEv,this._onHomeChanged,this)},n.prototype._onHomeChanged=function(t){var e=this._genTriggerKey(a.HomeChanged,"",t.data);this._tryTriggerGuide(e)},n.prototype._onOpenView=function(t){var e=this._genTriggerKey(a.OpenView,t.data);this._tryTriggerGuide(e)},n.prototype._onCloseView=function(t){var e=this._genTriggerKey(a.CloseView,"",t.data);this._tryTriggerGuide(e)},n.prototype._onCampaignSwitchType=function(t){var e=this._genTriggerKey(a.RefreshCampaignFort,"");this._tryTriggerGuide(e)},n.prototype.onLevelBattleBoutBegin=function(t,e){var i=this._genTriggerKey(a.LevelFight,"",t.toString(),e.toString(),u.BOUT_BEGIN);this._tryTriggerGuide(i)},n.prototype.onLevelBattleBoutEnd=function(t,e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return i=this._genTriggerKey(a.LevelFight,"",t.toString(),e.toString(),u.BOUT_END),[4,this._tryTriggerGuide(i)];case 1:return r.sent(),[2]}})})},n.prototype.onGuideBattleBoutBegin=function(t,e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return i=this._genTriggerKey(a.GuideBattle,"",t.toString(),e.toString(),u.BOUT_BEGIN),[4,this._tryTriggerGuide(i)];case 1:return r.sent(),[2]}})})},n.prototype.onGuideBattleBoutEnd=function(t,e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return i=this._genTriggerKey(a.GuideBattle,"",t.toString(),e.toString(),u.BOUT_END),[4,this._tryTriggerGuide(i)];case 1:return r.sent(),[2]}})})},n.prototype.onNewbiePvpBattleBoutBegin=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return e=this._genTriggerKey(a.NewbiePvpBattle,"","1",t.toString(),u.BOUT_BEGIN),[4,this._tryTriggerGuide(e)];case 1:return i.sent(),[2]}})})},n.prototype.onNewbiePvpBattleBoutEnd=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return e=this._genTriggerKey(a.NewbiePvpBattle,"","1",t.toString(),u.BOUT_END),[4,this._tryTriggerGuide(e)];case 1:return i.sent(),[2]}})})},n.prototype.addGuide=function(e){var i;if(e.timeout>0?i=new t.TimeoutGuide(e):e.click?i=new t.ClickGuide(e):e.dragCard.length>=2?i=new t.DragCardGuide(e):0==e.dragCard.length&&(i=new t.TalkGuide(e)),i){for(var r=0,n=e.triggerOpp;r<n.length;r++){var o=n[r];if(o[0]==a.GuideNextStep)this._addGuideNextStep(i,o);else{var s=this._genTriggerKey.apply(this,[o[0],e.view].concat(o.slice(1)));this._allGuides.setValue(s,i)}}var u=i.getGroupId();this._guideGroups.containsKey(u)||this._guideGroups.setValue(u,new l(u));var h=this._guideGroups.getValue(u);h.addGuide(i)}},n.prototype._addGuideNextStep=function(t,e){if(e){var i=parseInt(e[1]),r=Data.guide.get(i);if(r){var n=r.triggerOpp[0],o=this._genTriggerKey.apply(this,[n[0][0],r.view].concat(n.slice(1))),s=this._allGuides.getValue(o);if(s&&!(s.length<=0)){for(var a,u=0,h=s;u<h.length;u++){var l=h[u];if(l.getGuideId()==i){a=l;break}}a&&a.setNext(t)}}}},n.prototype.onPlayCard=function(t){if(this._curGuideItem){var e=t.data.card,i=t.data.gridIdx;this._curGuideItem.onPlayCard(e,i)}},n.prototype.canPlayCard=function(t,e){return this._curGuideItem?this._curGuideItem.canPlayCard(t,e):!0},n.prototype.waitGuideComplete=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return this._isInGuide?[4,new Promise(function(e){try{t.once(n.GUIDE_COMPLETE_EV,function(){e()},t)}catch(i){console.error("waitGuideComplete error",i)}})]:[2];case 1:return e.sent(),[2]}})})},n.prototype.showGuideText=function(e,i){var r=this;return this._view||(this._view=new t.GuideView),this._view.setTalkData(e,i,0,0,0,!1),this._view.show(),new Promise(function(t){r._view.once(egret.TouchEvent.TOUCH_TAP,function(){r._view.hide(),t()},r)})},n.prototype.beginGuideBattle=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_START_TUTORIAL_BATTLE,pb.StartTutorialBattleArg.encode({CampID:t}))];case 1:return e=r.sent(),0!=e.errcode?[2,!1]:(Player.inst.guideCamp=t,Pvp.PvpMgr.inst.fightCamp=t,i=pb.FightDesk.decode(e.payload),Battle.BattleMgr.inst.beginBattle(i,Battle.BattleType.Guide),Pvp.PvpMgr.inst.onEnterPvp(),Core.DeviceUtils.isWXGame()&&WXGame.WXGameMgr.inst.onCreateRole(),[2,!0])}})})},n.prototype.enterGuideHome=function(e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return i=Core.ViewManager.inst.getView(ViewName.guideHome),i||(i=fairygui.UIPackage.createObject(PkgName.guide,ViewName.guideHome,t.GuideHome),Core.ViewManager.inst.register(ViewName.guideHome,i)),[4,Core.ViewManager.inst.openView(i,e)];case 1:return r.sent(),[2]}})})},n.prototype.checkInterruptedGuide=function(){if(!Battle.BattleMgr.inst.battle&&i(this._curGuideGroupId)){var t=this._guideGroups.getValue(this._curGuideGroupId);t.firstGuide&&(this._runGuide(t.firstGuide),this._isInGuide&&(this._isInGuide=!1,this.dispatchEventWith(n.GUIDE_COMPLETE_EV)))}},n.prototype.hideGuide=function(){this._curGuideItem&&(this._curGuideItem=null,this._isInGuide=!1,this._view&&this._view.hide())},n.GUIDE_COMPLETE_EV="guideCompleteEv",n}(egret.EventDispatcher);t.GuideMgr=c,__reflect(c.prototype,"Guide.GuideMgr"),t.clearGuide=r,t.onLogin=n,t.init=s}(Guide||(Guide={}));var Home;!function(t){var e=function(){function t(){}return t.SHOP_GIFT="shopGift",t.ADVERT="advert",t.FEAT="honor",t.EQUIP="equip",t.RANK_SEASON="rankSeason",t.SURVEY="survey",t.WORLD_WAR="worldWar",t.CARD_UP_JADE="cardUpJade",t.EMOJI_TO_CHAT="emojiToChat",t.VIDEO_TO_CHAT="videoToChat",t.VIP_CARD="vipCard",t.SKIN="skin",t.LEVEL_VIDEO="levelVideo",t.SKILL_INSTR="skillInstruction",t.RANDOM_NAME="randomName",t.IAP="iap",t}();t.GameFuncType=e,__reflect(e.prototype,"Home.GameFuncType");var i=function(){function t(){}return Object.defineProperty(t,"inst",{get:function(){return t._inst||(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype.isFuncOpen=function(t){var e=window.gameGlobal.channel,i=Data.function_config.get(e);return null==i?!1:1==i[t]},t.prototype.isShopGiftOpen=function(){return this.isFuncOpen(e.SHOP_GIFT)},t.prototype.isAdvertOpen=function(){return this.isFuncOpen(e.ADVERT)},t.prototype.isFeatOpen=function(){return this.isFuncOpen(e.FEAT)},t.prototype.isEquipOpen=function(){return this.isFuncOpen(e.EQUIP)},t.prototype.isRankSeasonOpen=function(){return this.isFuncOpen(e.RANK_SEASON)},t.prototype.isSurveyOpen=function(){return this.isFuncOpen(e.SURVEY)},t.prototype.isWorldWarOpen=function(){return this.isFuncOpen(e.WORLD_WAR)},t.prototype.isCardUpJadeOpen=function(){return this.isFuncOpen(e.CARD_UP_JADE)},t.prototype.isEmojiToChatOpen=function(){return this.isFuncOpen(e.EMOJI_TO_CHAT)},t.prototype.isVideoToChatOpen=function(){return this.isFuncOpen(e.VIDEO_TO_CHAT)},t.prototype.isVipCardOpen=function(){return this.isFuncOpen(e.VIP_CARD)},t.prototype.isSkinOpen=function(){return this.isFuncOpen(e.SKIN)},t.prototype.isLevelVideoOpen=function(){return this.isFuncOpen(e.LEVEL_VIDEO)},t.prototype.isSkillInstructionOpen=function(){return this.isFuncOpen(e.SKILL_INSTR)},t.prototype.isRandomNameOpen=function(){return this.isFuncOpen(e.RANDOM_NAME)},t.prototype.isInAppPurchaseOpen=function(){return this.isFuncOpen(e.IAP)},t}();t.FunctionMgr=i,__reflect(i.prototype,"Home.FunctionMgr")}(Home||(Home={}));var Home;!function(t){function e(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return GameAccount.inst.archiveID>0&&Player.inst.uid&&(Core.ViewManager.inst.closeAll(),Player.inst.logout(),u.inst.login()),[2]})})}function i(){u.inst.playFightBgSound();var t=Core.ViewManager.inst.getView(ViewName.newHome);t&&(t.visible=!1)}function r(){u.inst.playMainBgSound();var t=Core.ViewManager.inst.getView(ViewName.newHome);t&&(t.visible=!0)}function n(){return"lzd_handjoy"==window.gameGlobal.channel?Core.StringUtils.TEXT(90003):Core.DeviceUtils.isWXGame()?Core.StringUtils.TEXT(90001):Core.StringUtils.TEXT(90002)}function o(){return"lzd_handjoy"==window.gameGlobal.channel?!0:!1}function s(){t.initRpc(),Core.EventCenter.inst.addEventListener(Core.Event.ReLoginEv,e,null),Core.EventCenter.inst.addEventListener(GameEvent.BattleBeginEv,i,null),Core.EventCenter.inst.addEventListener(GameEvent.BattleEndEv,r,null);var n=Core.ViewManager.inst.registerView.bind(Core.ViewManager.inst),o=fairygui.UIPackage.createObject;if(n(ViewName.login,function(){return o(PkgName.login,ViewName.login,t.LoginView)}),n(ViewName.cmdWnd,function(){return o(PkgName.home,ViewName.cmdWnd,t.CmdWnd)}),n(ViewName.switchLanWnd,function(){return o(PkgName.home,ViewName.switchLanWnd,t.LanguageSwitchWnd)}),n(ViewName.archive,function(){return o(PkgName.login,ViewName.archive,t.ArchiveView)}),n(ViewName.newHome,function(){return o(PkgName.home,ViewName.newHome,t.NewHomeView)}),n(ViewName.loginRegister,function(){return o(PkgName.login,ViewName.loginRegister,t.LoginRegisterWnd)}),n(ViewName.loginAcount,function(){return o(PkgName.login,ViewName.loginAcount,t.LoginAcountWnd)}),n(ViewName.modifyName,function(){return o(PkgName.home,ViewName.modifyName,t.ModifyNameWnd)
}),n(ViewName.survey,function(){return o(PkgName.home,ViewName.survey,t.SurveyView)}),n(ViewName.connectView,function(){return o(PkgName.login,ViewName.connectView,t.ConnectHintView)}),n(ViewName.descTipsWnd,function(){return o(PkgName.common,ViewName.descTipsWnd,t.DescTipsWnd)}),window.gameGlobal.isMultiLan){var s=fairygui.UIPackage.createObject(PkgName.login,ViewName.facebookLogin,t.LoginFacebook);Core.ViewManager.inst.register(ViewName.facebookLogin,s)}n(ViewName.noticeView,function(){return o(PkgName.login,ViewName.noticeView,t.LoginNoticeView)})}var a=!0,u=function(){function e(){this.playBgSound(),this._lastLoginReply=null,this._newbieChooseCamp=null}return Object.defineProperty(e,"inst",{get:function(){return e._inst||(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),e.prototype.playBgSound=function(){Battle.BattleMgr.inst.battle?this.playFightBgSound():this.playMainBgSound()},e.prototype.stopBgSound=function(t){void 0===t&&(t=!0),SoundMgr.inst.stopBgMusic(t)},e.prototype.playMainBgSound=function(){SoundMgr.inst.playBgMusic("bg_mp3")},e.prototype.playFightBgSound=function(){SoundMgr.inst.playBgMusic("fightbg_mp3")},e.prototype.checkVersion=function(t){if(window.gameGlobal.version&&t){var e=window.gameGlobal.version.split(".");if(3==e.length){var i=parseInt(e[0]),r=parseInt(e[1]),n=parseInt(e[2]);t.V1>i?Core.TipsUtils.alert(Core.StringUtils.TEXT(60222),function(){Core.DeviceUtils.isWXGame()?WXGame.WXGameMgr.inst.exitGame():window.location.reload()},this):t.V1==i&&(t.V2>r||t.V2==r&&t.V3>n)&&Core.TipsUtils.confirm(Core.StringUtils.TEXT(60222),function(){Core.DeviceUtils.isWXGame()?WXGame.WXGameMgr.inst.exitGame():window.location.reload()},null,this),Core.DeviceUtils.isiOS()&&Core.DeviceUtils.isMobile()&&Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.APPSTORE_CHECK_VERSION)}}},e.prototype.onPlayerLogin=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return e=pb.AccountTypeEnum.UnknowAccountType,e=Core.DeviceUtils.isWXGame()?"android"==WXGame.WXGameMgr.inst.platform?pb.AccountTypeEnum.Wxgame:pb.AccountTypeEnum.WxgameIos:Core.DeviceUtils.isAndroid()?pb.AccountTypeEnum.Android:Core.DeviceUtils.isiOS()?pb.AccountTypeEnum.Ios:pb.AccountTypeEnum.Android,[4,Net.rpcCall(pb.MessageID.C2S_LOGIN,pb.LoginArg.encode({Channel:window.gameGlobal.channel,ChannelID:GameAccount.inst.accountName,ArchiveID:t,AccountType:e,IsTourist:GameAccount.inst.isTouristLogin,LoginChannel:GameAccount.inst.loginChannel,Country:LanguageMgr.inst.countryCode}))];case 1:return i=o.sent(),1==i.errcode&&Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60155)),0!=i.errcode?[2,i.errcode]:(r=pb.LoginReply.decode(i.payload),GameAccount.inst.loginPlayer(t),Player.inst.accountType=e,[4,Player.inst.login(r,GameAccount.inst.accountName)]);case 2:return o.sent(),Core.DeviceUtils.isWXGame()?(WXGame.WXGameMgr.inst.isExamineVersion=!r.IsExamined,[4,platform.getUserInfo()]):[3,5];case 3:return n=o.sent(),[4,WXGame.WXGameMgr.inst.onLogin(n)];case 4:o.sent(),o.label=5;case 5:return this._lastLoginReply=r,[2,0]}})})},e.prototype.needNewbieGuideHome=function(){var t=Player.inst.getResource(ResType.T_SCORE);return 0>=t&&0==Player.inst.guideCamp},e.prototype.checkNewbieGuideHome=function(){return __awaiter(this,void 0,void 0,function(){var t,e=this;return __generator(this,function(i){return t=Player.inst.getResource(ResType.T_SCORE),egret.log("checkNewbieGuideHome ",t,Player.inst.guideCamp),0>=t&&0==Player.inst.guideCamp?[2,new Promise(function(t){Core.ViewManager.inst.close(ViewName.login),Core.ViewManager.inst.close(ViewName.loading);Guide.GuideMgr.inst.enterGuideHome(function(i){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){return this._newbieChooseCamp=i,t(!0),[2]})})}),Core.DeviceUtils.isWXGame()&&Promise.all([WXGame.WXGroupLoader.inst.loadZip("preload.zip",null,!0),WXGame.WXGroupLoader.inst.loadZip("common.zip",null,!0),WXGame.WXGroupLoader.inst.loadZip("card.zip",null,!0)])})]:[2,!1]})})},e.prototype.checkNewbieGuideBattle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return null==this._newbieChooseCamp?[3,2]:[4,Guide.GuideMgr.inst.beginGuideBattle(this._newbieChooseCamp)];case 1:t.sent(),this._newbieChooseCamp=null,t.label=2;case 2:return[2]}})})},e.prototype.onLoginDone=function(e){return void 0===e&&(e=!0),__awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return e=this._lastLoginReply,this._newbieChooseCamp&&Core.DeviceUtils.isWXGame()||(i=Core.ViewManager.inst.open(ViewName.newHome)),[4,t.HomeMgr.inst.checkNewbieGuideBattle()];case 1:return r.sent(),i?[4,i]:[3,3];case 2:r.sent(),r.label=3;case 3:return[4,Battle.BattleMgr.inst.loadBattle(e.FightID)];case 4:return r.sent(),[4,Quest.QuestMgr.inst.loadQuest()];case 5:return r.sent(),Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.ON_ENTER_GAME,{userId:""+Player.inst.uid,userName:Player.inst.name,level:1,serverId:1,serverName:"commonServer"}),Core.DeviceUtils.isWXGame()&&WXGame.WXGameMgr.inst.onEnterGame(),!e.IsInCampaignMatch||Battle.BattleMgr.inst.battle?[3,7]:(Core.MaskUtils.showTransMask(),[4,War.WarMgr.inst.openWarHome()]);case 6:r.sent(),Core.MaskUtils.hideTransMask(),r.label=7;case 7:return this.checkVersion(e.Ver),Guide.GuideMgr.inst.checkInterruptedGuide(),this._loginGameCenter(),fairygui.GTimers.inst.callDelay(800,function(){Core.ViewManager.inst.close(ViewName.login),Core.ViewManager.inst.close(ViewName.loading)},this),[2]}})})},e.prototype.onAccountLoginWithPwd=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.onAccountLogin(t,e)];case 1:return[2,i.sent()]}})})},e.prototype.onAccountLogin=function(t,e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return a?(a=!1,[4,Net.rpcCall(pb.MessageID.C2S_ACCOUNT_LOGIN,pb.AccountLoginArg.encode({Channel:window.gameGlobal.channel,ChannelID:t,Password:GameAccount.inst.md5hashPassword(e)}),!0,!1)]):[2,1];case 1:return i=r.sent(),101==i.errcode?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60167)),[2,i.errcode]):0!=i.errcode?(a=!0,Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60133)),[2,i.errcode]):(egret.localStorage.setItem("account",t),GameAccount.inst.login(t,!1,""),[4,this.login()]);case 2:return[2,r.sent()]}})})},e.prototype.onSdkAccountLogin=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o;return __generator(this,function(s){switch(s.label){case 0:return e=t.channel_id,i="",r="",""!=t.login_channel&&(i=t.login_channel),""!=t.token&&(r=t.token),n={Channel:window.gameGlobal.channel,ChannelID:e,Account:"",Password:"",SdkToken:r,IsTourist:!1,LoginChannel:i},[4,Net.rpcCall(pb.MessageID.C2S_SDK_ACCOUNT_LOGIN,pb.AccountLoginArg.encode(n),!0,!1)];case 1:return o=s.sent(),0!=o.errcode?[2,o.errcode]:(GameAccount.inst.login(e,!1,i),[4,this.onPlayerLogin(1)]);case 2:return[2,s.sent()]}})})},e.prototype.onRegister=function(t,e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_REGISTER_ACCOUNT,pb.RegisterAccount.encode({Channel:window.gameGlobal.channel,Account:t,Password:GameAccount.inst.md5hashPassword(e)}),!0,!1)];case 1:return i=r.sent(),0!=i.errcode?[2,i.errcode]:(egret.localStorage.setItem("account",t),GameAccount.inst.setPassword(t,e),GameAccount.inst.login(t,!1,""),[4,this.login()]);case 2:return r.sent(),[2,i.errcode]}})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.onPlayerLogin(1)];case 1:return t=e.sent(),Core.ViewManager.inst.close(ViewName.loginRegister),[4,this.checkNewbieGuideHome()];case 2:return e.sent(),[4,this.onLoginDone()];case 3:return e.sent(),[2,t]}})})},e.prototype.delPlayerArchive=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_DEL_ARCHIVES,pb.DelArchiveArg.encode({Channel:window.gameGlobal.channel,ChannelID:GameAccount.inst.accountName,ArchiveID:t}))];case 1:return e=i.sent(),[2,0==e.errcode]}})})},e.prototype.onPlayerLogout=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_PLAYER_LOGOUT,null)];case 1:return t=e.sent(),0!=t.errcode?[2]:(Core.ViewManager.inst.closeAll(),Player.inst.logout(),Core.ViewManager.inst.open(ViewName.archive,pb.AccountArchives.decode(t.payload)),[2])}})})},e.prototype.doGmCommand=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return"clearguide"==t?(Guide.clearGuide(),Core.TipsUtils.showTipsFromCenter("i think it is ok"),[2,!0]):"cn"==t?(LanguageMgr.inst.cur="cn",Core.TipsUtils.showTipsFromCenter("switch CN"),window.location.reload(),[2]):"tw"==t?(LanguageMgr.inst.cur="tw",Core.TipsUtils.showTipsFromCenter("switch TW"),window.location.reload(),[2]):"en"==t?(LanguageMgr.inst.cur="en",Core.TipsUtils.showTipsFromCenter("switch EN"),window.location.reload(),[2]):"logtxt "==t.substr(0,7)&&(e=/^[1-9]+[0-9]*]*$/,i=t.substr(7),e.test(i))?(r=parseInt(i),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(r)),[2]):[4,Net.rpcCall(pb.MessageID.C2S_GM_COMMAND,pb.GmCommand.encode({Command:t}))];case 1:return n=o.sent(),0!=n.errcode?[2,!1]:(Core.TipsUtils.showTipsFromCenter("i think it is ok"),[2,!0])}})})},e.prototype._beginPing=function(){fairygui.GTimers.inst.add(4e4,-1,function(){Net.SConn.inst.ping()},this)},e.prototype._loginGameCenter=function(){!Core.DeviceUtils.isWXGame()&&Core.DeviceUtils.isiOS()&&Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.LOGIN_GAME_CENTER)},e.prototype._touristLogin=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){switch(n.label){case 0:return i={Channel:window.gameGlobal.channel,Account:t,Password:e,IsTourist:!0},[4,Net.rpcCall(pb.MessageID.C2S_SDK_ACCOUNT_LOGIN,pb.AccountLoginArg.encode(i))];case 1:return r=n.sent(),0!=r.errcode?[3,3]:(GameAccount.inst.login(t,!0,""),[4,this.onPlayerLogin(1)]);case 2:return[2,n.sent()];case 3:return Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60097)+("[code="+r.errcode+"]")),[2,r.errcode]}})})},e.prototype._bindTouristAndLogin=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a;return __generator(this,function(u){switch(u.label){case 0:return[4,platform.login()];case 1:return u.sent(),[4,platform.getUserInfo()];case 2:return i=u.sent(),i?[3,3]:[2,-100];case 3:return r=i.channel_id,n="",o="",""!=i.login_channel&&(n=i.login_channel),""!=i.token&&(o=i.token),s={Channel:window.gameGlobal.channel,TouristAccount:t,TouristPassword:e,BindAccount:{Channel:window.gameGlobal.channel,ChannelID:r,Account:"",Password:"",SdkToken:o,IsTourist:!1,LoginChannel:n}},[4,Net.rpcCall(pb.MessageID.C2S_TOURIST_BIND_ACCOUNT,pb.TouristBindAccountArg.encode(s))];case 4:return a=u.sent(),0==a.errcode?[3,5]:(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60250)+("[code="+a.errcode+"]")),[2,a.errcode]);case 5:return egret.localStorage.setItem("tbind","true"),GameAccount.inst.login(r,!1,n),[4,this.onPlayerLogin(1)];case 6:return[2,u.sent()]}})})},e.prototype.onTouristLogin=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n,o,s,a=this;return __generator(this,function(u){switch(u.label){case 0:return t=egret.localStorage.getItem("taccount"),e=egret.localStorage.getItem("tpassword"),i=egret.localStorage.getItem("tbind"),t&&""!=t&&e&&""!=e?i&&""!=i?[3,6]:[4,new Promise(function(t){Core.TipsUtils.confirm(Core.StringUtils.TEXT(60249),function(){t(!0)},function(){t(!1)},a,Core.StringUtils.TEXT(60024),Core.StringUtils.TEXT(60020))})]:[3,9];case 1:return r=u.sent(),r?[4,this._bindTouristAndLogin(t,e)]:[3,3];case 2:return[2,u.sent()];case 3:return[4,this._touristLogin(t,e)];case 4:return[2,u.sent()];case 5:return[3,8];case 6:return[4,this._touristLogin(t,e)];case 7:return[2,u.sent()];case 8:return[3,13];case 9:return n={Channel:window.gameGlobal.channel},[4,Net.rpcCall(pb.MessageID.C2S_TOURIST_REGISTER_ACCOUNT,pb.TouristRegisterAccountArg.encode(n))];case 10:return o=u.sent(),0!=o.errcode?[3,12]:(s=pb.TouristRegisterAccountRelpy.decode(o.payload),egret.localStorage.setItem("taccount",s.Account),egret.localStorage.setItem("tpassword",s.Password),[4,this.onTouristLogin()]);case 11:return[2,u.sent()];case 12:return Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60097)+("[code="+o.errcode+"]")),[2,o.errcode];case 13:return[2]}})})},e.prototype.enterLogin=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o=this;return __generator(this,function(s){switch(s.label){case 0:return Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.ON_SHOW_LOADING),this._beginPing(),egret.log("isMultiLan: ",window.gameGlobal.isMultiLan),[4,t.LoginNoticeView.tryOpenNoticePanel()];case 1:return s.sent(),window.gameGlobal.isMultiLan?(e&&(e.visible=!1),[4,new Promise(function(t){Core.ViewManager.inst.open(ViewName.facebookLogin,function(){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(e){return t(),[2]})})})})]):[3,3];case 2:return s.sent(),e&&(e.visible=!0),Core.ViewManager.inst.close(ViewName.facebookLogin),[2];case 3:return[4,Core.ViewManager.inst.open(ViewName.login)];case 4:s.sent(),s.label=5;case 5:return Core.DeviceUtils.isWXGame()?(WXGame.WXGameMgr.inst.showConnectView(!1),[3,8]):[3,6];case 6:return[4,Core.ViewManager.inst.open(ViewName.login)];case 7:s.sent(),s.label=8;case 8:return window.gameGlobal.isSDKLogin?(r=this,n=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i=this;return __generator(this,function(o){switch(o.label){case 0:return console.log("tdChannel getchannelUserInfo"),Core.DeviceUtils.isWXGame()?[3,2]:[4,platform.login()];case 1:o.sent(),o.label=2;case 2:return[4,platform.getUserInfo()];case 3:return(t=o.sent())?(window.gameGlobal.tdChannel=t.td_channel_id,t.account_login?(e=Core.ViewManager.inst.getView(ViewName.login),e.showAccountLoginComs(!0),[3,6]):[3,4]):[3,7];case 4:return Core.DeviceUtils.isWXGame()&&LoadingView.inst.setText(Core.StringUtils.TEXT(70121)),[4,r.onSdkAccountLogin(t)];case 5:o.sent(),Core.DeviceUtils.isWXGame()&&LoadingView.inst.setText(Core.StringUtils.TEXT(70125)),o.label=6;case 6:return[3,8];case 7:Core.TipsUtils.alert(Core.StringUtils.TEXT(60097),function(){return __awaiter(i,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,n()];case 1:return t.sent(),[2]}})})},r,Core.StringUtils.TEXT(60038)),o.label=8;case 8:return[2]}})})},[4,n()]):(i=Core.ViewManager.inst.getView(ViewName.login),i.showAccountLoginComs(!0),[2]);case 9:return s.sent(),[2]}})})},e.prototype.modifyName=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_MODIFY_NAME,pb.ModifyNameArg.encode({Name:t}),!0,!1)];case 1:return e=i.sent(),0==e.errcode?(Core.EventCenter.inst.dispatchEventWith(GameEvent.ModifyNameEv,!1,t),[2,0]):[2,e.errcode]}})})},e.prototype.updateName=function(t,e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_UPDATE_NAME,pb.UpdateNameArg.encode({Name:t}),!0,!1)];case 1:return i=r.sent(),0==i.errcode?(e&&""!=e&&(t=e+t+"#n"),Core.EventCenter.inst.dispatchEventWith(GameEvent.ModifyNameEv,!1,t),[2,0]):[2,i.errcode]}})})},e.prototype.exchangeGiftCode=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_EXCHANGE_GIFT_CODE,pb.ExchangeCodeArg.encode({Code:t}),!0,!1)];case 1:return e=n.sent(),0==e.errcode&&(i=pb.ExchangeCodeReward.decode(e.payload),r=new Treasure.TreasureReward,r.gold=i.Reward.GoldAmount,i.Reward.CardIDs.forEach(function(t){r.addCardId(t)}),Core.ViewManager.inst.open(ViewName.treasureRewardInfo,r,new Treasure.TreasureItem(-1,i.TreasureID))),[2,e.errcode]}})})},e}();t.HomeMgr=u,__reflect(u.prototype,"Home.HomeMgr"),t.getGameName=n,t.hasBowlderRes=o,t.init=s}(Home||(Home={}));var Home;!function(t){function e(t,e){Player.inst.updateResource(pb.ResourceModify.decode(e).Res,!0)}function i(t,e){Net.SConn.inst.close(),Core.TipsUtils.alert(Core.StringUtils.TEXT(60193),function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,Net.SConn.inst.connectServer()];case 1:return t.sent(),Core.EventCenter.inst.dispatchEventWith(Core.Event.ReLoginEv),[2]}})})},this,Core.StringUtils.TEXT(60038))}function r(e,i){var r=pb.Version.decode(i),n=function(){Core.EventCenter.inst.removeEventListener(GameEvent.BattleEndEv,n,this),Core.EventCenter.inst.removeEventListener(GameEvent.MatchStopEv,n,this),t.HomeMgr.inst.checkVersion(r)};Battle.BattleMgr.inst.battle?Core.EventCenter.inst.once(GameEvent.BattleEndEv,n,this):Pvp.PvpMgr.inst.isMatching?(Core.EventCenter.inst.once(GameEvent.MatchStopEv,n,this),Core.EventCenter.inst.once(GameEvent.BattleEndEv,n,this)):n()}function n(t,e){Core.EventCenter.inst.dispatchEventWith(GameEvent.ShareIOSOK,!1,!1),Player.inst.isIOSShared=!1}function o(t,e){var i,r=pb.TellMe.decode(e);i=r.Text>0?Core.StringUtils.TEXT(r.Text):r.Msg,Core.TipsUtils.showTipsFromCenter(i)}function s(t,e){var i=pb.VipRemainTime.decode(e);Player.inst.vipTime=i.RemainTime}function a(t,e){Player.inst.vipTime=0}function u(t,e){var i=pb.MinVipRemainTime.decode(e);Player.inst.miniVipTime=i.RemainTime}function h(t,e){Player.inst.miniVipTime=0}function l(t,e){var i=pb.VipRemainTime.decode(e);Player.inst.hasGetVipExperience=!0,Player.inst.vipTime=i.RemainTime}function c(t,e){Core.TipsUtils.confirm(Core.StringUtils.TEXT(70368),function(){Core.ViewManager.inst.open(ViewName.shopView)})}function d(){Net.registerRpcHandler(pb.MessageID.S2C_SYNC_RESOURCE,e),Net.registerRpcHandler(pb.MessageID.S2C_KICK_OUT,i),Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_VERSION,r),Net.registerRpcHandler(pb.MessageID.S2C_ON_CROSS_DAY,n),Net.registerRpcHandler(pb.MessageID.S2C_TELL_ME,o),Net.registerRpcHandler(pb.MessageID.S2C_ADD_VIP,s),Net.registerRpcHandler(pb.MessageID.S2C_VIP_TIMEOUT,a),Net.registerRpcHandler(pb.MessageID.S2C_ADD_MIN_VIP,u),Net.registerRpcHandler(pb.MessageID.S2C_MIN_VIP_TIMEOUT,h),Net.registerRpcHandler(pb.MessageID.S2C_ADD_NEWBIE_VIP,l),Net.registerRpcHandler(pb.MessageID.S2C_NEWBIE_VIP_TIMEOUT,c)}t.initRpc=d}(Home||(Home={}));var Level;!function(t){var e;!function(t){t[t.Lock=1]="Lock",t[t.UnLock=2]="UnLock"}(e=t.ChapterState||(t.ChapterState={}));var i=function(){function i(t){this._id=t[0],this._name=Core.StringUtils.TEXT(t[1]),this._levelObjs=[],2==this._id?this.state=e.Lock:this.state=e.UnLock}return Object.defineProperty(i.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"levelObjs",{get:function(){return this._levelObjs},enumerable:!0,configurable:!0}),i.prototype.addLevel=function(t){this._levelObjs.push(t)},i.prototype.isClear=function(){for(var e=0,i=this._levelObjs;e<i.length;e++){var r=i[e];if(r.state!=t.LevelState.Clear)return!1}return!0},i}();t.Chapter=i,__reflect(i.prototype,"Level.Chapter")}(Level||(Level={}));var Level;!function(t){var e;!function(t){t[t.Lock=1]="Lock",t[t.UnLock=2]="UnLock",t[t.Clear=3]="Clear"}(e=t.LevelState||(t.LevelState={}));var i=function(){function t(t,i){this._data=t,this._state=e.Lock,this._chapter=i,this._help=!1}return Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(t){this._state=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._data.__id__},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._data.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"help",{get:function(){return this._help},set:function(t){this._help=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"chapter",{get:function(){return this._chapter},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unlockPvpLevel",{get:function(){return this._data.rankCondition},enumerable:!0,configurable:!0}),t}();t.Level=i,__reflect(i.prototype,"Level.Level")}(Level||(Level={}));var Level;!function(t){function e(){s.inst.initData()}function i(){s.inst.loadLevelHintData()}function r(e,i){var r=pb.ChapterUnlock.decode(i),n=s.inst.getChapter(r.Chapter);if(n&&n.state==t.ChapterState.Lock){n.state=t.ChapterState.UnLock;var o=Battle.BattleMgr.inst.battle,a=Core.StringUtils.format(Core.StringUtils.TEXT(60248),Core.StringUtils.getZhNumber(r.Chapter));o?o.addDelayTips(a):Core.TipsUtils.alert(a)}}function n(t,e){var i=pb.LevelBeHelpArg.decode(e),r=s.inst.getLevel(i.LevelID);r&&Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(60198),i.HelperName,r.name)),s.inst.refreshLevelView()}function o(){Player.inst.addEventListener(Player.LoginEvt,i,null),Player.inst.addEventListener(Player.LogoutEvt,e,null),Net.registerRpcHandler(pb.MessageID.S2C_CHAPTER_UNLOCK,r),Net.registerRpcHandler(pb.MessageID.S2C_LEVEL_BE_HELP,n);var o=Core.ViewManager.inst.registerView.bind(Core.ViewManager.inst),s=fairygui.UIPackage.createObject;o(ViewName.level,function(){return s(PkgName.level,ViewName.level,t.LevelView)}),o(ViewName.levelTreasureInfo,function(){var e=new t.ChapterTreasureInfoWnd;return e.contentPane=s(PkgName.level,ViewName.levelTreasureInfo).asCom,e}),o(ViewName.levelHelpWnd,function(){var e=new t.LevelHelpWnd;return e.contentPane=s(PkgName.level,ViewName.levelHelpWnd).asCom,e}),o(ViewName.levelVideo,function(){return s(PkgName.level,ViewName.levelVideo,t.LevelVideoView)})}var s=function(){function e(){this._STORE_KEY="levelHints",this.initData()}return e.prototype.initData=function(){var e=this;this._levelDict=new Collection.Dictionary,this._chapterDict=new Collection.Dictionary,this._chapters=[],this._cardUnlockLevels=new Collection.Dictionary,this._chapterUnlockCard=new Collection.Dictionary,this._chapterTreasureOpened=new Collection.Dictionary,Data.level.keys.forEach(function(i){var r=Data.level.get(i),n=e._chapterDict.getValue(r.chapter[0]);n||(n=new t.Chapter(r.chapter),e._chapterDict.setValue(r.chapter[0],n),e._chapters.push(n),e._chapterTreasureOpened.setValue(n.id,!1));var o=new t.Level(r,n.id);n.addLevel(o),e._levelDict.setValue(i,o);var s=r.generalUnlock;s>0&&(e._cardUnlockLevels.setValue(s,i),e._chapterUnlockCard.setValue(n.id,s))}),this._chapters.sort(function(t,e){return t.id-e.id})},e.prototype.loadLevelHintData=function(){var t=egret.localStorage.getItem(this._STORE_KEY);t&&""!=t||(t="{}"),this._chapterTreasureCanOpenHintData=JSON.parse(t);var e=""+Player.inst.uid;this._chapterTreasureCanOpenHintData[e]||(this._chapterTreasureCanOpenHintData[e]=0,this._saveLevelHintData())},e.prototype._saveLevelHintData=function(){var t=JSON.stringify(this._chapterTreasureCanOpenHintData);egret.localStorage.setItem(this._STORE_KEY,t)},e.prototype.getTotalLevelHintNum=function(){var t=""+Player.inst.uid;return this._chapterTreasureCanOpenHintData[t]},e.prototype.addLevelHintNum=function(){var t=""+Player.inst.uid,e=this._chapterTreasureCanOpenHintData[t]+1;this._chapterTreasureCanOpenHintData[t]=e,this._saveLevelHintData(),Core.EventCenter.inst.dispatchEventWith(Core.Event.LevelHintNumChangeEv,!1)},e.prototype.subLevelHintNum=function(){var t=""+Player.inst.uid,e=Math.max(0,this._chapterTreasureCanOpenHintData[t]-1);this._chapterTreasureCanOpenHintData[t]=e,this._saveLevelHintData(),Core.EventCenter.inst.dispatchEventWith(Core.Event.LevelHintNumChangeEv,!1)},Object.defineProperty(e,"inst",{get:function(){return e._inst||(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),e.prototype.getLevel=function(t){return this._levelDict.getValue(t)},e.prototype.getChapter=function(t){return this._chapterDict.getValue(t)},e.prototype.getChapterNum=function(){return this._chapters.length},Object.defineProperty(e.prototype,"curLevel",{get:function(){return this._curLevel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"curLevelName",{get:function(){return this.getLevel(this._curLevel).name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"curVideoLevel",{get:function(){return this._curVideoLevelId},set:function(t){this._curVideoLevelId=t},enumerable:!0,configurable:!0}),e.prototype.getCardIdUnlockLevelId=function(t){var e=this._cardUnlockLevels.getValue(t);return e?e:0},e.prototype.getChapterUnlockCardId=function(t){return this._chapterUnlockCard.getValue(t)},e.prototype.isClear=function(){return this._chapters[this._chapters.length-1].isClear()},e.prototype.fetchLevelData=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a,u,h=this;return __generator(this,function(l){switch(l.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_FETCH_LEVEL_INFO,null,e,e)];case 1:if(i=l.sent(),0!=i.errcode)return[2,!1];for(r=pb.LevelInfo.decode(i.payload),r.OpenedTreasureChapters.forEach(function(t){h._chapterTreasureOpened.setValue(t,!0)}),n=r.CurLevel,o=1;n>o;o++)s=this.getLevel(o),s&&(s.state=t.LevelState.Clear);return a=this._curLevel,this._curLevel=n,a&&n>a&&Core.EventCenter.inst.dispatchEventWith(GameEvent.ClearLevelEv,!1,a),this._levelDict.forEach(function(t,e){e.help=!1}),r.AskHelpLevels.forEach(function(t){var e=h.getLevel(t);e&&(e.help=!0)}),(u=this.getLevel(n))?(u.state=t.LevelState.UnLock,[2,!0]):[2,!0]}})})},e.prototype.isChapterTreasureOpen=function(t){return this._chapterTreasureOpened.getValue(t)},e.prototype.onChapterTreasureOpen=function(t){this._chapterTreasureOpened.setValue(t,!0)},e.prototype.onEnterLevel=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.fetchLevelData(!0)];case 1:return(t=e.sent())?(Core.ViewManager.inst.open(ViewName.level,this._chapters),[2]):[2]}})})},e.prototype.refreshLevelView=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=Core.ViewManager.inst.getView(ViewName.level),t?[4,this.onEnterLevel()]:[3,2];case 1:e.sent(),t.refresh(),e.label=2;case 2:return[2]}})})},e.prototype.beginLevelBattle=function(e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return e.state==t.LevelState.Lock?[2]:[4,Net.rpcCall(pb.MessageID.C2S_BEGIN_LEVEL_BATTLE,pb.BeginLevelBattle.encode({LevelId:e.id}))];case 1:return i=r.sent(),0!=i.errcode?[2]:(Battle.BattleMgr.inst.beginBattle(pb.LevelBattle.decode(i.payload),Battle.BattleType.LEVEL,e.id),Core.ViewManager.inst.close(ViewName.level),[2])}})})},e}();t.LevelMgr=s,__reflect(s.prototype,"Level.LevelMgr"),t.init=o}(Level||(Level={}));var Payment;!function(t){function e(){i.inst.initMgr(),t.initRpc()}var i=function(){function e(){this._curPayingPid=null,Core.DeviceUtils.isWXGame()?this._payment=new t.WXPayment:Core.DeviceUtils.isAndroid()?window.gameGlobal.isMultiLan?(egret.log("GooglePayment"),this._payment=new t.GooglePayment):(egret.log("AndroidPayment"),this._payment=new t.AndroidPayment):Core.DeviceUtils.isiOS()?window.gameGlobal.isSDKPay?(egret.log("iOSPaymentWithSDK"),this._payment=new t.iOSPaymentWithSDK):(egret.log("AppstorePayment"),Core.NativeMsgCenter.inst.addListener(Core.NativeMessage.FINISH_PAY,this._appStoreFinishPay,this),this._payment=new t.AppstorePayment):this._payment=new t.DefaultPayment,this._products=new Collection.Dictionary,this._initialized=!1}return Object.defineProperty(e,"inst",{get:function(){return e._inst||(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),e.prototype.initMgr=function(){return __awaiter(this,void 0,void 0,function(){var t,e=this;return __generator(this,function(i){switch(i.label){case 0:return this._payment.init(),[4,this._payment.getProducts()];case 1:return t=i.sent(),t.forEach(function(t){e._products.setValue(t.id,t)}),this._initialized=!0,[2]}})})},e.prototype.needSendBuyRpc=function(){return this._payment.needSendBuyRpc()},e.prototype._appStoreFinishPay=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o;return __generator(this,function(s){switch(s.label){case 0:return null!=this._curPayingPid?[2]:t.success?(e=t.productId,i=t.receipt,r=e.indexOf("."),n={GoodsID:e.substr(r+1,e.length-r-1),Receipt:i},[4,Net.rpcCall(pb.MessageID.C2S_BUY_JADE,pb.BuyJadeArg.encode(n))]):[2];case 1:return o=s.sent(),0==o.errcode?Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60073)):Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60116)),[2]}})})},e.prototype.getProducts=function(){return this._initialized?this._products:null},e.prototype.payProduct=function(e,i){return void 0===i&&(i=1),__awaiter(this,void 0,void 0,function(){var r,n,o;return __generator(this,function(s){switch(s.label){case 0:return(r=this._products.getValue(e))?[3,1]:(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60132)),[2,new t.PayResult(!1,"")]);case 1:return this._curPayingPid=e,n=this._payment.shouldShowNetMask(),n&&Core.MaskUtils.showNetMask(),[4,this._payment.payProduct(r,i)];case 2:return o=s.sent(),n&&Core.MaskUtils.hideNetMask(),this._curPayingPid=null,[2,o]}})})},e._inst=null,e}();t.PayMgr=i,__reflect(i.prototype,"Payment.PayMgr"),t.init=e}(Payment||(Payment={}));var Payment;!function(t){var e=function(){function t(){}return t.prototype.needSendBuyRpc=function(){return!1},t.prototype.getGiftProductConf=function(t){return"lzd_handjoy"==window.gameGlobal.channel?t?Data.ios_limit_gift_lzd_handjoy:Data.android_limit_gift_handjoy:t?Data.ios_limit_gift:Data.android_limit_gift},t.prototype.init=function(){},t}();t.PaymentBase=e,__reflect(e.prototype,"Payment.PaymentBase");var i=function(){function t(t,e,i){this.success=t,this.result=e,this.param=i}return t}();t.PayResult=i,__reflect(i.prototype,"Payment.PayResult");var r=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype._getAllProductIds=function(){var t=[];return Data.ios_recharge.keys.forEach(function(e){t.push(""+e)}),this.getGiftProductConf(!0).keys.forEach(function(e){t.push(""+e)}),t},r.prototype.init=function(){Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.INIT_APPSTORE_PAY)},r.prototype.shouldShowNetMask=function(){return!0},r.prototype.needSendBuyRpc=function(){return!0},r.prototype.getProducts=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o,s;return __generator(this,function(a){switch(a.label){case 0:return e=this._getAllProductIds(),i=[],e.forEach(function(t){i.push(window.gameGlobal.channel+"."+t)}),[4,Core.NativeMsgCenter.inst.sendAndWaitNativeMessage(Core.NativeMessage.APPSTORE_REQ_PRODUCTS,Core.NativeMessage.APPSTORE_GET_PRODUCTS,{productIds:i})];case 1:return r=a.sent(),n=this.getGiftProductConf(!0),r.success?(o=[],s=r.info,s.forEach(function(e){var i=e[0];if(i){var r=i.split(".")[1],s=Data.ios_recharge.get(r);if(s||t.GiftProduct.isNotMoneyPay()||(s=n.get(r)),s){var a=t.Product.newProduct(r,s);a.localizedPrice=e[2],o.push(a)}}}),t.GiftProduct.isNotMoneyPay()&&n.keys.forEach(function(e){var i=n.get(e);if(i){var r=t.Product.newProduct(""+e,i);r.localizedPrice="¥"+r.price,o.push(r)}}),[2,o]):[2,null]}})})},r.prototype.payProduct=function(t,e){return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a;
return __generator(this,function(u){switch(u.label){case 0:return r=window.gameGlobal.channel+"."+t.id,n={GoodsID:r},Net.rpcPush(pb.MessageID.C2S_IOS_PRE_PAY,pb.IosPrePayArg.encode(n)),[4,platform.pay(r,t.price,e,!1)];case 1:return o=u.sent(),o?o.success?(s=o.productId,a=o.receipt,[2,new i(!0,a)]):(Core.TipsUtils.showTipsFromCenter(o.reason),[2,new i(!1,"")]):(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60119)),[2,new i(!1,"")])}})})},r}(e);t.AppstorePayment=r,__reflect(r.prototype,"Payment.AppstorePayment",["Payment.IPayment"]);var n=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.getProducts=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){return e=[],Data.ios_recharge.keys.forEach(function(i){var r=Data.ios_recharge.get(i);if(r){var n=t.Product.newProduct(""+i,r);n.localizedPrice="¥"+n.price,e.push(n)}}),i=this.getGiftProductConf(!0),i.keys.forEach(function(r){var n=i.get(r);if(n){var o=t.Product.newProduct(""+r,n);o.localizedPrice="¥"+o.price,e.push(o)}}),[2,e]})})},r.prototype.payProduct=function(t,e){return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a,u=this;return __generator(this,function(h){switch(h.label){case 0:return r=window.gameGlobal.channel+"."+t.id,n={GoodsID:t.id},[4,Net.rpcCall(pb.MessageID.C2S_SDK_CREATE_ORDER,pb.SdkCreateOrderArg.encode(n),!1)];case 1:return o=h.sent(),0!=o.errcode?[2,new i(!1,Core.StringUtils.TEXT(60117))]:(s=pb.SdkCreateOrderReply.decode(o.payload).OrderID,egret.log("payProduct orderId: ",s),[4,platform.pay(r,t.price,e,!0,t.desc,s)]);case 2:return a=h.sent(),a?a.success?[2,new Promise(function(t){u._payResolve=t,Core.EventCenter.inst.addEventListener(GameEvent.SDKRechargeSuccessEv,u._onRechargeSuccess,u)})]:[2,new i(!1,a.reason)]:[2,new i(!1,Core.StringUtils.TEXT(60119))]}})})},r.prototype._onRechargeSuccess=function(t){if(Core.EventCenter.inst.removeEventListener(GameEvent.SDKRechargeSuccessEv,this._onRechargeSuccess,this),this._payResolve){var e=t.data;e.Errcode==pb.SdkRechargeResult.RechargeErr.Success?this._payResolve(new i(!0,"",e)):this._payResolve(new i(!1,Core.StringUtils.TEXT(60116))),this._payResolve=null}},r.prototype.shouldShowNetMask=function(){return!0},r}(e);t.iOSPaymentWithSDK=n,__reflect(n.prototype,"Payment.iOSPaymentWithSDK",["Payment.IPayment"]);var o=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.getProducts=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){return e=[],Data.android_recharge.keys.forEach(function(i){var r=Data.android_recharge.get(i);if(r){var n=t.Product.newProduct(""+i,r);n.localizedPrice="¥"+n.price,e.push(n)}}),i=this.getGiftProductConf(!1),i.keys.forEach(function(r){var n=i.get(r);if(n){var o=t.Product.newProduct(""+r,n);o.localizedPrice="¥"+o.price,e.push(o)}}),[2,e]})})},r.prototype.payProduct=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60119)),[2,new i(!1,"")]})})},r.prototype.shouldShowNetMask=function(){return!0},r}(e);t.AndroidPayment=o,__reflect(o.prototype,"Payment.AndroidPayment",["Payment.IPayment"]);var s=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype._getAllProductIds=function(){var t=[];return Data.android_recharge.keys.forEach(function(e){t.push(""+e)}),this.getGiftProductConf(!1).keys.forEach(function(e){t.push(""+e)}),t},r.prototype.getProducts=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o,s=this;return __generator(this,function(a){switch(a.label){case 0:return e=this._getAllProductIds(),[4,Core.NativeMsgCenter.inst.sendAndWaitNativeMessage(Core.NativeMessage.GOOGLEPLAY_REQ_PRODUCTS,Core.NativeMessage.GOOGLEPLAY_GET_PRODUCTS,{productIds:e})];case 1:return i=a.sent(),i.success?(r=[],n=i.info,n.forEach(function(e){var i=e[0];if(i){var n=Data.android_recharge.get(i);if(n||t.GiftProduct.isNotMoneyPay()||(n=s.getGiftProductConf(!1).get(i)),n){var o=t.Product.newProduct(i,n);o.localizedPrice=e[1],o.currency=e[2],o.localizedPriceAmount=parseInt(e[3]),r.push(o)}}}),t.GiftProduct.isNotMoneyPay()&&(o=this.getGiftProductConf(!1),o.keys.forEach(function(e){var i=o.get(e);if(i){var n=t.Product.newProduct(""+e,i);r.push(n)}})),[2,r]):[2,null]}})})},r.prototype.payProduct=function(t,e){return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a,u,h,l,c,d,p,_,g;return __generator(this,function(f){switch(f.label){case 0:return r=t.id,n={GoodsID:r},[4,Net.rpcCall(pb.MessageID.C2S_SDK_CREATE_ORDER,pb.SdkCreateOrderArg.encode(n),!1)];case 1:return o=f.sent(),0!=o.errcode?[2,new i(!1,Core.StringUtils.TEXT(60117))]:(s=pb.SdkCreateOrderReply.decode(o.payload).OrderID,[4,platform.pay(r,t.price,e,!0,t.desc,s)]);case 2:return a=f.sent(),a?[3,3]:[2,new i(!1,Core.StringUtils.TEXT(60119))];case 3:return a.success?(u=a.payResult,h=u.googlePayData,l=u.paySign,c=t.localizedPriceAmount,d=t.currency,p={GoodsID:r,InappPurchaseData:JSON.stringify(h),InappDataSignature:l,Money:c,Currency:d},[4,Net.rpcCall(pb.MessageID.C2S_GOOGLE_PLAY_RECHARGE,pb.GooglePlayRechargeArg.encode(p))]):[3,5];case 4:return _=f.sent(),0==_.errcode?(g=pb.SdkRechargeResult.decode(_.payload),[2,new i(!0,"",g)]):[2,new i(!1,Core.StringUtils.TEXT(60116))];case 5:return[2,new i(!1,a.reason)];case 6:return[2]}})})},r}(o);t.GooglePayment=s,__reflect(s.prototype,"Payment.GooglePayment");var a=function(e){function r(){var t=e.call(this)||this;return t._callbackUrl=WXGame.WXGameMgr.inst.wxConfig.recharge_cb,t}return __extends(r,e),r.prototype.getProducts=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=[],Data.wxgame_recharge.keys.forEach(function(i){var r=Data.wxgame_recharge.get(i);if(r){var n=t.Product.newProduct(""+i,r);n.localizedPrice="¥"+n.price,e.push(n)}}),Data.wxgame_limit_gift.keys.forEach(function(i){var r=Data.wxgame_limit_gift.get(i);if(r){var n=t.Product.newProduct(""+i,r);n.localizedPrice="¥"+n.price,e.push(n)}}),[2,e]})})},r.prototype.shouldShowNetMask=function(){return"android"==WXGame.WXGameMgr.inst.platform},r.prototype.payProduct=function(t,e){return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a=this;return __generator(this,function(u){switch(u.label){case 0:return"android"==WXGame.WXGameMgr.inst.platform||WXGame.WXGameMgr.inst.isInHuoshuWhiteList?(r={GoodsID:t.id},[4,Net.rpcCall(pb.MessageID.C2S_SDK_CREATE_ORDER,pb.SdkCreateOrderArg.encode(r),!1)]):[2,new i(!1,Core.StringUtils.TEXT(60119))];case 1:return n=u.sent(),0!=n.errcode?[2,new i(!1,Core.StringUtils.TEXT(60117))]:(o=pb.SdkCreateOrderReply.decode(n.payload).OrderID,console.log("payProduct orderId: ",o),[4,platform.pay(t.id,t.price,e,!0,t.desc,o,this._callbackUrl)]);case 2:return s=u.sent(),s?s.success?[2,new Promise(function(t){a._payResolve=t,Core.EventCenter.inst.addEventListener(GameEvent.SDKRechargeSuccessEv,a._onWXRechargeSuccess,a)})]:[2,new i(!1,s.reason)]:[2,new i(!1,Core.StringUtils.TEXT(60119))]}})})},r.prototype._onWXRechargeSuccess=function(t){if(Core.EventCenter.inst.removeEventListener(GameEvent.SDKRechargeSuccessEv,this._onWXRechargeSuccess,this),this._payResolve){var e=t.data;e.Errcode==pb.SdkRechargeResult.RechargeErr.Success?this._payResolve(new i(!0,"",e)):this._payResolve(new i(!1,Core.StringUtils.TEXT(60116))),this._payResolve=null}},r}(e);t.WXPayment=a,__reflect(a.prototype,"Payment.WXPayment",["Payment.IPayment"]);var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);t.DefaultPayment=u,__reflect(u.prototype,"Payment.DefaultPayment")}(Payment||(Payment={}));var Payment;!function(t){var e=function(){function t(){}return t.T_UNKOWN=0,t.T_JADE=1,t.T_GIFT=2,t.T_GOLD=3,t.T_TREASURE=4,t.T_FREE=5,t}();t.ProductType=e,__reflect(e.prototype,"Payment.ProductType");var i=function(){function t(t,i){this._id=t,this._conf=i,this._type=e.T_UNKOWN,this._price=0,this._localizedPriceAmount=0,this._currency="CNY"}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localizedPrice",{get:function(){return this._localizedPrice},set:function(t){this._localizedPrice=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localizedPriceAmount",{get:function(){return this._localizedPriceAmount},set:function(t){this._localizedPriceAmount=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currency",{get:function(){return this._currency},set:function(t){this._currency=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"price",{get:function(){return this._price<=0?this._conf.price:this._price},set:function(t){this._price=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"desc",{get:function(){return this._conf.desc},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"conf",{get:function(){return this._conf},enumerable:!0,configurable:!0}),t.prototype.hasEnoughResToBuy=function(){return!0},t.prototype.askSubRes=function(t){return void 0===t&&(t=!0),__awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,!0]})})},t.newProduct=function(t,e){return t.indexOf("gift")>=0||t.indexOf("vip")>=0?new u(t,e):new a(t,e)},t}();t.Product=i,__reflect(i.prototype,"Payment.Product");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(i);t.MoneyPayProduct=r,__reflect(r.prototype,"Payment.MoneyPayProduct");var n=function(t){function e(e,i){var r=t.call(this,e,i)||this;return i.jadePrice&&i.jadePrice>0?(r._resType=ResType.T_JADE,r._price=i.jadePrice,r._resIcon=Reward.RewardMgr.inst.getRewardIcon(Reward.RewardType.T_JADE)):(r._resType=ResType.T_BOWLDER,r._price=i.bowlderPrice,r._resIcon=Reward.RewardMgr.inst.getRewardIcon(Reward.RewardType.T_BOWLDER)),r}return __extends(e,t),Object.defineProperty(e.prototype,"resIcon",{get:function(){return this._resIcon},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"price",{get:function(){return this._price},enumerable:!0,configurable:!0}),e.prototype.hasEnoughResToBuy=function(){return this._resType==ResType.T_JADE?Player.inst.hasEnoughJade(this._price):Player.inst.hasEnoughBowlder(this._price,!0)},e.prototype.askSubRes=function(t){return void 0===t&&(t=!0),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this._resType!=ResType.T_JADE?[3,1]:Player.inst.hasEnoughJade(this._price)?[2,!0]:(t&&Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60085)),[2,!1]);case 1:return[4,Player.inst.askSubBowlder(this._price)];case 2:if(e.sent())return[2,!0];t&&Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60278)),e.label=3;case 3:return[2]}})})},e}(i);t.ResPayProduct=n,__reflect(n.prototype,"Payment.ResPayProduct");var o=function(t){function i(i,r){var n=t.call(this,i,r)||this;return n._type=e.T_TREASURE,n}return __extends(i,t),i}(n);t.TreasureProduct=o,__reflect(o.prototype,"Payment.TreasureProduct");var s=function(t){function i(i,r){var n=t.call(this,i,r)||this;return n._type=e.T_GOLD,n}return __extends(i,t),Object.defineProperty(i.prototype,"soldGold",{get:function(){return this._conf.soldGold},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"icon",{get:function(){return this._conf.icon},enumerable:!0,configurable:!0}),i}(n);t.GoldProduct=s,__reflect(s.prototype,"Payment.GoldProduct");var a=function(t){function i(i,r){var n=t.call(this,i,r)||this;return n._type=e.T_JADE,n._jade=0,n}return __extends(i,t),Object.defineProperty(i.prototype,"jade",{get:function(){return this._jade<=0?this._conf.jadeCnt:this._jade},set:function(t){this._jade=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"desc",{get:function(){return this._conf.desc},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"icon",{get:function(){return this._conf.icon},enumerable:!0,configurable:!0}),i}(r);t.JadeProduct=a,__reflect(a.prototype,"Payment.JadeProduct");var u=function(t){function i(i,r){var n=t.call(this,i,r)||this;return n._type=e.T_GIFT,n._name=r.name,n}return __extends(i,t),Object.defineProperty(i.prototype,"bgImage1",{get:function(){return this._conf.bg1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bgImage2",{get:function(){return this._conf.bg2?this._conf.bg2:""},enumerable:!0,configurable:!0}),i.prototype.isVipCard=function(){return"advip"==this._id},i.prototype.isMiniVipCard=function(){return"minivip"==this._id},Object.defineProperty(i.prototype,"icon",{get:function(){return this._conf.icon},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"glod",{get:function(){return this._conf.gold},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"jade",{get:function(){return this._conf.jade},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"skin",{get:function(){return this._conf.skin},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"headFrame",{get:function(){return this._conf.headFrame},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"showTeamLv",{get:function(){return this._conf.showTrue},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"payTeamLv",{get:function(){return this._conf.teamCondition},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hideTeamLv",{get:function(){return this._conf.showFalse},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"continueTime",{get:function(){return this._conf.continueTime},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"general",{get:function(){var t=new Array;return this._conf.general&&(t=this._conf.general),t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"treasureType",{get:function(){return this._conf.reward},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"remainTime",{get:function(){return this._remainTime},set:function(t){this._remainTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"refreshInterval",{get:function(){return this._conf.refreashTime},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"jadePrice",{get:function(){return this._conf.jadePrice},enumerable:!0,configurable:!0}),i.prototype.isVisible=function(){return 1==this._conf.visiable},i.prototype.isNotMoneyPay=function(){return i.isNotMoneyPay()},i.prototype.hasEnoughResToBuy=function(){return this.isNotMoneyPay()?t.prototype.hasEnoughResToBuy.call(this):!0},i.prototype.askSubRes=function(e){return void 0===e&&(e=!0),__awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return this.isNotMoneyPay()?[4,t.prototype.askSubRes.call(this,e)]:[3,2];case 1:return[2,i.sent()];case 2:return[2,!0]}})})},i.isNotMoneyPay=function(){return"lzd_handjoy"==window.gameGlobal.channel?!0:!0},i}(n);t.GiftProduct=u,__reflect(u.prototype,"Payment.GiftProduct")}(Payment||(Payment={}));var Payment;!function(t){function e(t,e){var i=pb.SdkRechargeResult.decode(e);Core.EventCenter.inst.dispatchEventWith(GameEvent.SDKRechargeSuccessEv,!1,i)}function i(){Net.registerRpcHandler(pb.MessageID.S2C_NOTIFY_SDK_RECHARGE_RESULT,e)}t.initRpc=i}(Payment||(Payment={}));var FacebookJsPlatform=function(){function t(){this._userInfo=null,this._readyPromise=null}return Object.defineProperty(t,"inst",{get:function(){return t._inst||(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._init(),[2]})})},t.prototype._init=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return this._readyPromise=new Promise(function(e){window.fbAsyncInit=function(){FB.init({appId:"740714252962921",cookie:!0,xfbml:!0,version:"v3.2"}),FB.AppEvents.logPageView(),t._readyPromise=null,e()},function(t,e,i){var r,n=t.getElementsByTagName(e)[0];t.getElementById(i)||(r=t.createElement(e),r.id=i,r.src="https://connect.facebook.net/en_US/sdk.js",n.parentNode.insertBefore(r,n))}(document,"script","facebook-jssdk")}),[4,this._readyPromise];case 1:return e.sent(),[2]}})})},t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this._userInfo]})})},t.prototype.login=function(t){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return this._readyPromise?[4,this._readyPromise]:[3,2];case 1:e.sent(),e.label=2;case 2:return[4,new Promise(function(e){FB.login(function(i){if("connected"==i.status){var r=i.authResponse;t._userInfo={},t._userInfo.channel_id=r.userID,t._userInfo.account_login=!1,t._userInfo.td_channel_id="lzd_handjoy_fbadvert",t._userInfo.token=r.accessToken,t._userInfo.login_channel="facebook"}e()})})];case 3:return e.sent(),[2]}})})},t.prototype.canMakePay=function(){return!1},t.prototype.pay=function(t,e,i,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(FacebookJsPlatform.prototype,"FacebookJsPlatform",["Platform"]);var FacebookSharePlatform=function(){function t(){}return Object.defineProperty(t,"inst",{get:function(){return t._inst||(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype.getShareType=function(){return ShareType.SHARE_FACEBOOK},t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.enableShareMenu=function(t,e,i,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.shareAppMsg=function(t,e,i){return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){switch(n.label){case 0:return i={title:t,link:e},[4,Core.NativeMsgCenter.inst.sendAndWaitNativeMessage(Core.NativeMessage.SHARE_LINK,Core.NativeMessage.SHARE_LINK_COMPLETE,i)];case 1:return r=n.sent(),[2,r.success]}})})},t.prototype.getShareLink=function(){return Core.DeviceUtils.isAndroid()?"lzd_handjoy"==window.gameGlobal.channel?"https://play.google.com/store/apps/details?id=com.openew.game.lzd.handjoy":"":Core.DeviceUtils.isiOS()?("lzd_handjoy"==window.gameGlobal.channel,""):void 0},t._inst=null,t}();__reflect(FacebookSharePlatform.prototype,"FacebookSharePlatform",["SharePlatform"]);var Fire2333Platform=function(){function t(){this._sdk||(this._game_id=Core.HttpUtils.getQueryVariable("game_id"),this._app_id=Core.HttpUtils.getQueryVariable("app_id"),this._game_key=Core.HttpUtils.getQueryVariable("game_key"),this._timestamp=Core.HttpUtils.getQueryVariable("timestamp"),this._nonce=Core.HttpUtils.getQueryVariable("nonce"),this._ticket=Core.HttpUtils.getQueryVariable("ticket"),this._signature=Core.HttpUtils.getQueryVariable("signature"),this._login_type=Core.HttpUtils.getQueryVariable("login_type"))}return Object.defineProperty(t,"inst",{get:function(){return t._inst||(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._readyPromise?[4,this._readyPromise]:[3,2];case 1:t.sent(),t.label=2;case 2:return this._loginPromise?[4,this._loginPromise]:[3,4];case 3:t.sent(),t.label=4;case 4:return[2,this._userInfo]}})})},t.prototype.login=function(t){return __awaiter(this,void 0,void 0,function(){var t,e,i,r;return __generator(this,function(n){switch(n.label){case 0:t=new Collection.Dictionary,t.setValue("game_id",this._game_id),t.setValue("app_id",this._app_id),t.setValue("game_key",this._game_key),t.setValue("timestamp",this._timestamp),t.setValue("nonce",this._nonce),t.setValue("ticket",this._ticket),t.setValue("signature",this._signature),t.setValue("login_type",this._login_type),this._loginPromise=Core.HttpUtils.post(document.location.protocol+"//game.fire2333.com/user/getticketuserinfo",t),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._loginPromise];case 2:return e=n.sent(),this._loginPromise=null,[3,4];case 3:return i=n.sent(),this._loginPromise=null,console.error("Fire2333Platform login error",i),[2];case 4:return e?(r=JSON.parse(e),0!=r.code?(console.error("Fire2333Platform login error ",r),[2]):(console.debug("Fire2333Platform login ok",e),this._userInfo={},this._userInfo.channel_id=r.data.open_id,[2])):(console.error("Fire2333Platform login error no reply"),[2])}})})},t.prototype.canMakePay=function(){return!1},t.prototype.pay=function(t,e,i,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(Fire2333Platform.prototype,"Fire2333Platform",["Platform"]);var PkgSDKPlatform=function(){function t(){this._userInfo=null,this._init=!1,this._isLogin=!1}return Object.defineProperty(t,"inst",{get:function(){return t._inst||(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this._userInfo]})})},t.prototype.login=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return this._isLogin?[2]:this._userInfo?[2]:(this._isLogin=!0,Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.ON_SHOW_LOADING),[4,Core.NativeMsgCenter.inst.sendAndWaitNativeMessage(Core.NativeMessage.LOGIN,Core.NativeMessage.LOGIN_DONE,t)]);case 1:return e=r.sent(),e.success?(i=e.info,this._userInfo={},this._userInfo.channel_id=i.channelUserID,this._userInfo.account_login=i.accountLogin,this._userInfo.td_channel_id=i.tdChannelID,this._userInfo.token=i.token,this._userInfo.login_channel=i.loginChannel,console.log("tdChannel "+i.tdChannelID),SoundMgr.inst.playSoundAsync("click_mp3",.01)):(e.reason?Core.TipsUtils.showTipsFromCenter(e.reason):Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60096)),this._userInfo=null),this._isLogin=!1,[2]}})})},t.prototype.canMakePay=function(){return!0},t.prototype.pay=function(t,e,i,r,n,o){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(s){switch(s.label){case 0:return[4,Core.NativeMsgCenter.inst.sendAndWaitNativeMessage(Core.NativeMessage.START_PAY,Core.NativeMessage.FINISH_PAY,{productId:t,price:e,count:i,orderId:o,isSDKPay:r})];case 1:return n=s.sent(),[2,n]}})})},t._inst=null,t}();__reflect(PkgSDKPlatform.prototype,"PkgSDKPlatform",["Platform"]);var PkgAdsPlatform=function(){function t(){}return Object.defineProperty(t,"inst",{get:function(){return t._inst||(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.ADS_INIT),[2]})})},t.prototype.isAdsOpen=function(){return!0},t.prototype.isAdsReady=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,Core.NativeMsgCenter.inst.sendAndWaitNativeMessage(Core.NativeMessage.ADS_IS_READY,Core.NativeMessage.ADS_READY)];case 1:return t=e.sent(),t.success?[2,{success:!0,reason:""}]:[2,{success:!1,reason:Core.StringUtils.TEXT(60226)}]}})})},t.prototype.showRewardAds=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return SoundMgr.inst.muteMusic(!0),Net.rpcCall(pb.MessageID.C2S_WATCH_ADS_BEGIN,null),[4,Core.NativeMsgCenter.inst.sendAndWaitNativeMessage(Core.NativeMessage.ADS_SHOW_RWD,Core.NativeMessage.ADS_FINISH_RWD)];case 1:return t=e.sent(),SoundMgr.inst.muteMusic(!1),t.success?(Net.rpcCall(pb.MessageID.C2S_WATCH_ADS_END,null),[2,t.success]):(Core.TipsUtils.showTipsFromCenter(t.reason),[2,!1])}})})},t.prototype.showBannerAds=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,!1]})})},t._inst=null,t}();__reflect(PkgAdsPlatform.prototype,"PkgAdsPlatform",["AdvertisePlatform"]);var Pvp;!function(t){var e=function(){function t(){var t=Data.rank.keys,e=0,i=0,r=0;this._levelInfo=new Collection.Dictionary,this._cardUnlockLevel=new Collection.Dictionary,this._pvpTeamToLevels=new Collection.Dictionary;for(var n=0;n<t.length;n++){var o=t[n],s=Data.rank.get(o),a=s.team,u=s.levelUpStar,h=new Collection.Dictionary;h.setValue("maxStar",u),a!=e?(e=a,i=5):i--,h.setValue("rankLv",i),h.setValue("totalStars",r+1),r+=u,this._levelInfo.setValue(o,h);for(var l=s.unlock,c=0;c<l.length;c++)this._cardUnlockLevel.setValue(l[c],o);this._pvpTeamToLevels.containsKey(a)||this._pvpTeamToLevels.setValue(a,[]);var d=this._pvpTeamToLevels.getValue(a);d.push(o)}}return Object.defineProperty(t,"inst",{get:function(){return t._inst||(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype.getPvpTeam=function(t){var e=Data.rank.get(t);return e.team},t.prototype.getPvpTeamName=function(t){var e=Data.rank.get(t);return e.name},t.prototype.getPvpRankLv=function(t){var e=this._levelInfo.getValue(t);return e?e.getValue("rankLv"):0},t.prototype.getPvpTitle=function(t){var e=Data.rank.get(t);return e.title},t.prototype.isPvpLevelProtected=function(t){var e=Data.rank.get(t);return 1==e.protection},t.prototype.getUnlockCard=function(t){return Data.rank.get(t).unlock},t.prototype.getCardUnlockLevel=function(t){return this._cardUnlockLevel.getValue(t)},t.prototype.getPvpMaxStar=function(t){var e=Data.rank.get(t);return e.levelUpStar},t.prototype.getTotalStar=function(t){var e=this._levelInfo.getValue(t);return e?e.getValue("totalStars"):0},t.prototype.getMaxPvpLevel=function(){return Data.rank.keys[Data.rank.keys.length-1]},t.prototype.getMiniLevelInPvpTeam=function(t){var e=this._pvpTeamToLevels.getValue(t);return e[0]},t._inst=null,t.MIN_RANK_TAEM=2,t.MAX_RANK_TEAM=8,t}();t.Config=e,__reflect(e.prototype,"Pvp.Config")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(){function t(t,e){this._videoID=t,this._discussID=e.ID,this._userName=e.Name,this._content=e.Content,this._like=e.Like,this._isLike=e.IsLike,this._time=e.Time,this._headImage=e.HeadImgUrl,this._frameImage=e.HeadFrame,this._uid=e.Uid}return Object.defineProperty(t.prototype,"videoID",{get:function(){return this._videoID},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"discussID",{get:function(){return this._discussID},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"userName",{get:function(){return this._userName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"likeNum",{get:function(){return this._like},set:function(t){this._like=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLike",{get:function(){return this._isLike},set:function(t){this._isLike=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"headImage",{get:function(){return this._headImage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frameImage",{get:function(){return this._frameImage&&""!=this._frameImage?"headframe_"+this._frameImage+"_png":"headframe_1_png"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return this._time},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),t}();t.DiscussData=e,__reflect(e.prototype,"Pvp.DiscussData");var i=function(){function t(){}return Object.defineProperty(t,"inst",{get:function(){return t._inst||(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype.reDisussDataMgr=function(){this._discussDataList=new Collection.Dictionary,this._discussIndexList=new Array},t.prototype.addDisussData=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._discussDataList.setValue(t.discussID,t),this._discussIndexList.push(t.discussID),this._discussIndexList.sort(function(t,e){return t>e?-1:e>t?1:0}),[2]})})},Object.defineProperty(t.prototype,"discussNum",{get:function(){return this._discussDataList.size()},enumerable:!0,configurable:!0}),t.prototype.getDiscussData4Key=function(t){var e=this._discussDataList.containsKey(t);return e?this._discussDataList.getValue(t):void console.log("没有找到id为"+t+"的数据")},t.prototype.getDiscussData4Index=function(t){var e=this._discussIndexList[t];return this.getDiscussData4Key(e)},t._inst=null,t}();t.DiscussDataMgr=i,__reflect(i.prototype,"Pvp.DiscussDataMgr")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(){function t(t){if(this._data=t,this._cards=[null,null,null,null,null],t.Cards)for(var e=0;e<t.Cards.length;e++){var i=t.Cards[e];if(!(0>=i)){var r=CardPool.CardPoolMgr.inst.getCollectCard(i);r||(r=Diy.DiyMgr.inst.getDiyCard(i)),r&&r.state==CardPool.CardState.Alive&&(this._cards[e]=r)}}}return Object.defineProperty(t.prototype,"id",{get:function(){return this._data.PoolId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camp",{get:function(){return this._data.Camp},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFight",{get:function(){return this._data.IsFight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cards",{get:function(){return this._cards},set:function(t){this._cards=t},enumerable:!0,configurable:!0}),t.prototype.providerHandItemData=function(t){return this._cards[t]},t.prototype.getCardAmout=function(){var t=0;return this._cards.forEach(function(e){e&&t++}),t},t.prototype.onCardInCampaignMs=function(t){for(var e=0;e<this._cards.length;e++)if(this._cards[e]&&this._cards[e].cardId==t)return this._cards[e]=null,!0;return!1},t.prototype.isCardInPool=function(t){for(var e=0;e<this._cards.length;e++)if(this._cards[e]&&this._cards[e].cardId==t)return!0;return!1},t}();t.FightCardPool=e,__reflect(e.prototype,"Pvp.FightCardPool",["UI.IHandItemDataProvider"])}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(){function t(t){this._fightPool=t}return t.prototype.getCamps=function(){return[this._fightPool.camp,Camp.HEROS]},t.prototype.getTitleCamps=function(){return[this._fightPool.camp,Camp.HEROS]},t.prototype.needDiyCard=function(){return!0},t.prototype.getCardState=function(t){return t.isInCampaignMission?UI.BaseCardItem.campaignBanState:UI.BaseCardItem.NormalState},t.prototype.getChoiceCard=function(){return this._fightPool.cards.concat()},t.prototype.getMinAmount=function(){return 0},t.prototype.getMaxAmount=function(){return 5},t.prototype.visableCampaign=function(){return!1},t.prototype.needEnergyProgress=function(){return!0},t.prototype.needExpProgress=function(){return!1},t.prototype.onConfirm=function(t,e){return __awaiter(this,void 0,void 0,function(){var e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:for(e=[0,0,0,0,0],this._fightPool.cards=t,i=0;i<t.length;i++)t[i]&&(e[i]=t[i].cardId);return r=pb.PoolUpdateCard.encode({PoolId:this._fightPool.id,Cards:e}),[4,Net.rpcCall(pb.MessageID.C2S_POOL_UPDATE_CARD,r)];case 1:return n=o.sent(),0==n.errcode?(Core.EventCenter.inst.dispatchEventWith(GameEvent.FightPoolUpdateCardEv,!1,this._fightPool),[2,!0]):[2,!1]}})})},t}();t.FightPoolChoiceCardCtrl=e,__reflect(e.prototype,"Pvp.FightPoolChoiceCardCtrl",["UI.IChoiceCardCtrl"])
}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(){function t(){}return t.prototype.updateMailCom=function(t,e,i){e.text=t.Title,i.text="\n"+t.Content},t}();__reflect(e.prototype,"CustomMailProcessor",["IMailProcessor"]);var i=function(){function t(){}return t.prototype.updateMailCom=function(t,e,i){var r=(pb.MailSeasonPvpBeginArg.decode(t.Arg).PvpLevel,Data.mail_config.get(t.MailType));e.text=r.title,i.text="\n"+r.content},t}();__reflect(i.prototype,"PvpSeasonProcessor",["IMailProcessor"]);var r=function(){function t(){}return t.prototype.updateMailCom=function(t,e,i){var r=pb.MailSeasonPvpEndArg.decode(t.Arg).WinDiff,n=Data.mail_config.get(t.MailType);e.text=n.title,i.text="\n"+n.content.replace("{0}",r)},t}();__reflect(r.prototype,"PvpSeasonEndProcessor",["IMailProcessor"]);var n=function(){function t(){}return t.prototype.updateMailCom=function(t,e,i){var r=Data.mail_config.get(t.MailType);e.text=r.title,i.text="\n"+r.content},t}();__reflect(n.prototype,"ConfigMailProcessor",["IMailProcessor"]);var o=function(o){function s(){var t=o.call(this)||this;return t._configMailProcessor=new n,t._mailType2Processor=new Collection.Dictionary,t._mailType2Processor.setValue(pb.MailTypeEnum.CUSTOM,new e),t._mailType2Processor.setValue(pb.MailTypeEnum.SeasonPvpBegin,new i),t._mailType2Processor.setValue(pb.MailTypeEnum.SeasonPvpEnd,new r),t._mailType2Processor.setValue(pb.MailTypeEnum.FbAdvert,new n),t}return __extends(s,o),Object.defineProperty(s,"inst",{get:function(){return s._inst||(s._inst=new s),s._inst},enumerable:!0,configurable:!0}),s.prototype.mailDataInit=function(t){this._mailDataList=new Collection.Dictionary,this._mailIDList=new Array,this.addMailData(t)},s.prototype.getMailContentProcessor=function(t){var e=this._mailType2Processor.getValue(t);return e?e:this._configMailProcessor},s.prototype.addMailData=function(t){var e=this;this._hasMore=t.HasMore,t.Mails.forEach(function(t){e._mailIDList.push(t.ID),e._mailDataList.setValue(t.ID,t)})},Object.defineProperty(s.prototype,"hasMore",{get:function(){return this._hasMore},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"mailNum",{get:function(){return this._mailDataList.size()},enumerable:!0,configurable:!0}),s.prototype.getMail=function(t){return this._mailIDList[t]?this._mailDataList.getValue(this._mailIDList[t]):void 0},s.prototype.getReward=function(t,e){this._mailDataList.containsKey(t)&&(this._mailDataList.getValue(t).IsReward=e,this._mailDataList.getValue(t).IsRead=e)},s.prototype.haveNoRead=function(){var t=!1;return this._mailDataList.forEach(function(e,i){i.IsRead||(t=!0)}),t},s.prototype.haveReward=function(){var t=!1;return this._mailDataList.forEach(function(e,i){i.IsReward||(t=!0)}),t},s.prototype.getAllReward=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_GET_ALL_MAIL_REWARD,null)];case 1:return e=n.sent(),0==e.errcode&&(i=pb.MailRewardReply.decode(e.payload),r=new t.GetRewardData,r.gold=i.Gold,r.jade=i.Jade,i.HeadFrames.forEach(function(t){r.addHeadFrame(t)}),i.CardSkins.forEach(function(t){r.addSkins(t)}),i.Cards.forEach(function(t){r.addCards(t.CardID,t.Amount)}),i.TreasureRewards.forEach(function(t){r.addTreasure(t)}),Core.ViewManager.inst.open(ViewName.getRewardWnd,r),this._mailDataList.forEach(function(t,e){e.IsRead||(e.IsRead=!0),e.IsReward||(e.IsReward=!0)}),s.inst.dispatchEventWith(s.SetGetAllBtn,!1)),[2]}})})},s.MailRedDot="MailRedDot",s.SetGetAllBtn="SetGetAllBtn",s}(egret.EventDispatcher);t.MailMgr=o,__reflect(o.prototype,"Pvp.MailMgr")}(Pvp||(Pvp={}));var Pvp;!function(t){function e(){r.inst.onLogout()}function i(){Player.inst.addEventListener(Player.LogoutEvt,e,null),t.initRpc();var i=Core.ViewManager.inst.registerView.bind(Core.ViewManager.inst),r=fairygui.UIPackage.createObject;i(ViewName.match,function(){return r(PkgName.pvp,ViewName.match,t.MatchView)}),i(ViewName.choiceFightCard,function(){return r(PkgName.common,ViewName.choiceFightCard,UI.ChoiceFightCardView)}),i(ViewName.rankSeason,function(){return r(PkgName.pvp,ViewName.rankSeason,t.RankSeasonWnd)}),i(ViewName.rankSeasonTreasureInfo,function(){return r(PkgName.pvp,ViewName.rankSeasonTreasureInfo,t.RankSeasonTreasureInfo)}),i(ViewName.rebornShopView,function(){return r(PkgName.reborn,ViewName.rebornShopView,Reborn.RebornShopView)}),i(ViewName.rebornWnd,function(){var t=new Reborn.RebornWnd;return t.contentPane=r(PkgName.reborn,ViewName.rebornWnd).asCom,t}),i(ViewName.refineWnd,function(){var t=new Reborn.RefineWnd;return t.contentPane=r(PkgName.reborn,ViewName.refineWnd).asCom,t}),i(ViewName.refineInfoWnd,function(){var t=new Reborn.RefineInfoWnd;return t.contentPane=r(PkgName.reborn,ViewName.refineInfoWnd).asCom,t}),i(ViewName.featCardInfo,function(){var t=new CardPool.BuyCardInfoWnd;return t.contentPane=r(PkgName.reborn,ViewName.featCardInfo).asCom,t}),i(ViewName.privInfo,function(){var t=new Reborn.PrivInfo;return t.contentPane=r(PkgName.reborn,ViewName.privInfo).asCom,t}),i(ViewName.rebornEquipInfo,function(){var t=new Reborn.RebornEquipInfo;return t.contentPane=r(PkgName.reborn,ViewName.rebornEquipInfo).asCom,t}),i(ViewName.buySkinInfo,function(){var t=new Reborn.BuySkinInfo;return t.contentPane=r(PkgName.reborn,ViewName.buySkinInfo).asCom,t}),i(ViewName.matching,function(){return r(PkgName.pvp,ViewName.matching,t.MatchingWnd)}),i(ViewName.team,function(){return r(PkgName.pvp,ViewName.team,t.TeamView)}),i(ViewName.rankRewardView,function(){return r(PkgName.pvp,ViewName.rankRewardView,t.RankRewardView)}),i(ViewName.rankListWnd,function(){var e=new t.RankListWnd;return e.contentPane=r(PkgName.pvp,ViewName.rankListWnd).asCom,e}),i(ViewName.rankUpTips,function(){var e=new t.RankupTipsWnd;return e.contentPane=r(PkgName.pvp,ViewName.rankUpTips).asCom,e}),i(ViewName.rankUpRewardTips,function(){var e=new t.RankupRewardTipsWnd;return e.contentPane=r(PkgName.pvp,ViewName.rankUpRewardTips).asCom,e}),i(ViewName.videoHall,function(){return r(PkgName.pvp,ViewName.videoHall,t.VideoHallWnd)}),i(ViewName.videoRecord,function(){return r(PkgName.pvp,ViewName.videoRecord,t.VideoRecordWnd)}),i(ViewName.videoUpload,function(){return r(PkgName.pvp,ViewName.videoUpload,t.VideoUploadWnd)}),i(ViewName.videoDiscuss,function(){return r(PkgName.pvp,ViewName.videoDiscuss,t.VideoDiscussWnd)}),i(ViewName.videoSearch,function(){var e=new t.VideoSearchWnd;return e.contentPane=r(PkgName.pvp,ViewName.videoSearch).asCom,e}),i(ViewName.wechatPlatform,function(){return r(PkgName.pvp,ViewName.wechatPlatform,t.WechatPlatform)}),i(ViewName.mail,function(){return r(PkgName.pvp,ViewName.mail,t.MailWnd)}),i(ViewName.mailInfo,function(){return r(PkgName.pvp,ViewName.mailInfo,t.MailInfoWnd)}),i(ViewName.getRewardWnd,function(){return r(PkgName.common,ViewName.getRewardWnd,t.GetRewardWnd)}),i(ViewName.videoShareOption,function(){var e=new t.VideoShareOptWnd;return e.contentPane=r(PkgName.pvp,ViewName.videoShareOption).asCom,e}),i(ViewName.rankSeasonRandomCard,function(){var e=new t.RankFirstWnd;return e.contentPane=r(PkgName.pvp,ViewName.rankSeasonRandomCard).asCom,e}),i(ViewName.rankSeasonRandomCard,function(){var e=new t.RankFirstWnd;return e.contentPane=r(PkgName.pvp,ViewName.rankSeasonRandomCard).asCom,e}),i(ViewName.rankSeasonHandCard,function(){var e=new t.RankHandWnd;return e.contentPane=r(PkgName.pvp,ViewName.rankSeasonHandCard).asCom,e}),Core.DeviceUtils.isWXGame()&&i(ViewName.wxgameFriendRankView,function(){var e=new t.WXGameFriendRankView;return e.contentPane=r(PkgName.pvp,ViewName.wxgameFriendRankView).asCom,e})}var r=function(){function e(){Player.inst.addEventListener(Player.PvpScoreChangeEvt,this._onScoreChange,this),this._pvpLevel=this.getPvpLevelByScore(Player.inst.getResource(ResType.T_SCORE)),this._pvpRankNeedRefresh=!0,this._pvpSeasonRankNeedRefresh=!0,Core.EventCenter.inst.addEventListener(GameEvent.CardInCampaignMsEv,this._onCardInCampaignMs,this)}return Object.defineProperty(e,"inst",{get:function(){return e._inst||(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),e.prototype.isCardInTeam=function(t){var e=CardPool.CardPoolMgr.inst.getCollectCard(t);if(e){var i=this._camp2CardPools.getValue(e.camp);if(i){for(var r=0;r<i.length;++r)if(i[r].isCardInPool(t))return!0;return!1}return!1}return!1},e.prototype.isCardInSeason=function(t){var e=CardPool.CardPoolMgr.inst.getCollectCard(t);return console.log(e.name,e.isInSeason,e.cardId),e.isInSeason},Object.defineProperty(e.prototype,"pvpRankNeedRefresh",{get:function(){return this._pvpRankNeedRefresh},set:function(t){this._pvpRankNeedRefresh=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pvpSeasonRankNeedRefresh",{get:function(){return this._pvpSeasonRankNeedRefresh},set:function(t){this._pvpSeasonRankNeedRefresh=t},enumerable:!0,configurable:!0}),e.prototype._onRelogin=function(){this._pvpRankNeedRefresh=!0},e.prototype.onLogout=function(){this._fightCamp=null,this._isMatching=!1},e.prototype.isNewbie=function(){return Player.inst.getResource(ResType.T_SCORE)<=0},Object.defineProperty(e.prototype,"fightCamp",{get:function(){return this._fightCamp},set:function(t){this._fightCamp=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fightPool",{get:function(){return this._fightPool},set:function(t){this._fightPool=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMatching",{get:function(){return this._isMatching},enumerable:!0,configurable:!0}),e.prototype.isOpen=function(){return Level.LevelMgr.inst.getLevel(9).state>=Level.LevelState.Clear},e.prototype.getPvpLevel=function(t){return null==t?this._pvpLevel:this.getPvpLevelByScore(t)},e.prototype._onScoreChange=function(){var t=this.getPvpLevelByScore(Player.inst.getResource(ResType.T_SCORE));t!=this._pvpLevel&&(this._pvpLevel=t,Core.EventCenter.inst.dispatchEventWith(GameEvent.PvpLevelChangeEv))},e.prototype._onCardInCampaignMs=function(t){var e=t.data;if(e.isInCampaignMission&&this._camp2CardPools){var i=!1;if(this._camp2CardPools.forEach(function(t,r){r.forEach(function(t){var r=t.onCardInCampaignMs(e.cardId);i||(i=r)})}),i){var r=Core.ViewManager.inst.getView(ViewName.team);r&&r.refresh(this._fightCamp,this._camp2CardPools)}}},e.prototype.getPvpStarCnt=function(e){var i=this.getPvpLevel(e);null==e&&(e=Player.inst.getResource(ResType.T_SCORE));for(var r=e,n=1;i>n;n++)r-=t.Config.inst.getPvpMaxStar(n);return r},e.prototype.getPvpLevelByScore=function(e){for(var i=Data.rank.keys,r=0;r<i.length;r++){var n=t.Config.inst.getPvpMaxStar(i[r]);if(e-=n,0>=e)return i[r]}return i[i.length-1]},e.prototype.getNextPvpLevelScore=function(){return this.getNextPvpLevelScoreByLevel(this.getPvpLevel())},e.prototype.getNextPvpLevelScoreByLevel=function(t){var e=Data.duel.get(t+1);return e?e.score:0},e.prototype.onEnterPvp=function(){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){switch(o.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_FETCH_CARD_DATA,null)];case 1:return i=o.sent(),0!=i.errcode?[2]:(r=new Collection.Dictionary,n=pb.CardPools.decode(i.payload),n.Pools.forEach(function(e){var i=new t.FightCardPool(e),n=r.getValue(i.camp);n||(n=[],r.setValue(i.camp,n)),n.push(i)}),this._fightCamp=n.FightCamp,e.inst.fightCamp=this._fightCamp,r.getValue(this._fightCamp).forEach(function(t,i){t.isFight&&(e.inst.fightPool=t)}),console.log("set fight pool "+this._fightCamp+" "+r,e.inst),this._camp2CardPools=r,[2,[this._fightCamp,r]])}})})},e.prototype.updateFightPool=function(t,e){Net.rpcPush(pb.MessageID.C2S_UPDATE_CARD_POOL,pb.UpdateCardPools.encode({Pools:t,FightCamp:e}))},e.prototype.beginMatch=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i=this;return __generator(this,function(r){switch(r.label){case 0:return Core.ViewManager.inst.isShow(ViewName.matching)?[2]:Battle.BattleMgr.inst.battle?[2]:!Core.DeviceUtils.isWXGame()&&Player.inst.isNewbieName(Player.inst.name)&&this.getPvpLevel()>=2?(Core.ViewManager.inst.open(ViewName.modifyName),[4,new Promise(function(t){Core.EventCenter.inst.once(GameEvent.ModifyNameEv,function(){t()},i)})]):[3,2];case 1:r.sent(),r.label=2;case 2:return[4,Net.rpcCall(pb.MessageID.C2S_BEGIN_MATCH,pb.MatchArg.encode({Camp:this.fightCamp}))];case 3:return t=r.sent(),0==t.errcode?(e=pb.MatchReply.decode(t.payload),e.ChooseCardData?Core.ViewManager.inst.open(ViewName.rankSeasonRandomCard,e.ChooseCardData,e.LastCamp):e.NeedChooseCamp?Core.ViewManager.inst.open(ViewName.rankSeasonRandomCard,e.ChooseCardData,e.LastCamp):(Core.ViewManager.inst.open(ViewName.matching),this._isMatching=!0)):Core.ViewManager.inst.close(ViewName.matching),[2]}})})},e.prototype.showRankHand=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_FETCH_SEASON_HAND_CARD,null)];case 1:return t=i.sent(),0==t.errcode&&(e=pb.FetchSeasonHandCardReply.decode(t.payload),Core.ViewManager.inst.open(ViewName.rankSeasonHandCard,e)),[2]}})})},e.prototype.cancelMatch=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this._isMatching?[4,Net.rpcCall(pb.MessageID.C2S_STOP_MATCH,null)]:(SoundMgr.inst.playBgMusic("bg_mp3"),Core.ViewManager.inst.close(ViewName.matching),[2]);case 1:return t=e.sent(),1!=t.errcode&&(this._isMatching=!1,SoundMgr.inst.playBgMusic("bg_mp3"),Core.ViewManager.inst.close(ViewName.matching)),Core.EventCenter.inst.dispatchEventWith(GameEvent.MatchStopEv),[2]}})})},e.prototype.readyFight=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this._isMatching?(this._isMatching=!1,t=Core.ViewManager.inst.getView(ViewName.matching),[4,t.readyFight()]):[2];case 1:return e.sent(),[2]}})})},e.prototype.onMatchTimeout=function(){this._isMatching=!1,SoundMgr.inst.playBgMusic("bg_mp3"),Core.ViewManager.inst.close(ViewName.matching),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60225)),Core.EventCenter.inst.dispatchEventWith(GameEvent.MatchStopEv)},e.prototype.watchVideo=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_GET_BATTLE_VIDEO,null,!0,!1)];case 1:return t=e.sent(),0!=t.errcode?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60127)),[2]):(Battle.VideoPlayer.inst.play(pb.VideoBattleData.decode(t.payload)),[2])}})})},e}();t.PvpMgr=r,__reflect(r.prototype,"Pvp.PvpMgr"),t.init=i}(Pvp||(Pvp={}));var Pvp;!function(t){function e(e,i){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(r){switch(r.label){case 0:return[4,t.PvpMgr.inst.readyFight()];case 1:return r.sent(),e=pb.MatchInfo.decode(i),Net.rpcCall(pb.MessageID.C2S_MATCH_READY_DONE,pb.MatchDoneArg.encode({RoomId:e.RoomId})),[2]}})})}function i(e,i){t.PvpMgr.inst.onMatchTimeout()}function r(e,i){console.debug("rpc_RefreshRank"),t.PvpMgr.inst.pvpRankNeedRefresh=!0,t.PvpMgr.inst.pvpSeasonRankNeedRefresh=!0}function n(e,i){t.MailMgr.inst.dispatchEventWith(t.MailMgr.MailRedDot,!1,!0)}function o(t,e){var i=pb.SeasonPvpLimitTime.decode(e);Core.EventCenter.inst.dispatchEventWith(GameEvent.SeasonBegin,!1,i.LimitTime)}function s(t,e){Player.inst.seaonTime=0,Core.EventCenter.inst.dispatchEventWith(GameEvent.SeasonEnd,!1)}function a(t,e){Core.EventCenter.inst.dispatchEventWith(GameEvent.ShowRankCard,!1,!1)}function u(){Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_MATCH_INFO,e),Net.registerRpcHandler(pb.MessageID.S2C_MATCH_TIMEOUT,i),Net.registerRpcHandler(pb.MessageID.S2C_REFRESH_RANK,r),Net.registerRpcHandler(pb.MessageID.S2C_NOTIFY_NEW_MAIL,n),Net.registerRpcHandler(pb.MessageID.S2C_SEASON_PVP_BEGIN,o),Net.registerRpcHandler(pb.MessageID.S2C_SEASON_PVP_STOP,s),Net.registerRpcHandler(pb.MessageID.S2C_SEASON_PVP_CHANGE_HAND_CARD,a)}t.initRpc=u}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(){function t(){this._cards=[]}return t.prototype.update=function(t){var e=this;this._uid=t.Uid,this._name=t.Name,t.FightCards.forEach(function(t){e._cards.push(t)})},Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cards",{get:function(){return this._cards},enumerable:!0,configurable:!0}),t}();t.VideoFighter=e,__reflect(e.prototype,"Pvp.VideoFighter");var i;!function(t){t[t.FENG_HUO_TAI=1]="FENG_HUO_TAI",t[t.ZHAN_JI=2]="ZHAN_JI"}(i||(i={}));var r=function(){function t(t,i){this._isSelf=i,this._id=t.VideoID,this._hasWatch=!1,this._hostFighter=new e,this._guestFighter=new e,this.update(t)}return t.prototype.update=function(t){this._hostFighter.update(t.Fighter1),this._guestFighter.update(t.Fighter2),this._winnerUid=t.WinnerUid,this.watchTimes=t.WatchTimes,this.likeTimes=t.Like,this._timeStamp=t.Time,this._sharePlayerName=t.SharePlayerName,this.isShare=this._sharePlayerName&&""!=this._sharePlayerName,this.isLike=t.IsLike,this.commentsAmount=t.CommentsAmount,this.title=t.Name,this._changePlayer()},t.prototype._changePlayer=function(){var t=!1;if(this._isSelf?this._guestFighter.uid==Player.inst.uid&&(t=!0):this._sharePlayerName==this._guestFighter.name&&(t=!0),t){var e=this._hostFighter;this._hostFighter=this._guestFighter,this._guestFighter=e}},Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hostFighter",{get:function(){return this._hostFighter},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guestFighter",{get:function(){return this._guestFighter},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"winner",{get:function(){return this._winnerUid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"watchTimes",{get:function(){return this._watchTimes},set:function(t){this._watchTimes=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"likeTimes",{get:function(){return this._likeTimes},set:function(t){this._likeTimes=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"timeStamp",{get:function(){return this._timeStamp},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sharePlayerName",{get:function(){return this._sharePlayerName},set:function(t){this._sharePlayerName=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isShare",{get:function(){return this._isShare},set:function(t){this._isShare=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLike",{get:function(){return this._isLike},set:function(t){this._isLike=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"commentsAmount",{get:function(){return this._commentsAmount},set:function(t){this._commentsAmount=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"title",{get:function(){return this._title},set:function(t){this._title=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasWatch",{get:function(){return this._hasWatch},set:function(t){this._hasWatch=t,t&&n.inst.setVideoWatch(this.id,!0)},enumerable:!0,configurable:!0}),t.prototype.initHasWatch=function(t){this._hasWatch=t},t.prototype.toLocalString=function(){var t=(""+this._id,{key:{hasWatch:this._hasWatch}});return JSON.stringify(t)},t}();t.Video=r,__reflect(r.prototype,"Pvp.Video");var n=function(){function t(){this._STORE_KEY="videos",this._loadData(),this._rankTeamVideoCache=new Collection.Dictionary}return Object.defineProperty(t,"inst",{get:function(){return t._inst||(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype._loadData=function(){var t=egret.localStorage.getItem(this._STORE_KEY);t&&""!=t||(t="{}"),this._videoData=JSON.parse(t)},t.prototype._saveData=function(){var t=JSON.stringify(this._videoData);egret.localStorage.setItem(this._STORE_KEY,t)},t.prototype._hasVideoWatched=function(t){var e=""+t;return this._videoData[e]?this._videoData[e].hasWatch:!1},t.prototype.setVideoWatch=function(t,e){var i=""+t;this._videoData[i]||(this._videoData[i]={}),this._videoData[i].hasWatch=e,this._saveData()},t.prototype._fetchPublishVideos=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n,o,s,a,u,h,l;return __generator(this,function(c){switch(c.label){case 0:return e={Team:t},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_VIDEO_LIST,null)];case 1:if(i=c.sent(),0==i.errcode){for(n=pb.VideoList.decode(i.payload),o=[],s=[],a=0;a<n.Videos.length;++a)u=n.Videos[a],h=new r(u,!1),this._hasVideoWatched(h.id)&&h.initHasWatch(!0),0==a?o.push(h):s.push(h);return s=Core.RandomUtils.shuffle(s),l=o.concat(s),this._rankTeamVideoCache.setValue(t,{time:Date.now(),videos:l}),[2,l]}return[2,[]]}})})},t.prototype.getPublishVideos=function(t,e){return void 0===e&&(e=!1),__awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return this._rankTeamVideoCache.containsKey(t)?(i=this._rankTeamVideoCache.getValue(t),Date.now()-i.time>36e5||e?[4,this._fetchPublishVideos(t)]:[3,2]):[3,4];case 1:return[2,r.sent()];case 2:return i.videos?[2,i.videos]:[2,[]];case 3:return[3,6];case 4:return[4,this._fetchPublishVideos(t)];case 5:return[2,r.sent()];case 6:return[2]}})})},t.prototype.getSelfVideos=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n,o,s,a,u;return __generator(this,function(h){switch(h.label){case 0:return e={Page:t},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_SELF_VIDEO_LIST,pb.FetchSelfVideoListArg.encode(e))];case 1:if(i=h.sent(),0==i.errcode){for(n=pb.VideoList.decode(i.payload),o=[],s=0;s<n.Videos.length;++s)a=n.Videos[s],u=new r(a,!0),this._hasVideoWatched(u.id)&&u.initHasWatch(!0),o.push(u);return[2,o]}return[2,[]]}})})},t.prototype.setCurVideo=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return this._curVideo=t,this._curVideoCom=e,[2]})})},Object.defineProperty(t.prototype,"curVideo",{get:function(){return this._curVideo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"curVideoCom",{get:function(){return this._curVideoCom},enumerable:!0,configurable:!0}),t.prototype.playVideo=function(e,i){return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a;return __generator(this,function(u){switch(u.label){case 0:return r={VideoID:e.id},[4,Net.rpcCall(pb.MessageID.C2S_WATCH_VIDEO,pb.WatchVideoArg.encode(r))];case 1:if(n=u.sent(),0!=n.errcode)return[3,6];t.inst.setCurVideo(e,i),o=pb.WatchVideoResp.decode(n.payload),s=null,Core.ViewManager.inst.isShow(ViewName.videoHall)?s=ViewName.videoHall:Core.ViewManager.inst.isShow(ViewName.videoRecord)&&(s=ViewName.videoRecord),s&&""!=s&&Core.ViewManager.inst.getView(s).setVisible(!1),u.label=2;case 2:return u.trys.push([2,4,,5]),[4,Battle.VideoPlayer.inst.play(o.VideoData)];case 3:return u.sent(),[3,5];case 4:return a=u.sent(),console.log(a),[3,5];case 5:return s&&""!=s&&Core.ViewManager.inst.getView(s).setVisible(!0),e.watchTimes=o.CurWatchTimes,e.likeTimes=o.CurLike,e.hasWatch=!0,[2,!0];case 6:return[2,!1]}})})},t.prototype.playVideoById=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getVideoById(t)];case 1:return e=i.sent(),e?[4,this.playVideo(e)]:[3,3];case 2:return[2,i.sent()];case 3:return[2,!1]}})})},t.prototype.getVideoById=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n,o;return __generator(this,function(s){switch(s.label){case 0:return e={VideoID:t},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_VIDEO_ITEM,pb.FetchVideoItemArg.encode(e))];case 1:return i=s.sent(),0==i.errcode?(n=pb.VideoItem.decode(i.payload),o=new r(n,!1),[2,o]):[2]}})})},t._inst=null,t}();t.VideoCenter=n,__reflect(n.prototype,"Pvp.VideoCenter")}(Pvp||(Pvp={}));var Quest;!function(t){var e=function(){function t(t){this._missionID=t.MissionID,this._curCnt=t.CurCnt,this._isReward=t.IsReward,this._ID=t.ID}return Object.defineProperty(t.prototype,"getMissionID",{get:function(){return this._missionID},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"getID",{get:function(){return this._ID},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"getIsReward",{get:function(){return this._isReward},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"setIsReward",{set:function(t){this._isReward=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"getCurCnt",{get:function(){return this._curCnt},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){var t=this.data;return t?t.type:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data||(this._data=Data.quest_config.get(this.getMissionID)),this._data},enumerable:!0,configurable:!0}),t.prototype.isComplete=function(){var t=this.data;return t?this._curCnt>=t.process:!1},t}();t.QuestData=e,__reflect(e.prototype,"Quest.QuestData")}(Quest||(Quest={}));var Quest;!function(t){function e(){var e=Core.ViewManager.inst.registerConstructor.bind(Core.ViewManager.inst),i=fairygui.UIPackage.createObject;e(ViewName.questView,function(){return i(PkgName.pvp,ViewName.questView,t.QuestView)}),e(ViewName.questView,function(){return i(PkgName.pvp,ViewName.questView,t.QuestView)}),e(ViewName.questTipView,function(){return i(PkgName.pvp,ViewName.questTipView,t.QuestTipView)}),e("questGetView",function(){return i(PkgName.pvp,ViewName.resourceGetView,Shop.GetResAniWnd)}),t.initRpc()}var i;!function(t){t[t.WatchVideo=9]="WatchVideo",t[t.WxShare=6]="WxShare"}(i=t.MissionType||(t.MissionType={}));var r=function(e){function r(){return e.call(this)||this}return __extends(r,e),Object.defineProperty(r,"inst",{get:function(){return r._inst||(r._inst=new r),r._inst},enumerable:!0,configurable:!0}),r.prototype.loadQuest=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_FETCH_MISSION_INFO,null)];case 1:return t=i.sent(),0!=t.errcode?(console.log("quest have errcode"),[2]):(e=pb.MissionInfo.decode(t.payload),this.setQuestList(e),this.updateQuestBtn(),[2])}})})},r.prototype.updateView=function(){this.updateTreasure(),this.updateQuestList()},r.prototype.setTreasureData=function(t){this._treasure=t,fairygui.GTimers.inst.remove(this._updateTimer,this),fairygui.GTimers.inst.add(1e3,this._nextRemainTime,this._updateTimer,this),this.updateTreasure()},r.prototype.setQuestList=function(e){var i=this;this._nextRemainTime=e.RefreshRemainTime,this.setTreasureData(e.Treasure),this._canRefresh=e.CanRefresh,this._questList=new Collection.Dictionary,e.Missions.forEach(function(e){var r=new t.QuestData(e);i._questList.setValue(r.getID,r)})},r.prototype.setQuest=function(t){t=t,this._questList.setValue(t.getID,t),this.dispatchEventWith(r.UpdateQuest,!1,t);var e=Core.ViewManager.inst.isShow(ViewName.questView);e||(Core.ViewManager.inst.open(ViewName.questTipView),r.inst.dispatchEventWith(r.ShowTip,!1,t))},r.prototype.showRedDot=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.dispatchEventWith(r.UpdateQuestHint,!1),[2]})})},r.prototype.updateQuestBtn=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return this.dispatchEventWith(r.UpdateQuestButton,!1),this._questList.forEach(function(e,i){i.getCurCnt>=Data.quest_config.get(i.getMissionID).process&&!i.getIsReward&&t.showRedDot()}),[2]})})},r.prototype._updateTimer=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._nextRemainTime-=1,r.inst.dispatchEventWith(r.UpdateTimer,!1),[2]})})},r.prototype.updateTreasure=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.dispatchEventWith(r.UpdateTreasure,!1),[2]})})},r.prototype.updateQuestList=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.dispatchEventWith(r.UpdateQuestList,!1),[2]})})},r.prototype.refreshQuest=function(e){return __awaiter(this,void 0,void 0,function(){var i,n,o;return __generator(this,function(s){switch(s.label){case 0:return this._canRefresh?[4,Net.rpcCall(pb.MessageID.C2S_REFRESH_MISSION,pb.TargetMission.encode({ID:e}))]:[2];case 1:return i=s.sent(),0!=i.errcode?[2]:(n=pb.Mission.decode(i.payload),o=new t.QuestData(n),this._canRefresh=!1,this._questList.setValue(o.getID,o),this.dispatchEventWith(r.UpdateQuest,!1,o),this.dispatchEventWith(r.HideRefresh,!1,null),[2])}})})},r.prototype.getQuestReward=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n,o;return __generator(this,function(s){switch(s.label){case 0:return e=this._questList.getValue(t),e.getCurCnt<Data.quest_config.get(e.getMissionID).process?[2,!1]:[4,Net.rpcCall(pb.MessageID.C2S_GET_MISSION_REWARD,pb.TargetMission.encode({ID:t}))];case 1:return i=s.sent(),0!=i.errcode?(console.log(i.errcode),[2,!1]):(n=pb.MissionReward.decode(i.payload),o=new Pvp.GetRewardData,o.jade=n.Jade,o.gold=n.Gold,o.bowlder=n.Bowlder,Core.ViewManager.inst.open(ViewName.getRewardWnd,o),e.setIsReward=!0,this.dispatchEventWith(r.UpdateQuest,!1,e),this.updateQuestBtn(),this.updateTreasure(),[2,!0])}})})},r.prototype.getTreasureReward=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,n,o,s;return __generator(this,function(a){switch(a.label){case 0:return t=Data.treasure_config.get(r.inst.getTreasureModelID),[4,Net.rpcCall(pb.MessageID.C2S_OPEN_MISSION_TREASURE,null)];case 1:return e=a.sent(),0!=e.errcode?[2]:(i=pb.OpenMissionTreasureReply.decode(e.payload),n=i.TreasureReward,o=new Treasure.TreasureReward,s=new Treasure.TreasureItem(-1,this._treasure.TreasureModelID),o.gold=n.GoldAmount,o.jade=n.Jade,n.CardIDs.forEach(function(t){o.addCardId(t)}),o.shareId=n.ShareHid,Core.ViewManager.inst.open(ViewName.treasureRewardInfo,o,s),this.setTreasureData(i.NextTreasure),this.updateQuestBtn(),this.updateTreasure(),[2])}})})},r.prototype.onWatchVideo=function(){if(this._questList){var t=!1;this._questList.forEach(function(e,r){r.type!=i.WatchVideo||r.isComplete()||(t=!0)}),t&&Net.rpcPush(pb.MessageID.C2S_WATCH_OUT_VIDEO,null)}},r.prototype.onWxShare=function(){if(this._questList){var t=!1;this._questList.forEach(function(e,r){r.type!=i.WxShare||r.isComplete()||(t=!0)}),t&&Net.rpcPush(pb.MessageID.C2S_WXGAME_SHARE,null)}},Object.defineProperty(r.prototype,"getCurCnt",{get:function(){return this._treasure.CurCnt},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"getCompleteNum",{get:function(){var t=0;return this._questList.forEach(function(e,i){i.isComplete()&&(t+=1)}),t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"getIsRewardNum",{get:function(){var t=0;return this._questList.forEach(function(e,i){i.getIsReward&&(t+=1)}),t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"canReward",{get:function(){this._questList.forEach(function(t,e){return e.getIsReward?!0:void 0});var t=Data.treasure_config.get(this.getTreasureModelID);return this._treasure.CurCnt>=t.quest_unlockCnt?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"getCanRefresh",{get:function(){return this._canRefresh},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"getQuestNum",{get:function(){return this._questList.size()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"getTreasureModelID",{get:function(){return this._treasure.TreasureModelID},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"getQuestList",{get:function(){return this._questList},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"getQuestTimer",{get:function(){var t=""+Core.StringUtils.secToString(this._nextRemainTime,"hm");
return t},enumerable:!0,configurable:!0}),r.UpdateQuestButton="UpdateQuestButton",r.UpdateQuestHint="UpdateQuestHint",r.UpdateTreasure="UpdateQuestView",r.UpdateTimer="UpdateTimer",r.UpdateQuestList="UpdateQuestList",r.UpdateQuest="UpdateQuest",r.HideRefresh="HideRefresh",r.ShowTip="ShowTip",r}(egret.EventDispatcher);t.QuestMgr=r,__reflect(r.prototype,"Quest.QuestMgr"),t.init=e}(Quest||(Quest={}));var Quest;!function(t){function e(e,i){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(r){return e=pb.MissionTreasure.decode(i),t.QuestMgr.inst.setTreasureData(e),t.QuestMgr.inst.updateQuestBtn(),Core.ViewManager.inst.isShow(ViewName.questView)&&t.QuestMgr.inst.updateTreasure(),[2]})})}function i(e,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t.QuestMgr.inst.showRedDot(),[2]})})}function r(e,i){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(r){return e=pb.MissionInfo.decode(i),t.QuestMgr.inst.setQuestList(e),t.QuestMgr.inst.updateQuestBtn(),Core.ViewManager.inst.isShow(ViewName.questView)&&t.QuestMgr.inst.updateView(),[2]})})}function n(e,i){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(r){return e=pb.UpdateMissionProcessArg.decode(i),e.Missions.forEach(function(e){var i=new t.QuestData(e);t.QuestMgr.inst.setQuest(i)}),[2]})})}function o(){Net.registerRpcHandler(pb.MessageID.S2C_MISSION_SHOW_RED_DOT,i),Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_MISSION_INFO,r),Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_MISSION_PROCESS,n),Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_MISSION_TREASURE_PROCESS,e)}t.initRpc=o}(Quest||(Quest={}));var Reborn;!function(t){var e=function(){function t(){}return t.prototype.setCardData=function(t){this._card=t,this._feat=t.amount*Data.card_caculation.get(t.rare).honor},Object.defineProperty(t.prototype,"card",{get:function(){return this._card},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"feat",{get:function(){return this._feat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"amount",{get:function(){return this._card.amount},enumerable:!0,configurable:!0}),t}();t.RebornCardData=e,__reflect(e.prototype,"Reborn.RebornCardData");var i=function(){function t(){this._levelCardNum=[0,10,50,130,330]}return Object.defineProperty(t,"inst",{get:function(){return t._inst||(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype.refresh=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this._refineCardFeats=0,this._rebornCart2Feats=0,this._gold=0,this._canRebornTeam=Data.reborn_treausre.keys[0],[4,this._fetchRebornData()];case 1:return t=e.sent(),t&&this._countCards(),[2]}})})},t.prototype._fetchRebornData=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return this._rebornFame=0,this._remainDay=0,[4,Net.rpcCall(pb.MessageID.C2S_FETCH_REBORN_DATA,null)];case 1:return t=i.sent(),0==t.errcode&&(e=pb.RebornData.decode(t.payload),this._rebornFame=e.Prestige,this._remainDay=e.RemainDay),[2,!0]}})})},t.prototype._countCards=function(){return __awaiter(this,void 0,void 0,function(){var t,t,i,r,n,o,s=this;return __generator(this,function(a){for(this._rebornCards=new Collection.Dictionary,this._rebornHeroList=new Array,this._rebornHeroList2=new Array,this._refineCards=new Collection.Dictionary,this._refineCardIndexs=new Array,this._refineRareDic=new Collection.Dictionary,t=1;5>=t;t++)this._rebornCards.setValue(t,0),this._refineRareDic.setValue(t,0);for(t=1;8>=t;t++)i=Data.rank.get(t).unlock,i.length>0&&(this._rebornHeroList=this._rebornHeroList.concat(i));return r=[],[Camp.WEI,Camp.SHU,Camp.WU,Camp.HEROS].forEach(function(t){var e=CardPool.CardPoolMgr.inst.getCollectCardsByCamp(t,!1);r=r.concat(e)}),r.forEach(function(t){if(t.level>=1&&t.rare<99){var i=s._rebornCards.getValue(t.rare);i+=t.amount+s._levelCardNum[t.level-1],s._rebornCards.setValue(t.rare,i);var r=s._coundCardLevelGold(t.gcardId,t.level);s._gold+=r}else 99==t.rare&&s._rebornHeroList2.push(t.cardId);if(t.amount>0&&t.level>=5){var n=new e;n.setCardData(t),s._refineCards.setValue(t.cardId,n),s._refineCardIndexs.push(t.cardId),s._refineCardFeats+=n.feat;var i=s._refineRareDic.getValue(t.rare);i+=t.amount,s._refineRareDic.setValue(t.rare,i)}}),this._rebornCards.forEach(function(t,e){s._rebornCart2Feats+=e*Data.card_caculation.get(t).honor}),this._refineCardIndexs.sort(function(t,e){return s._refineCards.getValue(e).amount-s._refineCards.getValue(t).amount}),n=Pvp.PvpMgr.inst.getPvpLevelByScore(Player.inst.getResource(ResType.T_SCORE)),this._team=Pvp.Config.inst.getPvpTeam(n),o=Pvp.PvpMgr.inst.getPvpLevelByScore(Player.inst.getResource(ResType.T_MAX_SCORE)),this._maxTeam=Pvp.Config.inst.getPvpTeam(o),this._team>=this.canRebornTeam?this._treasureId=Data.reborn_treausre.get(this._team).treasure:this._treasureId=null,[2]})})},t.prototype._coundCardLevelGold=function(t,e){var i=0;return e>1?i+=Data.pool.get(t-1).levelupGold+this._coundCardLevelGold(t-1,e-1):i},t.prototype.onReborn=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o;return __generator(this,function(s){switch(s.label){case 0:return null==this._treasureId?[2,!1]:[4,Net.rpcCall(pb.MessageID.C2S_REBORN,null)];case 1:return e=s.sent(),0!=e.errcode?[3,3]:(i=pb.RebornReply.decode(e.payload),Core.EventCenter.inst.dispatchEventWith(GameEvent.ModifyNameEv,!1,i.NewName),Player.inst.name=i.NewName,r=new Pvp.GetRewardData,r.addTreasure(i.TreasureReward),r.addTreasureId(this._treasureId),r.feat=i.Feats,r.fame=i.Prestige,Core.ViewManager.inst.open(ViewName.getRewardWnd,r),t.inst.refresh(),[4,Pvp.PvpMgr.inst.onEnterPvp()]);case 2:return n=s.sent(),o=Core.ViewManager.inst.getView(ViewName.team),o.refresh(n[0],n[1]),Core.EventCenter.inst.dispatchEventWith(GameEvent.BuyRebornGoods,!1),Core.EventCenter.inst.dispatchEventWith(GameEvent.SeasonEnd),[2,!0];case 3:return[2,!1]}})})},t.prototype.onAllRefineCard=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return t=new Array,this._refineCards.forEach(function(e){t.push(e)}),e={CardIDs:t},[4,Net.rpcCall(pb.MessageID.C2S_REFINE_CARD,pb.RefineCardArg.encode(e))];case 1:return i=o.sent(),0!=i.errcode?[3,3]:(r=pb.RefineCardReply.decode(i.payload),n=new Pvp.GetRewardData,n.feat=r.Feats,Core.ViewManager.inst.open(ViewName.getRewardWnd,n),[4,this.refresh()]);case 2:return o.sent(),Core.EventCenter.inst.dispatchEventWith(GameEvent.BuyRebornGoods,!1),[2,!0];case 3:return[2,!1]}})})},Object.defineProperty(t.prototype,"rebornCards",{get:function(){return this._rebornCards},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rebornFeats",{get:function(){return this._rebornCart2Feats},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rebornHeros",{get:function(){return this._rebornHeroList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rebornHeros2",{get:function(){return this._rebornHeroList2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"upLevGold",{get:function(){return this._gold},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"upLevGod2Fame",{get:function(){var t=Math.floor(this._gold/Data.gold_caculation.keys[0]);return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reborn2Fame",{get:function(){return this._rebornFame},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fames",{get:function(){return this.reborn2Fame+this.upLevGod2Fame},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"refineFeats",{get:function(){return this._refineCardFeats},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"refineCards",{get:function(){return this._refineCards},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"refineCardIndexs",{get:function(){return this._refineCardIndexs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"refineRareDic",{get:function(){return this._refineRareDic},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canRebornTeam",{get:function(){return this._canRebornTeam},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"team",{get:function(){return this._team},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxTeam",{get:function(){return this._maxTeam},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cardKey",{get:function(){return this._cardKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remainDay",{get:function(){return this._remainDay},enumerable:!0,configurable:!0}),t.prototype.openCardInfo=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return this._cardKey=t,Core.ViewManager.inst.open(ViewName.featCardInfo,e,null,CardPool.BuyType.Reborn),[2]})})},t.prototype.onBuyCard=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r;return __generator(this,function(n){switch(n.label){case 0:return t=Data.sold_general.get(this._cardKey),Player.inst.hasEnoughFeat(t.honorPrice)?(e={Type:pb.BuyRebornGoodsArg.GoodsType.Card,GoodsID:this._cardKey},[4,Net.rpcCall(pb.MessageID.C2S_BUY_REBORN_GOODS,pb.BuyRebornGoodsArg.encode(e))]):(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70149)),[2]);case 1:return i=n.sent(),0==i.errcode&&(r=new Pvp.GetRewardData,r.addCards(t.cardId,1),Core.ViewManager.inst.close(ViewName.featCardInfo),Core.ViewManager.inst.open(ViewName.getRewardWnd,r),Core.EventCenter.inst.dispatchEventWith(GameEvent.BuyRebornGoods)),[2]}})})},t.prototype.openPrivInfo=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._privKey=t,Core.ViewManager.inst.open(ViewName.privInfo,t),[2]})})},t.prototype.onBuyPriv=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return t=Data.sold_priv.get(this._privKey),Player.inst.hasEnoughFame(t.famePrice)?(e={Type:pb.BuyRebornGoodsArg.GoodsType.Privilege,GoodsID:this._privKey},[4,Net.rpcCall(pb.MessageID.C2S_BUY_REBORN_GOODS,pb.BuyRebornGoodsArg.encode(e))]):(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70165)),[2]);case 1:return i=o.sent(),0==i.errcode&&(Player.inst.addPrivilege(this._privKey),r=Data.priv_config.get(this._privKey),n=new Pvp.GetRewardData,n.addOther(r.name,"reborn_"+r.icon+"_png"),Core.ViewManager.inst.close(ViewName.privInfo),Core.ViewManager.inst.open(ViewName.getRewardWnd,n),Core.EventCenter.inst.dispatchEventWith(GameEvent.BuyRebornGoods)),[2]}})})},t.prototype.openEquipInfo=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._equipKey=t,Core.ViewManager.inst.open(ViewName.rebornEquipInfo,this._equipKey,CardPool.BuyType.Reborn),[2]})})},t.prototype.onBuyEquip=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return Player.inst.hasEnoughEquipMoney()?(t={Type:pb.BuyRebornGoodsArg.GoodsType.Equip,GoodsID:this._equipKey},[4,Net.rpcCall(pb.MessageID.C2S_BUY_REBORN_GOODS,pb.BuyRebornGoodsArg.encode(t))]):(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70186)),[2]);case 1:return e=o.sent(),0==e.errcode&&(i=Data.sold_equip.get(this._equipKey),r=Equip.EquipMgr.inst.getEquipData(i.equipId),r.setEquip(i.equipId),n=new Pvp.GetRewardData,n.addOther(r.equipName,r.equipIcon),Core.ViewManager.inst.close(ViewName.rebornEquipInfo),Core.ViewManager.inst.open(ViewName.getRewardWnd,n),Core.EventCenter.inst.dispatchEventWith(GameEvent.BuyRebornGoods)),[2]}})})},t}();t.RebornMgr=i,__reflect(i.prototype,"Reborn.RebornMgr")}(Reborn||(Reborn={}));var Reward;!function(t){var e=function(){function t(){}return t.T_GOLD=0,t.T_JADE=1,t.T_CARD=2,t.T_TREASURE=3,t.T_CARD_SKIN=4,t.T_HEAD_FRAME=5,t.T_FEATS=6,t.T_PRESTIGE=7,t.T_EQUIP=8,t.T_EMOJI=9,t.T_BOWLDER=10,t.T_COMMON_SKIN=1e3,t.T_COMMON_EMOJI=1001,t.T_COMMON_HEAD_FRAME=1002,t.T_COMMON_EQUIP=1003,t.T_COMMON_CARD=1004,t}();t.RewardType=e,__reflect(e.prototype,"Reward.RewardType");var i=function(){function t(){}return t.T_BIG=0,t.T_NORMAL=1,t}();t.RewardIconSize=i,__reflect(i.prototype,"Reward.RewardIconSize");var r=function(){function t(){}return Object.defineProperty(t,"inst",{get:function(){return t._inst||(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype.getRewardIcon=function(t,r,n){if(t>=1e3)return this.getCommonRewardIcon(t,r);if(r||(r=i.T_NORMAL),t==e.T_GOLD)return"common_goldIcon_png";if(t==e.T_JADE)return"common_jadeIcon_png";if(t==e.T_BOWLDER)return"common_bowlderIcon_png";if(t==e.T_CARD)return"avatar_"+n+"_png";if(t==e.T_HEAD_FRAME)return"headframe_"+n+"_png";if(t==e.T_CARD_SKIN)return"avatar_"+n+"_png";if(t==e.T_TREASURE)return"treasure_box"+n+"_png";if(t==e.T_FEATS)return"common_honorIcon_png";if(t==e.T_PRESTIGE)return"common_fameIcon_png";if(t==e.T_EMOJI){var o=n,s=Social.EmojiMgr.inst.getEmojiTeam(o);if(s)return s.icon}},t.prototype.getCommonRewardIcon=function(t,r){return r||(r=i.T_NORMAL),t==e.T_COMMON_CARD?"common_cardIcon_png":t==e.T_COMMON_EMOJI?"common_emojiIcon_png":t==e.T_COMMON_HEAD_FRAME?"common_headFrame_png":t==e.T_COMMON_SKIN?"common_skinIcon_png":null},t}();t.RewardMgr=r,__reflect(r.prototype,"Reward.RewardMgr")}(Reward||(Reward={}));var Shop;!function(t){function e(t,e){Core.EventCenter.inst.dispatchEventWith(GameEvent.ShopFreeAvailableEv)}function i(){Net.registerRpcHandler(pb.MessageID.S2C_TRIGGER_SHOP_ADD_GOLD_ADS,e)}t.initRpc=i}(Shop||(Shop={}));var Shop;!function(t){function e(){t.initRpc();var e=Core.ViewManager.inst.registerView.bind(Core.ViewManager.inst),i=fairygui.UIPackage.createObject;e(ViewName.advipInfo,function(){var e=new t.GiftVipInfoWnd;return e.contentPane=fairygui.UIPackage.createObject(PkgName.shop,ViewName.advipInfo).asCom,e}),e(ViewName.minivipInfo,function(){var e=new t.GiftMiniVipInfoWnd;return e.contentPane=fairygui.UIPackage.createObject(PkgName.shop,ViewName.minivipInfo).asCom,e}),e(ViewName.shopView,function(){return i(PkgName.shop,ViewName.shopView,t.ShopView).asCom}),e(ViewName.shopGoldInfoWnd,function(){var e=new t.GoldInfoWnd;return e.contentPane=i(PkgName.shop,ViewName.shopGoldInfoWnd).asCom,e}),e(ViewName.shopTreasureInfoWnd,function(){var e=new t.TreasureInfoWnd;return e.contentPane=i(PkgName.shop,ViewName.shopTreasureInfoWnd).asCom,e}),e(ViewName.freeGoldInfoWnd,function(){var e=new t.FreeGoldInfoWnd;return e.contentPane=i(PkgName.shop,ViewName.freeGoldInfoWnd).asCom,e}),e(ViewName.freeJadeInfoWnd,function(){var e=new t.FreeJadeInfoWnd;return e.contentPane=i(PkgName.shop,ViewName.freeJadeInfoWnd).asCom,e}),e(ViewName.freeTreasureInfoWnd,function(){var e=new t.FreeTreasureInfoWnd;return e.contentPane=i(PkgName.shop,ViewName.freeTreasureInfoWnd).asCom,e}),e(ViewName.freeTreasureInfoFacebookWnd,function(){var e=new t.FreeTreasureInfoFacebookWnd;return e.contentPane=i(PkgName.shop,ViewName.freeTreasureInfoFacebookWnd).asCom,e}),e(ViewName.resourceGetView,function(){return i(PkgName.shop,ViewName.resourceGetView,t.GetResAniWnd).asCom})}var i=function(){function t(){this._jadeProducts=new Collection.Dictionary,this._giftProducts=new Collection.Dictionary,this._goldProducts=new Collection.Dictionary,this._treasureProducts=new Collection.Dictionary,this._treasureIdToConfigId=new Collection.Dictionary}return Object.defineProperty(t,"inst",{get:function(){return t._inst||(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype._initJadeProducts=function(){var t=this;if(this._jadeProducts.isEmpty()){var e=Payment.PayMgr.inst.getProducts();e&&e.forEach(function(e,i){i.type==Payment.ProductType.T_JADE&&t._jadeProducts.setValue(i.id,i)})}},t.prototype.getJadeProduct=function(t){return this._jadeProducts.isEmpty()&&this._initJadeProducts(),this._jadeProducts.getValue(t)},t.prototype._initGiftProducts=function(){var t=this;if(this._giftProducts.isEmpty()){var e=Payment.PayMgr.inst.getProducts();e&&e.forEach(function(e,i){i.type==Payment.ProductType.T_GIFT&&t._giftProducts.setValue(i.id,i)})}},t.prototype.getGiftProduct=function(t){return this._giftProducts.isEmpty()&&this._initGiftProducts(),this._giftProducts.getValue(t)},t.prototype._initTreasureProducts=function(){var t=this;if(this._treasureProducts.isEmpty()){var e=null;e="lzd_handjoy"==window.gameGlobal.channel?Data.sold_treasure_handjoy:Data.sold_treasure;var i=e.keys;i.forEach(function(i){var r=e.get(i),n=new Payment.TreasureProduct(r.treasureId,r);t._treasureProducts.setValue(n.id,n)})}},t.prototype.getTreasureProduct=function(t){return this._treasureProducts.isEmpty()&&this._initTreasureProducts(),this._treasureProducts.getValue(t)},t.prototype._initGoldProducts=function(){var t=this;if(this._goldProducts.isEmpty()){if("lzd_handjoy"==window.gameGlobal.channel){var e=Data.sold_gold_handjoy;e.keys.forEach(function(i){var r=e.get(i.toString()),n=new Payment.GoldProduct(i.toString(),r);t._goldProducts.setValue(n.id,n)})}else{var i=Data.sold_gold;i.keys.forEach(function(e){var r=i.get(e.toString()),n=new Payment.GoldProduct(e.toString(),r);t._goldProducts.setValue(n.id,n)})}}},t.prototype.getGoldProduct=function(t){return this._goldProducts.isEmpty()&&this._initGoldProducts(),this._goldProducts.getValue(t)},t.getProductResIconByConf=function(t){return t.bowlderPrice&&t.bowlderPrice>0?Reward.RewardMgr.inst.getRewardIcon(Reward.RewardType.T_BOWLDER):Reward.RewardMgr.inst.getRewardIcon(Reward.RewardType.T_JADE)},t.getProductResCntByConf=function(t){return t.bowlderPrice&&t.bowlderPrice>0?t.bowlderPrice:t.jadePrice},t._inst=null,t}();t.ShopMgr=i,__reflect(i.prototype,"Shop.ShopMgr"),t.init=e}(Shop||(Shop={}));var Social;!function(t){var e="p",i="pn",r="pmid",n=function(){function n(){this._STORE_KEY="chat",this._MAX_WORLD_CHAT_CNT=50,this._channelChatlets=new Collection.Dictionary,this._privateChatlets=new Collection.Dictionary,this._privateChatHintTotalNum=0,this._loadData();var t=""+Player.inst.uid;this._privateChatData=this._chatData[t][e],this._privateChatHints=this._chatData[t][i],this._privateChatMaxID=this._chatData[t][r],this._privateChatInited=!1,this._WORLD_CHAT_CD=5,this._lastWorldSendTime=0}return Object.defineProperty(n,"inst",{get:function(){return n._inst||(n._inst=new n),n._inst},enumerable:!0,configurable:!0}),n.prototype._loadData=function(){var n=""+Player.inst.uid,o=egret.localStorage.getItem(this._STORE_KEY);if(o&&""!=o){this._chatData=JSON.parse(o),this._chatData[n]||(this._chatData[n]={},this._chatData[n][e]={},this._chatData[n][i]={},this._chatData[n][r]=0);try{"number"!=typeof this._chatData[n][r]&&(this._chatData[n][r]=0)}catch(s){this._chatData[n][r]=0}var a=this._chatData[n][e],u=function(e){var i=[],r=a[e];r.forEach(function(e){var r=new t.PrivateChatlet(t.ChatChannel.PRIVATE,e);i.push(r)}),h._privateChatlets.setValue(e,i)},h=this;for(var l in a)u(l);this._chatData[n][i]||(this._chatData[n][i]={});var c=this._chatData[n][i];for(var l in c)this._privateChatHintTotalNum+=c[l];this._chatData[n][r]||(this._chatData[n][r]=0)}else this._chatData={},this._chatData[n]={},this._chatData[n][e]={},this._chatData[n][i]={},this._chatData[n][r]=0},n.prototype._saveData=function(){var t=JSON.stringify(this._chatData);console.debug("_saveData +++++ : ",t),egret.localStorage.setItem(this._STORE_KEY,t)},n.prototype.addChannelChatlet=function(t,e){return this._doChannelChatlet(t,e)},n.prototype._doChannelChatlet=function(e,i){var r=null;i.Type==pb.Chatlet.TypeEnum.Normal?r=new t.ChannelMessageChatlet(e,i):i.Type==pb.Chatlet.TypeEnum.CampaignNotice&&(r=new t.CampaignNoticeChatlet(e,i));var n=this._channelChatlets.getValue(e);return n||(n=[],this._channelChatlets.setValue(e,n)),n.push(r),r},n.prototype.addPrivateChatlets=function(e){var i=e.Uid,r=[];return e.Msgs.forEach(function(t){var i=[""+e.Uid,e.Name,e.HeadImgUrl,""+t.Time,t.Msg,e.ID,e.Name,e.HeadImgUrl,e.PvpLevel,e.HeadFrame];r.push(i)}),t.UserLocalCache.inst.setUserCountry(e.Uid,e.Country),this._doAddPrivateChatlets(i,r)},n.prototype._doAddPrivateChatlets=function(i,n){var o=this,s=[],a=""+i;this._privateChatData[a]||(this._privateChatData[a]=[]),n.forEach(function(e){o._privateChatData[a].push(e);var i=new t.PrivateChatlet(t.ChatChannel.PRIVATE,e);s.push(i),o._privateChatMaxID<i.id&&(o._privateChatMaxID=i.id)});var u=""+Player.inst.uid;this._chatData[u][e]=this._privateChatData,this._chatData[u][r]=this._privateChatMaxID,this._saveData();var h=this._privateChatlets.getValue(a);return h?this._privateChatlets.setValue(a,h.concat(s)):this._privateChatlets.setValue(a,s),s},n.prototype.drainWorldChatlets=function(t){var e=this._channelChatlets.getValue(t);return this._channelChatlets.remove(t),e||(e=[]),e},Object.defineProperty(n.prototype,"currentChatUid",{get:function(){return this._currentChatUid},set:function(t){this._currentChatUid=t},enumerable:!0,configurable:!0}),n.prototype.addPrivateHintsNum=function(t,e){if(this._currentChatUid!=t){var r=""+t;this._privateChatHints[r]||(this._privateChatHints[r]=0);var n=this._privateChatHints[r];this._privateChatHints[r]=n+e,this._privateChatHintTotalNum+=e,this._chatData[""+Player.inst.uid][i]=this._privateChatHints,this._saveData(),Core.EventCenter.inst.dispatchEventWith(GameEvent.PrivateChatHintEv,!1,t)}},n.prototype.cleanPrivateHintsNum=function(t){var e=""+t,r=this._privateChatHints[e];this._privateChatHints[e]=0,r&&(this._privateChatHintTotalNum=Math.max(0,this._privateChatHintTotalNum-r)),this._chatData[""+Player.inst.uid][i]=this._privateChatHints,this._saveData(),Core.EventCenter.inst.dispatchEventWith(GameEvent.PrivateChatHintEv,!1,t)},n.prototype.getPrivateHintsNum=function(t){if(t){var e=""+t;return this._privateChatHints[e]?this._privateChatHints[e]:0}return this._privateChatHintTotalNum},n.prototype.initPrivateChat=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this._initPrivateChat()];case 1:return t.sent(),[2]}})})},n.prototype._initPrivateChat=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r=this;return __generator(this,function(n){switch(n.label){case 0:return t={MaxID:this._privateChatMaxID},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_PRIVATE_CHAT,pb.FetchPrivateChatArg.encode(t))];case 1:return e=n.sent(),0==e.errcode&&(i=pb.PrivateChatList.decode(e.payload),i.PrivateChatItems.forEach(function(t){var e=r.addPrivateChatlets(t);r.addPrivateHintsNum(e[0].uid,e.length)}),this._privateChatInited=!0),[2]}})})},n.prototype.getPrivateChatlets=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return this._privateChatInited?[3,2]:[4,this.initPrivateChat()];case 1:i.sent(),i.label=2;case 2:return e=""+t,[2,this._privateChatlets.getValue(""+t)]}})})},n.prototype.getLatestPrivateChatlet=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getPrivateChatlets(t)];case 1:return e=i.sent(),e?[2,e[e.length-1]]:[2,null]}})})},n.prototype.getPrivateUidKeys=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._privateChatInited?[3,2]:[4,this.initPrivateChat()];case 1:t.sent(),t.label=2;case 2:return[2,this._privateChatlets.keys()]}})})},n.prototype.subscribeChat=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,n=this;return __generator(this,function(o){switch(o.label){case 0:return e={Channel:t},[4,Net.rpcCall(pb.MessageID.C2S_SUBSCRIBE_CHAT,pb.TargetChatChannel.encode(e))];case 1:return i=o.sent(),0==i.errcode?(this._channelChatlets.remove(t),r=pb.ChatList.decode(i.payload),r.Chatlets.forEach(function(e){n.addChannelChatlet(t,e)}),[2,!0]):[2,!1]}})})},n.prototype.unsubscribeChat=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return e={Channel:t},[4,Net.rpcCall(pb.MessageID.C2S_UNSUBSCRIBE_CHAT,pb.TargetChatChannel.encode(e))];case 1:return i=r.sent(),0==i.errcode?(this._channelChatlets.remove(t),[2,!0]):[2,!1]}})})},n.prototype.sendChat=function(e,i){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(o){switch(o.label){case 0:return e==t.ChatChannel.WORLD&&Date.now()/1e3-this._lastWorldSendTime<this._WORLD_CHAT_CD?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60219)),[2,!1]):(r={Channel:e,Msg:i},[4,Net.rpcCall(pb.MessageID.C2S_SEND_CHAT,pb.SendChatArg.encode(r))]);case 1:return n=o.sent(),0==n.errcode?(e==t.ChatChannel.WORLD&&(this._lastWorldSendTime=Date.now()/1e3),[2,!0]):(101==n.errcode?Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60208)):1==n.errcode?Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60123)):Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60077)),[2,!1])}})})},n.prototype.sendPrivateChat=function(t,e,i,r){return __awaiter(this,void 0,void 0,function(){var n,o,s,a;return __generator(this,function(u){switch(u.label){case 0:return n={ToUid:t,Msg:r},[4,Net.rpcCall(pb.MessageID.C2S_SEND_PRIVATE_CHAT,pb.SendPrivateChatArg.encode(n))];case 1:return o=u.sent(),0==o.errcode?(s=[""+Player.inst.uid,Player.inst.name,Player.inst.avatarUrl,""+Date.now()/1e3,r,-1,e,i,Pvp.PvpMgr.inst.getPvpLevel(),Player.inst.frameID],a=[],a.push(s),[2,this._doAddPrivateChatlets(t,a)]):(101==o.errcode&&Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60208)),[2,null])}})})},n.secToChatDate=function(t){function e(t,e){function i(t){return 10>t?"0"+t:""+t}return 0==t?Core.StringUtils.TEXT(60031)+("00:"+i(e)):12>t?i(t)+":"+i(e):12==t?i(t)+":"+i(e):i(t)+":"+i(e)}function i(t){return LanguageMgr.inst.isChineseLocale()?Core.StringUtils.TEXT(60026)+"天一二三四五六".charAt(t):["Sun","Mon.","Tues.","Wed.","Thur.","Fri.","Sat."][t]}var r=new Date(1e3*t),n=r.getFullYear(),o=r.getMonth()+1,s=r.getDate(),a=r.getDay(),u=r.getHours(),h=r.getMinutes(),l=new Date,c=l.getFullYear(),d=l.getMonth()+1,p=l.getDate(),_=l.getDay();return n==c&&o==d&&s==p?e(u,h):n==c&&o==d?p-s==1?Core.StringUtils.TEXT(60033)+(""+e(u,h)):_>a&&7>p-s?i(a)+" "+e(u,h):""+n+Core.StringUtils.TEXT(60015)+(""+o)+Core.StringUtils.TEXT(60004)+(""+s)+Core.StringUtils.TEXT(60012)+(" "+e(u,h)):""+n+Core.StringUtils.TEXT(60015)+(""+o)+Core.StringUtils.TEXT(60004)+(""+s)+Core.StringUtils.TEXT(60012)+(" "+e(u,h))},n._inst=null,n}();t.ChatMgr=n,__reflect(n.prototype,"Social.ChatMgr")}(Social||(Social={}));var Social;!function(t){var e=function(){function t(){}return t.WORLD=pb.ChatChannel.World,t.CampaignCountry=pb.ChatChannel.CampaignCountry,t.PRIVATE=t.CampaignCountry+1,t}();t.ChatChannel=e,__reflect(e.prototype,"Social.ChatChannel");var i=function(){function t(){}return t.Normal=0,t.CampaignNotice=1,t}();t.ChatType=i,__reflect(i.prototype,"Social.ChatType");var r=function(){function t(t,e){this._data=e,this._channel=t}return Object.defineProperty(t.prototype,"uid",{get:function(){return this._data[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){if(this._channel!=e.CampaignCountry)return this._data[1];var t="";return this._data[9]!=pb.CampaignJob.UnknowJob&&(t="【"+Utils.job2Text(this._data[9])+"】"),t+="【"+this._data[7],t+=this._data[8]!=pb.CampaignJob.UnknowJob?Utils.job2Text(this._data[8])+"】":"】",t+this._data[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"headUrl",{get:function(){return this._data[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"timeStamp",{get:function(){return parseInt(this._data[3])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"msg",{get:function(){return this._data[4]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._data[5]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fromName",{get:function(){return this._channel==e.PRIVATE?this._data[6]:""},set:function(t){this._channel==e.PRIVATE&&(this._data[6]=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fromHeadUrl",{get:function(){return this._data[7]||""},set:function(t){this._channel==e.PRIVATE&&(this._data[7]=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pvpLevel",{get:function(){return this._channel!=e.PRIVATE?this._data[5]||1:this._data[8]||1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frameUrl",{get:function(){var t="";return t=this._channel!=e.PRIVATE?this._data[6]:this._data[9],t&&""!=t&&void 0!=t||(t="1"),t},set:function(t){this._channel!=e.PRIVATE?this._data[6]=t:this._data[9]=t},enumerable:!0,configurable:!0}),t.prototype.isMyselfChat=function(){return this.uid==Player.inst.uid},Object.defineProperty(t.prototype,"type",{get:function(){return i.Normal},enumerable:!0,configurable:!0}),t}();t.PrivateChatlet=r,__reflect(r.prototype,"Social.PrivateChatlet",["Social.IChatlet"]);var n=function(){function t(t,e){this._channel=t,this.parseData(e.Data)}return t.prototype.parseData=function(t){this._data=pb.ChatItem.decode(t)},t.prototype.isMyselfChat=function(){return this._data.Uid==Player.inst.uid},Object.defineProperty(t.prototype,"timeStamp",{get:function(){return this._data.Time},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uid",{get:function(){return this._data.Uid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){if(this._channel==e.CampaignCountry){var t="";this._data.CountryJob!=pb.CampaignJob.UnknowJob&&(t=Utils.job2Color(this._data.CountryJob)+"【"+Utils.job2Text(this._data.CountryJob)+"】#n");var i=War.CityMgr.inst.getCity(this._data.CityID),r="";return i&&(r="【"+i.cityName),t=this._data.CityJob!=pb.CampaignJob.UnknowJob?t+Utils.job2Color(this._data.CityJob)+r+(Utils.job2Text(this._data.CityJob)+"】#n"):t+r+"】",t+this._data.Name}return this._data.Name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"headUrl",{get:function(){return this._data.HeadImgUrl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"msg",{get:function(){return this._data.Msg},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fromName",{get:function(){return this.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fromHeadUrl",{get:function(){return this.headUrl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frameUrl",{get:function(){return this._data.HeadFrame},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pvpLevel",{get:function(){return this._data.PvpLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return i.Normal},enumerable:!0,configurable:!0}),t}();t.ChannelMessageChatlet=n,__reflect(n.prototype,"Social.ChannelMessageChatlet",["Social.IChatlet"]);var o=function(){function t(t,e){this._channel=t,this.parseData(e.Data)}return t.prototype.parseData=function(t){this._data=pb.CampaignNotice.decode(t),this._noticeData=new War.NoticeData(this._data)},t.prototype.getNoticeRawData=function(){return this._data},Object.defineProperty(t.prototype,"timeStamp",{get:function(){return this._data.Time},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uid",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._noticeData.title},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"headUrl",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"msg",{get:function(){return this._noticeData.content},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._data.ID
},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fromName",{get:function(){return this.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fromHeadUrl",{get:function(){return this.headUrl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frameUrl",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pvpLevel",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return i.CampaignNotice},enumerable:!0,configurable:!0}),t.prototype.isMyselfChat=function(){return!1},t}();t.CampaignNoticeChatlet=o,__reflect(o.prototype,"Social.CampaignNoticeChatlet",["Social.IChatlet"])}(Social||(Social={}));var Social;!function(t){var e=function(){function t(t){this._isUnlock=!1,this._id=t,this._eids=[],this._eidToConfig=new Collection.Dictionary,this._teamName=null,this._icon=null}return t.prototype.addEmoji=function(t,e){this._eids.push(t),this._eidToConfig.setValue(t,e),this._teamName||(this._teamName=e.teamName),this._icon||(this._icon=e.emojiPackIcon)},Object.defineProperty(t.prototype,"isUnlock",{get:function(){return this._isUnlock},set:function(t){this._isUnlock=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"teamId",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._teamName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"icon",{get:function(){return this._icon},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emojiIds",{get:function(){return this._eids},enumerable:!0,configurable:!0}),t}();t.EmojiTeam=e,__reflect(e.prototype,"Social.EmojiTeam");var i=function(){function t(){this._emojiTeams=new Collection.Dictionary,this._initialized=!1}return Object.defineProperty(t,"inst",{get:function(){return t._inst||(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype.initEmojis=function(){return __awaiter(this,void 0,void 0,function(){var t,i,r,n=this;return __generator(this,function(o){switch(o.label){case 0:return t=Data.emoji_config.keys,t.forEach(function(t){var i=Data.emoji_config.get(t);if(i){var r=i.team;n._emojiTeams.containsKey(r)||n._emojiTeams.setValue(r,new e(r));var o=n._emojiTeams.getValue(r);o.addEmoji(t.toString(),i)}}),[4,Net.rpcCall(pb.MessageID.C2S_FETCH_EMOJI,null)];case 1:return i=o.sent(),0==i.errcode&&(r=pb.EmojiData.decode(i.payload),r.EmojiTeams.forEach(function(t){var e=n._emojiTeams.getValue(t);e&&(e.isUnlock=!0)}),this._initialized=!0),[2]}})})},t.prototype.getEmojiTeams=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t=this._emojiTeams.values(),t=t.sort(function(t,e){return t.teamId<e.teamId?-1:1}),[2,t]})})},t.prototype.getEmojiTeam=function(t){return this._emojiTeams.getValue(t)},t._inst=null,t}();t.EmojiMgr=i,__reflect(i.prototype,"Social.EmojiMgr")}(Social||(Social={}));var Social;!function(t){var e=function(){function t(t){this._uid=t.Uid,this._name=t.Name,this._pvpScore=t.PvpScore,this._pvpCamp=t.PvpCamp,this._isOnline=t.IsOnline,this._isInBattle=t.IsInBattle,this._headImgUrl=t.HeadImgUrl,this._frameUrl=t.HeadFrame,this._lastOnlineTime=t.LastOnlineTime,this._isWeChatFriend=t.IsWechatFriend}return Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"score",{get:function(){return this._pvpScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camp",{get:function(){return this._pvpCamp},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOnline",{get:function(){return this._isOnline},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isInBattle",{get:function(){return this._isInBattle},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"headImgUrl",{get:function(){return this._headImgUrl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frameUrl",{get:function(){return this._frameUrl&&""!=this._frameUrl||(this._frameUrl="1"),this._frameUrl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastOnlineTime",{get:function(){return this._lastOnlineTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isWeChatFriend",{get:function(){return this._isWeChatFriend},enumerable:!0,configurable:!0}),t.prototype.toData=function(){return{uid:this.uid,name:this.name,score:this.score,camp:this.camp,isOnline:this.isOnline,isInBattle:this.isInBattle,headImgUrl:this.headImgUrl,lastOnlineTime:this.lastOnlineTime,isWeChatFriend:this.isWeChatFriend}},t}();t.Friend=e,__reflect(e.prototype,"Social.Friend")}(Social||(Social={}));var Social;!function(t){var e=function(){function e(){Core.EventCenter.inst.addEventListener(GameEvent.InviteBattleResEv,this._onInviteResult,this),this._friends=null,this._applyNum=0}return Object.defineProperty(e,"inst",{get:function(){return e._inst||(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"friends",{get:function(){return this._friends},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"applyNum",{get:function(){return this._applyNum},set:function(t){this._applyNum=t,Core.EventCenter.inst.dispatchEventWith(GameEvent.ApplyFriendHintEv)},enumerable:!0,configurable:!0}),e.prototype.fetchFriendList=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_FETCH_FRIEND_LIST,null)];case 1:return e=o.sent(),0==e.errcode?(i=pb.FriendList.decode(e.payload),r=null,i.LastOpponent&&(r=new t.Friend(i.LastOpponent)),n=[],i.Friends.forEach(function(e){n.push(new t.Friend(e))}),n.sort(function(t,e){return t.isOnline&&!e.isOnline?-1:!t.isOnline&&e.isOnline?1:t.score>e.score?-1:1}),this._friends=n,[2,{lastOpp:r,friends:n}]):(this._friends=null,[2,null])}})})},e.prototype.fetchPlayerInfo=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return e={Uid:t},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_PLAYER_INFO,pb.TargetPlayer.encode(e))];case 1:return i=n.sent(),0==i.errcode?(r=pb.PlayerInfo.decode(i.payload),[2,r]):[2,null]}})})},e.prototype.applyAddFriend=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return e={Uid:t},[4,Net.rpcCall(pb.MessageID.C2S_ADD_FRIEND_APPLY,pb.TargetPlayer.encode(e))];case 1:return i=r.sent(),[2,0==i.errcode]}})})},e.prototype.fetchAddFriendApplies=function(t){return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_FETCH_FRIEND_APPLY_LIST,null,!t)];case 1:return e=r.sent(),0==e.errcode?(i=pb.FriendApplyList.decode(e.payload),this.applyNum=i.FriendApplys.length,[2,i]):(Core.TipsUtils.alert("fetch add friend applies error"),[2,null])}})})},e.prototype.replyAddFriendApply=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){switch(n.label){case 0:return i={Uid:t,IsAgree:e},[4,Net.rpcCall(pb.MessageID.C2S_REPLY_AFRIEND_APPLY,pb.ReplyFriendApplyArg.encode(i))];case 1:return r=n.sent(),[2,0==r.errcode]}})})},e.prototype.delFriend=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return e={Uid:t},[4,Net.rpcCall(pb.MessageID.C2S_DEL_FRIEND,pb.TargetPlayer.encode(e))];case 1:return i=r.sent(),[2,0==i.errcode]}})})},e.prototype.inviteBattle=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return e={Uid:t},[4,Net.rpcCall(pb.MessageID.C2S_INVITE_BATTLE,pb.TargetPlayer.encode(e))];case 1:return i=r.sent(),[2,0==i.errcode]}})})},e.prototype.cancelInviteBattle=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_CANCEL_INVITE_BATTLE,null)];case 1:return t=e.sent(),[2,0==t.errcode]}})})},e.prototype._onInviteResult=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return e=t.data,i=Core.ViewManager.inst.getView(ViewName.inviteWaiting),e!=pb.InviteBattleResult.InviteResult.Agree?[3,3]:i?[4,i.readyFight()]:[3,2];case 1:r.sent(),r.label=2;case 2:return[3,11];case 3:return e!=pb.InviteBattleResult.InviteResult.Refuse?[3,6]:(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60177)),i?[4,i.cancelFight()]:[3,5]);case 4:r.sent(),r.label=5;case 5:return[3,11];case 6:return e!=pb.InviteBattleResult.InviteResult.Timeout?[3,9]:(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60228)),i?[4,i.cancelFight()]:[3,8]);case 7:r.sent(),r.label=8;case 8:return[3,11];case 9:return Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60077)),i?[4,i.cancelFight()]:[3,11];case 10:r.sent(),r.label=11;case 11:return[2]}})})},e._inst=null,e}();t.FriendMgr=e,__reflect(e.prototype,"Social.FriendMgr")}(Social||(Social={}));var Social;!function(t){function e(e,i){var r=t.FriendMgr.inst.applyNum;t.FriendMgr.inst.applyNum=r+1}function i(t,e){var i=pb.FriendApplyResult.decode(e);i.IsAgree&&Core.EventCenter.inst.dispatchEventWith(GameEvent.AddFriend,!1,i.Name)}function r(e,i){var r=pb.PrivateChatItem.decode(i),n=(r.Uid,t.ChatMgr.inst.addPrivateChatlets(r));n&&t.ChatMgr.inst.addPrivateHintsNum(n[0].uid,n.length),Core.EventCenter.inst.dispatchEventWith(GameEvent.PrivateChat,!1,n)}function n(e,i){var r=pb.ChatNotify.decode(i),n=t.ChatMgr.inst.addChannelChatlet(r.Channel,r.Chat);Core.EventCenter.inst.dispatchEventWith(GameEvent.ChannelChatEv,!1,{chatlet:n,channel:r.Channel})}function o(t,e){var i=pb.BeInviteBattleArg.decode(e);Core.EventCenter.inst.dispatchEventWith(GameEvent.BeInviteBattleEv,!1,[i.Uid,i.Name])}function s(t,e){var i=pb.InviteBattleResult.decode(e);Core.EventCenter.inst.dispatchEventWith(GameEvent.InviteBattleResEv,!1,i.Result)}function a(t,e){var i=pb.TargetPlayer.decode(e);Core.EventCenter.inst.dispatchEventWith(GameEvent.DeletedByFriend,!1,i.Uid)}function u(e,i){Core.EventCenter.inst.dispatchEventWith(t.InviteDataMgr.UpdateInviteHit,!1,!0)}function h(e,i){var r=pb.UnlockEmojiArg.decode(i),n=t.EmojiMgr.inst.getEmojiTeam(r.EmojiTeam);n&&(n.isUnlock=!0)}function l(e,i){var r=pb.TargetChatChannel.decode(i);t.ChatMgr.inst.drainWorldChatlets(r.Channel),Core.EventCenter.inst.dispatchEventWith(GameEvent.UnSubscribeChatEv,!1,r.Channel)}function c(){Net.registerRpcHandler(pb.MessageID.S2C_FRIEND_APPLY_NOTIFY,e),Net.registerRpcHandler(pb.MessageID.S2C_FRIEND_APPLY_RESULT,i),Net.registerRpcHandler(pb.MessageID.S2C_PRIVATE_CHAT_NOTIFY,r),Net.registerRpcHandler(pb.MessageID.S2C_CHAT_NOTIFY,n),Net.registerRpcHandler(pb.MessageID.S2C_BE_INVITE_BATTLE,o),Net.registerRpcHandler(pb.MessageID.S2C_INVITE_BATTLE_RESULT,s),Net.registerRpcHandler(pb.MessageID.S2C_BE_DEL_FRIEND,a),Net.registerRpcHandler(pb.MessageID.S2C_WX_INVITE_SHOW_RED_DOT,u),Net.registerRpcHandler(pb.MessageID.S2C_UNLOCK_EMOJI,h),Net.registerRpcHandler(pb.MessageID.S2C_ON_UNSUBSCRIBE_CHAT,l)}t.initRpc=c}(Social||(Social={}));var Social;!function(t){function e(){t.FriendMgr.inst.fetchAddFriendApplies(!0),t.ChatMgr.inst.initPrivateChat()}function i(){t.initRpc(),Player.inst.addEventListener(Player.LoginEvt,e,null);var i=Core.ViewManager.inst.registerView.bind(Core.ViewManager.inst),r=fairygui.UIPackage.createObject;i(ViewName.social,function(){return r(PkgName.social,ViewName.social,t.SocialView)}),i(ViewName.friendInfo,function(){var e=new t.FriendInfoWnd;return e.contentPane=r(PkgName.social,ViewName.friendInfo).asCom,e}),i(ViewName.selfInfo,function(){var e=new t.SelfInfoWnd;return e.contentPane=r(PkgName.social,ViewName.selfInfo).asCom,e}),i(ViewName.applyInfo,function(){var e=new t.FriendApplyWnd;return e.contentPane=r(PkgName.social,ViewName.applyInfo).asCom,e}),i(ViewName.friendSearch,function(){var e=new t.FriendSearchWnd;return e.contentPane=r(PkgName.social,ViewName.friendSearch).asCom,e}),i(ViewName.friendOption,function(){var e=new t.FriendOptionWnd;return e.contentPane=r(PkgName.social,ViewName.friendOption).asCom,e}),i(ViewName.friendOptionList,function(){var e=new t.FriendListOptionWnd;return e.contentPane=r(PkgName.social,ViewName.friendOptionList).asCom,e}),i(ViewName.privateChatWnd,function(){var e=new t.PrivateChatWnd;return e.contentPane=r(PkgName.social,ViewName.privateChatWnd).asCom,e}),i(ViewName.privPanelWnd,function(){var e=new t.PrivPanelWnd;return e.contentPane=r(PkgName.social,ViewName.privPanelWnd).asCom,e}),i(ViewName.privView,function(){var e=new t.PrivViewWnd;return e.contentPane=r(PkgName.social,ViewName.privView).asCom,e}),i(ViewName.inviteWaiting,function(){return r(PkgName.social,ViewName.inviteWaiting,t.InviteWaitingWnd)}),i(ViewName.avatarChangeWnd,function(){var e=new t.AvatarWnd;return e.contentPane=r(PkgName.social,ViewName.avatarChangeWnd).asCom,e}),i(ViewName.inviteRewardWnd,function(){return r(PkgName.social,ViewName.inviteRewardWnd,t.InviteRewardWnd)}),i(ViewName.shareReward,function(){return r(PkgName.social,ViewName.shareReward,t.ShareRewardWnd)}),i(ViewName.shareFacebookReward,function(){return r(PkgName.social,ViewName.shareFacebookReward,t.ShareFacebookRewardWnd)})}var r=function(){function t(){this._urlTextureCache=new Collection.Dictionary,this._maxCacheSize=200}return Object.defineProperty(t,"inst",{get:function(){return t._inst||(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype.getTextureByResUrl=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,n=this;return __generator(this,function(o){switch(o.label){case 0:return this._urlTextureCache.containsKey(t)?[2,this._urlTextureCache.getValue(t)]:[3,1];case 1:if(!(t.indexOf("http")<0&&t.indexOf("https")<0))return[3,6];o.label=2;case 2:return o.trys.push([2,4,,5]),[4,RES.getResAsync(t)];case 3:return e=o.sent(),[2,e];case 4:return i=o.sent(),console.error(i),[2,null];case 5:return[3,8];case 6:return r=new egret.ImageLoader,[4,new Promise(function(e){try{var i=new egret.ImageLoader;i.addEventListener(egret.Event.COMPLETE,function(i){var r=i.currentTarget,o=new egret.Texture;o._setBitmapData(r.data),n._urlTextureCache.setValue(t,o),e(o)},n),i.crossOrigin="anonymous",i.load(t)}catch(r){console.error(r),e(null)}})];case 7:return[2,o.sent()];case 8:return[2]}})})},t}();t.SocialMgr=r,__reflect(r.prototype,"Social.SocialMgr"),t.init=i}(Social||(Social={}));var Social;!function(t){var e=function(){function t(){this._cacheKey="userLocalCache",this._loadData()}return Object.defineProperty(t,"inst",{get:function(){return t._inst||(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype._loadData=function(){var t=egret.localStorage.getItem(this._cacheKey);if(t&&""!=t){var e=JSON.parse(t);this._cacheData=e}else this._cacheData={}},t.prototype._saveData=function(){egret.localStorage.setItem(this._cacheKey,JSON.stringify(this._cacheData))},t.prototype.setUserCountry=function(t,e){var i=""+t,r=this._cacheData[i];r?r.country!=e&&(r.country=e,this._saveData()):(r={},r.country=e,this._cacheData[i]=r,this._saveData())},t.prototype.getUserCountry=function(t){if(t==Player.inst.uid)return LanguageMgr.inst.countryCode;var e=""+t,i=this._cacheData[e];return i?i.country:null},t}();t.UserLocalCache=e,__reflect(e.prototype,"Social.UserLocalCache")}(Social||(Social={}));var Campign;!function(t){var e;!function(t){}(e=t.CampaignType||(t.CampaignType={}))}(Campign||(Campign={}));var TD;!function(t){function e(){var t={Account:function(t){Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.TD_ACCOUNT,t)},onMissionBegin:function(t){Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.TD_ONMISSIONBEGIN,{mission:t})},onMissionCompleted:function(t){Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.TD_ONMISSIONCOMPLETED,{mission:t})},onMissionFailed:function(t,e){Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.TD_ONMISSIONFAILED,{mission:t,reason:e})},onItemPurchase:function(t){Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.TD_ONITEMPURCHASE,t)},onItemUse:function(t){Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.TD_ONITEMUSE,t)},onEvent:function(t,e){Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.TD_ONEVENT,{name:t,data:e})},setLevel:function(t){Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.TD_SETLEVEL,{level:t})},onPageLeave:function(){}};window.TDGA=t}function i(){window.TDGA&&Player.inst.uid&&(console.log("tdChannel="+window.gameGlobal.tdChannel),window.TDGA.Account({accountId:(window.gameGlobal.tdChannel||window.gameGlobal.channel)+"_"+Player.inst.uid.toString(),gameServer:Player.inst.serverID,accountType:1,accountName:Player.inst.name,level:Pvp.PvpMgr.inst.getPvpLevel(),loginChannel:GameAccount.inst.loginChannel}))}function r(){window.TDGA&&window.TDGA.onPageLeave()}function n(t){window.TDGA&&window.TDGA.onMissionBegin("1-"+t)}function o(t){window.TDGA&&window.TDGA.onMissionCompleted("1-"+t)}function s(t){window.TDGA&&window.TDGA.onMissionFailed("1-"+t,"")}function a(t,e,i){if(window.TDGA){var r="";i>=0&&(r=i.toString()),window.TDGA.onMissionBegin("2-"+t+"-"+e+"-"+r)}}function u(t,e,i){if(window.TDGA){var r="";i>=0&&(r=i.toString()),window.TDGA.onMissionCompleted("2-"+t+"-"+e+"-"+r)}}function h(t,e,i){if(window.TDGA){var r="";i>=0&&(r=i.toString()),window.TDGA.onMissionFailed("2-"+t+"-"+e+"-"+r,"")}}function l(t,e){window.TDGA&&window.TDGA.onMissionBegin("3-"+t+"-"+e)}function c(t,e){window.TDGA&&window.TDGA.onMissionCompleted("3-"+t+"-"+e)}function d(t,e){window.TDGA&&window.TDGA.onMissionFailed("3-"+t+"-"+e,"")}function p(t,e){window.TDGA&&window.TDGA.onItemPurchase({item:t.toString(),itemNumber:e,priceInVirtualCurrency:0})}function _(t,e){window.TDGA&&window.TDGA.onItemUse({item:t.toString(),itemNumber:e})}function g(t){var e=t.getOwnFighter(),i="camp"+e.camp,r={uid:e.uid.toString(),name:e.name};r[i]=1;for(var n=0,o=e.initHandCard;n<o.length;n++){var s=o[n];if(s){var a=s.name;"#c"==a.slice(0,2)&&(a=a.slice(3,a.length-2)),r[a+"_"+s.cardId]=1}}return r}function f(t){window.TDGA&&(window.TDGA.onMissionBegin("4"),window.TDGA.onEvent("pvpBegin",g(t)))}function m(t){if(window.TDGA){window.TDGA.onMissionCompleted("4");var e=g(t);t.isFirstHand&&(e.firstWin=1),window.TDGA.onEvent("pvpWin",e)}}function y(t){window.TDGA&&(window.TDGA.onMissionFailed("4",""),window.TDGA.onEvent("pvpLose",g(t)))}function C(){window.TDGA&&window.TDGA.Account&&(window.TDGA.Account.setLevel?window.TDGA.Account.setLevel(Pvp.PvpMgr.inst.getPvpLevel()):window.TDGA.setLevel&&window.TDGA.setLevel(Pvp.PvpMgr.inst.getPvpLevel()))}function v(t){window.TDGA&&window.TDGA.onMissionBegin("guide-"+t)}function T(t){window.TDGA&&window.TDGA.onMissionCompleted("guide-"+t)}function w(){Core.EventCenter.inst.addEventListener(GameEvent.PvpLevelChangeEv,C,null)}t.initNativeTD=e,t.Account=i,t.onPageLeave=r,t.onLevelBegin=n,t.onLevelCompleted=o,t.onLevelFailed=s,t.onCampaignBegin=a,t.onCampaignCompleted=u,t.onCampaignFailed=h,t.onCampaignDefBegin=l,t.onCampaignDefCompleted=c,t.onCampaignDefFailed=d,t.onResAdd=p,t.onResSub=_,t.onPvpBegin=f,t.onPvpCompleted=m,t.onPvpFailed=y,t.onGuideBegin=v,t.onGuideFinish=T,t.init=w}(TD||(TD={}));var Treasure;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"treasureItem",{get:function(){return this._treasureItem},set:function(t){this._treasureItem=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInit",{get:function(){return this._isInit},set:function(t){this._isInit=t},enumerable:!0,configurable:!0}),e}(egret.Event);t.TreasureEvent=e,__reflect(e.prototype,"Treasure.TreasureEvent")}(Treasure||(Treasure={}));var Treasure;!function(t){function e(e,i){var r=pb.GainTreasure.decode(i);t.TreasureMgr.inst().addTreasureWithData(r.Treasure)}function i(e,i){var r=pb.DailyTreasure.decode(i);t.TreasureMgr.inst().updateDailyTreasureWithData(r)}function r(){Net.registerRpcHandler(pb.MessageID.S2C_GAIN_TREASURE,e),Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_DAILY_TREASURE,i)}t.initRpc=r}(Treasure||(Treasure={}));var Treasure;!function(t){var e=function(){function e(t,e){this.MAX_STAR_COUNT=1e4,this.MAX_OPEN_TIME=1e5,this._id=t,this._type=e,this._config=Data.treasure_config.get(e),this._lastUpdateTime=0,this._isEffectByPrivilege=!1}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t,this._config=Data.treasure_config.get(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this._pos},set:function(t){this._pos=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"openTime",{get:function(){return this._openTime},set:function(t){this._openTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastUpdateTime",{get:function(){return this._lastUpdateTime},set:function(t){this._lastUpdateTime=t},enumerable:!0,configurable:!0}),e.prototype.getAccResCnt=function(t){return void 0===t&&(t=-1),-1==t&&(t=this._openTime),"lzd_handjoy"==window.gameGlobal.channel?Math.ceil(t/600):Math.ceil(t/300)},Object.defineProperty(e.prototype,"image",{get:function(){var t=this.getRareType();return"treasure_box"+t+"_png"},enumerable:!0,configurable:!0}),e.prototype.fireUpdateEvent=function(){var e=new t.TreasureEvent(Core.Event.UpdateTreasureEvt);e.treasureItem=this,Core.EventCenter.inst.dispatchEvent(e)},e.prototype.getName=function(){return this._config.title},Object.defineProperty(e.prototype,"isEffectByPrivilege",{get:function(){return this._isEffectByPrivilege},set:function(t){this._isEffectByPrivilege=t},enumerable:!0,configurable:!0}),e.prototype.getMinGoldCnt=function(){return this._isEffectByPrivilege&&Player.inst.hasPrivilege(Priv.TREASURE_ADD_GOLD)?Math.floor(1.1*this._config.goldMin):this._config.goldMin},e.prototype.getMaxGoldCnt=function(){return this._isEffectByPrivilege&&Player.inst.hasPrivilege(Priv.TREASURE_ADD_GOLD)?Math.floor(1.1*this._config.goldMax):this._config.goldMax},e.prototype.getMinJadeCnt=function(){return this._config.jadeMin},e.prototype.getMaxJadeCnt=function(){return this._config.jadeMax},e.prototype.getCardNum=function(){return this._isEffectByPrivilege&&Player.inst.hasPrivilege(Priv.TREASURE_ADD_CARD)?this._config.cardCnt+2:this._config.cardCnt},e.prototype.getSkinNum=function(){var t=this._config.skin;return t.length>0?t.length:0},e.prototype.getHeadFrameNum=function(){var t=this._config.headFrame;return t.length>0?t.length:0},e.prototype.getEmojiNum=function(){var t=this._config.emojis;return t.length>0?t.length:0},e.prototype.getRareType=function(){return this._config.rare},e.prototype.getTeamType=function(){return this._config.team},e.prototype.getOpenNeedTime=function(){return this._config.reward_unlockTime},e.prototype.getNewCardNum=function(){var t=this.getTeamType();if(1==t)return 0;var e=this.getRareType();return 3==e?1:4==e?2:0},e.prototype.getCardstar1Num=function(){return this._config.cardStar1},e.prototype.getCardstar2Num=function(){return this._config.cardStar2},e.prototype.getCardstar3Num=function(){return this._config.cardStar3},e.prototype.getCardstar4Num=function(){return this._config.cardStar4},e.prototype.getCardstar5Num=function(){return this._config.cardStar5},e.prototype.getRareCardNum=function(){var t=0;return t=this._config.cardStar5+this._config.cardStar4+this._config.cardStar3},e.prototype.isActivating=function(){return this._openTime>0&&this._openTime<this.MAX_OPEN_TIME},e.prototype.canActivate=function(){return this._openTime>this.MAX_OPEN_TIME},e.prototype.getAccResType=function(){return"lzd_handjoy"==window.gameGlobal.channel?ResType.T_BOWLDER:ResType.T_JADE},e.prototype.getAccResIcon=function(){var t=this.getAccResType();return Utils.resType2Icon(t)},e.prototype.hasEnoughResToAcc=function(t){var e=this.getAccResType();return e==ResType.T_JADE?Player.inst.hasEnoughJade(t):Player.inst.hasEnoughBowlder(t,!0)},e.prototype.askSubAccRes=function(t,e){return void 0===e&&(e=!0),__awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return i=this.getAccResType(),i!=ResType.T_JADE?[3,1]:Player.inst.hasEnoughJade(t)?[2,!0]:(e&&Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60085)),[2,!1]);case 1:return[4,Player.inst.askSubBowlder(t)];case 2:return r.sent()?[2,!0]:(e&&Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60278)),[2,!1]);case 3:return[2]}})})},e.prototype.canOpen=function(){return this._openTime<0?!1:0==this._openTime},e}();t.TreasureItem=e,__reflect(e.prototype,"Treasure.TreasureItem");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"openStarCount",{get:function(){return this._openStarCount},set:function(t){this._openStarCount=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOpen",{get:function(){return this._isOpen},set:function(t){this._isOpen=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextTime",{get:function(){return this._nextTime},set:function(t){this._nextTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDouble",{get:function(){return this._isDouble},set:function(t){this._isDouble=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalStarCount",{get:function(){return this._config.daily_unlockstar},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalQuestCount",{get:function(){return this._config.quest_unlockCnt},enumerable:!0,configurable:!0}),e.prototype.canOpen=function(){return this._openStarCount<=0},e}(e);t.DailyTreasureItem=i,__reflect(i.prototype,"Treasure.DailyTreasureItem")}(Treasure||(Treasure={}));var Treasure;!function(t){function e(){t.initRpc(),Player.inst.addEventListener(Player.LogoutEvt,i.inst().initData,i.inst());var e=Core.ViewManager.inst.registerView.bind(Core.ViewManager.inst),r=fairygui.UIPackage.createObject;e(ViewName.treasureInfo,function(){var e=new t.TreasureInfoWnd;return e.contentPane=r(PkgName.treasure,ViewName.treasureInfo).asCom,e}),e(ViewName.dailyTreasureInfo,function(){var e=new t.DailyTreasureInfoWnd;return e.contentPane=r(PkgName.pvp,ViewName.dailyTreasureInfo).asCom,e}),e(ViewName.dailyTreasureDouble,function(){var e=new t.DailyTreasureDoubleWnd;return e.contentPane=r(PkgName.pvp,ViewName.dailyTreasureDouble).asCom,e}),e(ViewName.treasureRewardInfo,function(){return r(PkgName.treasure,ViewName.treasureRewardInfo,t.TreasureRewardView).asCom}),e(ViewName.treasureRewardResult,function(){return r(PkgName.treasure,ViewName.treasureRewardResult,t.TreasureRewardResultView).asCom}),e(ViewName.advertAddTreasureCardWnd,function(){var e=new t.AdvertAddTreasureCardWnd;return e.contentPane=r(PkgName.common,ViewName.advertAddTreasureCardWnd).asCom,e})}var i=function(){function e(){this.initData()}return e.inst=function(){return e._inst||(e._inst=new e),e._inst},e.prototype.initData=function(){this._treasureItems=new Collection.Dictionary,this._dailyTreasureItem=null,this._curActivatingTreasure=null},Object.defineProperty(e.prototype,"curActivatingTreasure",{get:function(){return this._curActivatingTreasure},enumerable:!0,configurable:!0}),e.prototype._fireEvent=function(e,i,r){void 0===r&&(r=!1);var n=new t.TreasureEvent(e);n.treasureItem=i,n.isInit=r,Core.EventCenter.inst.dispatchEvent(n)},e.prototype.addTreasure=function(t,e){return void 0===e&&(e=!1),this._treasureItems.setValue(t.id,t),this._fireEvent(Core.Event.AddTreasureEvt,t,e),t.isActivating()&&(this._curActivatingTreasure=t),!0},e.prototype.updateDailyTreasureWithData=function(e){var i=new t.DailyTreasureItem(e.ID,e.ModelID);return i.isOpen=e.IsOpen,i.nextTime=e.NextTime,i.openStarCount=e.OpenStarCount,i.isDouble=e.IsDouble,this._dailyTreasureItem=i,this._fireEvent(Core.Event.UpdateDailyTreasureEvt,i),!0},e.prototype.addTreasureWithData=function(e,i){void 0===i&&(i=!1);var r=new t.TreasureItem(e.ID,e.ModelID);return r.pos=e.Pos,r.openTime=e.OpenTimeout,r.isEffectByPrivilege=!0,this.addTreasure(r,i)?r:null},e.prototype.popTreasure=function(t){var e=this._treasureItems.getValue(t);return e&&(this._fireEvent(Core.Event.DelTreasureEvt,e),this._treasureItems.remove(t),this._fireEvent(Core.Event.UpdateTreasureEvt,null)),e},e.prototype.getTreasure=function(t){return this._treasureItems.containsKey(t)?this._treasureItems.getValue(t):null},e.prototype.getDailyTreasure=function(){return this._dailyTreasureItem},e.prototype.onTreasureCountDownDone=function(t){this._treasureItems.forEach(function(t,e){e.canActivate}),this._curActivatingTreasure=null},e.prototype.resCurActivatingTreasure=function(){var t=this;this._curActivatingTreasure=null,this._treasureItems.forEach(function(e,i){i.isActivating()&&(t._curActivatingTreasure=i)})},e.prototype.openTreasure=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o=this;return __generator(this,function(s){switch(s.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_OPEN_TREASURE,pb.OpenTreasureArg.encode({TreasureID:e}))];case 1:return i=s.sent(),0!=i.errcode?[2,null]:(r=pb.OpenTreasureReply.decode(i.payload),r.OK?(n=new t.TreasureReward,n.gold=r.GoldAmount,n.jade=r.Jade,r.CardIDs.forEach(function(t){n.addCardId(t)}),r.CardSkins.forEach(function(t){n.addSkinId(t)}),r.EmojiTeams.forEach(function(t){n.addEmojiTeamId(t)}),r.Headframes.forEach(function(t){n.addHeadFrame(t)}),n.shareId=r.ShareHid,r.CanWatchAddCardAds?[4,new Promise(function(t){Core.ViewManager.inst.open(ViewName.advertAddTreasureCardWnd,e,function(i,r,s){return void 0===s&&(s=0),__awaiter(o,void 0,void 0,function(){var o,a,u;return __generator(this,function(h){switch(h.label){case 0:return i?(o={TreasureID:e,IsConsumeJade:r},[4,Net.rpcCall(pb.MessageID.C2S_WATCH_TREASURE_ADD_CARD_ADS,pb.WatchTreasureAddCardAdsArg.encode(o))]):[3,2];case 1:return a=h.sent(),0==a.errcode&&(u=pb.WatchTreasureAddCardAdsReply.decode(a.payload),n.addAllCardByAmount(u.AddCardAmount)),[3,3];case 2:s>0&&n.addAllCardByAmount(s),h.label=3;case 3:return t(),[2]}})})})})]:[3,3]):[2,null]);case 2:s.sent(),s.label=3;case 3:return[2,n]}})})},e.prototype.activateTreasure=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return this._curActivatingTreasure?[2,!1]:[4,Net.rpcCall(pb.MessageID.C2S_ACTIVATE_REWARD_TREASURE,pb.ActivateRewardTreasureArg.encode({TreasureID:t}))];case 1:return e=o.sent(),0!=e.errcode?[2,!1]:(i=pb.ActivateRewardTreasureReply.decode(e.payload),r=i.OK,r&&(n=this.getTreasure(t),n&&(n.openTime=i.OpenTimeout,this._curActivatingTreasure=n)),[2,r])}})})},e.prototype.fetchTreasures=function(t){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n=this;return __generator(this,function(o){switch(o.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_GET_TREASURES,null)];case 1:return t=o.sent(),e=[],0!=t.errcode?[2,e]:(i=pb.GetTreasuresReply.decode(t.payload),i.Treasures.forEach(function(t){var i=n.addTreasureWithData(t,!0);i&&e.push(i)}),r=i.DailyTreasure1,r&&this.updateDailyTreasureWithData(r),[2,e])}})})},e._inst=null,e}();t.TreasureMgr=i,__reflect(i.prototype,"Treasure.TreasureMgr"),t.init=e}(Treasure||(Treasure={}));var Treasure;!function(t){var e=function(){function e(){this._cardIds=new Collection.Dictionary,this._skinIds=new Collection.Dictionary,this._emojiIds=new Collection.Dictionary,this._headFrames=new Collection.Dictionary,this._shareId=0,this._gold=0,this._jade=0
}return Object.defineProperty(e.prototype,"gold",{get:function(){return this._gold},set:function(t){this._gold=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"jade",{get:function(){return this._jade},set:function(t){this._jade=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cardIds",{get:function(){return this._cardIds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skinIds",{get:function(){return this._skinIds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emojiIds",{get:function(){return this._emojiIds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"headFrames",{get:function(){return this._headFrames},enumerable:!0,configurable:!0}),e.prototype.addCardId=function(t){if(this._cardIds.containsKey(t)){var e=this._cardIds.getValue(t);this._cardIds.setValue(t,e+1)}else this._cardIds.setValue(t,1)},e.prototype.addSkinId=function(t){if(this._skinIds.containsKey(t)){var e=this._skinIds.getValue(t);this._skinIds.setValue(t,e+1)}else this._skinIds.setValue(t,1)},e.prototype.addEmojiTeamId=function(t){if(this._emojiIds.containsKey(t)){var e=this._emojiIds.getValue(t);this._emojiIds.setValue(t,e+1)}else this._emojiIds.setValue(t,1)},e.prototype.addHeadFrame=function(t){if(this._headFrames.containsKey(t)){var e=this._headFrames.getValue(t);this._headFrames.setValue(t,e+1)}else this._headFrames.setValue(t,1)},e.prototype.addAllCardByAmount=function(t){var e=this,i=this._cardIds.keys();i.forEach(function(i){var r=e._cardIds.getValue(i);r+=t,e._cardIds.setValue(i,r)})},Object.defineProperty(e.prototype,"shareId",{get:function(){return this._shareId},set:function(t){this._shareId=t},enumerable:!0,configurable:!0}),e.genRewardItemComsByTreasure=function(e){var i=[],r=e.getMinGoldCnt();if(r>0){var n=fairygui.UIPackage.createObject(PkgName.treasure,"rewardItem",t.TreasureRewardItemCom).asCom;n.setRewardInfo(Reward.RewardType.T_GOLD,r,e.getMaxGoldCnt()),i.push(n)}var o=e.getMinJadeCnt();if(o>0){var n=fairygui.UIPackage.createObject(PkgName.treasure,"rewardItem",t.TreasureRewardItemCom).asCom;n.setRewardInfo(Reward.RewardType.T_JADE,o,e.getMaxJadeCnt()),i.push(n)}var s=e.getCardNum();if(s>0){var n=fairygui.UIPackage.createObject(PkgName.treasure,"rewardItem",t.TreasureRewardItemCom).asCom;n.setRewardInfo(Reward.RewardType.T_COMMON_CARD,s),i.push(n)}var a=e.getSkinNum();if(a>0){var n=fairygui.UIPackage.createObject(PkgName.treasure,"rewardItem",t.TreasureRewardItemCom).asCom;n.setRewardInfo(Reward.RewardType.T_COMMON_SKIN,a),i.push(n)}var u=e.getHeadFrameNum();if(u>0){var n=fairygui.UIPackage.createObject(PkgName.treasure,"rewardItem",t.TreasureRewardItemCom).asCom;n.setRewardInfo(Reward.RewardType.T_COMMON_HEAD_FRAME,u),i.push(n)}var h=e.getEmojiNum();if(h>0){var n=fairygui.UIPackage.createObject(PkgName.treasure,"rewardItem",t.TreasureRewardItemCom).asCom;n.setRewardInfo(Reward.RewardType.T_COMMON_EMOJI,h),i.push(n)}return i},e}();t.TreasureReward=e,__reflect(e.prototype,"Treasure.TreasureReward")}(Treasure||(Treasure={}));var War;!function(t){var e=function(){function t(){}return t.CAPITAL=1,t.CITY=2,t.PORT=3,t.BARRIER=4,t.STRONGHOLD=5,t}();t.CityType=e,__reflect(e.prototype,"War.CityType");var i=function(){function e(t){this._id=t,this._conf=Data.city.get(t),this._type=parseInt(this._conf.type),this._initCoord()}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roads",{get:function(){return this._roads},enumerable:!0,configurable:!0}),e.prototype._initCoord=function(){var t=this._conf.coord,e=t.split(":");this._x=parseInt(e[0]),this._y=parseInt(e[1])},e.prototype.initRoads=function(){var e=this;this._roads=new Collection.Dictionary;var i=t.Road.genRoadsByCity(this._id);i?i.forEach(function(t){e._roads.setValue(t.toCityId,t)}):console.error("initRoads no road for city ",this._id)},e}();t.CityMeta=i,__reflect(i.prototype,"War.CityMeta");var r=function(e){function r(t){var i=e.call(this)||this;i._defence=0,i.setDelegateHost(i),i._cityID=t;var r=Data.city.get(t);i._cityName=r.name,i._defenceMax=r.defense_max,i._agricultureMax=r.agriculture_max,i._businessMax=r.business_max,i._citySkill=r.castle[0];var n=r.coord.split(","),o=new egret.Point(parseInt(n[0]),parseInt(n[1]));return i._cityPoint=o,i._countryID=0,i._defPlayerNum=0,i._inCityPlayerNum=0,i._militaryOrderInfo=[],i}return __extends(r,e),r.prototype.initMeta=function(){this._neighbors=new Collection.Dictionary,this._cityMeta=new i(this._cityID),this._cityMeta.initRoads()},r.prototype.initCom=function(){var e=fairygui.UIPackage.createObject(PkgName.war,"cityItem").asCom;t.WarMgr.inst.warView.map.addChild(e),this._cityCom=e,this._cityCom.setCity(this),t.WarMgr.inst.inStatus(t.BattleStatusName.ST_DURING)&&this._cityCom.setCityInWarMode(!0)},r.prototype.setCitySimpleData=function(e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return this.countryID=e.CountryID,this.defence=e.Defense,[4,this.updateStatus(e.State)];case 1:return r.sent(),i=t.CountryMgr.inst.getCountry(e.CountryID),i.addCity(this),[2]}})})},r.prototype.updateStatus=function(e){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return e!=pb.CityState.NormalCS?[3,2]:[4,this.changeStatus.apply(this,[t.CityStatusName.ST_NORMAL,-1].concat(i))];case 1:return r.sent(),[3,6];case 2:return e!=pb.CityState.BeAttackCS?[3,4]:[4,this.changeStatus.apply(this,[t.CityStatusName.ST_ATTACKED,-1].concat(i))];case 3:return r.sent(),[3,6];case 4:return e!=pb.CityState.BeOccupyCS?[3,6]:[4,this.changeStatus.apply(this,[t.CityStatusName.ST_FALLEN,-1].concat(i))];case 5:r.sent(),r.label=6;case 6:return[2]}})})},r.prototype.setCityData=function(e){var i=this;this._players=new Array,this._applyPlayers=new Array,this.countryID=e.CountryID,this._country=t.CountryMgr.inst.getCountry(this._countryID),this.playerNum=e.PlayerAmount,this.agriculture=e.Agriculture,this.business=e.Business,this.defence=e.Defense,this.forage=e.Forage,this.gold=e.Gold,this.glory=e.Glory,this.yourMajesty=e.YourMajesty,this._createTime=0,this._inCityPlayerNum=e.InCityPlayerAmount,e.ApplyCreateCountry&&(this._createTime=e.ApplyCreateCountry.RemainTime,e.ApplyCreateCountry.Players.forEach(function(t){i._applyPlayers.push(t)})),e.Players.forEach(function(e){var r=new t.CampaignPlayer(e);i._players.push(r)}),this._playersSort()},r.prototype._playersSort=function(){this._players.sort(function(t,e){return t.employee.cityJob.isSameJob(Job.UnknowJob)?1:t.employee.cityJob.type-e.employee.cityJob.type})},r.prototype.checkBorderCity=function(){for(var t=this.getNeighbors(),e=0,i=t;e<i.length;e++){var r=i[e];if(!this.isSameCamp(r))return this._isBorderCity=!0,!0}return this._isBorderCity=!1,!1},r.prototype.getNeighborIds=function(){return this._cityMeta.roads.keys()},r.prototype.getNeighbors=function(){return this._neighbors.values()},r.prototype.getNeighborDic=function(){return this._neighbors},r.prototype.getNeighborEnemyCity=function(){var e=this,i=[];return this._neighbors.forEach(function(r,n){e._countryID==n.countryID||n.inStatus(t.CityStatusName.ST_FALLEN)||i.push(r)}),i},r.prototype.addNeighbor=function(t){this._neighbors.setValue(t.cityID,t)},r.prototype.isSameCamp=function(t){return this._countryID==t._countryID},r.prototype.getAdjCityDayno=function(t){var e=t.cityID;if(this._cityMeta.roads.containsKey(e)){var i=this._cityMeta.roads.getValue(e);return i.dayno}return Number.MAX_VALUE},r.prototype.hasCounty=function(){return this._countryID&&0!=this._countryID?!0:!1},r.prototype.getLord=function(){for(var t=0;t<this._players.length;t++)return this._players[t].employee.hasSameJob(Job.Prefect)?this._players[t]:!1},r.prototype.updatePlayer=function(t,e){this.removePlayer(e),this.addPlayer(t)},r.prototype.addPlayer=function(t){for(var e=this._players,i=0;i<e.length;i++)if(e[i].uID==t.uID){e.splice(i,1);break}e.push(t),this.players=e},r.prototype.removePlayer=function(t){for(var e=this.players,i=0;i<e.length;i++)e[i].uID==t&&e.splice(i,1);this.players=e},r.prototype.getMsRes=function(t){switch(t){case WarMsType.Build:return this._defence;case WarMsType.Trade:return this._business;case WarMsType.Irrigation:return this._agriculture;default:return 0}},r.prototype.getMsResMax=function(t){switch(t){case WarMsType.Build:return this._defenceMax;case WarMsType.Trade:return this._businessMax;case WarMsType.Irrigation:return this._agricultureMax;default:return 0}},r.prototype.getRoad=function(t){var e=this._cityMeta.roads;return e.getValue(t.cityID)},r.prototype.setHead=function(t){this._cityCom.setHead(t)},Object.defineProperty(r.prototype,"cityCom",{get:function(){return this._cityCom},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cityID",{get:function(){return this._cityID},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cityName",{get:function(){return this._cityName},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cityPoint",{get:function(){return this._cityPoint},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"countryID",{get:function(){return this._countryID},set:function(t){this._countryID=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"country",{get:function(){return this._country},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"defenceMax",{get:function(){return this._defenceMax},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"businessMax",{get:function(){return this._businessMax},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"agricultureMax",{get:function(){return this._agricultureMax},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"playerNum",{get:function(){return this._playerNum},set:function(t){this._playerNum=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"defPlayerNum",{get:function(){return this._defPlayerNum},set:function(t){this._defPlayerNum=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inCityPlayerNum",{get:function(){return this._inCityPlayerNum},set:function(t){this._inCityPlayerNum=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"defence",{get:function(){return this._defence},set:function(t){this._defence=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"business",{get:function(){return this._business},set:function(t){this._business=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"agriculture",{get:function(){return this._agriculture},set:function(t){this._agriculture=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"glory",{get:function(){return this._glory},set:function(t){this._glory=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"forage",{get:function(){return this._forage},set:function(t){this._forage=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"foragePrice",{get:function(){return this._foragePrice},set:function(t){this._foragePrice=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isBeAttack",{get:function(){return this._isBeAttack},set:function(t){this._isBeAttack=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"gold",{get:function(){return this._gold},set:function(t){this._gold=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"players",{get:function(){return this._players},set:function(t){this._players=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"applyPlayers",{get:function(){return this._applyPlayers},set:function(t){this._applyPlayers=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isBorderCity",{get:function(){return this._isBorderCity},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"createTime",{get:function(){return this._createTime},set:function(t){this._createTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"skillName",{get:function(){return Data.skill.get(this._citySkill).name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"skillDesc",{get:function(){var t=parse2html(Data.skill.get(this._citySkill).desTra).toString();return t&&""!=t?t:""},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"skillLinkText",{get:function(){var t='<a href="event:skill,'+this._citySkill+'"><u>'+Data.skill.get(this._citySkill).name+"</u></a>";return t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"yourMajesty",{get:function(){return this._yourMajesty},set:function(t){this._yourMajesty=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"militaryOrderInfo",{get:function(){return this._militaryOrderInfo},set:function(t){this._militaryOrderInfo=t},enumerable:!0,configurable:!0}),r.prototype.onDestroy=function(){this._cityCom&&(this._cityCom.onDestroy(),this._cityCom=null),this.resetToNoneStatus()},r.PropGold="gold",r.PropForage="forage",r.PropGlory="glory",r.PropAgriculture="agriculture",r.PropDefence="defence",r.PropBusiness="business",r.PropPlayers="players",r.PropApplyPlayer="applyPlayers",r.PropCountry="countryID",r.PropPlayerNum="playerNum",r.PropDefPlayerNum="defPlayerNum",r.PropMilitaryOrderInfo="militaryOrderInfo",r.PropYouMajesty="yourMajesty",r}(t.CityStatusDelegate);t.City=r,__reflect(r.prototype,"War.City")}(War||(War={}));var War;!function(t){var e=function(){function e(){this._myCity=null,this._cityList=new Collection.Dictionary,this._myCityList=new Collection.Dictionary,this._enemyCityList=new Collection.Dictionary,this._reachableCityIds=[]}return Object.defineProperty(e,"inst",{get:function(){return e._inst||(e._inst=new e,e._inst.initCityMgr()),e._inst},enumerable:!0,configurable:!0}),e.prototype.initCityMgr=function(){return __awaiter(this,void 0,void 0,function(){var e,i=this;return __generator(this,function(r){return this._cityList.isEmpty()?(e=Data.city.keys,this._cityList=new Collection.Dictionary,this._adjacencyMatrix=new Util.DjAdjacencyMatrix(e.length+1),this._dijkstraDistances=new Collection.Dictionary,e.forEach(function(e){var r=new t.City(e);i._cityList.setValue(e,r)}),this._cityList.forEach(function(t,e){e.initMeta();for(var r=e.getNeighborIds(),n=0,o=r;n<o.length;n++){var s=o[n],a=i._cityList.getValue(s);e.addNeighbor(a)}}),[2]):[2]})})},e.prototype.setAllCity=function(t){var e=new Collection.Dictionary;t.forEach(function(t){e.setValue(t.CityID,t)}),this._cityList.forEach(function(t,i){var r=e.getValue(t);r&&i.setCitySimpleData(r),i.checkBorderCity(),i.initCom()})},e.prototype.setAllCityDefPlayers=function(t){var e=this;t&&t.Amounts.forEach(function(t){var i=e.getCity(t.CityID);i.defPlayerNum=t.Amount})},e.prototype.getAllCities=function(){return this._cityList.values()},e.prototype.updateCityCamp=function(t,e){var i=this._cityList.getValue(t);i.countryID=e,i.checkBorderCity(),i.getNeighbors().forEach(function(t){t.checkBorderCity()})},e.prototype.updateCityPlayerNum=function(t,e){this._cityList.getValue(t).playerNum=e},e.prototype.getShortestPathBetweenCityForBattle=function(t,e){var i=t.cityID,r=e.cityID,n=this.getReachableCityIds();if(this._adjacencyMatrix.reset(),!this._adjacencyMatrix.initialized)for(var o=0,s=n;o<s.length;o++)for(var a=s[o],u=this.getCity(a),h=0,l=n;h<l.length;h++){var c=l[h],d=this.getCity(c);this._adjacencyMatrix.addAdjacentPoint(a,c,u.getAdjCityDayno(d))}this._dijkstraDistances.containsKey(i)||this._dijkstraDistances.setValue(i,Util.Dijkstra(this._adjacencyMatrix,i));var p=this._dijkstraDistances.getValue(i);return p[r].value==Number.MAX_VALUE?[]:p[r].path},e.prototype.getShortestPathBetweenCityForTransport=function(t,e){var i=this.getTransportCityIds();return this._getShortestPathBetweenCity(t,e,i)},e.prototype.getShortestPathBetweenCityForSupportFight=function(e,i){var r=[];if(0!=e.countryID){var n=t.CountryMgr.inst.getCountry(e.countryID);if(n){var o=n.cityList.keys();r=this._getShortestPathBetweenCity(e,i,o)}}return r},e.prototype.getShortestPathBetweenCityForAttack=function(t,e){var i=[],r=[t.cityID,e.cityID];return i=this._getShortestPathBetweenCity(t,e,r)},e.prototype._getShortestPathBetweenCity=function(t,e,i){var r=t.cityID,n=e.cityID;if(this._adjacencyMatrix.reset(),this._dijkstraDistances.clear(),!this._adjacencyMatrix.initialized)for(var o=0,s=i;o<s.length;o++)for(var a=s[o],u=this.getCity(a),h=0,l=i;h<l.length;h++){var c=l[h],d=this.getCity(c);this._adjacencyMatrix.addAdjacentPoint(a,c,u.getAdjCityDayno(d))}this._dijkstraDistances.containsKey(r)||this._dijkstraDistances.setValue(r,Util.Dijkstra(this._adjacencyMatrix,r));var p=this._dijkstraDistances.getValue(r);return p[n].value==Number.MAX_VALUE?[]:p[n].path},e.prototype.getReachableCityIds=function(){if(this._reachableCityIds.length<=0){for(var e=t.CountryMgr.inst.getCountry(t.MyWarPlayer.inst.countryID),i=e.cityList.keys(),r=new Collection.Dictionary,n=0,o=i;n<o.length;n++){var s=o[n],a=e.cityList.getValue(s);if(a&&a.isBorderCity)for(var u=a.getNeighbors(),h=0,l=u;h<l.length;h++){var c=l[h];c.isSameCamp(a)||r.setValue(c.cityID,!0)}}this._reachableCityIds=i.concat(r.keys())}return this._reachableCityIds},e.prototype.getTransportCityIds=function(){return this._cityList.keys()},e.prototype.getCity=function(t){return this._cityList.getValue(t)},e.prototype.getToCityPoint=function(t){return this._cityList.containsKey(t)||(t=1),this._cityList.getValue(t).cityPoint},e.prototype.setCitySelectMode=function(t,e){var i=this;t.forEach(function(t){i.getCity(t).cityCom.setCitySelectMode(e)})},e.prototype.onDestroy=function(){this._myCity=null,this._cityList.forEach(function(t,e){e.onDestroy()}),this._myCityList.clear(),this._enemyCityList.clear(),this._reachableCityIds=[],this._adjacencyMatrix.reset(),this._dijkstraDistances.clear()},e}();t.CityMgr=e,__reflect(e.prototype,"War.CityMgr")}(War||(War={}));var War;!function(t){var e=function(){function t(){}return t.job2Desc=function(e){return t.job2BattleRwdDesc(e)+", "+t.job2GoldRwdDesc(e)},t.job2BattleRwdDesc=function(t){switch(t){case Job.UnknowJob:return"";case Job.YourMajesty:return Core.StringUtils.format(Core.StringUtils.TEXT(70336),100*Data.parameter.get("king_per").para_value[0]);case Job.Counsellor:return Core.StringUtils.format(Core.StringUtils.TEXT(70336),100*Data.parameter.get("junshi_per").para_value[0]);case Job.General:return Core.StringUtils.format(Core.StringUtils.TEXT(70336),100*Data.parameter.get("zhonglangjiang_per").para_value[0]);case Job.Prefect:return Core.StringUtils.format(Core.StringUtils.TEXT(70337),100*Data.parameter.get("taishou_per").para_value[0]);case Job.DuWei:return Core.StringUtils.format(Core.StringUtils.TEXT(70337),100*Data.parameter.get("duwei_per").para_value[0]);case Job.FieldOfficer:return Core.StringUtils.format(Core.StringUtils.TEXT(70337),100*Data.parameter.get("xiaowei_per").para_value[0])}},t.job2GoldRwdDesc=function(t){switch(t){case Job.UnknowJob:return"";case Job.YourMajesty:return Core.StringUtils.format(Core.StringUtils.TEXT(70338),100*Data.parameter.get("king_salary").para_value[0]);case Job.Counsellor:return Core.StringUtils.format(Core.StringUtils.TEXT(70338),100*Data.parameter.get("junshi_salary").para_value[0]);case Job.General:return Core.StringUtils.format(Core.StringUtils.TEXT(70338),100*Data.parameter.get("zhonglangjiang_salary").para_value[0]);case Job.Prefect:return Core.StringUtils.format(Core.StringUtils.TEXT(70339),100*Data.parameter.get("taishou_salary").para_value[0]);case Job.DuWei:return Core.StringUtils.format(Core.StringUtils.TEXT(70339),100*Data.parameter.get("duwei_salary").para_value[0]);case Job.FieldOfficer:return Core.StringUtils.format(Core.StringUtils.TEXT(70339),100*Data.parameter.get("xiaowei_salary").para_value[0])}},t}();t.Const=e,__reflect(e.prototype,"War.Const")}(War||(War={}));var War;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i.setDelegateHost(i),i._countryID=t.CountryID,i._countryName=t.Name,i._countryFlagUrl=t.Flag,i._cityList=new Collection.Dictionary,i._players=new Array,i}return __extends(i,e),i.prototype.setCountryPlayers=function(e){var i=this;this._players=new Array,e.forEach(function(e){var r=new t.CampaignPlayer(e);i._players.push(r)}),this._playersSort()},i.prototype._playersSort=function(){this._players.sort(function(t,e){return t.employee.countryJob.isSameJob(Job.UnknowJob)?1:t.employee.countryJob.type-e.employee.countryJob.type})},i.prototype.getMaster=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){for(t=0;t<this._players.length;t++)if(this._players[t].employee.hasSameJob(Job.YourMajesty))return[2,this._players[t]];return[2]})})},i.prototype.updatePlayer=function(t,e){this.removePlayer(e),this.addPlayer(t)},i.prototype.addPlayer=function(t){for(var e=this._players,i=0;i<e.length;i++)if(e[i].uID==t.uID){e.splice(i,1);break}e.push(t),this.players=e},i.prototype.removePlayer=function(t){for(var e=this._players,i=0;i<e.length;i++)e[i].uID==t&&e.splice(i,1);this.players=e},Object.defineProperty(i.prototype,"countryID",{get:function(){return this._countryID},set:function(t){this._countryID=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"countryName",{get:function(){return this._countryName},set:function(t){this._countryName=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"countryFlag",{get:function(){return this._countryFlagUrl&&""!=this._countryFlagUrl||(this._countryFlagUrl="0"),"war_flag"+this._countryFlagUrl+"_png"},set:function(t){this._countryFlagUrl=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"countryFlagID",{get:function(){return this._countryFlagUrl},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"players",{get:function(){return this._players},set:function(t){this._players=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cityList",{get:function(){return this._cityList},enumerable:!0,configurable:!0}),i.prototype.addCity=function(t){this._cityList.setValue(t.cityID,t)},i.prototype.addCityID=function(e){var i=t.CityMgr.inst.getCity(e);this.addCity(i)},i.prototype.delCity=function(t){this._cityList.containsKey(t.cityID)&&this._cityList.remove(t.cityID)},i.PropFlag="countryFlag",i.PropCampName="countryName",i.PropPlayers="players",i}(t.CountryStatusDelegate);t.Country=e,__reflect(e.prototype,"War.Country")}(War||(War={}));var War;!function(t){var e=function(){function e(){}return Object.defineProperty(e,"inst",{get:function(){return e._inst||(e._inst=new e,e._inst.initCountryMgr()),e._inst},enumerable:!0,configurable:!0}),e.prototype.initCountryMgr=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._countryList=new Collection.Dictionary,[2]})})},e.prototype.setAllCountry=function(e){var i=this;this._countryList.clear(),e.forEach(function(e){var r=new t.Country(e);i._countryList.setValue(r.countryID,r)})},e.prototype.addCountry=function(e){var i=new t.Country(e);this._countryList.setValue(e.CountryID,i)},e.prototype.removeCountry=function(e){var i=e.CountryID;if(this._countryList.containsKey(i)){var r=this._countryList.getValue(i);r.cityList.forEach(function(e,r){r.countryID==i&&t.CityMgr.inst.updateCityCamp(r.cityID,0)}),this._countryList.remove(e.CountryID)}},e.prototype.countryAddCity=function(e,i){var r=t.CityMgr.inst.getCity(e);this._countryList.getValue(i).addCity(r)},e.prototype.getCountryForCityID=function(e){return this.getCountry(t.CityMgr.inst.getCity(e).countryID)},e.prototype.getCountry=function(t){return this._countryList.getValue(t)},e}();t.CountryMgr=e,__reflect(e.prototype,"War.CountryMgr")}(War||(War={}));var War;!function(t){function e(t){switch(t){case Job.UnknowJob:return new r;case Job.YourMajesty:return new o;case Job.Counsellor:return new s;case Job.General:return new a;case Job.Prefect:return new h;case Job.DuWei:return new l;case Job.FieldOfficer:return new c;default:return console.error("can't general job obj for type ",t),null}}var i=function(){function t(){}return Object.defineProperty(t.prototype,"type",{get:function(){return Job.UnknowJob},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return Utils.job2Text(this.type)},enumerable:!0,configurable:!0}),t.prototype.isCountryJob=function(){return!1},t.prototype.isCityJob=function(){return!1},t.prototype.isSameJob=function(t){return this.type==t},t.prototype.enter=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.leave=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.canNotice=function(){return!1},t.prototype.canKickMember=function(){return!1},t.prototype.canSetPrefect=function(){return!1},t.prototype.canSetOtherCityJob=function(){return!1},t.prototype.canJoinCityJob=function(){return!1},t.prototype.canSetBuild=function(){return!1},t.prototype.canSetCampFlag=function(){return!1},t.prototype.canAppointToJob=function(t){return!1},t}();t.BaseJob=i,__reflect(i.prototype,"War.BaseJob");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.canAppointToJob=function(t){return!0},e}(i);t.UnkownJob=r,__reflect(r.prototype,"War.UnkownJob");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.isCountryJob=function(){return!0},e}(i);t.CountryJob=n,__reflect(n.prototype,"War.CountryJob");var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return Job.YourMajesty},enumerable:!0,configurable:!0}),e.prototype.canSetPrefect=function(){return!0},e.prototype.canJoinCityJob=function(){return!0},e.prototype.canSetCampFlag=function(){return!0},e}(n);t.YourMajestyJob=o,__reflect(o.prototype,"War.YourMajestyJob");var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return Job.Counsellor},enumerable:!0,configurable:!0}),e.prototype.canAppointToJob=function(t){return this.type==t?!1:!0},e}(n);t.CounsellorJob=s,__reflect(s.prototype,"War.CounsellorJob");var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return Job.General},enumerable:!0,configurable:!0}),e.prototype.canAppointToJob=function(t){return this.type==t?!1:!0},e}(n);t.GeneralJob=a,__reflect(a.prototype,"War.GeneralJob");var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.isCityJob=function(){return!0},e.prototype.canKickMember=function(){return!0},e.prototype.canJoinCityJob=function(){return!0},e}(i);t.CityJob=u,__reflect(u.prototype,"War.CityJob");var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return Job.Prefect},enumerable:!0,configurable:!0}),e.prototype.canSetOtherCityJob=function(){return!0},e.prototype.canNotice=function(){return!0},e.prototype.canSetBuild=function(){return!0},e}(u);t.PrefectJob=h,__reflect(h.prototype,"War.PrefectJob");var l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return Job.DuWei},enumerable:!0,configurable:!0}),e.prototype.canAppointToJob=function(t){return t==Job.DuWei?!1:!0},e}(u);t.DuWeiJob=l,__reflect(l.prototype,"War.DuWeiJob");var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return Job.FieldOfficer},enumerable:!0,configurable:!0}),e.prototype.canAppointToJob=function(t){return t==Job.FieldOfficer?!1:!0},e}(u);t.FieldOfficerJob=c,__reflect(c.prototype,"War.FieldOfficerJob");var d=function(){function t(){this._countryJobObj=null,this._cityJobObj=null}return Object.defineProperty(t.prototype,"cityJob",{get:function(){return this._cityJobObj},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"countryJob",{get:function(){return this._countryJobObj},enumerable:!0,configurable:!0}),t.prototype.setCountryJob=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return this._countryJobObj&&this._countryJobObj.isSameJob(t)?[2]:this._countryJobObj?[4,this._countryJobObj.leave()]:[3,2];case 1:i.sent(),i.label=2;case 2:return this._countryJobObj=e(t),this._countryJobObj?[4,this._countryJobObj.enter()]:[3,4];case 3:i.sent(),i.label=4;case 4:return[2]}})})},t.prototype.setCityJob=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return this._cityJobObj&&this._cityJobObj.isSameJob(t)?[2]:this._cityJobObj?[4,this._cityJobObj.leave()]:[3,2];case 1:i.sent(),i.label=2;case 2:return this._cityJobObj=e(t),this._cityJobObj?[4,this._cityJobObj.enter()]:[3,4];case 3:i.sent(),i.label=4;case 4:return[2]}})})},t.prototype.hasOfficialTitle=function(){return this.hasCountryOfficialTitle()||this.hasCityOfficialTitle()},t.prototype.hasCountryOfficialTitle=function(){return this._countryJobObj&&this._countryJobObj.type!=Job.UnknowJob},t.prototype.hasCityOfficialTitle=function(){return this._cityJobObj&&this._cityJobObj.type!=Job.UnknowJob},t.prototype.canKickMember=function(){return this._cityJobObj.canKickMember()},t.prototype.canNotice=function(){return this._cityJobObj.canNotice()},t.prototype.canSurrender=function(){return this._cityJobObj.isSameJob(Job.Prefect)&&!this._countryJobObj.isSameJob(Job.YourMajesty)},t.prototype.canAutocephaly=function(){return this._cityJobObj.isSameJob(Job.Prefect)&&!this._countryJobObj.isSameJob(Job.YourMajesty)},t.prototype.hasSameJob=function(t){return this._cityJobObj.isSameJob(t)||this._countryJobObj.isSameJob(t)},t.prototype.canSetPrefect=function(){return this._countryJobObj.canSetPrefect()},t.prototype.canSetOtherCityJob=function(){return this._cityJobObj.canSetOtherCityJob()},t.prototype.canAppointToJob=function(t){var e=Utils.job2Type(t);return e==JobType.CityJob?this._cityJobObj.canAppointToJob(t):e==JobType.CountryJob?this._countryJobObj.canAppointToJob(t):!1},t.prototype.canJoinCityJob=function(){return this._cityJobObj.canJoinCityJob()||this._countryJobObj.canJoinCityJob()},t.prototype.canSetBuild=function(){return this._cityJobObj.canSetBuild()},t.prototype.canSetCampFlag=function(){return this._countryJobObj.canSetCampFlag()},t.prototype.doubleJobName=function(t){return Utils.doubleJob(this._countryJobObj.type,this._cityJobObj.type,t)},t}();t.NationalEmployee=d,__reflect(d.prototype,"War.NationalEmployee")}(War||(War={}));var War;!function(t){var e=function(){function t(){}return t.LAND=1,t.WATER=2,t}();t.RoadType=e,__reflect(e.prototype,"War.RoadType");var i=function(){function t(t,e){this._x=t,this._y=e,this._isDayPoint=!1,this._nextDayPoint=null}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDayPoint",{get:function(){return this._isDayPoint},set:function(t){this._isDayPoint=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextDayPoint",{get:function(){return this._nextDayPoint
},set:function(t){this._nextDayPoint=t},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return"("+this._x+", "+this._y+")"},t}();t.PathPoint=i,__reflect(i.prototype,"War.PathPoint");var r=function(){function r(t,e,i){this._id=t,this._fromCityId=e,this._toCityId=i,this._conf=Data.road.get(t),this._distance=this._conf.distance,this._playAni=!1,this._initPathCoords()}return r.genRoadsByCity=function(t){if(!r._cityRoadInfos){r._cityRoadInfos=new Collection.Dictionary;for(var e=Data.road.keys,i=0,n=e;i<n.length;i++){var o=n[i],s=Data.road.get(o),a=s.city1,u=s.city2;if(!r._cityRoadInfos.containsKey(a)){var h=new Collection.Dictionary;r._cityRoadInfos.setValue(a,h)}if(r._cityRoadInfos.getValue(a).setValue(u,o),!r._cityRoadInfos.containsKey(u)){var l=new Collection.Dictionary;r._cityRoadInfos.setValue(u,l)}r._cityRoadInfos.getValue(u).setValue(a,o)}}var c=r._cityRoadInfos.getValue(t);if(c){for(var d=c.keys(),p=new Array,_=0,g=d;_<g.length;_++){var f=g[_],m=new r(c.getValue(f),t,f);p.push(m)}return p}return[]},Object.defineProperty(r.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fromCityId",{get:function(){return this._fromCityId},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"toCityId",{get:function(){return this._toCityId},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"dayno",{get:function(){return this._distance},enumerable:!0,configurable:!0}),r.prototype._initPathCoords=function(){for(var e=this,r=new Collection.List,n=this._conf.coord,o=0;o<n.length;o++){var s=n[o],a=s.split(","),u=new i(parseInt(a[0]),parseInt(a[1]));r.push(u)}this._fromCityId>this._toCityId&&r.reverse();var h=t.CityMgr.inst.getCity(this._fromCityId),l=new i(h.cityPoint.x,h.cityPoint.y);r.pushFront(l);var c=t.CityMgr.inst.getCity(this._toCityId),d=new i(c.cityPoint.x,c.cityPoint.y);r.push(d);var p=0,_=new Array;r.forEach(function(t){var e=r.getPrev(t);if(e){var i=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));p+=i,_.push(i)}}),this._dayno2Coords=new Collection.Dictionary;var g=this._distance;if(g>1){for(var f=p/g,u=r.getFront(),m=u,y=r.getNext(u),o=0,C=1,v=_[o];;){if(!y)break;if(C>=g){d.isDayPoint=!0;break}if(v>f*C){var T=Math.atan2(y.y-u.y,y.x-u.x);T=(2*Math.PI+T)%(2*Math.PI);var w=_[o]-(v-f*C),b=u.x+w*Math.cos(T),P=u.y+w*Math.sin(T),I=new i(b,P);I.isDayPoint=!0,r.push(I,m),m=I,C++}else o++,u=y,y=r.getNext(u),m=u,_[o]&&(v+=_[o])}this._coords=new Array;var S=new Array,x=1;r.forEach(function(t){e._coords.push(t),S.push(t),t.isDayPoint&&(e._dayno2Coords.setValue(x,S),x++,S=new Array,S.push(t))})}else 1==g?(d.isDayPoint=!0,this._dayno2Coords.setValue(1,this._coords)):console.debug("error road dayno from city"+this._fromCityId+" to city"+this._toCityId)},r.prototype.getPathCoordsByDayno=function(t){return this._dayno2Coords.getValue(t)},r.prototype.getPathPointByDayno=function(e){if(0==e){var r=t.CityMgr.inst.getCity(this._fromCityId);return new i(r.cityPoint.x,r.cityPoint.y)}var n=this.getPathCoordsByDayno(e);return n?n[n.length-1]:null},r.prototype.getRestPathCoordsAfterDayno=function(t){for(var e=[],i=t;i<=this._distance;++i)e.concat(this.getPathCoordsByDayno(i));return e},Object.defineProperty(r.prototype,"roadType",{get:function(){var t=this._conf.terrain;return 6==t?e.WATER:e.LAND},enumerable:!0,configurable:!0}),r.countCityPathDistance=function(e){for(var i=0,r=1;r<e.length;r++){var n=e[r-1],o=e[r],s=t.CityMgr.inst.getCity(n);i+=s.getAdjCityDayno(t.CityMgr.inst.getCity(o))}return i},r._cityRoadInfos=null,r}();t.Road=r,__reflect(r.prototype,"War.Road")}(War||(War={}));var War;!function(t){function e(e,i){var r=pb.CampaignState.decode(i);t.WarMgr.inst.updateState(r)}function i(e,i){var r=pb.UpdateCityStateArg.decode(i),n=r.CityID,o=t.CityMgr.inst.getCity(n);o.changeStatus(r.State,-1,r.OccupyCountryID)}function r(e,i){var r=pb.UpdateMyTeamStateArg.decode(i),n=r.State,o=t.WarTeamMgr.inst.myTeam;o&&o.changeStatus(n,-1,r.Arg)}function n(e,i){var r=pb.CampaignPlayerState.decode(i);t.MyWarPlayer.inst.changeStatus(r.State,-1,r.Arg)}function o(e,i){var r=pb.CampaignTeams.decode(i);r.Teams.forEach(function(e){console.log("rpc_ChangeOtherTeamsState team: "+e.ID.toString()+", state: "+e.State.toString());var i=e.ID;if(t.WarTeamMgr.inst.myTeam&&t.WarTeamMgr.inst.myTeam.teamID==i)t.WarTeamMgr.inst.myTeam.amount=e.TeamAmount;else{console.log("rpc_ChangeOtherTeamsState handle team ",i);var r=t.WarTeamMgr.inst.getOtherTeam(i);if(r?(r.changeStatus(e.State),r.amount=e.TeamAmount):e.State!=t.TeamStatusName.ST_DISAPPEAR&&(r=new t.WarTeam(e),t.WarTeamMgr.inst.addOtherTeam(r),r.amount=e.TeamAmount),r=t.WarTeamMgr.inst.getOtherTeam(i),!r||r.destroyed||!t.WarTeamMgr.inst.myTeam)return;var n=r.road,o=t.WarTeamMgr.inst.myTeam.road;if(!n||!o||n.id!=o.id||n.toCityId!=o.toCityId)return;t.WarTeamMgr.inst.myTeam.amount=0}})}function s(e,i){var r=pb.CountryCreatedArg.decode(i);t.WarMgr.inst.countryCreated(r)}function a(e,i){var r=pb.CountryDestoryed.decode(i);t.WarMgr.inst.countryDestoryed(r)}function u(e,i){var r=pb.UpdateForageArg.decode(i);t.MyWarPlayer.inst.forage=r.ForageAmount}function h(e,i){var r=pb.CampaignNotifyRedDotArg.decode(i);r.Type==pb.CampaignNotifyRedDotArg.RedDotType.Misson?Core.EventCenter.inst.dispatchEventWith(t.WarMgr.ShowMissionRedDot):r.Type==pb.CampaignNotifyRedDotArg.RedDotType.Notice&&Core.EventCenter.inst.dispatchEventWith(t.WarMgr.ShowNotifyRedDot)}function l(e,i){var r=pb.SyncCityDefenseArg.decode(i);r.CityDefenses.forEach(function(e){var i=t.CityMgr.inst.getCity(e.CityID);i&&(i.defence=e.Defense)})}function c(e,i){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(r){switch(r.label){case 0:return e=pb.CampaignUpdateJobArg.decode(i),[4,t.MyWarPlayer.inst.employee.setCityJob(e.CityJob)];case 1:return r.sent(),[4,t.MyWarPlayer.inst.employee.setCountryJob(e.CountryJob)];case 2:return r.sent(),Core.EventCenter.inst.dispatchEventWith(t.WarMgr.RefreshCityInfo),Core.EventCenter.inst.dispatchEventWith(t.WarMgr.RefreshAppoint),[2]}})})}function d(t,e){}function p(t,e){}function _(e,i){var r=pb.UpdateMyCityArg.decode(i);t.MyWarPlayer.inst.cityID=r.CityID,t.MyWarPlayer.inst.locationCityID=r.LocationCityID}function g(e,i){var r=pb.UpdateMyCountryArg.decode(i);t.MyWarPlayer.inst.countryID=r.CountryID,t.MyWarPlayer.inst.lastCountryID=r.LastCountryID}function f(t,e){}function m(e,i){var r=pb.UpdateCountryNameArg.decode(i);t.WarMgr.inst.updateCountryName(r.CountryID,r.Name)}function y(e,i){var r=pb.UpdateCountryFlagArg.decode(i);t.WarMgr.inst.updateCountryFlag(r.CountryID,r.Flag)}function C(e,i){var r=pb.UpdateContributionArg.decode(i);t.MyWarPlayer.inst.contribution=r.Contribution,t.MyWarPlayer.inst.contributionMax=r.MaxContribution}function v(e,i){var r=pb.SyncCityPlayerAmount.decode(i);t.CityMgr.inst.getCity(r.CityID).playerNum=r.Amount}function T(e,i){var r=pb.CitysDefPlayerAmount.decode(i);t.CityMgr.inst.setAllCityDefPlayers(r)}function w(e,i){var r=pb.CampaignSupportCard.decode(i);t.MyWarPlayer.inst.supportCards=r.CardIDs}function b(e,i){var r=pb.UpdateCityCountryArg.decode(i),n=t.CityMgr.inst.getCity(r.CityID);if(0!=n.countryID){var o=t.CountryMgr.inst.getCountry(n.countryID);o.delCity(n)}var s=t.CountryMgr.inst.getCountry(r.CountryID);s&&s.addCity(n),n.countryID=r.CountryID}function P(){Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_CAMPAIGN_STATE,e),Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_CITY_STATE,i),Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_MY_TEAM_STATE,r),Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_CAMPAIGN_PLAYER_STATE,n),Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_CAMPAIGN_TEAMS,o),Net.registerRpcHandler(pb.MessageID.S2C_COUNTRY_CREATED,s),Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_FORAGE,u),Net.registerRpcHandler(pb.MessageID.S2C_CAMPAIGN_NOTIFY_RED_DOT,h),Net.registerRpcHandler(pb.MessageID.S2C_SYNC_CITY_DEFENSE,l),Net.registerRpcHandler(pb.MessageID.S2C_CAMPAIGN_UPDATE_JOB,c),Net.registerRpcHandler(pb.MessageID.S2C_MY_TEAM_CAN_ATTACK_CITY,d),Net.registerRpcHandler(pb.MessageID.S2C_TO_BE_CAPTIVE,p),Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_MY_CITY,_),Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_MY_COUNTRY,g),Net.registerRpcHandler(pb.MessageID.S2C_COUNTRY_WAR_END,f),Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_COUNTRY_NAME,m),Net.registerRpcHandler(pb.MessageID.S2C_COUNTRY_DESTORYED,a),Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_COUNTRY_FLAG,y),Net.registerRpcHandler(pb.MessageID.S2C_SYNC_CITY_PLYAER_AMOUNT,v),Net.registerRpcHandler(pb.MessageID.S2C_SYNC_DEF_CITY_PLAYER_AMOUNT,T),Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_CAMPAIGN_SUPPORT_CARDS,w),Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_CONTRIBUTION,C),Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_CITY_COUNTRY,b)}t.initRpc=P}(War||(War={}));var War;!function(t){function e(){t.initRpc();var e=Core.ViewManager.inst.registerView.bind(Core.ViewManager.inst),i=fairygui.UIPackage.createObject;e(ViewName.warHome,function(){var e=i(PkgName.war,ViewName.warHome,t.WarHomeView);return e}),e(ViewName.cityInfoPanel,function(){var e=new t.CityInfoWnd;return e.contentPane=i(PkgName.war,ViewName.cityInfoPanel).asCom,e}),e(ViewName.warQuestPanel,function(){var e=new t.WarQuestWnd;return e.contentPane=i(PkgName.war,ViewName.warQuestPanel).asCom,e}),e(ViewName.cityManagePanel,function(){var e=new t.CityManageWnd;return e.contentPane=i(PkgName.war,ViewName.cityManagePanel).asCom,e}),e(ViewName.addGoldWnd,function(){var e=new t.AddGoldWnd;return e.contentPane=i(PkgName.war,ViewName.addGoldWnd).asCom,e}),e(ViewName.setFoodPriceWnd,function(){var e=new t.SetFoodPriceWnd;return e.contentPane=i(PkgName.war,ViewName.setFoodPriceWnd),e}),e(ViewName.allMemberPanel,function(){var e=new t.AllMemberPanel;return e.contentPane=i(PkgName.war,ViewName.allMemberPanel),e}),e(ViewName.allCityPanel,function(){var e=new t.AllCityPanel;return e.contentPane=i(PkgName.war,ViewName.allCityPanel),e}),e(ViewName.warNoticePanel,function(){var e=new t.WarNoticePanel;return e.contentPane=i(PkgName.war,ViewName.warNoticePanel),e}),e(ViewName.questChooseCardWnd,function(){var e=new t.QuestChooseCardWnd;return e.contentPane=i(PkgName.war,ViewName.questChooseCardWnd).asCom,e}),e(ViewName.emperorApplyWnd,function(){var e=new t.EmperorApplyWnd;return e.contentPane=i(PkgName.war,ViewName.emperorApplyWnd).asCom,e}),e(ViewName.independentWnd,function(){var e=new t.IndependentWnd;return e.contentPane=i(PkgName.war,ViewName.independentWnd).asCom,e}),e(ViewName.appointChooseWnd,function(){var e=new t.AppointChooseWnd;return e.contentPane=i(PkgName.war,ViewName.appointChooseWnd).asCom,e}),e(ViewName.questReleaseWnd,function(){var e=new t.QuestReleaseWnd;return e.contentPane=i(PkgName.war,ViewName.questReleaseWnd).asCom,e}),e(ViewName.questTransReleaseWnd,function(){var e=new t.QuestTransReleaseWnd;return e.contentPane=i(PkgName.war,ViewName.questTransReleaseWnd).asCom,e}),e(ViewName.modifyCampFlagWnd,function(){var e=new t.ModifyCampFlagWnd;return e.contentPane=i(PkgName.war,ViewName.modifyCampFlagWnd).asCom,e}),e(ViewName.countryAppointPanel,function(){var e=new t.CountryAppointWnd;return e.contentPane=i(PkgName.war,ViewName.countryAppointPanel).asCom,e}),e(ViewName.cityAppointPanel,function(){var e=new t.CityAppointWnd;return e.contentPane=i(PkgName.war,ViewName.cityAppointPanel).asCom,e}),e(ViewName.addGoldRecordPanel,function(){var e=new t.AddGoldRecordPanel;return e.contentPane=i(PkgName.war,ViewName.addGoldRecordPanel).asCom,e}),e(ViewName.cityNoticeWnd,function(){var e=new t.CityNoticeWnd;return e.contentPane=i(PkgName.war,ViewName.cityNoticeWnd).asCom,e}),e(ViewName.cityInfoWarPanel,function(){var e=new t.WarCityInfoWnd;return e.contentPane=i(PkgName.war,ViewName.cityInfoWarPanel).asCom,e}),e(ViewName.questAttackReleaseWnd,function(){var e=new t.QuestAttackReleaseWnd;return e.contentPane=i(PkgName.war,ViewName.questAttackReleaseWnd).asCom,e}),e(ViewName.questDefenseReleaseWnd,function(){var e=new t.QuestDefenseReleaseWnd;return e.contentPane=i(PkgName.war,ViewName.questDefenseReleaseWnd).asCom,e}),e(ViewName.questMoveReleaseWnd,function(){var e=new t.QuestMoveReleaseWnd;return e.contentPane=i(PkgName.war,ViewName.questMoveReleaseWnd).asCom,e}),e(ViewName.questFightPanel,function(){var e=new t.QuestFightPanel;return e.contentPane=i(PkgName.war,ViewName.questFightPanel).asCom,e}),e(ViewName.choiceFightCardWnd,function(){var e=new t.ChoiceFightCardWnd;return e.contentPane=i(PkgName.war,ViewName.choiceFightCardWnd).asCom,e}),e(ViewName.questMigrateReleaseWnd,function(){var e=new t.QuestMigrateReleaseWnd;return e.contentPane=i(PkgName.war,ViewName.questMigrateReleaseWnd).asCom,e}),e(ViewName.warShopView,function(){var e=fairygui.UIPackage.createObject(PkgName.war,ViewName.warShopView,t.WarShopView);return e}),e(ViewName.battleEndView,function(){return fairygui.UIPackage.createObject(PkgName.war,ViewName.battleEndView,t.WarEndView)}),e(ViewName.battleUnifiedView,function(){return fairygui.UIPackage.createObject(PkgName.war,ViewName.battleUnifiedView,t.WarUnifiedView)}),e(ViewName.enterWarAni,function(){return fairygui.UIPackage.createObject(PkgName.war,ViewName.enterWarAni,t.WarEnterAniView)}),t.initRpc()}var i;!function(t){t[t.Normal=0]="Normal",t[t.Transport=1]="Transport",t[t.SelectMy=2]="SelectMy",t[t.SelectEnemy=3]="SelectEnemy",t[t.SurrenderCity=4]="SurrenderCity",t[t.SurrenderCamp=5]="SurrenderCamp"}(i=t.MapState||(t.MapState={}));var r;!function(t){t[t.NormalState=0]="NormalState",t[t.ReadyWar=1]="ReadyWar",t[t.InWar=2]="InWar"}(r=t.WarState||(t.WarState={}));var n=function(e){function r(){var t=e.call(this)||this;return t.setDelegateHost(t),t}return __extends(r,e),Object.defineProperty(r,"inst",{get:function(){return r._inst||(r._inst=new r),r._inst},enumerable:!0,configurable:!0}),r.prototype.joinSelectCityMode=function(e,r,n){return __awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(s){return e?(this._mapState=r,this._citys=n,this._citys&&this._citys.length>0&&t.CityMgr.inst.setCitySelectMode(this._citys,!0)):(this._mapState=i.Normal,this._citys&&this._citys.length>0&&t.CityMgr.inst.setCitySelectMode(this._citys,!1)),o=Core.ViewManager.inst.getView(ViewName.warHome),o.joinSelectMode(e,r),[2]})})},r.prototype.joinCity=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_SETTLE_CITY,pb.TargetCity.encode({CityID:t}))];case 1:return e=i.sent(),0==e.errcode?[2,!0]:[2,!1]}})})},r.prototype.moveCity=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){switch(n.label){case 0:return i={CityID:t,Gold:e},[4,Net.rpcCall(pb.MessageID.C2S_MOVE_CITY,pb.MoveCityArg.encode(i))];case 1:return r=n.sent(),0==r.errcode?[2,!0]:[2,!1]}})})},r.prototype.fetchCityData=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){switch(o.label){case 0:return i={CityID:e},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_CITY_DATA,pb.TargetCity.encode(i))];case 1:return r=o.sent(),0==r.errcode?(n=pb.CityData.decode(r.payload),this._nowSelectCity=t.CityMgr.inst.getCity(e),this._nowSelectCity.setCityData(n),[2,!0]):[2,!1]}})})},r.prototype.fetchCountryJobPlayer=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_FETCH_COUNTRY_JOB_PLAYERS,null)];case 1:return e=r.sent(),0==e.errcode&&(i=pb.CampaignPlayerList.decode(e.payload),t.setCountryPlayers(i.Players)),[2]}})})},r.prototype.fetchCityMember=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){switch(o.label){case 0:return i={CityID:t,Page:e},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_CITY_PLAYERS,pb.FetchCityPlayersArg.encode(i))];case 1:return r=o.sent(),0==r.errcode?(n=pb.CampaignPlayerList.decode(r.payload),[2,n]):[2,!1]}})})},r.prototype.fetchInCityMember=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){switch(o.label){case 0:return i={CityID:t,Page:e},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_IN_CITY_PLAYERS,pb.FetchCityPlayersArg.encode(i))];case 1:return r=o.sent(),0==r.errcode?(n=pb.CampaignPlayerList.decode(r.payload),[2,n]):[2,!1]}})})},r.prototype.fetchCityCaptives=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){switch(o.label){case 0:return i={CityID:t,Page:e},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_CITY_CAPTIVES,pb.FetchCityPlayersArg.encode(i))];case 1:return r=o.sent(),0==r.errcode?(n=pb.CampaignPlayerList.decode(r.payload),[2,n]):[2,!1]}})})},r.prototype.fetchCountryMember=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){switch(o.label){case 0:return i={CountryID:t,Page:e},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_COUNTRY_PLAYERS,pb.FetchCountryPlayersArg.encode(i))];case 1:return r=o.sent(),0==r.errcode?(n=pb.CampaignPlayerList.decode(r.payload),[2,n]):[2,!1]}})})},r.prototype.quitCountry=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return e=null,t?(i={Uid:t},[4,Net.rpcCall(pb.MessageID.C2S_QUIT_COUNTRY,pb.CampaignTargetPlayer.encode(i))]):[3,2];case 1:return e=r.sent(),[3,4];case 2:return[4,Net.rpcCall(pb.MessageID.C2S_QUIT_COUNTRY,null)];case 3:e=r.sent(),r.label=4;case 4:return 0==e.errcode?[2,!0]:[2,!1]}})})},r.prototype.appointJob=function(t,e,i){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(o){switch(o.label){case 0:return r={Uid:t,Job:e,OldUid:i},[4,Net.rpcCall(pb.MessageID.C2S_APPOINT_JOB,pb.AppointJobArg.encode(r))];case 1:return n=o.sent(),0==n.errcode?[2,!0]:[2,!1]}})})},r.prototype.recallJob=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){switch(n.label){case 0:return i={Uid:t,Job:e},[4,Net.rpcCall(pb.MessageID.C2S_RECALL_JOB,pb.RecallJobArg.encode(i))];case 1:return r=n.sent(),0==r.errcode?[2,!0]:[2,!1]}})})},r.prototype.setForagePrice=function(e){return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){switch(n.label){case 0:return i={Price:e},[4,Net.rpcCall(pb.MessageID.C2S_SET_FORAGE_PRICE,pb.SetForagePriceArg.encode(i))];case 1:return r=n.sent(),0==r.errcode?(t.CityMgr.inst.getCity(t.MyWarPlayer.inst.cityID).foragePrice=e,[2,!0]):[2,!1]}})})},r.prototype.publishMission=function(e,i,n,o,s){return __awaiter(this,void 0,void 0,function(){var a,u,h,l,c;return __generator(this,function(d){switch(d.label){case 0:return r.inst.inStatus(t.BattleStatusName.ST_NORMAL)?(a=null,a={Type:e,GoldReward:i,Amount:n,TransportType:o,TransportCityPath:s},[4,Net.rpcCall(pb.MessageID.C2S_CAMPAIGN_PUBLISH_MISSION,pb.CampaignPublishMissionArg.encode(a))]):(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70250)),[2,!1]);case 1:return u=d.sent(),0==u.errcode?(h=pb.CampaignPublishMissionReply.decode(u.payload),l=Core.ViewManager.inst.getView(ViewName.cityManagePanel),l.refreshMission(h.MissionInfo),c=t.CityMgr.inst.getCity(t.MyWarPlayer.inst.cityID),c&&(c.forage=h.Forage,c.gold=h.Gold),[2,!0]):[2,!1]}})})},r.prototype.fetchMilitaryOrders=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return e={CityID:t.cityID},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_MILITARY_ORDERS,pb.TargetCity.encode(e))];case 1:return i=n.sent(),0==i.errcode?(r=pb.MilitaryOrderInfo.decode(i.payload),t.militaryOrderInfo=r.Orders,[2,!0]):[2,!1]}})})},r.prototype.publishMilitaryOrders=function(e,i,n,o,s){return __awaiter(this,void 0,void 0,function(){var a,u,h;return __generator(this,function(l){switch(l.label){case 0:return r.inst.inStatus(t.BattleStatusName.ST_DURING)||r.inst.inStatus(t.BattleStatusName.ST_PREPARE)?(a={Type:i,Forage:n,Amount:o,CityPath:s},[4,Net.rpcCall(pb.MessageID.C2S_PUBLISH_MILITARY_ORDERS,pb.PublishMilitaryOrderArg.encode(a))]):(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70250)),[2,!1]);case 1:return u=l.sent(),0==u.errcode?(h=pb.PublishMilitaryOrderReply.decode(u.payload),e.militaryOrderInfo=h.Orders,e.forage=h.Forage,[2,!0]):[2,!1]}})})},r.prototype.acceptMilitaryOrder=function(e,i,n){return __awaiter(this,void 0,void 0,function(){var o,s,a,u;return __generator(this,function(h){switch(h.label){case 0:return r.inst.inStatus(t.BattleStatusName.ST_DURING)||r.inst.inStatus(t.BattleStatusName.ST_PREPARE)?(o=t.CityMgr.inst.getCity(t.MyWarPlayer.inst.locationCityID),o&&o.inStatus(t.CityStatusName.ST_ATTACKED)&&e!=pb.MilitaryOrderType.DefCityMT?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70283)),[2,!1]):(s={Type:e,CardIDs:i,TargetCity:n},[4,Net.rpcCall(pb.MessageID.C2S_ACCEPT_MILITARY_ORDER,pb.AcceptMilitaryOrderArg.encode(s))])):(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70321)),[2,!1]);case 1:return a=h.sent(),0==a.errcode?(u=pb.AcceptMilitaryOrderReply.decode(a.payload),t.WarTeamMgr.inst.newMyTeam(u.Team),t.MyWarPlayer.inst.changeStatus(u.State.State,-1,u.State.Arg),[2,!0]):[2,!1]}})})},r.prototype.surrender=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_CAMPAIGN_SURRENDER,null)];case 1:return t=e.sent(),0==t.errcode?[2,!0]:[2,!1]}})})},r.prototype.runAway=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_ESCAPED_FROM_JAIL,null)];case 1:return e=r.sent(),0==e.errcode?(i=pb.TargetCity.decode(e.payload),t.MyWarPlayer.inst.locationCityID=i.CityID):100==e.errcode&&Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70340)),[2]}})})},r.prototype.surrenderCity=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return e={CountryID:t},[4,Net.rpcCall(pb.MessageID.C2S_SURRENDER_CITY,pb.SurrenderCityArg.encode(e))];case 1:return i=r.sent(),0==i.errcode?[2,!0]:12==i.errcode?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70341)),[2,!1]):[2,!1]}})})},r.prototype.autocephaly=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_AUTOCEPHALY,null)];case 1:return t=e.sent(),0==t.errcode?[2,!0]:12==t.errcode?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70341)),[2,!1]):[2,!1]}})})},r.prototype.buyGoods=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,n;return __generator(this,function(o){switch(o.label){case 0:return i={Type:t,GoodsID:e},[4,Net.rpcCall(pb.MessageID.C2S_CAMPAIGN_BUY_GOODS,pb.CampaignBuyGoodsArg.encode(i))];case 1:return n=o.sent(),0==n.errcode?(Core.EventCenter.inst.dispatchEventWith(r.RefreshShop),[2,!0]):[2,!1]}})})},r.prototype.countryCreated=function(e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return t.CountryMgr.inst.addCountry(e),t.CityMgr.inst.updateCityCamp(e.CityID,e.CountryID),t.CountryMgr.inst.countryAddCity(e.CityID,e.CountryID),t.CityMgr.inst.getCity(e.CityID).yourMajesty=e.YourMajesty,this._nowSelectCity&&this._nowSelectCity.cityID&&this._nowSelectCity.cityID==e.CityID?[4,this.fetchCityData(e.CityID)]:[3,2];case 1:i=r.sent(),r.label=2;case 2:return[2]}})})},r.prototype.countryDestoryed=function(e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){return i=t.CountryMgr.inst.getCountry(e.CountryID),i&&(i.changeStatus(t.CountryStatusName.ST_DEFEAT),t.CountryMgr.inst.removeCountry(e)),[2]})})},r.prototype.occupyCity=function(e,i){return __awaiter(this,void 0,void 0,function(){var r,n,o;return __generator(this,function(s){return r=t.CityMgr.inst.getCity(e),0!=r.countryID&&(n=t.CountryMgr.inst.getCountry(r.countryID),n.delCity(r)),o=t.CountryMgr.inst.getCountry(i),o.addCity(r),r.countryID=i,[2]})})},r.prototype.updateCountryName=function(e,i){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){return r=t.CountryMgr.inst.getCountry(e),r.countryName=i,[2]})})},r.prototype.updateCountryFlag=function(e,i){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){return r=t.CountryMgr.inst.getCountry(e),r.countryFlag=i,[2]})})},r.prototype.updateCityDefense=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},Object.defineProperty(r.prototype,"warView",{get:function(){return this._warView},enumerable:!0,configurable:!0}),r.prototype.openWarHome=function(){return __awaiter(this,void 0,void 0,function(){var e,r,n,o,s;return __generator(this,function(a){switch(a.label){case 0:return this._mapState=i.Normal,[4,Net.rpcCall(pb.MessageID.C2S_FETCH_CAMPAIGN_INFO,null)];case 1:return e=a.sent(),0!=e.errcode?[3,5]:(r=pb.CampaignInfo.decode(e.payload),this.updateState(r.State),t.CountryMgr.inst.setAllCountry(r.Countrys),[4,Core.ViewManager.inst.open(ViewName.warHome)]);case 2:return a.sent(),this._warView=Core.ViewManager.inst.getView(ViewName.warHome),[4,t.CityMgr.inst.setAllCity(r.Citys)];case 3:return a.sent(),t.CityMgr.inst.setAllCityDefPlayers(r.DefPlayerAmounts),[4,t.MyWarPlayer.inst.initByCampaignInfo(r)];case 4:if(a.sent(),this._warView.initMap(),r.MyTeam&&t.WarTeamMgr.inst.newMyTeam(r.MyTeam),r.Teams)for(n=0;n<r.Teams.length&&(o=r.Teams[n],!t.WarTeamMgr.inst.myTeam||t.WarTeamMgr.inst.myTeam.teamID!=o.ID);n++)s=new t.WarTeam(o),t.WarTeamMgr.inst.addOtherTeam(s);this._warView.refreshHomeView(),this._hasCompleteMission=r.HasCompleteMission,this._hasNewNotice=r.HasNewNotice,t.WarTeamMgr.inst.myTeam||r.TeamDisappear&&t.WarTeam.showTeamDisappearTips(r.TeamDisappear),a.label=5;case 5:return[2]}})})},r.prototype.updateState=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,r,r,r,r;return __generator(this,function(n){switch(n.label){case 0:return i=e.State,i!=pb.CampaignState.StateEnum.Normal?[3,2]:(r=pb.CaStateWarArg.decode(e.Arg),[4,this.changeStatus(t.BattleStatusName.ST_NORMAL,r.RemainTime)]);case 1:return n.sent(),[3,10];case 2:return i!=pb.CampaignState.StateEnum.ReadyWar?[3,4]:(r=pb.CaStateWarArg.decode(e.Arg),[4,this.changeStatus(t.BattleStatusName.ST_PREPARE,r.RemainTime)]);case 3:return n.sent(),[3,10];case 4:return i!=pb.CampaignState.StateEnum.InWar?[3,6]:(r=pb.CaStateWarArg.decode(e.Arg),[4,this.changeStatus(t.BattleStatusName.ST_DURING,r.RemainTime)]);case 5:return n.sent(),[3,10];case 6:return i!=pb.CampaignState.StateEnum.WarEnd?[3,8]:(r=pb.CaStateWarEndArg.decode(e.Arg),[4,this.changeStatus(t.BattleStatusName.ST_END,r.NextWarRemainTime,r)]);case 7:return n.sent(),[3,10];case 8:return i!=pb.CampaignState.StateEnum.Unified?[3,10]:(r=pb.CaStateUnifiedArg.decode(e.Arg),[4,this.changeStatus(t.BattleStatusName.ST_UNIFIED,-1,r)]);case 9:n.sent(),n.label=10;case 10:return[2]}})})},r.prototype.openMyCityInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.openCityInfo(t.MyWarPlayer.inst.cityID),[2]})})},r.prototype.openCityInfo=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,this.fetchCityData(t)];case 1:return e=i.sent(),e&&Core.ViewManager.inst.open(ViewName.cityInfoPanel,t),[2]}})})},r.prototype.openMyQuestInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.openQuestInfo(t.MyWarPlayer.inst.cityID),[2]})})},r.prototype.openQuestInfo=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return e={CityID:t},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_CAMPAIGN_MISSION_INFO,pb.TargetCity.encode(e))];case 1:return i=n.sent(),0==i.errcode&&(r=pb.CampaignMissionInfo.decode(i.payload),Core.ViewManager.inst.open(ViewName.warQuestPanel,t,r)),[2]}})})},r.prototype.openCountryInfo=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},r.prototype.openCityManagePanel=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){switch(o.label){case 0:return i={CityID:e},[4,Net.rpcCall(pb.MessageID.C2S_PATROL_CITY,pb.TargetCity.encode(i))];case 1:return r=o.sent(),0==r.errcode&&(n=pb.PatrolCityReply.decode(r.payload),t.MyWarPlayer.inst.setInfoForPatrolCityReply(n),Core.ViewManager.inst.open(ViewName.cityManagePanel,e)),[2]}})})},r.prototype.openSetFoodPriceWnd=function(e){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_FETCH_FORAGE_PRICE,null)];case 1:return e=n.sent(),0==e.errcode&&(i=t.CityMgr.inst.getCity(t.MyWarPlayer.inst.cityID),r=pb.FetchForagePriceReply.decode(e.payload),i.forage=r.ForageAmount,i.foragePrice=r.Price,Core.ViewManager.inst.open(ViewName.setFoodPriceWnd,i)),[2]}})})},r.prototype.openCityListPanel=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_FETCH_ALL_CITY_PLAYER_AMOUNT,null)];case 1:return t=i.sent(),0==t.errcode&&(e=pb.AllCityPlayerAmount.decode(t.payload),Core.ViewManager.inst.open(ViewName.allCityPanel,e)),[2]}})})},r.prototype.openEmperorApply=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return e={CityID:t},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_APPLY_CREATE_COUNTRY_INFO,pb.TargetCity.encode(e))];case 1:return i=n.sent(),0==i.errcode&&(r=pb.ApplyCreateCountryData.decode(i.payload),Core.ViewManager.inst.open(ViewName.emperorApplyWnd,t,r)),[2]}})})},Object.defineProperty(r.prototype,"stateTime",{get:function(){return this.getCurStatusRemainTime()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"nowSelectCity",{get:function(){return this._nowSelectCity},set:function(t){this._nowSelectCity=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hasCompleteMisson",{get:function(){return this._hasCompleteMission},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hasCompleteMission",{set:function(t){this._hasCompleteMission=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hasNewNotice",{get:function(){return this._hasNewNotice},set:function(t){this._hasNewNotice=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"mapState",{get:function(){return this._mapState},set:function(t){this._mapState=t},enumerable:!0,configurable:!0}),r.prototype.onDestroy=function(){this._nowSelectCity=null,t.WarTeamMgr.inst.onDestroy(),t.CityMgr.inst.onDestroy(),t.MyWarPlayer.inst.resetToNoneStatus(),this.resetToNoneStatus()},r.ShowNotifyRedDot="ShowNotifyRedDot",r.ShowMissionRedDot="ShowMissionRedDot",r.RefreshCityInfo="RefreshCityInfo",r.RefreshAppoint="RefreshCityAppoint",r.KingDie="KingDie",r.SelectCity="SelectCity",r.RefreshShop="RefreshShop",r}(t.BattleStatusDelegate);t.WarMgr=n,__reflect(n.prototype,"War.WarMgr"),t.init=e}(War||(War={}));var War;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(t.PlayerStatusDelegate);t.WarPlayer=e,__reflect(e.prototype,"War.WarPlayer")}(War||(War={}));var War;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.setDelegateHost(i),i._employee=new t.NationalEmployee,i}return __extends(i,e),Object.defineProperty(i,"inst",{get:function(){return i._inst||(i._inst=new i),i._inst},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"employee",{get:function(){return this._employee
},enumerable:!0,configurable:!0}),i.prototype.initByCampaignInfo=function(e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return this._cityID=e.MyCityID,this._locationCityID=e.MyLocationCityID,this._countryID=e.MyCountryID,this._lastCountryID=e.LastCountryID,this._employee.setCountryJob(e.MyCountryJob),this._employee.setCityJob(e.MyCityJob),this._forage=e.Forage,this.contribution=e.Contribution,this._contributionMax=e.MaxContribution,this.supportCards=e.SupportCards,[4,this.changeStatus(e.MyState.State,-1,e.MyState.Arg)];case 1:return r.sent(),0!=this._locationCityID&&(i=t.CityMgr.inst.getCity(this._locationCityID),i.setHead(!0)),[2]}})})},i.prototype.setInfoForPatrolCityReply=function(t){this._contribution=t.Contribution,this._salary=t.Salary},i.prototype.isMyCity=function(t){return 0==this._cityID?!1:this._cityID==t},i.prototype.isMyLocationCity=function(t){return 0==this._locationCityID?!1:this._locationCityID==t},i.prototype.isMyCountry=function(t){return 0==this._countryID?!1:this._countryID==t},i.prototype.isMyCountryCity=function(e){return 0==this._countryID?!1:t.CityMgr.inst.getCity(e).countryID==this._countryID},i.prototype.canAttack=function(t){return 0!=this._locationCityID?-1!=this._canAttackCitys.indexOf(t):!1},Object.defineProperty(i.prototype,"cityID",{get:function(){return this._cityID},set:function(t){this._cityID=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"locationCityID",{get:function(){return this._locationCityID},set:function(e){if(0!=this._locationCityID){var i=t.CityMgr.inst.getCity(this._locationCityID);i.setHead(!1)}if(this._locationCityID=e,0!=this._locationCityID){var i=t.CityMgr.inst.getCity(this._locationCityID);i.setHead(!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"countryID",{get:function(){return this._countryID},set:function(t){this._countryID=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastCountryID",{get:function(){return this._lastCountryID},set:function(t){this._lastCountryID=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cityJobObj",{get:function(){return this._employee.cityJob},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"countryJobObj",{get:function(){return this._employee.countryJob},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"forage",{get:function(){return this._forage},set:function(t){this._forage=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"contribution",{get:function(){return this._contribution},set:function(t){this._contribution=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"contributionMax",{get:function(){return this._contributionMax},set:function(t){this._contributionMax=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"salary",{get:function(){return this._salary},set:function(t){this._salary=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isCaptive",{get:function(){return this._isCaptive},set:function(t){this._isCaptive=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isKickOut",{get:function(){return this._isKickOut},set:function(t){this._isKickOut=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"supportCards",{get:function(){return this._supportCards},set:function(t){this._supportCards=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasCity",{get:function(){return this._cityID?!0:!1},enumerable:!0,configurable:!0}),i.prototype.getOffContribution=function(t){return this._contributionMax?Math.ceil(i.inst.contributionMax*t):0},i.PropCity="cityID",i.PropLocationCity="locationCityID",i.PropCountry="countryID",i.PropContribution="contribution",i.PropForage="forage",i}(t.PlayerStatusDelegate);t.MyWarPlayer=e,__reflect(e.prototype,"War.MyWarPlayer");var i=function(){function e(e){this._employee=new t.NationalEmployee,this._uID=e.Uid,this._name=e.Name,this._headImg=e.HeadImg,this._headFrame=e.HeadFrame,this._employee.setCityJob(e.CityJob),this._employee.setCountryJob(e.CountryJob),this._pvpScore=e.PvpScore,this._contribution=e.Contribution}return Object.defineProperty(e.prototype,"uID",{get:function(){return this._uID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"headImg",{get:function(){return this._headImg},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"headFrame",{get:function(){return this._headFrame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pvpScore",{get:function(){return this._pvpScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contribution",{get:function(){return this._contribution},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pvpTeamIcon",{get:function(){var t=Pvp.PvpMgr.inst.getPvpLevel(this._pvpScore),e=Pvp.Config.inst.getPvpTeam(t);return"common_rank"+e+"_png"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pvpLvTitle",{get:function(){var t=Pvp.PvpMgr.inst.getPvpLevel(this._pvpScore);return Pvp.Config.inst.getPvpTitle(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kickOutTime",{get:function(){return this._kickOutTime},set:function(t){this._kickOutTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"employee",{get:function(){return this._employee},enumerable:!0,configurable:!0}),e}();t.CampaignPlayer=i,__reflect(i.prototype,"War.CampaignPlayer")}(War||(War={}));var War;!function(t){var e=function(e){function i(i,r){void 0===r&&(r=!0);var n=e.call(this)||this;return n._road=null,n.setDelegateHost(n),n._teamID=i.ID,n._countryID=i.CountryID,n._cityPath=i.CityPath,n._trip=i.Trip,n._teamCntWithSameDirAndRoad=i.TeamAmount,n._char=null,n._roadPath=[],n._destroyed=!1,n._amount=i.TeamAmount,n._cityPath&&n._cityPath.length>0?(n._fromCity=n._cityPath[0],n._toCity=n._cityPath[n._cityPath.length-1],n._totalDayno=t.Road.countCityPathDistance(n._cityPath),n._updateCurrentRoad()):(n._fromCity=null,n._toCity=null,n._totalDayno=null),n._amount=0,r&&n.changeStatus(i.State),n}return __extends(i,e),i.prototype.isMyTeam=function(){return t.WarTeamMgr.inst.myTeam?t.WarTeamMgr.inst.myTeam.teamID==this._teamID:!1},Object.defineProperty(i.prototype,"amount",{get:function(){return this._amount},set:function(t){this._amount=t,this.updateCharAmount()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"road",{get:function(){return this._road},enumerable:!0,configurable:!0}),i.prototype._updateCurrentRoad=function(){if(this._trip>=this._totalDayno){var e=this._cityPath[this._cityPath.length-2],i=this._cityPath[this._cityPath.length-1],r=t.CityMgr.inst.getCity(e),n=t.CityMgr.inst.getCity(i);this._road=r.getRoad(n);for(var o=this._road.dayno,s=0,a=null;30>s;){for(var u=this._road.getPathCoordsByDayno(o),h=1;h<u.length;h++){var l=u[h],c=u[h-1];if(s+=Math.sqrt(Math.pow(l.x-c.x,2)+Math.pow(l.y-c.y,2)),s>=30){a=c;break}}if(a)break;o--}if(a)this._roadPath=[a];else{var d=this._road.getPathCoordsByDayno(this._road.dayno);this._roadPath=[d[d.length-2]]}}else{this._trip++;var u=this._cityPath,p=this._trip;this._road=null,this._roadPath=[];for(var h=0;h<u.length-1;h++){var _=u[h],g=u[h+1],f=t.CityMgr.inst.getCity(_),m=t.CityMgr.inst.getCity(g),y=f.getRoad(m);if(!y){console.error("ERROR! there is NO road between "+_+" and "+g);break}var o=y.dayno;if(o>=p){this._road=y,this._roadDayno=p,this._roadPath=this._road.getPathCoordsByDayno(this._roadDayno),this._trip>=this._totalDayno&&(this._roadPath=this._roadPath.slice(0,this._roadPath.length-1));break}p-=o}}},i.prototype._marchLog=function(){},i.prototype._run=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return this._trip<this._totalDayno&&!this._destroyed?this._char?[4,this._char.moveAlongPath(this._roadPath)]:[3,2]:[3,4];case 1:return r.sent(),this._marchLog(),this._updateCurrentRoad(),this._char.updateCharType(t.Char.roadType2CharType(this._road.roadType)),e=this._countryID,i=t.CountryMgr.inst.getCountry(e),i&&this._char.updateCountry(i),[3,3];case 2:return[3,4];case 3:return[3,0];case 4:return[2]}})})},i.prototype.resumeRun=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o,s,a;return __generator(this,function(u){if(!this._char)return[2];if(t)if(this._char.isMoving)this._char.resume();else{for(e=this._roadPath,i=0,r=1;r<e.length;r++)n=e[r],o=e[r-1],i+=Math.sqrt(Math.pow(n.x-o.x,2)+Math.pow(n.y-o.y,2));s=1e3*Data.parameter.get("march_speed").para_value[0],a=(i-30/this._totalDayno)/s,this._char.speed=a,this._run()}else this._char.pause();return[2]})})},i.prototype.genCharCom=function(){if(!this._char){console.log("genCharCom for team ",this._teamID);var e=this._road;if(e){var i=t.Char.roadType2CharType(e.roadType);this._char=new t.Char(t.WarMgr.inst.warView.map,i);var r=this._countryID,n=t.CountryMgr.inst.getCountry(r);if(n&&this._char.updateCountry(n),this._setCharPos(),this._roadPath&&this._roadPath.length>1){var o={x:this._char.x,y:this._char.y},s={x:this._roadPath[1].x,y:this._roadPath[1].y};this._char.dir=this._char.calcDir(o,s)}else if(this._cityPath&&this._cityPath.length>0){var a=this._cityPath[this._cityPath.length-1],u=t.CityMgr.inst.getCity(a);if(u){var o={x:this._char.x,y:this._char.y},s={x:u.cityPoint.x,y:u.cityPoint.y};this._char.dir=this._char.calcDir(o,s)}}this.updateCharAmount(),this.isMyTeam()?this.showMyHead(!0):this.showMyHead(!1)}}},i.prototype.updateCharAmount=function(){this._char&&this._char.updateAmount(this._amount)},i.prototype.showMyHead=function(e){if(this._char){this._char.showMyHead(e);var i=t.CityMgr.inst.getCity(t.MyWarPlayer.inst.locationCityID);i&&i.setHead(!e)}},i.prototype.destroyCharCom=function(){this._char&&(this._char.onDestroy(),this._char.removeFromParent(),this._char=null)},i.prototype._setCharPos=function(){if(this._road&&this._char){var t=this._roadPath[0];this._char.x=t.x,this._char.y=t.y}},Object.defineProperty(i.prototype,"teamID",{get:function(){return this._teamID},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"char",{get:function(){return this._char},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"toCityID",{get:function(){return this._toCity},enumerable:!0,configurable:!0}),i.prototype.destroyed=function(){return this._destroyed},i.prototype.onDestroy=function(){if(!this._destroyed&&(this.destroyCharCom(),this._cityPath=[],this._roadPath=[],this.resetToNoneStatus(),this._destroyed=!0,console.log("team.onDestroy ",this._teamID),this.isMyTeam)){var e=t.CityMgr.inst.getCity(t.MyWarPlayer.inst.locationCityID);e&&e.setHead(!0)}},i.showTeamDisappearTipsByPayload=function(t,e){void 0===e&&(e=!1);var i=pb.MyTeamDisappear.decode(t);this.showTeamDisappearTips(i,e)},i.showTeamDisappearTips=function(e,i){void 0===i&&(i=!1);var r=e.Arg,n=null;if(r){var o=pb.TargetCity.decode(r);n=t.CityMgr.inst.getCity(o.CityID)}switch(e.Reason){case pb.MyTeamDisappear.ReasonEnum.CityBeOccupy:n&&Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70342),n.cityName));break;case pb.MyTeamDisappear.ReasonEnum.OccupyCity:n&&(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70343),n.cityName)),i&&t.WarMgr.inst.warView.map.moveCenter(n));break;case pb.MyTeamDisappear.ReasonEnum.EnterCity:n&&(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70344),n.cityName)),i&&t.WarMgr.inst.warView.map.moveCenter(n));break;case pb.MyTeamDisappear.ReasonEnum.NoForage:break;case pb.MyTeamDisappear.ReasonEnum.CountryDestory:Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70345))}},i}(t.TeamStatusDelegate);t.WarTeam=e,__reflect(e.prototype,"War.WarTeam")}(War||(War={}));var War;!function(t){var e=function(){function e(){this._myTeam=null,this._teamList=new Collection.Dictionary,this._myTeam=null}return Object.defineProperty(e,"inst",{get:function(){return e._inst||(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),e.prototype.setMyTeam=function(e){this._myTeam&&this._myTeam.onDestroy(),this._myTeam=e,console.log("setMyTeam ",this._myTeam.teamID),t.WarMgr.inst.warView.setCloseBtn(!1)},e.prototype.newMyTeam=function(e){var i=new t.WarTeam(e,!1);this.setMyTeam(i),i.changeStatus(e.State)},e.prototype.addOtherTeam=function(t){t.isMyTeam()||(console.log("addOtherTeam ",t.teamID),this._teamList.setValue(t.teamID,t))},e.prototype.delOtherTeam=function(t){var e=this._teamList.getValue(t);e&&(console.log("delOtherTeam ",t),e.onDestroy(),this._teamList.remove(t))},e.prototype.getOtherTeam=function(t){return this._teamList.getValue(t)},Object.defineProperty(e.prototype,"myTeam",{get:function(){return this._myTeam},enumerable:!0,configurable:!0}),e.prototype.cleanMyTeam=function(){this._myTeam&&(this._myTeam.onDestroy(),this._myTeam=null,console.log("cleanMyTeam")),t.WarMgr.inst.warView.setCloseBtn(!0)},Object.defineProperty(e.prototype,"otherTeam",{get:function(){return this._teamList},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allOtherTeams",{get:function(){return this._teamList.values()},enumerable:!0,configurable:!0}),e.prototype.onDestroy=function(){this._myTeam&&(this._myTeam.onDestroy(),this._myTeam=null),this._teamList.forEach(function(t,e){e.onDestroy()}),this._teamList.clear()},e}();t.WarTeamMgr=e,__reflect(e.prototype,"War.WarTeamMgr")}(War||(War={}));var Core;!function(t){function e(t,e){if(t.hasOwnProperty(i))t[i].push(e);else{var r=[e];t[i]&&(r=t[i].concat(r)),t[i]=r}}var i="__bindables__";t.registerBindable=e}(Core||(Core={}));var Collection;!function(t){function e(t,e){return e>t?-1:t===e?0:1}function i(t,e){return t===e}function r(t){return null===t?"COLLECTION_NULL":s(t)?"COLLECTION_UNDEFINED":a(t)?"$s"+t:"$o"+t.toString()}function n(e,i){if(void 0===i&&(i=","),null===e)return"COLLECTION_NULL";if(s(e))return"COLLECTION_UNDEFINED";if(e instanceof String||e instanceof Number)return e.toString();var r="{",n=!0;for(var o in e)t.has(e,o)&&(n?n=!1:r+=i,r=r+o+":"+e[o]);return r+"}"}function o(t){return"function"==typeof t}function s(t){return"undefined"==typeof t}function a(t){return"[object String]"===Object.prototype.toString.call(t)}function u(t){return s(t)||!o(t)?function(t,e){return e>t?1:t===e?0:-1}:function(e,i){return-1*t(e,i)}}function h(t){return function(e,i){return 0===t(e,i)}}var l=Object.prototype.hasOwnProperty;t.has=function(t,e){return l.call(t,e)},t.defaultCompare=e,t.defaultEquals=i,t.defaultToString=r,t.makeString=n,t.isFunction=o,t.isUndefined=s,t.isString=a,t.reverseCompareFunction=u,t.compareToEquals=h}(Collection||(Collection={}));var Collection;!function(t){function e(e,i,r){for(var n=r||t.defaultEquals,o=e.length,s=0;o>s;s++)if(n(e[s],i))return s;return-1}function i(e,i,r){for(var n=r||t.defaultEquals,o=e.length,s=o-1;s>=0;s--)if(n(e[s],i))return s;return-1}function r(t,i,r){return e(t,i,r)>=0}function n(t,i,r){var n=e(t,i,r);return 0>n?!1:(t.splice(n,1),!0)}function o(e,i,r){for(var n=r||t.defaultEquals,o=e.length,s=0,a=0;o>a;a++)n(e[a],i)&&s++;return s}function s(e,i,r){var n=r||t.defaultEquals;if(e.length!==i.length)return!1;for(var o=e.length,s=0;o>s;s++)if(!n(e[s],i[s]))return!1;return!0}function a(t){return t.concat()}function u(t,e,i){if(0>e||e>=t.length||0>i||i>=t.length)return!1;var r=t[e];return t[e]=t[i],t[i]=r,!0}function h(t){return"["+t.toString()+"]"}function l(t,e){for(var i=0,r=t;i<r.length;i++){var n=r[i];if(e(n)===!1)return}}t.indexOf=e,t.lastIndexOf=i,t.contains=r,t.remove=n,t.frequency=o,t.equals=s,t.copy=a,t.swap=u,t.toString=h,t.forEach=l}(Collection||(Collection={}));var Core;!function(t){var e=function(){function t(){}return t.defaultFont="AaKaiTi",t.defaultFontSize=27,t}();t.UIConfig=e,__reflect(e.prototype,"Core.UIConfig")}(Core||(Core={}));var Collection;!function(t){function e(t){return null===t.next}var i=function(){function t(t,e){this.key=t,this.value=e}return t.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},t}();__reflect(i.prototype,"LinkedDictionaryPair",["Collection.IDictionaryPair"]);var r=function(){function t(){this.key=null,this.value=null}return t.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},t}();__reflect(r.prototype,"HeadOrTailLinkedDictionaryPair",["Collection.IDictionaryPair"]);var n=function(n){function o(t){var e=n.call(this,t)||this;return e.head=new r,e.tail=new r,e.head.next=e.tail,e.tail.prev=e.head,e}return __extends(o,n),o.prototype.appendToTail=function(t){var e=this.tail.prev;e.next=t,t.prev=e,t.next=this.tail,this.tail.prev=t},o.prototype.getLinkedDictionaryPair=function(e){if(!t.isUndefined(e)){var i="$"+this.toStr(e),r=this.table[i];return r}},o.prototype.getValue=function(e){var i=this.getLinkedDictionaryPair(e);return t.isUndefined(i)?void 0:i.value},o.prototype.remove=function(e){var i=this.getLinkedDictionaryPair(e);return t.isUndefined(i)?void 0:(n.prototype.remove.call(this,e),i.unlink(),i.value)},o.prototype.clear=function(){n.prototype.clear.call(this),this.head.next=this.tail,this.tail.prev=this.head},o.prototype.replace=function(t,e){var i="$"+this.toStr(e.key);e.next=t.next,e.prev=t.prev,this.remove(t.key),e.prev.next=e,e.next.prev=e,this.table[i]=e,++this.nElements},o.prototype.setValue=function(e,r){if(!t.isUndefined(e)&&!t.isUndefined(r)){var n=this.getLinkedDictionaryPair(e),o=new i(e,r),s="$"+this.toStr(e);return t.isUndefined(n)?(this.appendToTail(o),this.table[s]=o,void++this.nElements):(this.replace(n,o),n.value)}},o.prototype.keys=function(){var t=[];return this.forEach(function(e,i){t.push(e)}),t},o.prototype.values=function(){var t=[];return this.forEach(function(e,i){t.push(i)}),t},o.prototype.forEach=function(t){for(var i=this.head.next;!e(i);){var r=t(i.key,i.value);if(r===!1)return;i=i.next}},o}(t.Dictionary);t.LinkedDictionary=n,__reflect(n.prototype,"Collection.LinkedDictionary")}(Collection||(Collection={}));var War;!function(t){t.ST_NONE=-1;var e;!function(t){t[t.ST_NORMAL=0]="ST_NORMAL",t[t.ST_PREPARE=1]="ST_PREPARE",t[t.ST_DURING=2]="ST_DURING",t[t.ST_END=3]="ST_END",t[t.ST_UNIFIED=4]="ST_UNIFIED"}(e=t.BattleStatusName||(t.BattleStatusName={}));var i;!function(t){t[t.ST_ALIVE=0]="ST_ALIVE",t[t.ST_DEFEAT=1]="ST_DEFEAT"}(i=t.CountryStatusName||(t.CountryStatusName={}));var r;!function(t){t[t.ST_NORMAL=0]="ST_NORMAL",t[t.ST_ATTACKED=1]="ST_ATTACKED",t[t.ST_FALLEN=2]="ST_FALLEN"}(r=t.CityStatusName||(t.CityStatusName={}));var n;!function(t){t[t.ST_NORMAL=0]="ST_NORMAL",t[t.ST_ARREST=1]="ST_ARREST",t[t.ST_KICKOUT=2]="ST_KICKOUT",t[t.ST_SUPPORT=3]="ST_SUPPORT",t[t.ST_EXPEDITION=4]="ST_EXPEDITION",t[t.ST_DEFEND=5]="ST_DEFEND",t[t.ST_RECTIFY=6]="ST_RECTIFY",t[t.ST_REST=7]="ST_REST"}(n=t.PlayerStatusName||(t.PlayerStatusName={}));var o;!function(t){t[t.ST_NORMAL=0]="ST_NORMAL",t[t.ST_FIELD_BATTLE=1]="ST_FIELD_BATTLE",t[t.ST_CAN_ATT_CITY=2]="ST_CAN_ATT_CITY",t[t.ST_ATTACKING_CITY=3]="ST_ATTACKING_CITY",t[t.ST_DISAPPEAR=4]="ST_DISAPPEAR",t[t.ST_FIELD_BATTLE_END=5]="ST_FIELD_BATTLE_END",t[t.ST_ATT_CITY=6]="ST_ATT_CITY",t[t.ST_DEF_CITY=7]="ST_DEF_CITY",t[t.ST_DEF_BATTLE_END=8]="ST_DEF_BATTLE_END"}(o=t.TeamStatusName||(t.TeamStatusName={}))}(War||(War={}));var Collection;!function(t){var e=function(){function t(){this.prev=null,this.next=null,this.obj=null}return t}();__reflect(e.prototype,"Entry");var i=function(){function i(){this._head=new e,this._head.prev=this._head,this._head.next=this._head,this._objMap=new t.Dictionary}return i.prototype._insert=function(t,i,r){var n=new e;n.obj=t,this._objMap.setValue(t,n),n.prev=i,n.next=r,r.prev=n,i.next=n},i.prototype._remove=function(t){t.next.prev=t.prev,t.prev.next=t.next,this._objMap.remove(t.obj)},i.prototype.push=function(t,e){var i=null;e&&(i=this._objMap.getValue(e)),i||(i=this._head.prev),this._insert(t,i,i.next)},i.prototype.pushFront=function(t,e){var i=null;e&&(i=this._objMap.getValue(e)),i||(i=this._head.next),this._insert(t,i.prev,i)},i.prototype.isEmpty=function(){return this._head.next==this._head||this._head.prev==this._head},i.prototype.getFront=function(){return this.isEmpty()?null:this._head.next.obj},i.prototype.popFront=function(){if(this.isEmpty())return null;var t=this._head.next;return this._remove(t),t.obj},i.prototype.getBack=function(){return this.isEmpty()?null:this._head.prev.obj},i.prototype.popBack=function(){if(this.isEmpty())return null;var t=this._head.prev;return this._remove(t),t.obj},i.prototype.getNext=function(t){var e=this._objMap.getValue(t);return e.next.obj},i.prototype.getPrev=function(t){var e=this._objMap.getValue(t);return e.prev.obj},i.prototype.reverse=function(){for(var t=this._head.next;t!=this._head;){var e=t.next;t.next=t.prev,t.prev=e,t=e}var i=this._head.next,r=this._head.prev;this._head.next=r,this._head.prev=i},i.prototype.remove=function(t){var e=this._objMap.getValue(t);e&&this._remove(e)},i.prototype.forEach=function(t,e){if(void 0===e&&(e=!1),e)for(var i=this._head.prev;i!=this._head;i=i.prev)t(i.obj);else for(var i=this._head.next;i!=this._head;i=i.next)t(i.obj)},Object.defineProperty(i.prototype,"length",{get:function(){return this._objMap.keys.length},enumerable:!0,configurable:!0}),i.prototype.clear=function(){this._head.next=this._head,this._head.prev=this._head,this._objMap.clear()},i}();t.List=i,__reflect(i.prototype,"Collection.List")}(Collection||(Collection={}));var WXGame;!function(t){function e(t,e){var i=pb.WxInviteBattleResult.decode(e);Core.EventCenter.inst.dispatchEventWith(GameEvent.WXInviteBattleResEv,!1,i.Result)}function i(e,i){if(t.WXGameMgr.inst.isExamineVersion){var r=pb.TreasureBeHelp.decode(i),n=Treasure.TreasureMgr.inst().curActivatingTreasure;n.id==r.TreasureID?(n.openTime=Math.max(0,r.OpenTimeout),n.openTime<=0&&Treasure.TreasureMgr.inst().onTreasureCountDownDone(n),n.fireUpdateEvent(),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60242))):console.log("rpc_WXTreasureBeHelp treasure id wrong, ",n.id,r.TreasureID)}}function r(e,i){if(t.WXGameMgr.inst.isExamineVersion){var r=Treasure.TreasureMgr.inst().getDailyTreasure();r.isDouble=!0;var n=Core.ViewManager.inst.getView(ViewName.dailyTreasureDouble);n&&(n.refresh(r),Core.TipsUtils.showTipsFromCenter("已得到好友的帮助，每日宝箱奖励翻倍！"))}}function n(t,e){var i=pb.BattleLoseBeHelp.decode(e),r=Core.ViewManager.inst.getView(ViewName.pvpNewBattleEnd);r&&r.onBeHelpToPreventLoseStar(i.AddStar)}function o(e,i){var r=pb.WxExamineState.decode(i);t.WXGameMgr.inst.isExamineVersion=r.IsExamined}function s(e,i){if(t.WXGameMgr.inst.isExamineVersion){var r=pb.WxShareBeHelpArg.decode(i);t.WXShareMgr.inst.shareBeHelped(r)}}function a(){Net.registerRpcHandler(pb.MessageID.S2C_WX_INVITE_BATTLE_RESULT,e),Net.registerRpcHandler(pb.MessageID.S2C_TREASURE_BE_HELP,i),Net.registerRpcHandler(pb.MessageID.S2C_DAILY_TREASURE_BE_HELP,r),Net.registerRpcHandler(pb.MessageID.S2C_BATTLE_LOSE_BE_HELP,n),Net.registerRpcHandler(pb.MessageID.S2C_UPDATE_WX_EXAMINE_STATE,o),Net.registerRpcHandler(pb.MessageID.S2C_WX_SHARE_BE_HELP,s)}t.initRpc=a}(WXGame||(WXGame={}));var WXGame;!function(t){var e=function(){function t(){this._advertCom1=null,this._advertCom2=null}return Object.defineProperty(t,"inst",{get:function(){return null==t._inst&&(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype._getFloatAdertIconInfo=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return t=platform,console.log("getFloatAdertIconInfo2"),[4,t.getFloatIconInfo()];case 1:return e=i.sent(),console.log("++++++ res: ",e),[2,e]}})})},t.prototype.genAdertIcons=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){switch(o.label){case 0:return[4,this._getFloatAdertIconInfo()];case 1:return i=o.sent(),i||(t.alpha=0,e.alpha=0),r=i[0],r?(this._advertCom1=t,this._advertCom1.setData(r)):t.alpha=0,n=i[1],n?(this._advertCom2=e,this._advertCom2.setData(n)):e.alpha=0,[2]}})})},t.prototype.onMatchViewVisible=function(t){},t._inst=null,t}();t.WXAdvertMgr=e,__reflect(e.prototype,"WXGame.WXAdvertMgr");var i=function(){function e(){var e=this;this._rewardedVideoAd=null,this._lastErrCode=-1,this._isAdsReaddy=!1,this._errCode2Msg={},this._errCode2Msg[0]="微信平台广告次数已达上限",this._errCode2Msg[1e3]="后端接口调用失败",this._errCode2Msg[1001]="参数错误",this._errCode2Msg[1002]="广告单元无效",this._errCode2Msg[1003]="内部错误",this._errCode2Msg[1004]="无合适的广告",this._errCode2Msg[1005]="广告组件审核中",this._errCode2Msg[1006]="广告组件被驳回",this._errCode2Msg[1007]="广告组件被封禁",this._errCode2Msg[1008]="广告单元已关闭";var i=wx.getSystemInfoSync();console.log("check system info: ",i),i.SDKVersion>="2.0.4"&&(this._adUnitId=t.WXGameMgr.inst.wxConfig.adUnitId,this._rewardedVideoAd=wx.createRewardedVideoAd({adUnitId:this._adUnitId}),this._rewardedVideoAd.onLoad(function(){console.log("++++ ads load success"),e._isAdsReaddy=!0}),this._rewardedVideoAd.onError(function(t){console.log("++++ ads load fail: ",t.errCode,t.errMsg),e._lastErrCode=t.errCode,e._isAdsReaddy=!1}),this._rewardedVideoAd.onClose(function(t){console.log("++++ ads closed: ",t),e._watchAdsResolve&&(i.SDKVersion<"2.1.0"?(e._onEndAds(!0),e._watchAdsResolve(!0)):(e._onEndAds(t.isEnded),e._watchAdsResolve(t.isEnded)),e._watchAdsResolve=null)})),this._watchAdsResolve=null}return Object.defineProperty(e,"inst",{get:function(){return e._inst||(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},e.prototype.isAdsOpen=function(){return!0},e.prototype.isAdsReady=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return!this._isAdsReaddy&&this._rewardedVideoAd&&this._rewardedVideoAd.load(),this._isAdsReaddy?[2,{success:!0,reason:""}]:(t=this._errCode2Msg[this._lastErrCode],t?[2,{success:!1,reason:t}]:[2,{success:!1,reason:"视频广告还未准备好，请稍后再试"}])})})},e.prototype._onBeginAds=function(){Home.HomeMgr.inst.stopBgSound(!1),Net.rpcPush(pb.MessageID.C2S_WATCH_ADS_BEGIN,null),this._isAdsReaddy=!1},e.prototype._onEndAds=function(t){Home.HomeMgr.inst.playBgSound(),t&&Net.rpcPush(pb.MessageID.C2S_WATCH_ADS_END,null)},e.prototype.showRewardAds=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return this._onBeginAds(),[2,new Promise(function(e){t._rewardedVideoAd.show().then(function(){console.log("++++ ads show success"),t._watchAdsResolve=e})["catch"](function(i){console.log("++++ ads show fail"),t._rewardedVideoAd.load().then(function(){t._rewardedVideoAd.show(),console.log("++++ ads show success2"),t._watchAdsResolve=e})["catch"](function(i){console.log("++++ ads show fail2"),t._onEndAds(!1),e(!1)})})})]})})},e.prototype.showBannerAds=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,!1]})})},e._inst=null,e}();t.WXAdsPlatform=i,__reflect(i.prototype,"WXGame.WXAdsPlatform",["AdvertisePlatform"])}(WXGame||(WXGame={}));var WXGame;!function(t){function e(){t.initRpc(),i.inst.initMgr(),Core.ViewManager.inst.registerConstructor(ViewName.shareRewardTreasure,function(){var e=new t.WXTreasureShareReward;return e.contentPane=fairygui.UIPackage.createObject(PkgName.treasure,ViewName.shareRewardTreasure).asCom,e}),Core.ViewManager.inst.registerConstructor(ViewName.shareGetTreasure,function(){var e=new t.WXTreasureGetReward;return e.contentPane=fairygui.UIPackage.createObject(PkgName.treasure,ViewName.shareGetTreasure).asCom,e})}var i=function(){function e(){this._isSharing=!1,this._sessionKey="",this._isExamineVersion=!0,this._pt=1e3,this._lastHandledOption=null;var t=wx.getSystemInfoSync();this._platform=t.platform,this._wxConfig=RES.getRes("wxconfig_json"),console.log("++++++++ ",this._platform,this._wxConfig,t.model);for(var e=["iPhone X","PAR-AL00"],i=0;i<e.length;i++)if(t.model.indexOf(e[i])>=0){window.support.topMargin=38,window.support.bottomMargin=10;break}this._onShowCallbacks=[]}return Object.defineProperty(e,"inst",{get:function(){return null==e._inst&&(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),e.getWebClientHost=function(){return"https://client.lzd2.openew.com/"+window.gameGlobal.resPrefix},e.getOpenDataContextBitmap=function(t,e){return this._openDataContextBitmap||(this._openDataContextBitmap=platform.openDataContext.createDisplayObject(1,t,e)),this._openDataContextBitmap},e.prototype.initMgr=function(){var t=this;Core.EventCenter.inst.addEventListener("WXGAME_ONSHOW",this._onWXGameOnShow,this),Core.EventCenter.inst.addEventListener("WXGAME_ONHIDE",this._onWXGameOnHide,this),Core.EventCenter.inst.addEventListener("WXGAME_OPTIONS",this._onWXGameOptions,this),Core.EventCenter.inst.addEventListener(GameEvent.WXInviteBattleResEv,this._onInviteBattleResult,this),Player.inst.addEventListener(Player.PvpScoreChangeEvt,function(){t.cloudStorePvpData()},this)},e.prototype.registerOnShowCallback=function(t){this._onShowCallbacks.push(t)},Object.defineProperty(e.prototype,"lastHandledOption",{get:function(){return this._lastHandledOption},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isExamineVersion",{get:function(){return this._isExamineVersion},set:function(t){this._isExamineVersion=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"curShareId",{get:function(){return this._curShareId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"curShareType",{get:function(){return this._curShareType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInHuoshuWhiteList",{get:function(){return this._isInHuoShuWhiteList},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"platform",{get:function(){return this._platform},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wxConfig",{get:function(){return this._wxConfig},enumerable:!0,configurable:!0}),e.prototype.onLogin=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o;return __generator(this,function(s){if(e=t.channel_username,i=t.avatar,this._pt=t.pt,this._isInHuoShuWhiteList=t.isWhiteList,Player.inst.isNewbieName(Player.inst.name)||(e=Player.inst.name),Player.inst.name=e,Player.inst.avatarUrl=i,r={NickName:e,HeadImgUrl:i},0==Player.inst.guideCamp&&this._launchOptions)try{n=this._launchOptions.query,this._isValidateQuery(n)&&n.uid&&(o=Core.StringUtils.stringToLong(n.uid),o!=Player.inst.uid&&(r.InviterUid=o))}catch(a){console.log(a)}return Net.rpcCall(pb.MessageID.C2S_UPDATE_SDK_USER_INFO,pb.SdkUserInfo.encode(r)),[2]})})},e.prototype.onBattleEnd=function(){wx.triggerGC(),console.log("triggerGC")},e.prototype._isValidateQuery=function(t){return t&&"lzd"==t.tag},e.prototype._onWXGameOnShow=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return e=t.data,console.log("_onWXGameOnShow",e),this._showOptions=e,this._showOptions&&this._showOptions.query?[4,this._handleLaunchOptions(this._showOptions)]:[3,2];case 1:i.sent(),i.label=2;case 2:return setTimeout(function(){Core.MaskUtils.forbidTimeout(!0)},1),console.log("++++++++ begin onshow callback"),this._onShowCallbacks.forEach(function(t){console.log("++++++++ onshow callback"),t()}),this._onShowCallbacks=[],console.log("++++++++ end onshow callback"),[2]}})})},e.prototype._onWXGameOnHide=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return console.log("_onWXGameOnHide"),Core.MaskUtils.forbidTimeout(!0),[2]})})},e.prototype._onWXGameOptions=function(t){var e=t.data;console.log("_onWXGameOptions",e),this._launchOptions=e},e.prototype.hasLaunchActionToHandle=function(){if(this._launchOptions&&this._isValidateQuery(this._launchOptions.query)){var e=this._launchOptions.query.act;if(e==t.WXShareType.SHARE_FIGHT||e==t.WXShareType.SHARE_VEDIO)return!0
}return!1},e.prototype.tryHandleLaunchOptions=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this._handleLaunchOptions(this._launchOptions)];case 1:return t.sent(),[2]}})})},e.prototype._handleLaunchOptions=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a,u,h,l,c,d,p,_,g,d,a,g,d,g,f=this;return __generator(this,function(m){switch(m.label){case 0:if(e&&!this._isValidateQuery(e.query))return[2];try{i=parseInt(e.query.act),r=parseInt(e.query.shareId),n=Core.StringUtils.stringToLong(e.query.uid),o=e.query.name}catch(y){return console.log("parse query failed"),[2]}return s=null,i!=t.WXShareType.SHARE_GRP_RANK?[3,2]:[4,this._handleLaunchGroupRank(e.shareTicket)];case 1:return m.sent(),[3,21];case 2:return i!=t.WXShareType.SHARE_TREASURE&&i!=t.WXShareType.SHARE_DAILY_REWARD_DOUBLE?[3,4]:(a=parseInt(e.query.treasureId),[4,this._handleLaunchHelpTreasure(n,o,a,i)]);case 3:return m.sent(),[3,21];case 4:return i!=t.WXShareType.SHARE_FIGHT?[3,6]:[4,this._handleLaunchFight(n,o)];case 5:return m.sent(),[3,21];case 6:return i!=t.WXShareType.SHARE_INVITE?[3,7]:[3,21];case 7:return i!=t.WXShareType.SHARE_REWARD?[3,9]:(u=parseInt(e.query.hid),[4,this._handleLaunchGetShareReward(n,u,o)]);case 8:return m.sent(),[3,21];case 9:return i!=t.WXShareType.SHARE_VEDIO?[3,11]:(h=Core.StringUtils.stringToLong(e.query.battleId),[4,this._handleLaunchBattleVedio(o,h)]);case 10:return m.sent(),[3,21];case 11:return i!=t.WXShareType.SHARE_PREVENT_LOSE?[3,13]:[4,this._handleLaunchHelpBattleLose(n,o)];case 12:return m.sent(),[3,21];case 13:return i!=t.WXShareType.SHARE_LEVEL_HELP?[3,15]:(l=parseInt(e.query.levelId),c=parseInt(e.query.time),[4,this._handleLaunchHelpLevel(n,o,l,c)]);case 14:return m.sent(),[3,21];case 15:return i!=t.WXShareType.SHARE_FREE_GOLD&&i!=t.WXShareType.SHARE_FREE_JADE&&i!=t.WXShareType.SHARE_FREE_TREASURE?[3,17]:n==Player.inst.uid?[2]:[4,new Promise(function(t){Core.TipsUtils.confirm("要为<"+o+">集赞获得免费礼品吗？",function(){Core.TipsUtils.showTipsFromCenter("你点了个赞，对方获得了免费的商城礼品！"),t(!0)},function(){t(!1)},f,"赞","踩")})];case 16:return(d=m.sent())?(p=parseInt(e.query.freeId),_=parseInt(e.query.freeType),g={Type:_,ID:p},s=pb.WatchShopFreeAdsArg.encode(g).finish(),[3,21]):[2];case 17:return i!=t.WXShareType.SHARE_TREASURE_ADD_CARD?[3,19]:n==Player.inst.uid?[2]:[4,new Promise(function(t){Core.TipsUtils.confirm("要助力<"+o+">获得更多卡牌吗？",function(){Core.TipsUtils.showTipsFromCenter("对方已获得你的助力，可以开到更多的卡牌。"),t(!0)},function(){t(!1)},f,"助力","算了")})];case 18:return(d=m.sent())?(a=parseInt(e.query.treasureId),g={TreasureID:a},s=pb.TargetTreasure.encode(g).finish(),[3,21]):[2];case 19:return i!=t.WXShareType.SHARE_UP_TREASURE?[3,21]:n==Player.inst.uid?[2]:[4,new Promise(function(t){Core.TipsUtils.confirm("要帮助<"+o+">升级宝箱吗？",function(){Core.TipsUtils.showTipsFromCenter("已帮助对方宝箱升级。"),t(!0)},function(){t(!1)},f,"帮助","算了")})];case 20:if(d=m.sent(),!d)return[2];m.label=21;case 21:return this._lastHandledOption=e,n!=Player.inst.uid&&(g={ShareID:r,ShareUid:n,ShareType:i},s&&(g.Data=s),Net.rpcPush(pb.MessageID.C2S_CLICK_WXGAME_SHARE,pb.ClickWxgameShareArg.encode(g))),[2]}})})},e.prototype._handleLaunchGroupRank=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t&&!Pvp.PvpMgr.inst.isNewbie()&&(Core.ViewManager.inst.close(ViewName.wxgameFriendRankView),Core.ViewManager.inst.open(ViewName.wxgameFriendRankView,"group",t)),[2]})})},e.prototype._handleLaunchHelpTreasure=function(e,i,r,n){return __awaiter(this,void 0,void 0,function(){var o,s=this;return __generator(this,function(a){return console.log("_handleLaunchHelpTreasure "+e+", "+r),Pvp.PvpMgr.inst.isNewbie()||null==e||null==r||e==Player.inst.uid||(o="",o=n==t.WXShareType.SHARE_DAILY_REWARD_DOUBLE?"要帮助<"+i+">加倍每日宝箱的奖励吗？？":"要帮助<"+i+">加速宝箱开启吗？",Core.TipsUtils.confirm(o,function(){return __awaiter(s,void 0,void 0,function(){return __generator(this,function(t){return Core.TipsUtils.showTipsFromCenter("对方感受到了你的热情。"),[2]})})},null,this,"帮助","算了")),[2]})})},e.prototype._handleLaunchFight=function(t,e){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(r){return t&&e&&!Pvp.PvpMgr.inst.isNewbie()&&!Battle.BattleMgr.inst.battle&&Player.inst.uid!=t&&Core.TipsUtils.confirm("是否接受<"+e+">的约战邀请？",function(){return __awaiter(i,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return e={Uid:t},[4,Net.rpcCall(pb.MessageID.C2S_WX_REPLY_INVITE_BATTLE,pb.ReplyWxInviteBattleArg.encode(e),!0,!1)];case 1:return i=r.sent(),0==i.errcode?Core.TipsUtils.showTipsFromCenter("约战成功！"):Core.TipsUtils.showTipsFromCenter("对方已不再等待"),[2]}})})},null,this,"同意","拒绝"),[2]})})},e.prototype._handleLaunchGetShareReward=function(t,e,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return Player.inst.uid==t?[2]:(e&&(Core.ViewManager.inst.close(ViewName.shareGetTreasure),Core.ViewManager.inst.open(ViewName.shareGetTreasure,e,i)),[2])})})},e.prototype._handleLaunchBattleVedio=function(t,e){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(r){return Pvp.PvpMgr.inst.isNewbie()||Battle.BattleMgr.inst.battle||Core.TipsUtils.confirm("是否观看<"+t+">分享的一场精彩对局？",function(){return __awaiter(i,void 0,void 0,function(){var t,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return t={VideoID:e},[4,Net.rpcCall(pb.MessageID.C2S_WATCH_VIDEO,pb.WatchVideoArg.encode(t))];case 1:if(i=o.sent(),0!=i.errcode)return[3,5];r=pb.WatchVideoResp.decode(i.payload),o.label=2;case 2:return o.trys.push([2,4,,5]),[4,Battle.VideoPlayer.inst.play(r.VideoData)];case 3:return o.sent(),[3,5];case 4:return n=o.sent(),console.log(n),[3,5];case 5:return[2]}})})},null,this,"观看","算了"),[2]})})},e.prototype._handleLaunchHelpBattleLose=function(t,e){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(r){return t&&t!=Player.inst.uid&&Core.TipsUtils.confirm("要帮助一下<"+e+">，挽回他的失败吗？",function(){return __awaiter(i,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return e={ShareUid:t},[4,Net.rpcCall(pb.MessageID.C2S_HELP_SHARE_BATTLE_LOSE,pb.HelpShareBattleLoseArg.encode(e))];case 1:return i=r.sent(),0==i.errcode&&Core.TipsUtils.showTipsFromCenter("对方避免了掉级的命运。"),[2]}})})},null,this,"帮助","算了"),[2]})})},e.prototype._handleLaunchHelpLevel=function(t,e,i,r){return __awaiter(this,void 0,void 0,function(){var n,o=this;return __generator(this,function(s){if(t&&i&&t!=Player.inst.uid&&!Pvp.PvpMgr.inst.isNewbie()&&!Battle.BattleMgr.inst.battle){if(n=Level.LevelMgr.inst.getLevel(i),!n)return Core.TipsUtils.showTipsFromCenter("分享关卡id错误"),[2];if(Date.now()/1e3-r>86400)return Core.TipsUtils.showTipsFromCenter("求助信息已经过了太久，求助者不知所踪。"),[2];Core.TipsUtils.confirm("要为<"+e+"挑战关卡<"+n.name+">吗？",function(){return __awaiter(o,void 0,void 0,function(){var e,r;return __generator(this,function(n){switch(n.label){case 0:return e={HelpUid:t,LevelID:i},[4,Net.rpcCall(pb.MessageID.C2S_LEVEL_HELP_OTHER,pb.LevelHelpArg.encode(e))];case 1:return r=n.sent(),0==r.errcode&&Core.TipsUtils.showTipsFromCenter("开始挑战！"),[2]}})})},null,this,"挑战","算了")}return[2]})})},e.prototype.onEnableShareMenuSuccess=function(t){console.log("onEnableShareMenuSuccess",JSON.stringify(t))},e.prototype.onDisableShareMenuSuccess=function(t){console.log("onDisableShareMenuSuccess",JSON.stringify(t))},e.prototype.onShareAppMessageSuccess=function(e,i){var r=this._curShareType;return void(r==t.WXShareType.SHARE_FIGHT&&this._handleShareInviteFight())},e.prototype.onShareAppMessageFail=function(t,e){},e.prototype.onShareAppMessageComplete=function(t){},e.prototype._handleShareInviteFight=function(){return __awaiter(this,void 0,void 0,function(){var t,e=this;return __generator(this,function(i){switch(i.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_WX_INVITE_BATTLE,null)];case 1:return t=i.sent(),0!=t.errcode?[3,3]:[4,Core.ViewManager.inst.open(ViewName.inviteWaiting,function(){return __awaiter(e,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_WX_CANCEL_INVITE_BATTLE,null)];case 1:return t=e.sent(),0==t.errcode&&Core.TipsUtils.showTipsFromCenter("约战已取消"),[2]}})})})];case 2:return i.sent(),[3,4];case 3:Core.TipsUtils.showTipsFromCenter("分享约战失败"),i.label=4;case 4:return[2]}})})},e.prototype._onInviteBattleResult=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=t.data,e==pb.WxInviteBattleResult.WxInviteResult.Timeout&&Core.TipsUtils.showTipsFromCenter("等待超时"),Core.ViewManager.inst.close(ViewName.inviteWaiting),[2]})})},e.prototype._handleShareTreasure=function(e){return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){switch(n.label){case 0:return i={TreasureID:t.WXShareMgr.inst.shareTreasureId,WxGroupID:e},[4,Net.rpcCall(pb.MessageID.C2S_SHARE_TREASURE,pb.ShareTreasureArg.encode(i))];case 1:return r=n.sent(),0==r.errcode||Core.TipsUtils.alert("不要频繁分享到同一个群哦。"),[2]}})})},e.prototype._handleSharePreventLoseStar=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return e={WxGroupID:t},[4,Net.rpcCall(pb.MessageID.C2S_SHARE_BATTLE_LOSE,pb.ShareBattleLoseArg.encode(e))];case 1:return i=r.sent(),0==i.errcode&&console.log("_handleSharePreventLoseStar success"),[2]}})})},e.prototype.setSessionKey=function(t){this._sessionKey=t},e.prototype.getBaseWXShareQuery=function(){return"tag=lzd&uid="+Player.inst.uid+"&name="+Player.inst.name},e.prototype.shareAppMessage=function(t,e,i,r,n,o){void 0===o&&(o=null),this._isSharing=!0,this._curShareType=r,this._curShareId=n,this._curShareData=o,sharePlatform.shareAppMsg(t,e,i)},e.prototype.cloudStorePvpData=function(){var t=Pvp.PvpMgr.inst.getPvpLevel(),e=Pvp.Config.inst.getPvpTitle(t),i=Pvp.PvpMgr.inst.getPvpStarCnt(Player.inst.getResource(ResType.T_SCORE));wx.setUserCloudStorage({KVDataList:[{key:"title",value:e},{key:"star",value:""+i},{key:"score",value:""+Player.inst.getResource(ResType.T_SCORE)}],success:function(t){console.log("setUserCloudStorage success: ",t)},fail:function(t){console.log("setUserCloudStorage fail: ",t)},complete:function(t){console.log("setUserCloudStorage complete: ",t)}})},e.prototype.onEnterGame=function(){var t=platform;t.onEnterGame(Player.inst.uid,Player.inst.name,1,1,"WXGameServer")},e.prototype.onCreateRole=function(){var t=platform;t.onCreateRole(Player.inst.uid,Player.inst.name,1,"WXGameServer")},e.prototype.exitGame=function(){wx.exitMiniProgram({success:function(){},fail:function(){Core.TipsUtils.showTipsFromCenter("退出游戏失败，请重启微信并进入游戏~")},complete:function(){}})},e.prototype.showConnectView=function(t){t?Core.ViewManager.inst.open(ViewName.connectView):Core.ViewManager.inst.close(ViewName.connectView)},e._inst=null,e._openDataContextBitmap=null,e}();t.WXGameMgr=i,__reflect(i.prototype,"WXGame.WXGameMgr"),t.init=e}(WXGame||(WXGame={}));var WXGame;!function(t){function e(){return r.inst.fsRoot}function i(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return RES.processor.map("image",new s),RES.processor.map("bin",new u),RES.processor.map("sound",new a),RES.processor.map("json",new h),RES.processor.map("text",new l),[4,r.inst.initFileVersionInfos()];case 1:return t.sent(),[2]}})})}var r=function(){function t(){this._NO_VERSION="n",this._fs=wx.getFileSystemManager(),this._dirCache=new Collection.Dictionary,this._fsRoot=wx.env.USER_DATA_PATH+"/",this._fsCacheFile="cached_file_version2.info",this._fsCacheVersionInfo={},this._dirty=!1,this._saving=!1,this._mkdirPromise=new Collection.Dictionary,this._isNewDownloader=!1,fairygui.GTimers.inst.add(6e4,-1,this._saveVersionFile,this)}return Object.defineProperty(t,"inst",{get:function(){return t._inst||(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype._saveVersionFile=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return!this._dirty||this._saving?[3,2]:(this._dirty=!1,this._saving=!0,t=JSON.stringify(this._fsCacheVersionInfo),[4,this.writeFile(this._fsCacheFile,t)]);case 1:e.sent(),console.log("saving version file, size = ",t.length),this._saving=!1,e.label=2;case 2:return[2]}})})},t.prototype.initFileVersionInfos=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.access(this._fsCacheFile)];case 1:return e.sent()?[3,3]:(this._isNewDownloader=!0,[4,this.writeFile(this._fsCacheFile,"{}")]);case 2:e.sent()||console.error("can't init file version info"),e.label=3;case 3:return[4,this.readFile(this._fsCacheFile,"utf8")];case 4:return t=e.sent(),t?this._fsCacheVersionInfo=JSON.parse(t):console.error("can't read file version info"),[2]}})})},Object.defineProperty(t.prototype,"isNewDownloader",{get:function(){return this._isNewDownloader},enumerable:!0,configurable:!0}),t.prototype.getFileLocalVersion=function(t){return this._fsCacheVersionInfo[t]},t.prototype.setFileLocalVersion=function(t,e){null==e&&(e=this._NO_VERSION),this._dirty=!0,this._fsCacheVersionInfo[t]=e,console.log("set "+t+" local version "+e)},Object.defineProperty(t.prototype,"fsRoot",{get:function(){return this._fsRoot},enumerable:!0,configurable:!0}),t.prototype.isRemotePath=function(t){return 0==t.indexOf("http://")||0==t.indexOf("https://")},t.prototype.getLocalFilePath=function(t){return t.split("?")[0]},t.prototype.getWXFilePath=function(t){return this._fsRoot+t},t.prototype.getFileVersion=function(t){var e=t.split("?");return e.length>=2?e[1]:null},t.prototype.fileExists=function(t,e){return void 0===e&&(e=null),__awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return i=this.getFileLocalVersion(t),null!=i?[3,4]:null!=e?[3,2]:[4,this.access(t)];case 1:return r.sent()?(this.setFileLocalVersion(t,this._NO_VERSION),[2,!0]):[2,!1];case 2:return[2,!1];case 3:return[3,5];case 4:return i==this._NO_VERSION&&null==e?[2,!0]:[2,e==i];case 5:return[2]}})})},t.prototype.dirExists=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this._dirCache.getValue(t)?[2,!0]:[3,1];case 1:return[4,this.access(t)];case 2:return[2,e.sent()]}})})},t.prototype.readFile=function(t,e){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(r){switch(r.label){case 0:return[4,new Promise(function(r){i._fs.readFile({filePath:i._fsRoot+t,encoding:e,success:function(t){r(t.data)},fail:function(t){console.error(t),r(null)},complete:function(t){}})})];case 1:return[2,r.sent()]}})})},t.prototype.writeFile=function(t,e,i){return void 0===i&&(i="utf8"),__awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(n){switch(n.label){case 0:return[4,new Promise(function(n){r._fs.writeFile({filePath:r._fsRoot+t,data:e,encoding:i,success:function(t){n(!0)},fail:function(t){console.error(t),n(!1)},complete:function(t){}})})];case 1:return[2,n.sent()]}})})},t.prototype.access=function(t){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(i){switch(i.label){case 0:return[4,new Promise(function(i){e._fs.access({path:e._fsRoot+t,success:function(t){i(!0)},fail:function(t){i(!1)},complete:function(t){}})})];case 1:return[2,i.sent()]}})})},t.prototype.unlink=function(t){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(i){switch(i.label){case 0:return[4,new Promise(function(i){e._fs.unlink({filePath:e._fsRoot+t,success:function(r){delete e._fsCacheVersionInfo[t],i(!0)},fail:function(t){console.error(t),i(!1)},complete:function(t){}})})];case 1:return[2,i.sent()]}})})},t.prototype.unzip=function(t,e){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(r){switch(r.label){case 0:return[4,new Promise(function(r){i._fs.unzip({zipFilePath:i._fsRoot+t,targetPath:i._fsRoot+e,success:function(t){r(!0)},fail:function(t){console.error(t),r(!1)},complete:function(t){}})})];case 1:return[2,r.sent()]}})})},t.prototype.dirname=function(t){var e=t.split("/");return e.pop(),e.join("/")},t.prototype.mkdir=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r=this;return __generator(this,function(n){switch(n.label){case 0:return e=this._mkdirPromise.getValue(t),e?[4,e]:[3,2];case 1:return[2,n.sent()];case 2:return i=new Promise(function(e){r._fs.mkdir({dirPath:r._fsRoot+t,success:function(i){r._mkdirPromise.remove(t),e(!0)},fail:function(i){console.error(i),r._mkdirPromise.remove(t),e(!1)},complete:function(t){}})}),this._mkdirPromise.setValue(t,i),[4,i];case 3:return[2,n.sent()]}})})},t.prototype.mkdirs=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return""==t?[2]:[4,this.dirExists(t)];case 1:if(o.sent())return[3,7];e=t.split("/"),console.log("mkdirs: ",JSON.stringify(e)),i="",r=0,o.label=2;case 2:return r<e.length?(n=e[r],i+=n+"/",[4,this.dirExists(i)]):[3,6];case 3:return o.sent()?[3,5]:[4,this.mkdir(i)];case 4:o.sent(),this._dirCache.setValue(i,!0),o.label=5;case 5:return++r,[3,2];case 6:return[3,8];case 7:return[2];case 8:return[2]}})})},t.prototype._downloadFile=function(t,e,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return[2,new Promise(function(r,n){var o=wx.downloadFile({url:t,filePath:e,success:function(i){if(i.statusCode>=400){try{wx.getFileSystemManager().accessSync(e),wx.getFileSystemManager().unlinkSync(e)}catch(o){console.error("_downloadFile fail, status error: ",t,e,o)}n("加载失败："+t)}else r(e)},fail:function(i){console.log("_downloadFile fail: ",t,e,i);var r=new RES.ResourceManagerError(1001,t);n(r)},complete:function(t){}});i&&o.onProgressUpdate(function(t){i(t)})})]})})},t.prototype.download=function(t,e,i){return __awaiter(this,void 0,void 0,function(){var r,n,o=this;return __generator(this,function(s){switch(s.label){case 0:return r=this.dirname(e),[4,this.mkdirs(r)];case 1:return s.sent(),n=this._fsRoot+e,[4,new Promise(function(r,s){o._downloadFile(t,n,i).then(function(i){var s=o.getFileVersion(t);o.setFileLocalVersion(e,s),r(n)},function(t){s(t)})})];case 2:return[2,s.sent()]}})})},t.prototype.xhrLoad=function(t,e,i,r){return __awaiter(this,void 0,void 0,function(){var n,o,s;return __generator(this,function(a){switch(a.label){case 0:return[4,new Promise(function(e,n){var o=new XMLHttpRequest;i&&(o.responseType=i),o.onload=function(){if(o.status>=400){var i="加载失败："+t;console.error(i),n(i)}else e(r?o.responseText:o.response)},o.onerror=function(){var e=new RES.ResourceManagerError(1001,t);console.error("xhrLoad error: ",e),n(e)},o.open("get",t),o.send()})];case 1:return n=a.sent(),o=this.dirname(e),[4,this.mkdirs(o)];case 2:return a.sent(),[4,this.writeFile(e,n)];case 3:return a.sent(),s=this.getFileVersion(t),this.setFileLocalVersion(e,s),[2,n]}})})},t._inst=null,t}();__reflect(r.prototype,"WXFileSystem");var n=function(){function e(){}return Object.defineProperty(e,"inst",{get:function(){return null==e._inst&&(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isNewbieLoader",{get:function(){return r.inst.isNewDownloader},enumerable:!0,configurable:!0}),e.prototype.loadZip=function(e,i,n){return void 0===n&&(n=!1),__awaiter(this,void 0,void 0,function(){var o,s,a,u;return __generator(this,function(h){switch(h.label){case 0:return o=t.WXGameMgr.getWebClientHost()+"/resource/"+e+"?v="+(n?window.gameGlobal.version:Math.random()),console.log(""+o),[4,r.inst.download(o,e,function(t){i&&i.onProgress(t.totalBytesWritten,t.totalBytesExpectedToWrite,null)})];case 1:return h.sent(),s="",[4,r.inst.dirExists(s)];case 2:return h.sent()?[3,4]:[4,r.inst.mkdir(s)];case 3:h.sent(),h.label=4;case 4:return[4,r.inst.unzip(e,s)];case 5:return h.sent()||console.error("can't unzip group ",e),[4,r.inst.fileExists("default.res.json")];case 6:return a=h.sent(),[4,r.inst.dirExists("king_ui")];case 7:return u=h.sent(),console.log("default.res.json exist "+a+" king_ui exist "+u),r.inst.unlink(e),[2]}})})},e.prototype.loadGroup=function(e,i,n,o){return void 0===o&&(o=!1),__awaiter(this,void 0,void 0,function(){var o,s,a;return __generator(this,function(u){switch(u.label){case 0:return o=e+".zip",s=t.WXGameMgr.getWebClientHost()+"/resource/"+o+"?v="+window.gameGlobal.version,[4,r.inst.download(s,o,function(t){i&&i.onProgress(t.totalBytesWritten,t.totalBytesExpectedToWrite,null)})];case 1:return u.sent(),a="",[4,r.inst.dirExists(a)];case 2:return u.sent()?[3,4]:[4,r.inst.mkdir(a)];case 3:u.sent(),u.label=4;case 4:return[4,r.inst.unzip(o,a)];case 5:return u.sent()||console.error("can't unzip group ",e),[4,r.inst.unlink(o)];case 6:return u.sent(),"sound"!=e?[3,8]:[4,RES.loadGroup(e,0,n,!0)];case 7:return u.sent(),[3,10];case 8:return[4,RES.loadGroup(e,0,n)];case 9:u.sent(),u.label=10;case 10:return[2]}})})},e._inst=null,e}();t.WXGroupLoader=n,__reflect(n.prototype,"WXGame.WXGroupLoader");var o=function(){function t(){}return t.prototype._shouldCache=function(t){return!0},t.prototype.prepareNewbieLoads=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,o,s;return __generator(this,function(a){switch(a.label){case 0:return n.inst.isNewbieLoader?t.groupNames&&t.groupNames.length>0?(e=t.url,i=r.inst.getFileVersion(e),o=r.inst.getLocalFilePath(e),s=r.inst.getFileLocalVersion(o),[4,r.inst.fileExists(o)]):[3,2]:[2,!1];case 1:return a.sent()?(r.inst.setFileLocalVersion(o,i),[2,!0]):[2,!1];case 2:return[2,!1];case 3:return[2]}})})},t}();__reflect(o.prototype,"WXGameLoaderBase");var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoadStart=function(t,e){return __awaiter(this,void 0,void 0,function(){var t,i,n,o,s,a,u,h,l=this;return __generator(this,function(c){switch(c.label){case 0:return t=e.root,i=e.url,n=null,e.scale9grid&&(o=e.scale9grid.split(","),n=new egret.Rectangle(parseInt(o[0]),parseInt(o[1]),parseInt(o[2]),parseInt(o[3]))),s=t+i,RES.getVirtualUrl&&(s=RES.getVirtualUrl(s)),r.inst.isRemotePath(s)?[4,this.prepareNewbieLoads(e)]:[3,8];case 1:return c.sent(),a=r.inst.getLocalFilePath(i),u=r.inst.getFileVersion(i),h=this._shouldCache(a),h?[4,r.inst.fileExists(a,u)]:[3,3];case 2:h=c.sent(),c.label=3;case 3:return h?[4,this._loadImage(r.inst.getWXFilePath(a),n)]:[3,5];case 4:return[2,c.sent()];case 5:return[4,new Promise(function(t,e){r.inst.download(s,a).then(function(i){console.log("download "+s+" success => "+i),l._loadImage(i,n).then(function(e){t(e)},function(t){console.error("_loadImage ",t),e(t)})},function(t){console.error("download ",t),e(t)})})];case 6:return[2,c.sent()];case 7:return[3,10];case 8:return[4,this._loadImage(s,n)];case 9:return[2,c.sent()];case 10:return[2]}})})},e.prototype.onRemoveStart=function(t,e){var i=t.get(e);return i&&i.dispose(),Promise.resolve()},e.prototype._loadImage=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return[2,new Promise(function(i,r){var n=wx.createImage();n.onload=function(){n.onload=null,n.onerror=null;var t=new egret.BitmapData(n);n=null;var r=new egret.Texture;r._setBitmapData(t),e&&(r.scale9Grid=e),setTimeout(function(){i(r)},0)},n.onerror=function(e){console.error(e);var i=new RES.ResourceManagerError(1001,t);r(i)},n.src=t})]})})},e}(o);__reflect(s.prototype,"WXImageProcessor",["RES.processor.Processor"]);var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoadStart=function(t,e){return __awaiter(this,void 0,void 0,function(){var t,i,n,o,s,a,u=this;return __generator(this,function(h){switch(h.label){case 0:return t=e.root,i=e.url,n=t+i,RES.getVirtualUrl&&(n=RES.getVirtualUrl(n)),r.inst.isRemotePath(n)?[4,this.prepareNewbieLoads(e)]:[3,8];case 1:return h.sent(),o=r.inst.getLocalFilePath(i),s=r.inst.getFileVersion(i),a=this._shouldCache(o),a?[4,r.inst.fileExists(o,s)]:[3,3];case 2:a=h.sent(),h.label=3;case 3:return a?[4,this._loadSound(r.inst.getWXFilePath(o))]:[3,5];case 4:return[2,h.sent()];case 5:return[4,new Promise(function(t,e){r.inst.download(n,o).then(function(i){console.log("download "+n+" success => "+i),u._loadSound(i).then(function(e){t(e)},function(t){console.error("_loadSound ",t),e(t)})},function(t){console.error("download ",t),e(t)})})];case 6:return[2,h.sent()];case 7:return[3,10];case 8:return[4,this._loadSound(n)];case 9:return[2,h.sent()];case 10:return[2]}})})},e.prototype.onRemoveStart=function(t,e){var i=t.get(e);return i&&i.close(),Promise.resolve()},e.prototype.onTempLoadDone=function(t,e,i){e.close(),console.log("temp load done, close sound ",i.url)},e.prototype._loadSound=function(t){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(i){return[2,new Promise(function(i,r){var n=new egret.Sound;n.load(t);var o=function(){n.removeEventListener(egret.Event.COMPLETE,o,e),n.removeEventListener(egret.IOErrorEvent.IO_ERROR,s,e),i(n)},s=function(){n.removeEventListener(egret.Event.COMPLETE,o,e),n.removeEventListener(egret.IOErrorEvent.IO_ERROR,s,e);var i=new RES.ResourceManagerError(1001,t);r(i)};n.addEventListener(egret.Event.COMPLETE,o,e),n.addEventListener(egret.IOErrorEvent.IO_ERROR,s,e)})]})})},e}(o);__reflect(a.prototype,"WXSoundProcessor",["RES.processor.Processor"]);var u=function(t){function e(){var e=t.call(this)||this;return e._wxSystemInfo=null,e}return __extends(e,t),e.prototype.onLoadStart=function(t,e){return __awaiter(this,void 0,void 0,function(){var t,i,n,o,s,a,u;return __generator(this,function(h){switch(h.label){case 0:return t=e.root,i=e.url,n=i.indexOf("://")>=0?i:t+i,RES.getVirtualUrl&&(n=RES.getVirtualUrl(n)),r.inst.isRemotePath(n)?[4,this.prepareNewbieLoads(e)]:[3,8];case 1:return h.sent(),o=r.inst.getLocalFilePath(i),s=r.inst.getFileVersion(i),a=this._shouldCache(o),a?[4,r.inst.fileExists(o,s)]:[3,3];case 2:a=h.sent(),h.label=3;case 3:return a?[4,r.inst.readFile(o)]:[3,5];case 4:return[2,h.sent()];case 5:return[4,r.inst.xhrLoad(n,o,"arraybuffer")];case 6:return u=h.sent(),console.log("download "+n+" success => "+r.inst.getWXFilePath(o)),this._needReadFile()&&(u=r.inst.readFile(o)),[2,u];case 7:return[3,10];case 8:return[4,r.inst.readFile(n)];case 9:return[2,h.sent()];case 10:return[2]}})})},e.prototype.onRemoveStart=function(t,e){return Promise.resolve()},e.prototype._needReadFile=function(){if(!this._wxSystemInfo){this._wxSystemInfo=wx.getSystemInfoSync();var t=this._wxSystemInfo.SDKVersion,e=this._wxSystemInfo.system.split(" ").shift();this._needReadFileFlag="2.2.3">=t&&"iOS"==e}return this._needReadFileFlag},e}(o);__reflect(u.prototype,"WXBinaryProcessor",["RES.processor.Processor"]);var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoadStart=function(t,e){return __awaiter(this,void 0,void 0,function(){var t,i,n,o,s,a,u,h,l,c,h;return __generator(this,function(d){switch(d.label){case 0:return t=e.root,i=e.url,n=i.indexOf("://")>=0?i:t+i,RES.getVirtualUrl&&(n=RES.getVirtualUrl(n)),r.inst.isRemotePath(n)?[4,this.prepareNewbieLoads(e)]:[3,9];case 1:return d.sent(),o=r.inst.getLocalFilePath(i),s=r.inst.getFileVersion(i),(a=this._useLocal(o))?[3,4]:(u=this._shouldCache(o),u?[4,r.inst.fileExists(o,s)]:[3,3]);case 2:u=d.sent(),d.label=3;case 3:a=u,d.label=4;case 4:return a?[4,r.inst.readFile(o,"utf8")]:[3,6];case 5:return h=d.sent(),l=JSON.parse(h),[2,l];case 6:return console.log("download "+n+" success => "+r.inst.getWXFilePath(o)),[4,r.inst.xhrLoad(n,o,null,!0)];case 7:return c=d.sent(),[2,JSON.parse(c)];case 8:return[3,11];case 9:return[4,r.inst.readFile(n,"utf8")];case 10:return h=d.sent(),[2,JSON.parse(h)];case 11:return[2]}})})},e.prototype.onRemoveStart=function(t,e){return Promise.resolve()},e.prototype._useLocal=function(t){for(var e=["serverlist","wxconfig"],i=0;i<e.length;++i)if(t.indexOf(e[i])>=0)return!0;return!1},e.prototype._shouldCache=function(t){for(var e=[],i=0;i<e.length;++i)if(t.indexOf(e[i])>=0)return!1;return!0},e}(o);__reflect(h.prototype,"WXJsonProcessor",["RES.processor.Processor"]);var l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoadStart=function(t,e){return __awaiter(this,void 0,void 0,function(){var t,i,n,o,s,a;return __generator(this,function(u){switch(u.label){case 0:return t=e.root,i=e.url,n=i.indexOf("://")>=0?i:t+i,RES.getVirtualUrl&&(n=RES.getVirtualUrl(n)),r.inst.isRemotePath(n)?[4,this.prepareNewbieLoads(e)]:[3,8];case 1:return u.sent(),o=r.inst.getLocalFilePath(i),s=r.inst.getFileVersion(i),a=this._shouldCache(o),a?[4,r.inst.fileExists(o,s)]:[3,3];case 2:a=u.sent(),u.label=3;case 3:return a?[4,r.inst.readFile(o,"utf8")]:[3,5];case 4:return[2,u.sent()];case 5:return console.log("download "+n+" success => "+r.inst.getWXFilePath(o)),[4,r.inst.xhrLoad(n,o,null,!0)];case 6:return[2,u.sent()];case 7:return[3,10];case 8:return[4,r.inst.readFile(n,"utf8")];case 9:return[2,u.sent()];case 10:return[2]}})})},e.prototype.onRemoveStart=function(t,e){return Promise.resolve()},e}(o);__reflect(l.prototype,"WXTextProcessor",["RES.processor.Processor"]),t.getFSRoot=e,t.initLoaders=i}(WXGame||(WXGame={}));var WXGame;!function(t){var e=function(){function t(){}return t.SHARE_FIGHT=1,t.SHARE_INVITE=2,t.SHARE_TREASURE=3,t.SHARE_REWARD=4,t.SHARE_GRP_RANK=5,t.SHARE_PREVENT_LOSE=6,t.SHARE_VEDIO=7,t.SHARE_SHOWOFF_TREASURE=8,t.SHARE_DAILY_REWARD_DOUBLE=9,t.SHARE_GAME=10,t.SHARE_LEVEL_HELP=11,t.SHARE_FREE_GOLD=12,t.SHARE_FREE_JADE=13,t.SHARE_FREE_TREASURE=14,t.SHARE_UP_TREASURE=15,t.SHARE_TREASURE_ADD_CARD=16,t}();t.WXShareType=e,__reflect(e.prototype,"WXGame.WXShareType");var i=function(){function i(){var t=this;this._shareType2IDS=new Collection.Dictionary;var e=Data.share_config.keys;e.forEach(function(e){var i=Data.share_config.get(e),r=i.type;t._shareType2IDS.containsKey(r)||t._shareType2IDS.setValue(r,[]);var n=t._shareType2IDS.getValue(r);n.push(e)})}return Object.defineProperty(i,"inst",{get:function(){return i._inst||(i._inst=new i),i._inst},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shareTreasureId",{get:function(){return this._shareTreasureId},set:function(t){this._shareTreasureId=t},enumerable:!0,configurable:!0}),i.prototype._filterText=function(t,e,i){return t.indexOf(e)>=0?t.replace(e,i):t},i.prototype._randomShareId=function(t){var e=this._shareType2IDS.getValue(t);return e?e[Core.RandomUtils.randInt(e.length)]:-1},i.prototype._getShareTitle=function(t){var e=Data.share_config.get(t);return e?this._filterText(e.text,"NAME",Player.inst.nameWithNoColor):""},i.prototype._getShareImageUrl=function(e){var i=Data.share_config.get(e);if(i){var r=i.img;return t.WXGameMgr.getWebClientHost()+"/resource/king_ui/assets/society/"+r+"?"+Date.now()}return""},i.prototype.enableShareMenu=function(i){return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s;return __generator(this,function(a){switch(a.label){case 0:return i=e.SHARE_GAME,r=this._randomShareId(i),n=this._getShareTitle(r),o=this._getShareImageUrl(r),s=t.WXGameMgr.inst.getBaseWXShareQuery()+("&act="+i+"&shareId="+r),[4,sharePlatform.enableShareMenu(!0,n,o,s)];case 1:return a.sent(),[2]}})})},i.prototype.wechatInvite=function(){var i=e.SHARE_INVITE,r=this._randomShareId(i),n=this._getShareTitle(r),o=this._getShareImageUrl(r),s=t.WXGameMgr.inst.getBaseWXShareQuery()+("&act="+i+"&shareId="+r);t.WXGameMgr.inst.shareAppMessage(n,o,s,i,r)},i.prototype.wechatFight=function(){var i=e.SHARE_FIGHT,r=this._randomShareId(i),n=this._getShareTitle(r),o=this._getShareImageUrl(r),s=t.WXGameMgr.inst.getBaseWXShareQuery()+("&act="+i+"&shareId="+r);t.WXGameMgr.inst.shareAppMessage(n,o,s,i,r)
},i.prototype.wechatGrpRank=function(){var i=e.SHARE_GRP_RANK,r=this._randomShareId(i),n=this._getShareTitle(r),o=this._getShareImageUrl(r),s=t.WXGameMgr.inst.getBaseWXShareQuery()+("&act="+i+"&shareId="+r);t.WXGameMgr.inst.shareAppMessage(n,o,s,i,r)},i.prototype.wechatShowOffTreasure=function(i){var r=e.SHARE_SHOWOFF_TREASURE,n=this._randomShareId(r),o=this._filterText(this._getShareTitle(n),"CARD",i),s=this._getShareImageUrl(n),a=t.WXGameMgr.inst.getBaseWXShareQuery()+("&act="+r+"&shareId="+n);t.WXGameMgr.inst.shareAppMessage(o,s,a,r,n)},i.prototype.wechatShareReward=function(i){var r=e.SHARE_REWARD,n=this._randomShareId(r),o=this._getShareTitle(n),s=this._getShareImageUrl(n),a=t.WXGameMgr.inst.getBaseWXShareQuery()+("&hid="+i+"&act="+r+"&shareId="+n);t.WXGameMgr.inst.shareAppMessage(o,s,a,r,n)},i.prototype.wechatShareTreasure=function(i){this.shareTreasureId=i;var r=e.SHARE_TREASURE,n=this._randomShareId(r),o=this._getShareTitle(n),s=this._getShareImageUrl(n),a=t.WXGameMgr.inst.getBaseWXShareQuery()+("&treasureId="+i+"&act="+r+"&shareId="+n);t.WXGameMgr.inst.shareAppMessage(o,s,a,r,n)},i.prototype.wechatShareDailyTreasure=function(i){this.shareTreasureId=i;var r=e.SHARE_DAILY_REWARD_DOUBLE,n=this._randomShareId(r),o=this._getShareTitle(n),s=this._getShareImageUrl(n),a=t.WXGameMgr.inst.getBaseWXShareQuery()+("&treasureId="+i+"&act="+r+"&shareId="+n);t.WXGameMgr.inst.shareAppMessage(o,s,a,r,n)},i.prototype.wechatShareBattleVideo=function(i){var r=e.SHARE_VEDIO,n=this._randomShareId(r),o=this._getShareTitle(n),s=this._getShareImageUrl(n),a=t.WXGameMgr.inst.getBaseWXShareQuery()+("&battleId="+i+"&act="+r+"&shareId="+n);t.WXGameMgr.inst.shareAppMessage(o,s,a,r,n)},i.prototype.wechatSharePreventLoseStar=function(){var i=e.SHARE_PREVENT_LOSE,r=this._randomShareId(i),n=this._getShareTitle(r),o=this._getShareImageUrl(r),s=t.WXGameMgr.inst.getBaseWXShareQuery()+("&act="+i+"&shareId="+r);t.WXGameMgr.inst.shareAppMessage(n,o,s,i,r)},i.prototype.cancelPreventLoseStar=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_END_SHARE_BATTLE_LOSE,null)];case 1:return t=e.sent(),0==t.errcode&&console.log("cancelPreventLoseStar success"),[2]}})})},i.prototype.wechatShareLevelHelp=function(i){var r=e.SHARE_LEVEL_HELP,n=this._randomShareId(r),o=this._getShareTitle(n),s=Level.LevelMgr.inst.getLevel(i);if(s){var a=s.name;o=this._filterText(o,"LEVEL",a)}var u=this._getShareImageUrl(n),h=Math.floor(Date.now()/1e3),l=t.WXGameMgr.inst.getBaseWXShareQuery()+("&time="+h+"&levelId="+i+"&act="+r+"&shareId="+n);t.WXGameMgr.inst.shareAppMessage(o,u,l,r,n)},i.prototype.wechatShareFreeItem=function(e,i,r){console.log("wechatShareFreeItem",e,i);var n=r,o=this._randomShareId(n),s=this._getShareTitle(o),a=this._getShareImageUrl(o),u=t.WXGameMgr.inst.getBaseWXShareQuery()+("&act="+n+"&shareId="+o+"&freeId="+e+"&freeType="+i+"&name="+Player.inst.name),h={Type:i,ID:e},l=pb.WatchShopFreeAdsArg.encode(h).finish();return t.WXGameMgr.inst.shareAppMessage(s,a,u,n,o,l),o},i.prototype.wechatShareUpTreasure=function(){var i=e.SHARE_UP_TREASURE,r=this._randomShareId(i),n=this._getShareTitle(r),o=this._getShareImageUrl(r),s=t.WXGameMgr.inst.getBaseWXShareQuery()+("&act="+i+"&shareId="+r);return t.WXGameMgr.inst.shareAppMessage(n,o,s,i,r),r},i.prototype.wechatShareAddTreasureCard=function(i){var r=e.SHARE_TREASURE_ADD_CARD,n=this._randomShareId(r),o=this._getShareTitle(n),s=this._getShareImageUrl(n),a=t.WXGameMgr.inst.getBaseWXShareQuery()+("&act="+r+"&shareId="+n+"&treasureId="+i),u={TreasureID:i},h=pb.TargetTreasure.encode(u).finish();return t.WXGameMgr.inst.shareAppMessage(o,s,a,r,n,h),n},i.prototype.shareBeHelped=function(t){console.log("=++++++++++ shareBeHelped");var i=t.ShareType;if(i==e.SHARE_FREE_GOLD||i==e.SHARE_FREE_JADE||i==e.SHARE_FREE_TREASURE);else if(i==e.SHARE_UP_TREASURE){var r=Core.ViewManager.inst.getView(ViewName.advertUpTreasureWnd);r&&r.isShow()&&Core.ViewManager.inst.close(ViewName.advertUpTreasureWnd);var n=pb.Treasure.decode(t.Data);Core.EventCenter.inst.dispatchEventWith(GameEvent.UpTreasureRareEv,!1,n),Core.TipsUtils.showTipsFromCenter("你得到了好友的帮助，宝箱变得更棒啦！")}else if(i==e.SHARE_TREASURE_ADD_CARD){var n=pb.WatchTreasureAddCardAdsReply.decode(t.Data);Core.EventCenter.inst.dispatchEventWith(GameEvent.AddTreasureCardEv,!1,n),Core.TipsUtils.showTipsFromCenter("你得到了好友的帮助，宝箱打开了更多的卡牌")}},i.prototype.cancelCurShare=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e={ShareID:t.WXGameMgr.inst.curShareId,ShareType:t.WXGameMgr.inst.curShareType},Net.rpcCall(pb.MessageID.C2S_CANCEL_WX_SHARE,pb.CancelWxShareArg.encode(e)),[2]})})},Object.defineProperty(i.prototype,"shareDelayOpTime",{get:function(){return 3e3},enumerable:!0,configurable:!0}),i._inst=null,i}();t.WXShareMgr=i,__reflect(i.prototype,"WXGame.WXShareMgr")}(WXGame||(WXGame={}));var WXGame;!function(t){var e=function(){function t(){this._musicAudio=wx.createInnerAudioContext(),this._SOUND_POOL_SIZE=10,this._soundAudioPool=[];for(var t=0;t<this._SOUND_POOL_SIZE;++t)this._soundAudioPool.push(wx.createInnerAudioContext());this._soundPoolIdx=0}return Object.defineProperty(t,"inst",{get:function(){return null==t._inst&&(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype._genSoundPoolIdx=function(){return this._soundPoolIdx=(this._soundPoolIdx+1)%this._SOUND_POOL_SIZE,this._soundPoolIdx},t.prototype.playSound=function(t,e){var i=RES.getRes(t);if(i){var r=wx.createInnerAudioContext();r.src=i,r.volume=e,r.onCanplay(function(){r.play()}),r.onStop(function(){r.destroy()}),console.log("WXSoundMgr playSound",t,i,e)}else RES.getResAsync(t)},t.prototype.playSoundAsync=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return RES.getResAsync(t).then(function(i){console.log("WXSoundMgr playSoundAsync",t,i,e);var r=wx.createInnerAudioContext();r.src=i,r.volume=e,r.onCanplay(function(){r.play()}),r.onStop(function(){r.destroy()})}),[2]})})},t.prototype.playMusic=function(t,e){var i=this;RES.getResAsync(t).then(function(r){i._musicAudio.stop(),i._musicAudio.src=r,i._musicAudio.loop=!0,i._musicAudio.volume=e,i._musicAudio.onCanplay(function(){i._musicAudio.play()}),console.log("WXSoundMgr playMusic",t,r,e)})},t.prototype.setMusicVolume=function(t){this._musicAudio.volume=t},t.prototype.stopMusic=function(){this._musicAudio.stop()},t}();t.WXSoundMgr=e,__reflect(e.prototype,"WXGame.WXSoundMgr")}(WXGame||(WXGame={}));var util;!function(t){function e(t,e){if(!e)return void(t.filters=[]);var i=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],r=new egret.ColorMatrixFilter(i);t.filters=[r]}t.setObjGray=e}(util||(util={}));var LoadingResource=function(){function t(t){this.name=t}return t}();__reflect(LoadingResource.prototype,"LoadingResource",["RES.ResourceItem","RES.ResourceInfo"]);var LoadingReporter=function(){function t(t,e){this._name=e,this._parent=t,this._parent.addRes(e),this._res=new LoadingResource(e)}return t.prototype.onProgress=function(t,e){this._parent.onProgress(t,e,this._res)},t}();__reflect(LoadingReporter.prototype,"LoadingReporter",["RES.PromiseTaskReporter"]);var LoadingView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._titleAdd=null,e}return __extends(e,t),Object.defineProperty(e,"inst",{get:function(){return e._inst},enumerable:!0,configurable:!0}),e.prototype.initUI=function(){if(e._inst=this,t.prototype.initUI.call(this),window.gameGlobal.isMultiLan){this.getChild("isnbTxt").asTextField.visible=!1,this.getChild("goodTxt").asTextField.visible=!1;var i=new fairygui.GLoader;i.url="loading_logoName_png",i.autoSize=!1,i.fill=fairygui.LoaderFillType.ScaleMatchWidth,i.x=0,i.y=58,i.addRelation(this.getChild("bg"),fairygui.RelationType.Top_Top),this.addChild(i),this.adjust(this.getChild("bg"),Core.AdjustType.NO_BORDER),i.width=Math.min(fairygui.GRoot.inst.getDesignStageWidth(),this.getChild("bg").width)}else this.adjust(this.getChild("bg"),Core.AdjustType.NO_BORDER),Core.DeviceUtils.isWXGame()?this.getChild("isnbTxt").asTextField.visible=!0:this.getChild("goodTxt").asTextField.y=this.getChild("isnbTxt").asTextField.y;this._progressBar=this.getChild("progressBar"),this._bg=this.getChild("bg").asLoader,this._bg.url=(window.gameGlobal.logoUrl||"loading_logo_lzd_jpg").replace("png","jpg"),this._resDict=new Collection.Dictionary,Core.DeviceUtils.isiOS()&&!Core.DeviceUtils.isWXGame()&&IOS_EXAMINE_VERSION&&!window.gameGlobal.isMultiLan&&(this._progressBar.visible=!1)},e.prototype.addRes=function(t){this._resDict.setValue(t,0)},e.prototype.clear=function(){this._resDict.clear()},Object.defineProperty(e.prototype,"titleAddString",{set:function(t){this._titleAdd=t},enumerable:!0,configurable:!0}),e.prototype.onProgress=function(t,e,i){this._resDict.setValue(i.name,t/e),Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.SET_LOADING_PERCENT,{percentStr:"("+t+"/"+e+")"});var r=0,n=0;this._resDict.forEach(function(t,e){n++,r+=e});var o=r/n;Core.DeviceUtils.isWXGame()?(this._progressBar.setProgress(r,n),o=r/n):(this._progressBar.setProgress(t,e),o=t/e),this._titleAdd?this._progressBar.getChild("title").text=""+Math.floor(100*o)+"% ["+this._titleAdd+"]":this._progressBar.getChild("title").text=""+Math.floor(100*o)+"%",1==o&&(Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.ON_SHOW_LOADING),this.close())},e.prototype.setText=function(t){this.getChild("isnbTxt").asTextField.visible=!0,this.getChild("isnbTxt").text=t},e.prototype.hideProgress=function(t){this._progressBar.visible=!t,this.getChild("goodTxt").visible=!t,this.getChild("isnbTxt").visible=!t},e}(Core.BaseView);__reflect(LoadingView.prototype,"LoadingView",["RES.PromiseTaskReporter"]);var GroupLoadingReporter=function(){function t(){this._onComplete=null}return t.prototype.registerCompleteCallback=function(t){this._onComplete=t},t.prototype.onProgress=function(t,e){console.log("onProgress ",t,e),t>=e&&this._onComplete&&(this._onComplete(),this._onComplete=null)},t}();__reflect(GroupLoadingReporter.prototype,"GroupLoadingReporter",["RES.PromiseTaskReporter"]);var skillRegx=/#\(\s*skill\s*,\s*(\d+)\s*\)/g,descRegx=/#\(\s*desc\s*,\s*(\d+)\s*\)/g,heroRegx=/#\(\s*hero\s*,\s*(\d+)\s*\)/g,lastSkillid,Battle;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.center(),this.modal=!0,this._boxImg1=this.contentPane.getChild("boxIcon1").asLoader,this._boxNameText1=this.contentPane.getChild("boxName1").asTextField,this._boxImg2=this.contentPane.getChild("boxIcon2").asLoader,this._boxNameText2=this.contentPane.getChild("boxName2").asTextField,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._advertBtn=this.contentPane.getChild("advertBtn").asButton,this._shareBtn=this.contentPane.getChild("shareBtn").asButton,this._jadeSkipBtn=this.contentPane.getChild("jadeSkipBtn").asButton,this._hintText=this.contentPane.getChild("txt2").asTextField,this._closeBtn.addClickListener(this._onClose,this),this._advertBtn.addClickListener(this._onAdvert,this),this._jadeSkipBtn.addClickListener(this._onSkipAdvert,this),this._shareBtn.addClickListener(this._onShare,this),this._shareBtn.x=270,this._jadeSkipBtn.visible=!0,Core.DeviceUtils.isWXGame()?(this._advertBtn.visible=!1,this._shareBtn.visible=!0,this._hintText.text=Core.StringUtils.TEXT(60203)):adsPlatform.isAdsOpen()?(this._advertBtn.visible=!0,this._shareBtn.visible=!1,this._hintText.text=Core.StringUtils.TEXT(60204)):(this._advertBtn.visible=!1,this._shareBtn.visible=!1,this._jadeSkipBtn.x=150,this._hintText.text=Core.StringUtils.TEXT(60253)),this._jadeSkipBtn.icon=Player.inst.getSkipAdvertResIcon(),this._callback=null},e.prototype._onClose=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return this._shareBtn.visible?(Core.TipsUtils.confirm(Core.StringUtils.TEXT(60217),function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return WXGame.WXShareMgr.inst.cancelCurShare(),this._callback?[4,this._callback(!1,!1)]:[3,2];case 1:t.sent(),this._callback=null,t.label=2;case 2:return Core.ViewManager.inst.closeView(this),[2]}})})},null,this,Core.StringUtils.TEXT(60041),Core.StringUtils.TEXT(60040)),[3,5]):[3,1];case 1:return this._advertBtn.visible?(Core.TipsUtils.confirm(Core.StringUtils.TEXT(60194),function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._callback?[4,this._callback(!1,!1)]:[3,2];case 1:t.sent(),this._callback=null,t.label=2;case 2:return Core.ViewManager.inst.closeView(this),[2]}})})},null,this,Core.StringUtils.TEXT(60041),Core.StringUtils.TEXT(60040)),[3,5]):[3,2];case 2:return this._callback?[4,this._callback(!1,!1)]:[3,4];case 3:e.sent(),this._callback=null,e.label=4;case 4:Core.ViewManager.inst.closeView(this),e.label=5;case 5:return[2]}})})},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,n,o;return __generator(this,function(s){return t.prototype.open.apply(this,e),i=e[0],r=e[1],this._callback=e[2],n=new Treasure.TreasureItem(-1,i),o=new Treasure.TreasureItem(-1,r),this._boxImg1.url=n.image,this._boxNameText1.text=n.getName(),this._boxImg2.url=o.image,this._boxNameText2.text=o.getName(),Player.inst.hasEnoughResToSkipAdvert()||Player.inst.canSkipAdvertForTreasure()?(this._jadeSkipBtn.titleColor=16776960,Player.inst.canSkipAdvertForTreasure()?this._jadeSkipBtn.text=Core.StringUtils.TEXT(70114):this._jadeSkipBtn.text="3"):this._jadeSkipBtn.titleColor=16711680,this._jadeSkipBtn.icon=Player.inst.getSkipAdvertResIcon(),[2]})})},e.prototype._onAdvert=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return Player.inst.canSkipAdvertForTreasure()?(this._onSkipAdvert(),[2]):[4,adsPlatform.isAdsReady()];case 1:return t=i.sent(),t.success?[4,adsPlatform.showRewardAds()]:(Core.TipsUtils.showTipsFromCenter(t.reason),[2]);case 2:return e=i.sent(),e?this._callback?[4,this._callback(!0,!1)]:[3,4]:[3,5];case 3:i.sent(),this._callback=null,i.label=4;case 4:return Core.ViewManager.inst.closeView(this),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60213)),[3,6];case 5:Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60172)),i.label=6;case 6:return[2]}})})},e.prototype._onSkipAdvert=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,Player.inst.askSubSkipAdvertRes(!0)];case 1:return t.sent()||Player.inst.canSkipAdvertForTreasure()?this._callback?[4,this._callback(!0,!0)]:[3,3]:[2];case 2:t.sent(),this._callback=null,t.label=3;case 3:return Core.ViewManager.inst.closeView(this),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60144)),[2]}})})},e.prototype._onShare=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return Player.inst.canSkipAdvertForTreasure()?(this._onSkipAdvert(),[2]):(Core.DeviceUtils.isWXGame()&&(WXGame.WXShareMgr.inst.wechatShareUpTreasure(),WXGame.WXGameMgr.inst.isExamineVersion||WXGame.WXGameMgr.inst.registerOnShowCallback(function(){setTimeout(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._callback?[4,this._callback(!0,!1)]:[3,2];case 1:t.sent(),this._callback=null,t.label=2;case 2:return Core.ViewManager.inst.closeView(this),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60232)),[2]}})})},WXGame.WXShareMgr.inst.shareDelayOpTime)})),[2])})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,t.prototype.close.apply(this,e)];case 1:return i.sent(),[2]}})})},e}(Core.BaseWindow);t.AdvertUpTreasureWnd=e,__reflect(e.prototype,"Battle.AdvertUpTreasureWnd")}(Battle||(Battle={}));var ShareType;!function(t){t[t.SHARE_NONE=0]="SHARE_NONE",t[t.SHARE_WECHAT=1]="SHARE_WECHAT",t[t.SHARE_FACEBOOK=2]="SHARE_FACEBOOK"}(ShareType||(ShareType={}));var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"ERROR_USER"}]})})},t.prototype.login=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.canMakePay=function(){return!1},t.prototype.pay=function(t,e,i,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]);var DebugSharePlatform=function(){function t(){}return t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.enableShareMenu=function(t,e,i,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.shareAppMsg=function(t,e,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.getShareType=function(){return ShareType.SHARE_NONE},t.prototype.getShareLink=function(){return""},t}();__reflect(DebugSharePlatform.prototype,"DebugSharePlatform",["SharePlatform"]);var DebugAdsPlatform=function(){function t(){}return t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.isAdsOpen=function(){return!1},t.prototype.isAdsReady=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{success:!1,reason:Core.StringUtils.TEXT(60154)}]})})},t.prototype.showRewardAds=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.showBannerAds=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugAdsPlatform.prototype,"DebugAdsPlatform",["AdvertisePlatform"]),window.platform||(window.platform=new DebugPlatform),window.sharePlatform||(window.sharePlatform=new DebugSharePlatform),window.adsPlatform||(window.adsPlatform=new DebugAdsPlatform);var Battle;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._timerValue=100,t}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.adjust(this.getChild("bg")),this._recordImage=this.getChild("img_record").asLoader,this._grids=[],this._grids.push(this.getChild("grid1")),this._grids.push(this.getChild("grid2")),this._grids.push(this.getChild("grid3")),this._grids.push(this.getChild("grid4")),this._grids.push(this.getChild("grid5")),this._grids.push(this.getChild("grid6")),this._grids.push(this.getChild("grid7")),this._grids.push(this.getChild("grid8")),this._grids.push(this.getChild("grid9")),this._topGrid=this._grids[this._grids.length-1];for(var i=0;i<this._grids.length;i++)this._grids[i].gridId=i;var r=Utils.getResolutionDistance();this._beginBtn=this.getChild("beginBtn").asButton,this._myHandCom=this.getChild("myHand"),this._myHandCom.y-=r/4,this._oppHandCom=this.getChild("oppHand"),this._oppHandCom.y+=r/4,this._surrenderBtn=this.getChild("surrenderBtn").asButton,this._gmWinBtn=this.getChild("gmWinBtn").asButton,this._enemyTimer=this.getChild("enemyProgress"),this._myTimer=this.getChild("myProgress"),this._selfOffensiveTrans=this.getTransition("self"),this._enemyOffensiveTrans=this.getTransition("enemy"),this._recordTrans=this.getTransition("record"),this._offensiveGroup=this.getChild("offensiveGroup").asGroup,this._emojiBtn=this.getChild("emojiBtn").asButton,this._switchEmojiBtn=this.getChild("n67").asButton,this._enemyName=this.getChild("enemyName").asTextField,this._enemyName.textParser=Core.StringUtils.parseColorText,this._enemyCountry=this.getChild("enemyCountry").asLoader,this._startRecordBtn=this.getChild("startRecordBtn").asButton,this._stopRecordBtn=this.getChild("stopRecordBtn").asButton,this._exitPlayBtn=this.getChild("exitPlayBtn").asButton,this._myTurnIcon=this.getChild("myTurnCardIcon").asLoader,this._oppTurnIcon=this.getChild("oppTurnCardIcon").asLoader,this._myturnTrans=this.getTransition("myturn"),this._oppturnTrans=this.getTransition("oppturn"),this._enemyHead=this.getChild("enemyHead"),this._levelName=this.getChild("levelName").asTextField,this._enemyName.y-=Utils.getResolutionDistance()/4/2,this._levelName.visible=!1,this._enemyTimer.visible=!1,this._myTimer.visible=!1,this._recordImage.visible=!1,this._beginBtn.addClickListener(this._onLevelReadyDone,this),this._surrenderBtn.addClickListener(this._onSurrender,this),this._gmWinBtn.addClickListener(t.BattleMgr.inst.gmWin,t.BattleMgr.inst),this._exitPlayBtn.addClickListener(this._onExit,this),this._emojiBtn.addClickListener(this._showEmojiChoiceWnd,this),this._switchEmojiBtn.addClickListener(this._onDisregardBtn,this),this._startRecordBtn.addClickListener(this.startRecord,this),this._stopRecordBtn.addClickListener(this.stopRecord,this),this._showRecordBtn=!Core.DeviceUtils.isWXGame(),window.gameGlobal.isMultiLan&&(this._enemyName.fontSize=20,this._levelName.fontSize=20)},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a;return __generator(this,function(u){return e.prototype.open.apply(this,i),egret.MainContext.instance.stage.maxTouches=1,r=i[0],this._disregard=!1,this._beginBtn.visible=!1,this._offensiveGroup.visible=!1,this._setCasterSkill(r),this._myHand=new t.MyHand(this._myHandCom,r,r.getOwnFighter()),this._oppHand=new t.EnemyHand(this._oppHandCom,r,r.getEnemyFighter()),n=r.getEnemyFighter(),r instanceof t.LevelBattle?(this._enemyName.visible=!1,this._levelName.visible=!0,this._enemyCountry.url=null,this._levelName.text=r.levelName):r instanceof t.VideoBattle&&0==n.pvpScore?(this._enemyName.visible=!1,this._levelName.visible=!0,this._enemyCountry.url=null,Level.LevelMgr.inst.curVideoLevel?this._levelName.text=Level.LevelMgr.inst.curVideoLevel.name:this._levelName.text=""):(this._enemyName.visible=!0,this._levelName.visible=!1,this._enemyName.text=n.name,this._enemyCountry.url=this._campToResUrl(n.camp)),this._grids.forEach(function(t){t.setup(r.getGridById(t.gridId))}),o=!1,window.gameGlobal.debug&&(Player.inst.name.indexOf("www")>=0||Player.inst.name.indexOf("kcmj")>=0||Player.inst.name.indexOf("lsw")>=0)&&(o=!0),this._recordImage.visible=!1,r.battleType==t.BattleType.VIDEO?(this._surrenderBtn.visible=!1,this._gmWinBtn.visible=!1,this._exitPlayBtn.visible=!0,this._startRecordBtn.visible=this._showRecordBtn&&!0,this._stopRecordBtn.visible=!1,Core.ViewManager.inst.open(ViewName.videoFunction,r)):(this._gmWinBtn.visible=o,this._exitPlayBtn.visible=!1,this._startRecordBtn.visible=!1,this._stopRecordBtn.visible=!1,this._surrenderBtn.visible=!0,Core.ViewManager.inst.close(ViewName.videoFunction)),this._myTurnIcon.visible=!1,this._oppTurnIcon.visible=!1,this.stopTimerProgress(),this._emojiBtn.visible=r.isPvp(),this._switchEmojiBtn.visible=r.isPvp(),s=r.battleType,s==t.BattleType.LEVEL||s==t.BattleType.LevelHelp?this._enemyHead.visible=!1:s==t.BattleType.VIDEO&&0==n.pvpScore?this._enemyHead.visible=!1:(a=r.getEnemyFighter(),this._enemyHead.setAll(a.headIcon,a.frameIcon)),Core.EventCenter.inst.addEventListener(GameEvent.BeginDragGuideEv,this._onBeginDragGuide,this),[2]})})},i.prototype.setRecordMode=function(t){this._recordImage.visible=t,t&&this._recordTrans.play(null,null,null,-1),this._startRecordBtn.visible=this._showRecordBtn&&!t,this._stopRecordBtn.visible=this._showRecordBtn&&t},i.prototype.startRecord=function(){t.VideoPlayer.inst.startRecord()},i.prototype.stopRecord=function(){t.VideoPlayer.inst.stopRecord()},i.prototype._campToResUrl=function(t){return t==Camp.WEI?"battle_txtWei_png":t==Camp.SHU?"battle_txtShu_png":t==Camp.WU?"battle_txtWu_png":""},i.prototype._campToBgResUrl=function(t){return t==Camp.WEI?"battle_nameWei_png":t==Camp.SHU?"battle_nameShu_png":t==Camp.WU?"battle_nameWu_png":""},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),egret.MainContext.instance.stage.maxTouches=2,this._myHand.clear(),this._oppHand.clear(),this._grids.forEach(function(t){t.clear()}),this.stopRecord(),Core.ViewManager.inst.isShow(ViewName.matching)&&Core.ViewManager.inst.close(ViewName.matching),Core.ViewManager.inst.close(ViewName.videoFunction),Core.EventCenter.inst.removeEventListener(GameEvent.BeginDragGuideEv,this._onBeginDragGuide,this),[2]})})},i.prototype._showEmojiChoiceWnd=function(){Core.ViewManager.inst.openPopup(ViewName.emojiChoiceWnd,function(e){t.BattleMgr.inst.sendEmoji(e)})},i.prototype._onDisregardBtn=function(){var t="";t=this._disregard?Core.StringUtils.TEXT(60145):Core.StringUtils.TEXT(60146),this._disregard=!this._disregard,this._enemyEmojiCom&&(this._enemyEmojiCom.visible=!this._disregard),Core.TipsUtils.showTipsFromCenter(t)},i.prototype._onSurrender=function(){var e=t.BattleMgr.inst.battle;return!e||e instanceof t.LevelBattle&&e.curBout<=0?void t.BattleMgr.inst.exitLevel():void Core.TipsUtils.confirm(Core.StringUtils.TEXT(60129),function(){t.BattleMgr.inst.surrender()},null,this)},i.prototype._onExit=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return t.BattleMgr.inst.exitVideo(),e=t.BattleMgr.inst.battle,e.isPvp()?[3,2]:(i=Core.ViewManager.inst.getView(ViewName.newHome),[4,i.openLevelView(!0)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},i.prototype.visibleBeginBtn=function(t,e){this._beginBtn.visible=t},i.prototype._setCasterSkill=function(t){this.getController("castler").selectedPage="noCastler";var e,i=t.getOwnFighter().casterSkill;i&&i.length>0?(this.getController("castler").selectedPage="ownCastler",e=this.getChild("ownCastlerSkill")):(i=t.getEnemyFighter().casterSkill,i&&i.length>0&&(this.getController("castler").selectedPage="enemyCastler",e=this.getChild("oppCastlerSkill"))),e&&e.setData(i)},i.prototype._onLevelReadyDone=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,t.BattleMgr.inst.levelBattleReadyDone()];case 1:return e=i.sent(),e&&(this._beginBtn.visible=!1,this._surrenderBtn.visible=!0),[2]}})})},i.prototype.bringGridToFront=function(t){this._topGrid!=t&&(this.swapChildren(this._topGrid,t),this._topGrid=t)},i.prototype.switchGridAndHand=function(t){this.swapChildren(t,this._gmWinBtn)},i.prototype.onTimer=function(e,i){if(!t.BattleMgr.inst.battle)return void fairygui.GTimers.inst.remove(this.onTimer,this);var r=Math.min(1,this._timerValue/e);this._myTimer.value=100*r,this._myTimer.getChild("head").x=this._myTimer.width*r-5,this._enemyTimer.value=100*r,this._enemyTimer.getChild("head").x=this._enemyTimer.width*r-5,this._timerValue-=1,this._timerValue<=e&&(i==t.BattleMgr.inst.battle.getOwnFighter()?(this._myTimer.visible=!0,this._enemyTimer.visible=!1):(this._myTimer.visible=!1,this._enemyTimer.visible=!0)),0>=r&&(this._myTimer.visible=!1,this._enemyTimer.visible=!1)},i.prototype.boutBegin=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this._myHand.boutBegin(t)];case 1:return e.sent(),[4,this._oppHand.boutBegin(t)];case 2:return e.sent(),[2]}})})},i.prototype.beginBoutTimer=function(t,e){if(fairygui.GTimers.inst.remove(this.onTimer,this),this._myTimer.visible=!1,this._enemyTimer.visible=!1,!(0>=e)){var i=1e3*e/50;this._timerValue=i,fairygui.GTimers.inst.add(50,i,this.onTimer,this,160,t)}},i.prototype.selectGrid=function(t,e,i,r){var n=this.rootToLocal(t,e);t=n.x,e=n.y;for(var o=0;o<this._grids.length;o++){var s=this._grids[o];if(s.isInGrid(t,e,i,r))return s}return null},i.prototype.onPlayBoutActions=function(){this._myHand.handDraggable(!1)},i.prototype.endBattle=function(t,e,i){return void 0===i&&(i=!1),__awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,Core.ViewManager.inst.open(t.getEndViewName(),e,t,i)];case 1:return r.sent(),[2]}})})},i.prototype.getNode=function(i){var r=i.split(":");if("fightCard"==r[0]){var n=t.BattleMgr.inst.battle.getCardByIdx(parseInt(r[1]));return n?n.view:null}return"myEmptyHand"==i?this._myHand.getGuideClickNode():e.prototype.getNode.call(this,i)},i.prototype.stopTimerProgress=function(){fairygui.GTimers.inst.remove(this.onTimer,this),this._myTimer.visible=!1,this._enemyTimer.visible=!1},i.prototype.playOffensiveAni=function(t){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(i){switch(i.label){case 0:return this._offensiveGroup.visible=!0,[4,new Promise(function(i){var r=e,n=function(){i(),r._offensiveGroup.visible=!1};if(t){if(e._selfOffensiveTrans.playing)return void n();e._selfOffensiveTrans.play(n,e),e.getChild("card1").asLoader.url="cards_cardLightSelf_png",e.getChild("card2").asLoader.url="cards_cardLightSelf_png",e.getChild("card3").asLoader.url="cards_cardLightSelf_png",e.getChild("card4").asLoader.url="cards_cardLightSelf_png",e.getChild("card5").asLoader.url="cards_cardLightSelf_png"}else{if(e._enemyOffensiveTrans.playing)return void n();e._enemyOffensiveTrans.play(n,e),e.getChild("card1").asLoader.url="cards_cardLightEnemy_png",e.getChild("card2").asLoader.url="cards_cardLightEnemy_png",e.getChild("card3").asLoader.url="cards_cardLightEnemy_png",e.getChild("card4").asLoader.url="cards_cardLightEnemy_png",e.getChild("card5").asLoader.url="cards_cardLightEnemy_png"}})];case 1:return i.sent(),[2]}})})},i.prototype.playTurnAni=function(t){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(i){switch(i.label){case 0:return[4,new Promise(function(i){t?(e._oppTurnIcon.visible=!1,e._myturnTrans.playing?i():e._myturnTrans.play(function(){i()},e)):(e._myTurnIcon.visible=!1,e._oppturnTrans.playing?i():e._oppturnTrans.play(function(){i()},e))})];case 1:return i.sent(),[2]}})})},i.prototype.showSelfEmoji=function(e){return this._selfEmojiCom||(this._selfEmojiCom=fairygui.UIPackage.createObject(PkgName.battle,"emojiSelf",t.SelfEmojiCom),this._selfEmojiCom.setParent(this._myHandCom),this._selfEmojiCom.setXY(240,0)),this._selfEmojiCom.show(e)},i.prototype.showEnemyEmoji=function(e){this._disregard||(this._enemyEmojiCom||(this._enemyEmojiCom=fairygui.UIPackage.createObject(PkgName.battle,"emojiEnemy",t.EmojiCom),this._enemyEmojiCom.setParent(this._oppHandCom),this._enemyEmojiCom.setXY(240,100)),this._enemyEmojiCom.visible=!0,this._enemyEmojiCom.show(e))},i.prototype.showGoldGob=function(e,i){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return r=fairygui.UIPackage.createObject(PkgName.battle,"goldGob",t.GoldGobTips),r.x=this.width/2-r.width/2,r.y=this._myHandCom.y,this.addChild(r),[4,r.show(e,i)];case 1:return n.sent(),r.removeFromParent(),[2]}})})},i.prototype._onBeginDragGuide=function(t){var e=this,i=t.data;this._myHand.handDraggable(!1),i.draggable=!0,this._surrenderBtn.touchable=!1,this._gmWinBtn.touchable=!1,Guide.GuideMgr.inst.once(Guide.GuideMgr.GUIDE_COMPLETE_EV,function(){e._surrenderBtn.touchable=!0,e._gmWinBtn.touchable=!0},this)},i}(Core.BaseView);t.BattleView=e,__reflect(e.prototype,"Battle.BattleView")}(Battle||(Battle={}));
var Battle;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){this._myParent=Core.LayerManager.inst.maskLayer,this.adjust(this.getChild("closeBg")),t.prototype.initUI.call(this),this.center(),this._frontImg=this.getChild("frontImg").asLoader,this._baseImg=this.getChild("baseImg").asLoader,this._icon=this.getChild("icon").asImage;var e=fairygui.GRoot.inst.getDesignStageWidth()/480;this.setScale(e,e),this.getChild("closeBg").addClickListener(this.close,this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){return this.toTopLayer(),t.prototype.open.apply(this,e),i=e[0],r=this,UI.CardImgTextureMgr.inst.fetchTexture(i.icon,i.skin,"b",function(t,e,i){r._icon.texture=e}),[2]})})},e}(Core.BaseWindow);t.CardBigWnd=e,__reflect(e.prototype,"Battle.CardBigWnd");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.resigterView=function(){if(!Core.ViewManager.inst.getView(ViewName.cardDetail)){var t=fairygui.UIPackage.createObject(PkgName.cards,"bigCard",i);Core.ViewManager.inst.register(ViewName.cardDetail,t)}},i.prototype.initUI=function(){this._myParent=Core.LayerManager.inst.maskLayer,this.adjust(this.getChild("closeBg")),e.prototype.initUI.call(this),e.prototype.center.call(this),this.y=this.y+15,this._frontImg=this.getChild("frontImg").asLoader,this._baseImg=this.getChild("baseImg").asLoader,this._icon=this.getChild("icon").asImage,this._nameImg=this.getChild("nameImg").asLoader,this._skillDescTxt=[],this._skillBg=[];for(var t=1;4>=t;t++)this._skillDescTxt.push(this.getChild("skillDescTxt"+t).asRichTextField),this._skillBg.push(this.getChild("skillBg"+t).asLoader),this._skillDescTxt[t-1].addEventListener(egret.TextEvent.LINK,htmlClickCallback,this);this._equipSkillDescTxt=this.getChild("equipDescTxt").asRichTextField,this._equipSkillDescTxt.addEventListener(egret.TextEvent.LINK,htmlClickCallback,this),this._equipSkillDescTxtY=this._equipSkillDescTxt.y,this._equipSkillBg=this.getChild("equipSkillBg").asLoader,this._equipSkillBgY=this._equipSkillBg.y,this._nameTxt=this.getChild("nameText").asTextField,this._nameTxt.textParser=Core.StringUtils.parseColorText,this.getChild("closeBg").addClickListener(this._onTouchBegin,this),this._adjustWidgetByLocale()},i.prototype._adjustWidgetByLocale=function(){if(!LanguageMgr.inst.isChineseLocale()){this._nameImg.setSize(166,39),this._nameImg.setXY(209,0),this._nameTxt.setSize(166,30),this._nameTxt.setXY(209,4),this._nameTxt.fontSize=24,this._nameTxt.autoSize=fairygui.AutoSizeType.Shrink;for(var t=0;4>t;t++){var e=this._skillDescTxt[t];e.autoSize=fairygui.AutoSizeType.Shrink,e.leading=0}this._equipSkillDescTxt.autoSize=fairygui.AutoSizeType.Shrink,this._equipSkillDescTxt.leading=0}},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a,u,h,l,s,c,d,p;return __generator(this,function(_){for(e.prototype.open.apply(this,i),r=i[0],this._fightCard&&this._fightCard!=r&&this._fightCard.view&&(this._fightCard.view.isDetailOpen=!1),this._fightCard=r,n=r.rare,r.side==t.Side.OWN?(this._frontImg.url="cards_back1_b"+n+"_png",n==CardQuality.LIMITED?this._baseImg.url="cards_base1_b_ex_png":this._baseImg.url="cards_base1_b_png"):(this._frontImg.url="cards_back2_b"+n+"_png",n==CardQuality.LIMITED?this._baseImg.url="cards_base2_b_ex_png":this._baseImg.url="cards_base2_b_png"),o=this,UI.CardImgTextureMgr.inst.fetchTexture(r.icon,r.skin,"b",function(t,e,i){o._icon.texture=e,o._imgUrl=i}),s=0;4>s;s++)this._skillDescTxt[s].visible=!1,this._skillBg[s].visible=!1;if(this._equipSkillDescTxt.visible=!1,this._equipSkillBg.visible=!1,a=t.BattleMgr.inst.battle,r.isShowFogUI())return this._nameImg.visible=!1,this._nameTxt.visible=!1,[2];for(this._nameImg.visible=!0,this._nameTxt.visible=!0,n==CardQuality.LIMITED?this._nameImg.url="cards_name_b_ex_png":this._nameImg.url="cards_name_b_png",this._nameTxt.text=r.name,u=(r.skillDesc||"").split("\n").filter(function(t,e,i){return""!=t}),h="1",null!=r.collectCard&&(h=r.collectCard.level.toString()),l=-1,s=0;s<u.length;s++)l=s,c="",r.skin&&""!=r.skin&&(c=Data.skin_config.get(r.skin).bind),d=u[s].replace(/level/g,h),d=d.replace(/skin/g,c),this._skillDescTxt[s].text=d,this._skillDescTxt[s].visible=!0,this._skillBg[s].visible=!0,this._skillBg[s].url="cards_skillBg"+((u.length-s-1)%2+1)+"_png";return r.equipment?(p=r.equipment.getSkillDesc(),p&&""!=p?(this._equipSkillBg.visible=!0,this._equipSkillDescTxt.visible=!0,this._equipSkillDescTxt.text=p,0>l?(this._equipSkillBg.y=this._skillBg[0].y,this._equipSkillDescTxt.y=this._skillDescTxt[0].y):l<this._skillDescTxt.length-1?(this._equipSkillBg.y=this._skillBg[l+1].y,this._equipSkillDescTxt.y=this._skillDescTxt[l+1].y):(this._equipSkillBg.y=this._equipSkillBgY,this._equipSkillDescTxt.y=this._equipSkillDescTxtY),[2]):[2]):[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return this._imgUrl&&(RES.destroyRes(this._imgUrl),this._imgUrl=void 0,this._icon&&this._icon.texture&&(this._icon.texture.dispose(),this._icon.texture=void 0)),e.prototype.close.apply(this,t),[2]})})},i.prototype._onTouchBegin=function(t){return Guide.GuideMgr.inst.isInGuide?(Core.ViewManager.inst.closeView(this),void this.close()):void(Core.ViewManager.inst.getView("htmlCardView")&&Core.ViewManager.inst.getView("htmlCardView").isShow()||(Core.ViewManager.inst.closeView(this),this.close()))},i}(Core.BaseWindow);t.CardDetailWnd=i,__reflect(i.prototype,"Battle.CardDetailWnd")}(Battle||(Battle={}));var Battle;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._icon=this.getChild("emojiIcon").asLoader},e.prototype.setParent=function(t){this._myParent=t,this.x=t.width/2,this.y=t.height/2},e.prototype.show=function(t){return fairygui.GTimers.inst.remove(this.removeFromParent,this),this._icon.url="ui://common/emoji"+t,this.parent||this._myParent.addChild(this),fairygui.GTimers.inst.add(3e3,1,this.removeFromParent,this),!0},e}(fairygui.GComponent);t.EmojiCom=e,__reflect(e.prototype,"Battle.EmojiCom");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._lastTime=0,this._isContinuity=!1},e.prototype.show=function(e){if(this.parent)return!1;var i=Math.round((new Date).getTime()/1e3);return this._isContinuity?this._isContinuity=!1:i-this._lastTime<=2&&(this._isContinuity=!0),this._lastTime=i+3,t.prototype.show.call(this,e)},e}(e);t.SelfEmojiCom=i,__reflect(i.prototype,"Battle.SelfEmojiCom");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._emojis=this.getChild("emoji").asList,this._emojis.addEventListener(fairygui.ItemEvent.CLICK,this._onClickEmoji,this),this._initialized=!1},e.prototype._onClickEmoji=function(t){if(!this._emojiTeam.isUnlock)return void Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60063));var e=t.itemObject.name;if(this._choiceCallback){var i=e;this._choiceCallback(parseInt(i))}},e.prototype.updateEmojiTeam=function(t,e){this._emojiTeam=t,this._choiceCallback=e},Object.defineProperty(e.prototype,"emojiTeam",{get:function(){return this._emojiTeam},enumerable:!0,configurable:!0}),e}(fairygui.GComponent);t.EmojiListViewCom=r,__reflect(r.prototype,"Battle.EmojiListViewCom");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._ctrl=this.getController("button"),this.addClickListener(this._onClick,this)},e.prototype.updateEmojiTeam=function(t,e){this._emojiTeam=t,this._emojiChoiceWnd=e,LanguageMgr.inst.isChineseLocale()||(this.getChild("title").asTextField.fontSize=12),this.getChild("title").asTextField.text=t.name,t.isUnlock?this.getController("enable").setSelectedPage("true"):this.getController("enable").setSelectedPage("false")},e.prototype._onClick=function(){this._emojiChoiceWnd.onChoiceTeam(this)},Object.defineProperty(e.prototype,"emojiTeam",{get:function(){return this._emojiTeam},enumerable:!0,configurable:!0}),e.prototype.setChosen=function(t){t?this._ctrl.setSelectedPage("down"):this._ctrl.setSelectedPage("up")},e}(fairygui.GButton);t.EmojiTeamChkBtnCom=n,__reflect(n.prototype,"Battle.EmojiTeamChkBtnCom");var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.center(),this._pageList=this.contentPane.getChild("pageList").asList,this._emojiTeamIdToCom=new Collection.Dictionary,this._emojiTeamIdToChk=new Collection.Dictionary,this._initialized=!1,this._curChkBtn=null,this._pageCtrl=this.contentPane.getController("pageCtrl")},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,o,s,a,u,h;return __generator(this,function(l){switch(l.label){case 0:return[4,t.prototype.open.apply(this,e)];case 1:return l.sent(),this._choiceCallback=e[0],this.contentPane.setXY(0,100),i=this,[4,Social.EmojiMgr.inst.getEmojiTeams()];case 2:for(r=l.sent(),o=0;o<r.length;++o)s=r[o],a=s.teamId,u=this._emojiTeamIdToChk.getValue(a),u||(u=fairygui.UIPackage.createObject(PkgName.common,"emojiChk",n),this._emojiTeamIdToChk.setValue(a,u),this._pageList.addChild(u),u.pageOption.controller=this._pageCtrl,u.pageOption.name=s.teamId.toString(),u.changeStateOnClick=!0),u.updateEmojiTeam(s,this),h=this._emojiTeamIdToCom.getValue(a),h||(h=this.contentPane.getChild("view"+a).asCom,this._emojiTeamIdToCom.setValue(s.teamId,h)),h.updateEmojiTeam(s,function(t){i._choiceCallback&&(i._choiceCallback(t),i._choiceCallback=null),Core.ViewManager.inst.closeView(i),fairygui.GRoot.inst.hidePopup(i)}),this._curChkBtn||0!=o?this._curChkBtn!=u&&u.setChosen(!1):this._setCurChkBtn(u);return[2]}})})},e.prototype.onChoiceTeam=function(t){var e=t.emojiTeam,i=e.teamId,r=this._emojiTeamIdToCom.getValue(i);r&&this._setCurChkBtn(t)},e.prototype._setCurChkBtn=function(t){this._curChkBtn&&this._curChkBtn.setChosen(!1),this._curChkBtn=t,this._curChkBtn.setChosen(!0);var e=t.emojiTeam,i=e.teamId;this._pageCtrl.setSelectedPage(""+i)},e.prototype._onScrollEnd=function(){var t=parseInt(this._pageCtrl.selectedPage),e=this._emojiTeamIdToChk.getValue(t);this._setCurChkBtn(e)},e}(Core.BaseWindow);t.EmojiChoiceWnd=o,__reflect(o.prototype,"Battle.EmojiChoiceWnd")}(Battle||(Battle={}));var Battle;!function(t){var e=function(){function e(t,e){this._numCom=t,this._pos=e,this._isMoving=!1,this._fightBeginTrans=t.getTransition("newbieFightBegin"),this._fightWinTrans=t.getTransition("newbieFightWin"),this._fightLoseTrans=t.getTransition("newbieFightLose"),this._value=t.getChild("value").asTextField}return Object.defineProperty(e.prototype,"isMoving",{get:function(){return this._isMoving},enumerable:!0,configurable:!0}),e.prototype.blink=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s=this;return __generator(this,function(a){switch(a.label){case 0:return this._fightBeginTrans.playing?[2]:(t&&(i=this._numCom.getChild("img").asLoader,r=new fairygui.GLoader,r.autoSize=!1,r.fill=fairygui.LoaderFillType.ScaleNoBorder,r.rotation=i.rotation,r.x=i.x,r.y=i.y,r.width=i.width,r.height=i.height,r.url="cards_circle_m_w_png",r.setPivot(.5,.5),this._numCom.addChild(r),r.alpha=0,n=this,o=function(){egret.Tween.get(r).to({alpha:.6},750).to({alpha:0},500).call(function(){n._isBlinking?o():n._numCom.removeChild(r)},n)},this._isBlinking=!0,o(),this._valueOldFont=this._value.font,this._valueOldFontSize=this._value.fontSize,e?this._value.font="ui://tlhdbap0p1qsm":this._value.font="ui://tlhdbap0p1qsw",this._value.fontSize=24),this._fightBeginTrans.playing?[2]:[4,new Promise(function(t){s._fightBeginTrans.play(function(){t()},s)})]);case 1:return a.sent(),[2]}})})},e.prototype.stopBlink=function(){this._isBlinking=!1,this._value.font=this._valueOldFont,this._value.fontSize=this._valueOldFontSize},e.prototype.attack=function(e,i){return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a,u=this;return __generator(this,function(h){switch(h.label){case 0:return this._isMoving?[4,fairygui.GTimers.inst.waitTime(177)]:[3,3];case 1:return h.sent(),[4,e.call(i)];case 2:return h.sent(),[2];case 3:switch(this._isMoving=!0,a=this._pos){case t.CardNumPos.UP:return[3,4];case t.CardNumPos.DOWN:return[3,5];case t.CardNumPos.LEFT:return[3,6];case t.CardNumPos.RIGHT:return[3,7]}return[3,8];case 4:return s=this._numCom.y,r={y:s+10},n={y:s-20},o={y:s-40},[3,11];case 5:return s=this._numCom.y,r={y:s-10},n={y:s+20},o={y:s+40},[3,11];case 6:return s=this._numCom.x,r={x:s+10},n={x:s-20},o={x:s-40},[3,11];case 7:return s=this._numCom.x,r={x:s-10},n={x:s+20},o={x:s+40},[3,11];case 8:return[4,fairygui.GTimers.inst.waitTime(177)];case 9:return h.sent(),[4,e.call(i)];case 10:return h.sent(),[2];case 11:return[4,new Promise(function(a){var h,l=u;egret.Tween.get(u._numCom).to(r,70).wait(37).to(n,70).call(function(){h=e.call(i)},u).to(o,37).wait(70).call(function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return l._isMoving=!1,l._pos==t.CardNumPos.UP?l._numCom.y=s:l._pos==t.CardNumPos.DOWN?l._numCom.y=s:l._pos==t.CardNumPos.LEFT?l._numCom.x=s:l._numCom.x=s,h?[4,h]:[3,2];case 1:e.sent(),e.label=2;case 2:return a(),[2]}})})},u),u._fightWinTrans.play()})];case 12:return h.sent(),[2]}})})},e.prototype.beAttack=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o=this;return __generator(this,function(s){switch(s.label){case 0:return this._isMoving?[2]:(this._isMoving=!0,e==t.CardNumPos.UP?(r=this._numCom.y,i={y:r-10}):e==t.CardNumPos.DOWN?(r=this._numCom.y,i={y:r+10}):e==t.CardNumPos.LEFT?(r=this._numCom.x,i={x:r-10}):(r=this._numCom.x,i={x:r+10}),n=this,[4,new Promise(function(s){egret.Tween.get(o._numCom).to(i,70).wait(37).call(function(){n._isMoving=!1,e==t.CardNumPos.UP||e==t.CardNumPos.DOWN?n._numCom.y=r:n._numCom.x=r,s()},o),o._fightLoseTrans.play()})]);case 1:return s.sent(),[2]}})})},e}();t.FightCardNum=e,__reflect(e.prototype,"Battle.FightCardNum")}(Battle||(Battle={}));var Battle;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._upMoveing=!1,t._downMoveing=!1,t._leftMoveing=!1,t._rightMoveing=!1,t._isDetailOpen=!1,t}return __extends(i,e),i.prototype.constructFromXML=function(i){e.prototype.constructFromXML.call(this,i),this._battleView=Core.ViewManager.inst.getView(ViewName.battle),this._effectPlayer=new t.EffectPlayer(this),this._nums=new Collection.Dictionary,this._nums.setValue(t.CardNumPos.UP,new t.FightCardNum(this._upNum,t.CardNumPos.UP)),this._nums.setValue(t.CardNumPos.DOWN,new t.FightCardNum(this._downNum,t.CardNumPos.DOWN)),this._nums.setValue(t.CardNumPos.LEFT,new t.FightCardNum(this._leftNum,t.CardNumPos.LEFT)),this._nums.setValue(t.CardNumPos.RIGHT,new t.FightCardNum(this._rightNum,t.CardNumPos.RIGHT)),this.addEventListener(fairygui.DragEvent.DRAG_START,this._onDragStart,this),this.addEventListener(fairygui.DragEvent.DRAG_MOVING,this._onDragMove,this),this.addEventListener(fairygui.DragEvent.DRAG_END,this._onDragEnd,this),this.addClickListener(this._onClick,this)},i.prototype.playEffect=function(t,e,i,r,n){return void 0===i&&(i=!0),this._effectPlayer.playEffect(t,e,i,r,n)},i.prototype.clearEffect=function(){return this._effectPlayer.clearEffect()},Object.defineProperty(i.prototype,"hand",{get:function(){return this._hand},set:function(t){this._hand=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"effectPlayer",{get:function(){return this._effectPlayer},set:function(t){this._effectPlayer=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectGrid",{get:function(){return this._selectGrid},set:function(t){this._selectGrid=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isDetailOpen",{set:function(t){this._isDetailOpen=t},enumerable:!0,configurable:!0}),i.prototype.toBeCopy=function(t){this.cardObj=t,this._effectPlayer.clearEffect(),t.view=this},i.prototype.setNumText=function(){if(!this._hand||this._hand.isShow){var t=this.cardObj;t.isShowFogUI()?e.prototype.setNumText.call(this,!1):e.prototype.setNumText.call(this)}},i.prototype.cacheAsBitmap=function(t){this.displayObject.cacheAsBitmap=t},i.prototype.refleshSkill=function(){var t=this.cardObj;if(t.isShowFogUI())return void this.hideSkill();for(var e=this.cardObj,i=["","","",""],r=0,n=0,o=e.getEffectiveSkill();n<o.length;n++){var s=o[n];if(i[r]=s.name,r++,r>=i.length)break}this.setSkillByName(i[0],i[1],i[2],i[3])},i.prototype.leaveFog=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r=this;return __generator(this,function(n){switch(n.label){case 0:return t=RES.getResAsync("effect_sanwu_mc_json"),[4,RES.getResAsync("effect_sanwu_tex_png")];case 1:return n.sent(),[4,t];case 2:return n.sent(),this.setFrontSkin(),(e=Core.MCFactory.inst.getMovieClip("sanwu","sanwu"))?(this.addChild(e),e.x=this.width/2,e.y=this.height/2,i=new Promise(function(t){e.once(egret.MovieClipEvent.COMPLETE,function(){e.removeFromParent(),e.scaleX=1,e.scaleY=1,Core.MCFactory.inst.revertMovieClip(e),t()},r)}),e.gotoAndPlay(1,1),[4,i]):[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}})})},i.prototype.setFrontSkin=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o=this;return __generator(this,function(s){return e=this.cardObj,e.side==t.Side.OWN?(this.setOwnFront(),this.setOwnBackground()):(this.setOppFront(),this.setOppBackground()),this.setEquip(),this.setCardImg(),this.setName(),this.setNumText(),this.refleshSkill(),this.touchable=!0,i=this.getChild("fogEffect"),e.isInFog?i||(r=this,RES.getResAsync("effect_dawu_mc_json").then(function(){RES.getResAsync("effect_dawu_tex_png").then(function(){e.isInFog&&(i=Core.MCFactory.inst.getMovieClip("dawu","dawu"),i&&(i.name="fogEffect",r.addChild(i),i.x=r.width/2,i.y=r.height/2,i.gotoAndPlay(1,-1)))})})):i&&(this.removeChild(i),Core.MCFactory.inst.revertMovieClip(i)),e.initEffects&&(n=e.initEffects,e.clearInitEffects(),egret.callLater(function(){t.BattleMgr.inst.battle&&n.forEach(function(i){var r=!0,n=t.BattleMgr.inst.battle.getBattleObj(i.OwnerObjID);if(n&&n instanceof t.FightCard){r=!e.isShowFogUI()}var s=parseInt(i.MovieID);isNaN(s)?o.playEffect(i.MovieID,i.PlayType,r):o.playEffect(s,i.PlayType,r)})},this)),[2]})})},i.prototype.setName=function(){var t=this.cardObj;t.isShowFogUI()?e.prototype.hideName.call(this):e.prototype.setName.call(this)},i.prototype._onClick=function(){return"smallCard"==this.packageItem.name&&this._isDetailOpen?void(this._isDetailOpen=!1):(this._isDetailOpen=!0,void Core.ViewManager.inst.open(ViewName.cardDetail,this.cardObj))},i.prototype._onDragStart=function(){this._hand&&(this._hand.handTouchable(!1),this._hand.bringCardToFront(this))},i.prototype._onDragMove=function(){if(!t.BattleMgr.inst.battle.isMyBout()){var e=Math.sqrt(Math.pow(this.x-this.inHandPoint.x,2)+Math.pow(this.y-this.inHandPoint.y,2));if(e>110)return Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60162)),this.stopDrag(),this._selectGrid&&(this._selectGrid.selected=!1,this._selectGrid=null),void this._onDragEnd()}var i=this.parent.localToRoot(this.x,this.y,null,!1),r=this._battleView.selectGrid(i.x,i.y,this.width,this.height);null==r||r.inGridCard?null!=this._selectGrid&&(this._selectGrid.selected=!1,this._selectGrid=null):null!=this._selectGrid&&this._selectGrid.gridId!=r.gridId?(this._selectGrid.selected=!1,r.selected=!0,this._selectGrid=r):(r.selected=!0,this._selectGrid=r)},i.prototype._onDragEnd=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o;return __generator(this,function(s){switch(s.label){case 0:return null!=this._selectGrid&&t.BattleMgr.inst.battle?[4,t.BattleMgr.inst.battle.playCard(this.cardObj.objId,this._selectGrid.gridId)]:[3,2];case 1:if(e=s.sent())return this._hand.handTouchable(!0),[2];this._selectGrid.selected=!1,this._selectGrid=null,s.label=2;case 2:return this._hand.handTouchable(!0),i=this.inHandPoint.x,r=this.inHandPoint.y,n=2.4,o=Math.sqrt(Math.pow(i-this.x,2)+Math.pow(r-this.y,2)),egret.Tween.get(this).to({x:i,y:r},o/n),[2]}})})},i.prototype._addToGrid=function(e,i){return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a;return __generator(this,function(u){switch(u.label){case 0:return r=this.cardObj,n=e.addCard(this.cardObj),o=n[0],s=n[1],this._effectPlayer.switchParent(o),o.effectPlayer=this._effectPlayer,this._effectPlayer=null,this.cardObj=null,this._selectGrid=null,this._hand.refresh(),s?[4,s]:[3,2];case 1:u.sent(),u.label=2;case 2:return a=r,fairygui.GTimers.inst.callDelay(160,function(e){SoundMgr.inst.playSoundAsync("playcard_mp3"),i&&e&&!t.VideoPlayer.inst.isPlaying&&!a.isShowFogUI()&&SoundMgr.inst.playSoundAsync(e+"_mp3")},this,r.sound),o.displayObject.cacheAsBitmap=!0,[2]}})})},i.prototype.moveAndAddToGrid=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r,n=this;return __generator(this,function(o){switch(o.label){case 0:return t.inGridCard?[2]:this._selectGrid?(this._addToGrid(t,e),[2]):(i=t.localToGlobal(t.width/2-this.width/2,t.height/2-this.height/2),r=this.parent.globalToLocal(i.x,i.y),[4,new Promise(function(i){egret.Tween.get(n).to({x:r.x,y:r.y},200).call(function(){n._addToGrid(t,e),i()},null)})]);case 1:return o.sent(),[2]}})})},i.prototype.moveToHand=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a,u=this;return __generator(this,function(h){switch(h.label){case 0:return i=Core.ViewManager.inst.getView(ViewName.battle),r=this.parent,n=t.getGridByIndex(e),o=n.width/this.width,s=n.localToGlobal(n.width/2,n.height/2),a=this.parent.globalToLocal(s.x,s.y),i.switchGridAndHand(r),[4,new Promise(function(t){egret.Tween.get(u).to({x:a.x,y:a.y,scaleX:o,scaleY:o},200).call(function(){i.switchGridAndHand(r),t()},null)})];case 1:return h.sent(),[2]}})})},i.prototype.blink=function(t){return void 0===t&&(t=Core.TextColors.red),__awaiter(this,void 0,void 0,function(){var e,i=this;return __generator(this,function(r){switch(r.label){case 0:return e=new fairygui.GGraph,e.width=this.width,e.height=this.height,e.drawRect(0,t,0,t,.8,[7]),this.addChild(e),[4,new Promise(function(t){egret.Tween.get(e).to({alpha:.4},110).wait(35).call(function(){i.removeChild(e)},null).wait(263).call(function(){t()},i)})];case 1:return r.sent(),[2]}})})},i.prototype.showNewbieCountNum=function(t,e){var i=this;this._newbieCountNum||(this._newbieCountNum=new fairygui.GImage);var r="battle_r"+t+"_png";e&&(r="battle_b"+t+"_png"),this.addChild(this._newbieCountNum),RES.getResAsync(r).then(function(t){i._newbieCountNum.parent&&(i._newbieCountNum.texture=t,i._newbieCountNum.width=i.initWidth,i._newbieCountNum.height=i.initHeight,i._newbieCountNum.setPivot(.5,.5,!0),i._newbieCountNum.setScale(.8,.8),i._newbieCountNum.x=i.width/2,i._newbieCountNum.y=i.height/2)})},i.prototype.hideNewbieCountNum=function(){this._newbieCountNum&&(this._newbieCountNum.removeFromParent(),this._newbieCountNum=null)},i.prototype._playEffectOnTarget=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r,n=this;return __generator(this,function(o){switch(o.label){case 0:return i=RES.getResAsync("effect_"+e+"_mc_json"),[4,RES.getResAsync("effect_"+e+"_tex_png")];case 1:return o.sent(),[4,i];case 2:return o.sent(),(r=Core.MCFactory.inst.getMovieClip(e,e))?(r.x=t.x+t.width/2-r.width/2,r.y=t.y+t.height/2-r.height/2,this.addChild(r),[4,new Promise(function(t){r.once(egret.MovieClipEvent.COMPLETE,function(){Core.MCFactory.inst.revertMovieClip(r),r=null,t()},n),r.gotoAndPlay(1,1)})]):(console.error("can't play effect ",e),[2]);case 3:return o.sent(),[2]}})})},i.prototype.equipBlink=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this._playEffectOnTarget(this._equipBtn,"eqshanbai")];case 1:return t.sent(),[2]}})})},i.prototype.skillBlink=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o;return __generator(this,function(s){switch(s.label){case 0:for(i=[this._skill1Text,this._skill2Text,this._skill3Text,this._skill4Text],r=0,n=i;r<n.length;r++)if(o=n[r],o.text==t){e=o;break}return e?[4,this._playEffectOnTarget(e,"jinengshanbai")]:[2];case 1:return s.sent(),[2]}})})},i.prototype.beAttackNumBlink=function(t,e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return i=this._nums.getValue(t),!i||i.isMoving?[2]:[4,i.blink(e,!1)];case 1:return r.sent(),[2]}})})},i.prototype.beAttackNumStopBlink=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=this._nums.getValue(t),!e||e.isMoving?[2]:(e.stopBlink(),[2])})})},i.prototype.attackAndMoveTarget=function(e,i,r,n,o,s,a,u,h){return __awaiter(this,void 0,void 0,function(){var l,c,d,p,_,g,f;return __generator(this,function(m){switch(m.label){case 0:return l=this._nums.getValue(i),l.isMoving||(c=l.blink(u,!0)),[4,e.beAttackNumBlink(r,u)];case 1:return m.sent(),c?[4,c]:[3,3];case 2:m.sent(),m.label=3;case 3:return u?[4,Guide.GuideMgr.inst.showGuideText(e,Core.StringUtils.TEXT(60236))]:[3,5];case 4:m.sent(),l.stopBlink(),e.beAttackNumStopBlink(r),m.label=5;case 5:return d=this.cardObj.weapon,h&&"arrow"!=d&&(p=e.cardObj.gridObj,_=this.cardObj.gridObj,p&&_&&(Math.floor(p.id/3)==Math.floor(_.id/3)?Math.abs(p.id-_.id)>1&&(d="arrow"):p.id%3==_.id%3&&Math.abs(p.id-_.id)>3&&(d="arrow"))),g=this,f=Core.ViewManager.inst.getView(ViewName.battle),f.bringGridToFront(this.parent),[4,l.attack(function(){return __awaiter(this,void 0,void 0,function(){var u;return __generator(this,function(h){switch(h.label){case 0:return u=e.beAttackAndMove(i,r,d,g.cardObj.weaponRedFrame),n&&a!=t.CardNumPos.NONE?[4,n.moveToGrid(o,s,a)]:[3,2];case 1:h.sent(),h.label=2;case 2:return[4,u];case 3:return h.sent(),g=null,[2]}})})},this)];case 6:return m.sent(),[2]}})})},i.prototype.beAttackAndMove=function(e,i,r,n){var o=this,s=[],a=this._nums.getValue(i);if(s.push(a.beAttack(e)),e!=t.CardNumPos.NONE){var u=Core.MCFactory.inst.getMovieClip(r,r);if(null!=u){u.addFrameEvent(n,"blinkRed");var h=this.localToRoot(0,0,null,!1);u.x=h.x,u.y=h.y,e==t.CardNumPos.DOWN?u.rotation=180:e==t.CardNumPos.LEFT?u.rotation=-90:e==t.CardNumPos.RIGHT&&(u.rotation=90),fairygui.GRoot.inst.addChild(u),s.push(new Promise(function(t){u.once(egret.MovieClipEvent.COMPLETE,function(){u&&(u.rotation=0,Core.MCFactory.inst.revertMovieClip(u),u=null),t()},o)})),s.push(new Promise(function(t){u.once(egret.MovieClipEvent.FRAME_LABEL,function(){egret.Tween.get(o).to({rotation:5},25).to({rotation:-5},50).to({rotation:0},25),o.blink(Core.TextColors.red).then(function(){t()})},o)})),u.gotoAndPlay(1,1),SoundMgr.inst.playSoundAsync(r+"_mp3")}}return Promise.all(s)},i.prototype.moveToGrid=function(e,i,r){var n=this,o=[];null!=e&&o.push(e.cardMoveIn(this));var s=Core.MCFactory.inst.getMovieClip(i,i);if(null!=s){var a=this.localToRoot(0,0,null,!1);s.x=a.x,s.y=a.y,r==t.CardNumPos.DOWN?s.rotation=180:r==t.CardNumPos.LEFT?s.rotation=-90:r==t.CardNumPos.RIGHT&&(s.rotation=90),fairygui.GRoot.inst.addChild(s);var u=new Promise(function(t){s.once(egret.MovieClipEvent.COMPLETE,function(){s&&(s.rotation=0,Core.MCFactory.inst.revertMovieClip(s),s=null),t()},n),s.gotoAndPlay(1,1)});o.push(u),SoundMgr.inst.playSoundAsync(i+"_mp3")}return Promise.all(o)},i.prototype.changeSide=function(){var e=this;return fairygui.GTimers.inst.callDelay(100,function(){SoundMgr.inst.playSoundAsync("turn_mp3")},null),new Promise(function(i){var r=e.cardObj;r.gridObj||e.setPivot(.5,.5),egret.Tween.get(e).to({skewY:-112},132).call(function(){var n=e.getTransition("hit");if(n&&n.play(),r.gridObj&&(e.displayObject.cacheAsBitmap=!1),r.gridObj)r.side==t.Side.OWN?(e.setOwnFront(),e.setOwnBackground()):(e.setOppFront(),e.setOppBackground());else{var o=t.BattleMgr.inst.battle;if(!o)return void i();o.getFighter(r.initOwner.uid).handView.updateCardSkin(e)}fairygui.GTimers.inst.callDelay(500,function(){r.gridObj&&this.parent&&(this.displayObject.cacheAsBitmap=!0)},e,null)},e).to({skewY:-166},66).wait(28).call(function(){e.skewY=0,r.gridObj||e.setPivot(0,0),i()},e)})},i.prototype.watch=function(){},i.prototype.unwatch=function(){},i}(UI.CardCom);t.FightCardView=e,__reflect(e.prototype,"Battle.FightCardView")}(Battle||(Battle={}));var Battle;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(i){e.prototype.constructFromXML.call(this,i),this._selectedImg=this.getChild("selectedImg").asLoader,this._effectPlayer=new t.EffectPlayer(this),this._effectPlayer.removeEffectFunc=t.EffectPlayer.removeAllEffectByID,this.selected=!1},Object.defineProperty(i.prototype,"gridId",{get:function(){return this._gridId},set:function(t){this._gridId=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selected",{get:function(){return this._selectedImg.visible},set:function(t){this._selectedImg.visible=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"inGridCard",{get:function(){return this._inGridCard},set:function(t){this._inGridCard=t},enumerable:!0,configurable:!0}),i.prototype.isInGrid=function(t,e,i,r){var n=this.x-30,o=this.y-40,s=this.width+60,a=this.height+80;return t>=n&&e>=o&&s-i>=t-n&&a-r>=e-o},i.prototype.playEffect=function(t,e,i,r,n){return void 0===i&&(i=!0),this._effectPlayer.playEffect(t,e,!0,r,n)},i.prototype.setup=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,n=this;return __generator(this,function(o){switch(o.label){case 0:return t.view=this,t.inGridCard?(e=this.addCard(t.inGridCard,0),i=e[0],r=e[1],r?[4,r]:[3,2]):[3,3];case 1:o.sent(),o.label=2;case 2:i.cardObj.gridObj=t,o.label=3;case 3:return t.initEffects&&t.initEffects.forEach(function(t){var e=parseInt(t.MovieID);isNaN(e)?n.playEffect(t.MovieID,t.PlayType):n.playEffect(e,t.PlayType)}),[2]}})})},i.prototype.addCard=function(e,i){void 0===i&&(i=1);var r=fairygui.UIPackage.createObject(PkgName.cards,"middleCard",t.FightCardView);r.cardObj=e,e.view=r,r.setFrontSkin(),r.setPivot(.5,.5,!0),r.x=this.width/2,r.y=this.height/2,r.touchable=!0,r.selectGrid=this,this.selected=!1,this.addChild(r),this.inGridCard=r;var n;1==i?n=r.getTransition("add"):2==i&&(n=r.getTransition("readd"));var o;if(n&&!n.playing){var s=this;o=new Promise(function(t){n.play(function(){s=null,t()},s)})}return[r,o]},i.prototype.cardMoveIn=function(t){var e=this;return new Promise(function(i){t.selectGrid.inGridCard=null;var r=t.parent.rootToLocal(e.x,e.y);t.parent.parent==e.parent&&(r={x:e.x-t.parent.x,y:e.y-t.parent.y}),SoundMgr.inst.playSoundAsync("newcard_mp3"),egret.Tween.get(t).to({x:r.x+e.width/2,y:r.y+e.height/2},200).call(function(){t.selectGrid=e,e._inGridCard=t,t.removeFromParent(),t.x=e.width/2,t.y=e.height/2,e.addChild(t),i()},e)})},i.prototype.clear=function(){this._inGridCard&&(this._inGridCard.parent&&this._inGridCard.parent.removeChild(this._inGridCard,!0),this._inGridCard=null);for(var e=0;e<this.numChildren;){var i=this.getChildAt(e);i instanceof t.FightCardView?this.removeChildAt(e,!0):e++}this.selected=!1,this._effectPlayer.clearEffect()},i.prototype.inGridCardToBeCopy=function(t){this._inGridCard=t},i}(fairygui.GComponent);t.GridView=e,__reflect(e.prototype,"Battle.GridView")}(Battle||(Battle={}));var Battle;!function(t){var e=function(){function e(t,e){this._handCardGrid=t,this._handCardGrid.disabled=!0,this._owner=e,e.handView=this,this._handCardGrid.dataProvider=e,this._isShow=!1,this._isFightBegin=!1
}return Object.defineProperty(e.prototype,"isShow",{get:function(){return this._isShow},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"handCardGrid",{get:function(){return this._handCardGrid},enumerable:!0,configurable:!0}),e.prototype._forEachCard=function(t){for(var e=0;5>e;e++){var i=this._handCardGrid.getItem(e);if(i){var r=i;t.call(this,r)}}},e.prototype.bringCardToFront=function(t){t.parent&&t.parent.setChildIndex(t,t.parent.numChildren)},e.prototype.handDraggable=function(t){this._forEachCard(function(e){e.cardObj.isShadow||(e.draggable=t)})},e.prototype.handTouchable=function(t){this._forEachCard(function(e){e.touchable=t})},e.prototype.handVisibleLightCircle=function(t){this._forEachCard(function(e){e.visibleLightCircle(t)})},e.prototype.buildHandItem=function(e,i){if(!i)return null;var r=i,n=fairygui.UIPackage.createObject(PkgName.cards,"smallCard",t.FightCardView);return n.cardObj=r,r.view=n,this.updateCardSkin(n),n.hand=this,n},e.prototype.updateCardSkin=function(e){var i=e.cardObj;this._isShow?e.setFrontSkin():(e.hideFront(),e.showEquipBtn(!1),i.owner==this._owner?e.setBackImg():e.setOwnBackImg()),t.BattleMgr.inst.battle&&(t.BattleMgr.inst.battle.getOwnFighter()==this._owner?e.getChild("lightCircle").asLoader.url="cards_cardLightSelf_png":e.getChild("lightCircle").asLoader.url="cards_cardLightEnemy_png"),e.cardObj.isShadow?e.alpha=.3:e.alpha=1,e.touchable=this._isShow},e.prototype.show=function(){this._isShow=!0},e.prototype.refresh=function(t){void 0===t&&(t=!1),this._handCardGrid.refresh(t)},e.prototype.clear=function(){this._owner=null,this._handCardGrid.clear()},e.prototype.boutBegin=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=t.uid==this._owner.uid,this.handVisibleLightCircle(e),this._isFightBegin||(this._isFightBegin=!0,this._handCardGrid.disabled=!0),[2]})})},e.prototype.getGridByIndex=function(t){return this._handCardGrid.getGrid(t)},e.prototype.getGuideClickNode=function(){for(var t=this,e=new fairygui.GGraph,i=function(i){if(r._handCardGrid.getItem(i))return"continue";var n=r._handCardGrid.getGrid(i);return e.graphics.clear(),e.graphics.beginFill(Core.TextColors.white,0),e.graphics.drawRect(0,0,r._handCardGrid.width-n.x,r._handCardGrid.height),e.graphics.endFill(),e.x=n.x,e.y=n.y,e.width=r._handCardGrid.width-n.x,e.height=r._handCardGrid.height,r._handCardGrid.addChildAt(e,0),e.once(egret.TouchEvent.TOUCH_TAP,function(){t._handCardGrid.removeChild(e),n.dispatchEventWith(egret.TouchEvent.TOUCH_TAP)},r),{value:e}},r=this,n=0;n<this._handCardGrid.itemNum;n++){var o=i(n);if("object"==typeof o)return o.value}return null},e}();t.Hand=e,__reflect(e.prototype,"Battle.Hand",["UI.IHandItemBuilder"]);var i=function(e){function i(i,r,n){var o=e.call(this,i,n)||this;return o._isShow=!0,o._handCardGrid.itemBuilder=o,o._canDragCard=!0,r instanceof t.LevelBattle&&!r.isBeginFight?r.getMaxAmount()>0?(o._handCardGrid.choiceCardCtrl=r,Core.ViewManager.inst.getView(ViewName.battle).visibleBeginBtn(!0,!1)):Core.ViewManager.inst.getView(ViewName.battle).visibleBeginBtn(!0,!1):r.battleType==t.BattleType.VIDEO&&(o._canDragCard=!1),o._handCardGrid.refresh(),o}return __extends(i,e),i.prototype.boutBegin=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,e.prototype.boutBegin.call(this,t)];case 1:return i.sent(),this.handDraggable(this._canDragCard),[2]}})})},i}(e);t.MyHand=i,__reflect(i.prototype,"Battle.MyHand");var r=function(t){function e(e,i,r){var n=t.call(this,e,r)||this;return n._handCardGrid.itemBuilder=n,i.isEnemyHandOpen()&&t.prototype.show.call(n),n._handCardGrid.refresh(),n}return __extends(e,t),e.prototype.show=function(){t.prototype.show.call(this),this._forEachCard(function(t){t.setFrontSkin()})},e}(e);t.EnemyHand=r,__reflect(r.prototype,"Battle.EnemyHand")}(Battle||(Battle={}));var Battle;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this.visibleEnergyProgress(!1)},e}(t.RewardCardItem);__reflect(e.prototype,"LevelRewardCardItem");var i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.initUI=function(){i.prototype.initUI.call(this),this._cardList=this.getChild("cardList").asList,this._cardList.itemClass=e,this._noRewardTips=this.getChild("noRewardTips").asTextField;var t=this.getChild("rewardTitle");t&&(this._rewardTitle=t.asTextField)},r.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(r){switch(r.label){case 0:return e=t[0].WinUid==Player.inst.uid,this._resultCtrl.selectedPage=e?"win":"lose",e?(this._rewardTitle&&(this._rewardTitle.visible=!1),this.setRewardResBar(t[0].Res),this._hasNewCard(t[0].ChangeCards)&&this._visibleRewardResBar(!1)):this._rewardTitle&&(this._rewardTitle.visible=!1),this._noRewardTips.visible=!1,[4,i.prototype.open.call(this,e)];case 1:return r.sent(),Core.MaskUtils.showTransMask(),Level.LevelMgr.inst.onEnterLevel(),e?(fairygui.GTimers.inst.callLater(this._showReward,this,t[0]),[2]):(Core.MaskUtils.hideTransMask(),this.touchable=!0,[2])}})})},r.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,i.prototype.close.apply(this,t)];case 1:return e.sent(),this._cardList.removeChildren(),[2]}})})},r.prototype._visibleRewardResBar=function(t){var e=this.getChild("rewardResBg"),i=this.getChild("rewardResBar");e&&(e.visible=t),i&&(i.visible=t)},r.prototype._showReward=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return[4,fairygui.GTimers.inst.waitTime(300)];case 1:return r.sent(),Core.MaskUtils.hideTransMask(),this.isShow()?[4,this._showNewCard(t.ChangeCards)]:[2];case 2:return e=r.sent(),this.isShow()?(t.Res&&t.Res.length>0&&this._visibleRewardResBar(!0),this.touchable=!0,i=t.ChangeCards&&t.ChangeCards.length>0,i?this.cardListDoAnimation(this._cardList,t.ChangeCards):(!t.Res||t.Res.length<=0)&&this._showNoRewardTips(),[2]):[2]}})})},r.prototype._showNoRewardTips=function(){this._noRewardTips.visible=!0,this._noRewardTips.alpha=0,egret.Tween.get(this._noRewardTips).to({alpha:1},600)},r.prototype._hasNewCard=function(t){if(!t)return!1;for(var e=0,i=t;e<i.length;e++){var r=i[e];if(!r.Old)return!0}return!1},r.prototype._showNewCard=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a;return __generator(this,function(u){switch(u.label){case 0:if(!e)return[2,!1];this._cardList.visible=!1,r=!1,n=0,o=e,u.label=1;case 1:return n<o.length?(s=o[n],s.Old?(r=!0,[3,3]):(a=new CardPool.Card(CardPool.CardPoolMgr.inst.getCardData(s.New.CardId,s.New.Level)),a.init(s.New),i||(i=fairygui.UIPackage.createObject(PkgName.battle,"rewardNewCard",t.RewardNewCard)),[4,i.show(a)])):[3,4];case 2:if(u.sent(),!this.isShow())return i.hide(),[2,r];u.label=3;case 3:return n++,[3,1];case 4:return i&&i.hide(),[2,r]}})})},r}(t.BaseBattleEnd);t.LevelBattleEnd=i,__reflect(i.prototype,"Battle.LevelBattleEnd")}(Battle||(Battle={}));var Battle;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.adjust(this.getChild("bg")),this._winCom=this.getChild("win").asCom,this._winCom.visible=!1,this._loseCom=this.getChild("lose").asCom,this._loseCom.visible=!1,this._isClosing=!1,this._canClose=!1,this._closeTrans=this.getTransition("t0"),this._showBtnTrans=this.getTransition("t1"),this.getChild("closeBtn").addClickListener(this.onBack,this),this.getChild("backBtn").addClickListener(this.onBack,this)},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a,u;return __generator(this,function(h){switch(h.label){case 0:return SoundMgr.inst.stopBgMusic(!1),Core.TipsUtils.closeConfirmPanel(),e.prototype.open.apply(this,i),this._battleId=t.BattleMgr.inst.battle.battleID,this._battleType=t.BattleMgr.inst.battle.battleType,r=i[0],n=i[2],console.log("isReplay:"+n),this.setupReplay(n),r.WinUid!=i[1].getOwnFighter().uid?[3,2]:(this._winCom.visible=!0,[4,this.onWin(r)]);case 1:return h.sent(),[3,4];case 2:return this._loseCom.visible=!0,[4,this.onLose(r)];case 3:h.sent(),h.label=4;case 4:return this._canClose=!0,this._showBtnTrans.play(),o=Core.ViewManager.inst.getView(ViewName.match),o||(Core.ViewManager.inst.tryCreateView(ViewName.match),o=Core.ViewManager.inst.getView(ViewName.match)),s=o.getLatestAddTreasureCom(),s&&s.hideContent(),Pvp.PvpMgr.inst.getPvpLevel()<2&&this._loseCom.visible?this.getChild("closeBtn").asButton.title=Core.StringUtils.TEXT(60068):this.getChild("closeBtn").asButton.title=Core.StringUtils.TEXT(60044),a=Player.inst.oldFlag,u=Player.inst.getResource(ResType.SeasonWinDiff),a&&a!=u&&(Core.TipsUtils.flagTips(a,u),Player.inst.oldFlag=u),[2]}})})},i.prototype.setupReplay=function(t){},i.prototype.playCloseAni=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){t._closeTrans.play(function(){e()})})];case 1:return e.sent(),[2]}})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return[4,e.prototype.close.apply(this,t)];case 1:return r.sent(),this._canClose=!1,this._isClosing=!1,SoundMgr.inst.playBgMusic("bg_mp3"),[4,this.playCloseAni()];case 2:return r.sent(),this._winCom.visible=!1,this._loseCom.visible=!1,this.alpha=1,i=Core.ViewManager.inst.getView(ViewName.newHome),i||(Core.ViewManager.inst.open(ViewName.newHome),Quest.QuestMgr.inst.updateQuestBtn()),[2]}})})},i.prototype.onWin=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},i.prototype.onLose=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},i.prototype.calcResModify=function(t,e){if(e.scoreModify)return e.scoreModify;for(var i=e.ChangeRes,r=0,n=0,o=i;n<o.length;n++){var s=o[n];if(s.Old.Type==t){r=s.New.Amount-s.Old.Amount;break}}return r},i.prototype.onBack=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._isClosing||!this._canClose?[2,!1]:(this._isClosing=!0,[4,Core.ViewManager.inst.close(ViewName.battle)]);case 1:return t.sent(),[4,Core.ViewManager.inst.closeView(this)];case 2:return t.sent(),[2,!0]}})})},i}(Core.BaseView);t.BattleEndBaseView=e,__reflect(e.prototype,"Battle.BattleEndBaseView");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this._loseAdvertBtn=this.getChild("loseAdvertBtn").asButton,this._loseShareBtn=this.getChild("loseShareBtn").asButton,this._winShareBtn=this.getChild("winShareBtn").asButton,this._closeBtn=this.getChild("closeBtn").asButton,this._backBtn=this.getChild("backBtn").asButton,this._winShareBtn.addClickListener(function(){Core.DeviceUtils.isWXGame()&&WXGame.WXShareMgr.inst.wechatShareBattleVideo(e._battleId)},this),this._loseShareBtn.addClickListener(function(){Core.DeviceUtils.isWXGame()&&WXGame.WXShareMgr.inst.wechatSharePreventLoseStar()},this),this._loseAdvertBtn.addClickListener(function(){return __awaiter(e,void 0,void 0,function(){var t,e,i,r;return __generator(this,function(n){switch(n.label){case 0:return adsPlatform.isAdsOpen()?[4,adsPlatform.isAdsReady()]:[3,4];case 1:return t=n.sent(),t.success?[4,adsPlatform.showRewardAds()]:(Core.TipsUtils.showTipsFromCenter(t.reason),[2]);case 2:return e=n.sent(),e?[4,Net.rpcCall(pb.MessageID.C2S_BATTLE_LOSE_READ_ADS,null)]:[3,4];case 3:i=n.sent(),0==i.errcode&&(r=pb.BattleLoseReadAdsReply.decode(i.payload),r.AddStar>0&&this.onBeHelpToPreventLoseStar(r.AddStar)),n.label=4;case 4:return[2]}})})},this)},e.prototype.onWin=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o=this;return __generator(this,function(s){switch(s.label){case 0:return this._isWin=!0,e=t,this._closeBtn.visible=!0,this._backBtn.visible=!1,this._loseShareBtn.visible=!1,this._loseAdvertBtn.visible=!1,this._winCom.setPvpMode(),i=this.calcResModify(ResType.T_GOLD,e),this._winCom.initGold(i),r=this.calcResModify(ResType.T_SCORE,e),this._scoreModify=r,this._cardIds=[],e.UpPvpLevelRewardCards.forEach(function(t){o._cardIds.push(t)}),r>=0?(r>1&&Core.TipsUtils.privTips(Priv.BATTLE_ADD_STAR),n=Player.inst.getResource(ResType.T_SCORE)-r,this._winCom.initCurRankBanner(n),this._winCom.initBox(e.TreasureID,e.NoTreasureReason),[4,this._winCom.playWinAnimation()]):[3,3];case 1:return s.sent(),r>0?[4,this._winCom.onWin(r)]:[3,3];case 2:s.sent(),s.label=3;case 3:return e.UpRareTreasureModelID&&""!=e.UpRareTreasureModelID?(Core.DeviceUtils.isWXGame()&&Core.EventCenter.inst.addEventListener(GameEvent.UpTreasureRareEv,this._onShareUpTreasure,this),[4,new Promise(function(t){o._upTreasureResolve=t,Core.ViewManager.inst.open(ViewName.advertUpTreasureWnd,e.TreasureID,e.UpRareTreasureModelID,function(i,r){return __awaiter(o,void 0,void 0,function(){var n,o,s,a;return __generator(this,function(u){switch(u.label){case 0:return i?(n={IsConsumeJade:r},[4,Net.rpcCall(pb.MessageID.C2S_WATCH_UP_TREASURE_RARE_ADS,pb.WatchUpTreasureRareAdsArg.encode(n))]):[3,2];case 1:o=u.sent(),0==o.errcode&&(s=pb.Treasure.decode(o.payload),this._winCom.initBox(s.ModelID,e.NoTreasureReason),a=Treasure.TreasureMgr.inst().getTreasure(s.ID),a.type=s.ModelID,a.fireUpdateEvent()),u.label=2;case 2:return this._upTreasureResolve=null,t(),[2]}})})})})]):[3,5];case 4:s.sent(),s.label=5;case 5:return[2]}})})},e.prototype._onShareUpTreasure=function(t){var e=t.data;this._winCom.initBox(e.ModelID,pb.NoTreasureReasonEnum.Unknow);var i=Treasure.TreasureMgr.inst().getTreasure(e.ID);i&&(i.type=e.ModelID,i.fireUpdateEvent()),this._upTreasureResolve&&(this._upTreasureResolve(),this._upTreasureResolve=null)},e.prototype.onBeHelpToPreventLoseStar=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return e=Player.inst.getResource(ResType.T_SCORE)-t,t>0?(this._loseAdvertBtn.visible=!1,this._loseShareBtn.visible=!1,this._backBtn.visible=!1,this._closeBtn.visible=!0,Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60164)),this._loseCom.initCurRankBanner(e),[4,this._loseCom.onPreventLoseStar(t)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},e.prototype.onLose=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return this._isWin=!1,e=this.calcResModify(ResType.T_SCORE,t),Player.inst.getResource(ResType.T_NO_SUB_STAR_CNT)>0&&0>e?adsPlatform.isAdsOpen()?(this._loseAdvertBtn.visible=!1,this._loseShareBtn.visible=!1,this._closeBtn.visible=!0,this._backBtn.visible=!1):Core.DeviceUtils.isWXGame()?(this._loseAdvertBtn.visible=!1,this._loseShareBtn.visible=!1,this._closeBtn.visible=!0,this._backBtn.visible=!1):(this._loseAdvertBtn.visible=!1,this._loseShareBtn.visible=!1,this._closeBtn.visible=!0,this._backBtn.visible=!1):(this._loseAdvertBtn.visible=!1,this._loseShareBtn.visible=!1,this._closeBtn.visible=!0,this._backBtn.visible=!1),this._winShareBtn.visible=!1,this._loseCom.setPvpMode(),this._scoreModify=e,0>=e?(i=Player.inst.getResource(ResType.T_SCORE)-e,this._loseCom.initCurRankBanner(i),[4,this._loseCom.playLoseAnimation()]):[3,4];case 1:return r.sent(),0>e?[4,this._loseCom.onLose(-e)]:[3,3];case 2:return r.sent(),[3,4];case 3:t.NoSubStarReason==pb.BattleResult.NoSubStarReasonEnum.NoSubStarPriv?Core.TipsUtils.privTips(Priv.BATTLE_NOT_SUB_STAR):t.NoSubStarReason==pb.BattleResult.NoSubStarReasonEnum.Normal?this._loseCom.noScoreDecLose():Pvp.PvpMgr.inst.getPvpLevel()>=2&&this._loseCom.noScoreDecLose(),r.label=4;case 4:return Core.EventCenter.inst.removeEventListener(GameEvent.UpTreasureRareEv,this._onShareUpTreasure,this),[2]}})})},e.prototype.onBack=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o,s,a,u;return __generator(this,function(h){switch(h.label){case 0:return[4,t.prototype.onBack.call(this)];case 1:return h.sent()?(e=!0,i=this._scoreModify,i>0?(r=Player.inst.getResource(ResType.T_SCORE),n=r-i,o=Pvp.PvpMgr.inst.getPvpLevel(r),s=Pvp.PvpMgr.inst.getPvpLevel(n),o>s?(a=Pvp.Config.inst.getUnlockCard(o),a.length>0&&this._cardIds.length>0?[4,Core.ViewManager.inst.open(ViewName.rankUpRewardTips,!0,this._cardIds)]:[3,3]):[3,3]):[3,4]):[2,!1];case 2:h.sent(),e=!1,h.label=3;case 3:return[3,5];case 4:Core.DeviceUtils.isWXGame()&&WXGame.WXShareMgr.inst.cancelPreventLoseStar(),h.label=5;case 5:return e?(u=Core.ViewManager.inst.getView(ViewName.match),[4,u.tryPlayTreasureAddAnimation()]):[3,7];case 6:h.sent(),h.label=7;case 7:return this._isWin||Player.inst.getResource(ResType.T_GUIDE_PRO)<Guide.MaxGuideProgress&&Pvp.PvpMgr.inst.beginMatch(),[2,!0]}})})},e}(e);t.PvpNewBattleEnd=i,__reflect(i.prototype,"Battle.PvpNewBattleEnd");var r=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var t=this;e.prototype.initUI.call(this),this._rewardList=this._winCom.getChild("rewardList").asList,this._saveVideoBtn=this.getChild("saveVideoBtn").asButton,this._shareFacebookBtn=this.getChild("shareFacebookBtn").asButton,this._saveVideoBtn.addClickListener(function(){Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.SAVE_TO_PHOTO),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60201)),t.onBack()},this),this._shareFacebookBtn.addClickListener(function(){Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.SHARE_VIDEO)},this),this._shareFacebookBtn.visible=!1,this._shareFacebookBtn.enabled=!1},i.prototype.setupReplay=function(e){var i=e&&window.support.record&&t.VideoPlayer.inst.recordStartSuccess;this._saveVideoBtn.visible=i,this._saveVideoBtn.enabled=i,i?this.getChild("closeBtn").setXY(280,675):this.getChild("closeBtn").setXY(165,675),window.sharePlatform.getShareType()==ShareType.SHARE_FACEBOOK?(this._shareFacebookBtn.visible=i,this._shareFacebookBtn.enabled=i):(this._shareFacebookBtn.visible=!1,this._shareFacebookBtn.enabled=!1)},i.prototype.onWin=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r=this;return __generator(this,function(n){switch(n.label){case 0:return this._isWin=!0,this._winCom.setLevelMode(),this._rewardList.visible=!0,e=this.calcResModify(ResType.T_GOLD,t),e>0&&(i=fairygui.UIPackage.createObject(PkgName.treasure,"goldCnt",Treasure.GoldRewardCom).asCom,i.count=e,this._rewardList.addChild(i)),t.ChangeCards&&t.ChangeCards.forEach(function(t){if(t.New){var e=CardPool.CardPoolMgr.inst.getCollectCard(t.New.CardId);if(e){var i=fairygui.UIPackage.createObject(PkgName.cards,"middleCard",UI.CardCom);i.cardObj=e,i.setOwnBackground(),i.setOwnFront(),i.setName(),i.setSkill(),i.setNumText(),i.setNumOffsetText(),i.setCardImg(),i.setEquip(),r._rewardList.addChild(i)}}}),[4,this._winCom.playWinAnimation()];case 1:return n.sent(),[2]}})})},i.prototype.onLose=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._isWin=!1,this._loseCom.setLevelMode(),this._rewardList.visible=!1,[4,this._loseCom.playLoseAnimation()];case 1:return t.sent(),[2]}})})},i.prototype._doBack=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this._saveVideoBtn.enabled=!1,this._shareFacebookBtn.enabled=!1,this._isClosing=!0,this._rewardList.removeChildren(),t=Core.ViewManager.inst.getView(ViewName.newHome),[4,t.openLevelView(!0)];case 1:return e.sent(),[4,Core.ViewManager.inst.close(ViewName.battle)];case 2:return e.sent(),[4,Core.ViewManager.inst.closeView(this)];case 3:return e.sent(),[2]}})})},i.prototype.onBack=function(){return __awaiter(this,void 0,void 0,function(){var e,i=this;return __generator(this,function(r){switch(r.label){case 0:return this._isClosing||!this._canClose?[2,!1]:(this._battleType==t.BattleType.LevelHelp&&Core.DeviceUtils.isWXGame()&&this._isWin&&Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60233)),this._battleType!=t.BattleType.LevelHelp||!Core.DeviceUtils.isWXGame()||this._isWin?[3,4]:(e=WXGame.WXGameMgr.inst.lastHandledOption,e&&parseInt(e.query.act)==WXGame.WXShareType.SHARE_LEVEL_HELP?(Core.TipsUtils.confirm(Core.StringUtils.TEXT(60240),function(){return __awaiter(i,void 0,void 0,function(){var t,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return[4,this._doBack()];case 1:return o.sent(),t=Core.StringUtils.stringToLong(e.query.uid),i=parseInt(e.query.levelId),r={HelpUid:t,LevelID:i},[4,Net.rpcCall(pb.MessageID.C2S_LEVEL_HELP_OTHER,pb.LevelHelpArg.encode(r))];case 2:return n=o.sent(),0==n.errcode&&Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60093)),[2]}})})},function(){return __awaiter(i,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this._doBack()];case 1:return t.sent(),[2]}})})},null,Core.StringUtils.TEXT(60028),Core.StringUtils.TEXT(60019)),[3,3]):[3,1]));case 1:return[4,this._doBack()];case 2:r.sent(),r.label=3;case 3:return[3,6];case 4:return[4,this._doBack()];case 5:r.sent(),r.label=6;case 6:return[2,!0]}})})},i}(e);t.LevelNewBattleEnd=r,__reflect(r.prototype,"Battle.LevelNewBattleEnd");var n=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.onWin=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._winCom.setFriendMode(),[4,this._winCom.playWinAnimation()];case 1:return t.sent(),[2]}})})},i.prototype.onLose=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._loseCom.setPvpMode(),[4,this._loseCom.playLoseAnimation()];case 1:return t.sent(),[2]}})})},i.prototype.onBack=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,e.prototype.onBack.call(this)];case 1:return t.sent()?[2,!0]:[2,!1]}})})},i.prototype.playCloseAni=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return this._battleType!=t.BattleType.Campaign?[3,2]:[4,Core.ViewManager.inst.open(ViewName.enterWarAni)];case 1:return i.sent(),[3,4];case 2:return[4,e.prototype.playCloseAni.call(this)];case 3:i.sent(),i.label=4;case 4:return[2]}})})},i}(e);t.FriendBattleEnd=n,__reflect(n.prototype,"Battle.FriendBattleEnd")}(Battle||(Battle={}));var Battle;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._curRankBanner=this.getChild("oldRankBanner").asCom,this._newRankBanner=this.getChild("newRankBanner").asCom,this._loseTrans=this.getTransition("t0"),this._rankdownTrans=this.getTransition("t1"),this._rankupTrans=this.getTransition("t2"),this._cantDecStarHintText=this.getChild("cantDecStarText").asTextField,LanguageMgr.inst.isChineseLocale()||(this.getChild("loseText2").asLoader.y=330)},e.prototype.playLoseAnimation=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return SoundMgr.inst.playSoundAsync("lose_mp3"),[4,new Promise(function(e){t._loseTrans.play(function(){e()})})];case 1:return e.sent(),[2]}})})},e.prototype.playRankdownAnimation=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){t._rankdownTrans.play(function(){e()})})];case 1:return e.sent(),[2]}})})},e.prototype.playRankupAnimation=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){t._rankupTrans.play(function(){e()})})];case 1:return e.sent(),[2]}})})},e.prototype.setPvpMode=function(){this._curRankBanner.show(),this._newRankBanner.show(),this._cantDecStarHintText.visible=!1},e.prototype.setLevelMode=function(){this._curRankBanner.hide(),this._newRankBanner.hide(),this._cantDecStarHintText.visible=!1},e.prototype.setFriendMode=function(){this._curRankBanner.hide(),this._newRankBanner.hide(),this._cantDecStarHintText.visible=!1},e.prototype.initCurRankBanner=function(t){this._curRankBanner.show(),this._curRankBanner.refresh(t)},e.prototype.noScoreDecLose=function(){this._cantDecStarHintText.visible=!0},e.prototype.onPreventLoseStar=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o,s,a,u,h,u,u;return __generator(this,function(l){switch(l.label){case 0:if(e=Player.inst.getResource(ResType.T_SCORE),i=Pvp.PvpMgr.inst.getPvpLevel(e),r=Pvp.PvpMgr.inst.getPvpStarCnt(e),n=e-t,o=Pvp.PvpMgr.inst.getPvpLevel(n),s=Pvp.PvpMgr.inst.getPvpStarCnt(n),this.initCurRankBanner(n),a=Pvp.Config.inst.getPvpMaxStar(o),!(i>o))return[3,10];u=s+1,l.label=1;case 1:return a>=u?[4,this._curRankBanner.curBannerCom.playStarUpAnimation(u)]:[3,4];case 2:l.sent(),l.label=3;case 3:return u++,[3,1];case 4:return h=t-a+s,this._newRankBanner.refresh(e),this._newRankBanner.curBannerCom.refresh(i,0),this._newRankBanner.show(),[4,this.playRankupAnimation()];case 5:l.sent(),u=1,l.label=6;case 6:return h>=u?[4,this._newRankBanner.curBannerCom.playStarUpAnimation(u)]:[3,9];case 7:l.sent(),l.label=8;case 8:return u++,[3,6];case 9:return[3,14];case 10:u=s+1,l.label=11;case 11:return r>=u?[4,this._curRankBanner.curBannerCom.playStarUpAnimation(u)]:[3,14];case 12:l.sent(),l.label=13;case 13:return u++,[3,11];case 14:return[2]}})})},e.prototype.onLose=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o,s,a,u,h,u,u;return __generator(this,function(l){switch(l.label){case 0:if(e=Player.inst.getResource(ResType.T_SCORE),i=Pvp.PvpMgr.inst.getPvpLevel(e),r=Pvp.PvpMgr.inst.getPvpStarCnt(e),n=e+t,o=Pvp.PvpMgr.inst.getPvpLevel(n),s=Pvp.PvpMgr.inst.getPvpStarCnt(n),this._cantDecStarHintText.visible=!1,console.debug("score "+n+"=>"+e+", level "+o+"=>"+i+", star "+s+"=>"+r),this.initCurRankBanner(n),a=Pvp.Config.inst.getPvpMaxStar(i),!(o>i))return[3,10];u=s,l.label=1;case 1:return u>0?[4,this._curRankBanner.curBannerCom.playStarDownAnimation(u)]:[3,4];case 2:l.sent(),l.label=3;case 3:return u--,[3,1];case 4:return h=t-s,this._newRankBanner.refresh(e),this._newRankBanner.curBannerCom.refresh(i,a),this._newRankBanner.show(),[4,this.playRankdownAnimation()];case 5:l.sent(),u=a,l.label=6;case 6:return u>a-h?[4,this._newRankBanner.curBannerCom.playStarDownAnimation(u)]:[3,9];case 7:l.sent(),l.label=8;case 8:return u--,[3,6];case 9:return[3,14];case 10:u=s,l.label=11;case 11:return u>s-t?[4,this._curRankBanner.curBannerCom.playStarDownAnimation(u)]:[3,14];case 12:l.sent(),l.label=13;case 13:return u--,[3,11];case 14:return[2]}})})},e}(fairygui.GComponent);t.NewBattleLoseCom=e,__reflect(e.prototype,"Battle.NewBattleLoseCom")}(Battle||(Battle={}));var Battle;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._curRankBanner=this.getChild("oldRankBanner").asCom,this._newRankBanner=this.getChild("newRankBanner").asCom,this._goldCom=this.getChild("gold").asCom,this._goldCom.setNoGoldHint(""),this._boxImg=this.getChild("boxImg").asLoader,this._rewardBg=this.getChild("rewardBg").asLoader,this._boxNameText=this.getChild("boxName").asTextField,this._boxHintText=this.getChild("boxHintText").asTextField,this._cantGetBoxText=this.getChild("cantGetBoxText").asTextField,this._levelWin=this.getChild("levelWin").asLoader,this._winTrans=this.getTransition("t0"),this._rankupTrans=this.getTransition("t1")},e.prototype.playWinAnimation=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return SoundMgr.inst.playSoundAsync("win_mp3"),[4,new Promise(function(e){t._winTrans.play(function(){e()})})];case 1:return e.sent(),[2]}})})},e.prototype.playRankupAnimation=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){t._rankupTrans.play(function(){e()})})];case 1:return e.sent(),[2]}})})},e.prototype.setPvpMode=function(){this._boxImg.visible=!0,this._boxHintText.visible=!0,this._cantGetBoxText.visible=!0,this._goldCom.visible=!0,this._rewardBg.visible=!0,this._levelWin.visible=!1,this._curRankBanner.show(),this._newRankBanner.hide()},e.prototype.setLevelMode=function(){this._boxImg.visible=!1,this._boxHintText.visible=!1,this._cantGetBoxText.visible=!1,this._goldCom.visible=!1,this._boxNameText.visible=!1,this._rewardBg.visible=!1,this._levelWin.visible=!0,this._curRankBanner.hide(),this._newRankBanner.hide()},e.prototype.setFriendMode=function(){this._boxImg.visible=!1,this._boxHintText.visible=!1,this._cantGetBoxText.visible=!1,this._goldCom.visible=!1,this._boxNameText.visible=!1,this._rewardBg.visible=!1,this._levelWin.visible=!0,this._curRankBanner.hide(),this._newRankBanner.hide()},e.prototype.initBox=function(t,e){if(""==t)this._boxImg.visible=!1,this._boxNameText.visible=!1,this._boxHintText.visible=!1,this._cantGetBoxText.visible=!0,e==pb.NoTreasureReasonEnum.AmountLimit?this._cantGetBoxText.text=Core.StringUtils.TEXT(60244):e==pb.NoTreasureReasonEnum.NoPos?this._cantGetBoxText.text=Core.StringUtils.TEXT(60234):this._cantGetBoxText.text=Core.StringUtils.TEXT(60234);else{var i=Data.treasure_config.get(t),r=i.rare;this._boxImg.url="treasure_box"+r+"_png",this._boxImg.visible=!0,this._boxNameText.text=i.title,this._boxNameText.visible=!0,this._boxHintText.visible=!0,this._boxHintText.alpha=1,this._cantGetBoxText.visible=!1}},e.prototype.initGold=function(t){t>0?this._goldCom.count=t:this._goldCom.setNoGoldHint(Core.StringUtils.TEXT(60182))},e.prototype.initCurRankBanner=function(t){this._curRankBanner.show(),this._curRankBanner.refresh(t)},e.prototype.onWin=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o,s,a,u,h,u,u;return __generator(this,function(l){switch(l.label){case 0:if(e=Player.inst.getResource(ResType.T_SCORE),i=Pvp.PvpMgr.inst.getPvpLevel(e),r=Pvp.PvpMgr.inst.getPvpStarCnt(e),n=e-t,o=Pvp.PvpMgr.inst.getPvpLevel(n),s=Pvp.PvpMgr.inst.getPvpStarCnt(n),this.initCurRankBanner(n),a=Pvp.Config.inst.getPvpMaxStar(o),!(i>o))return[3,10];u=s+1,l.label=1;case 1:return a>=u?[4,this._curRankBanner.curBannerCom.playStarUpAnimation(u)]:[3,4];case 2:l.sent(),l.label=3;case 3:return u++,[3,1];case 4:return h=t-a+s,this._newRankBanner.refresh(e),this._newRankBanner.curBannerCom.refresh(i,0),this._newRankBanner.show(),[4,this.playRankupAnimation()];case 5:l.sent(),u=1,l.label=6;case 6:return h>=u?[4,this._newRankBanner.curBannerCom.playStarUpAnimation(u)]:[3,9];case 7:l.sent(),l.label=8;case 8:return u++,[3,6];case 9:return[3,14];case 10:u=s+1,l.label=11;case 11:return r>=u?[4,this._curRankBanner.curBannerCom.playStarUpAnimation(u)]:[3,14];case 12:l.sent(),l.label=13;case 13:return u++,[3,11];case 14:return[2]}})})},e}(fairygui.GComponent);t.NewBattleWinCom=e,__reflect(e.prototype,"Battle.NewBattleWinCom")}(Battle||(Battle={}));var Battle;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this
}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.adjust(this.getChild("background")),this._pvpExpProgressBar=this.getChild("pvpExpProgressBar"),this._pvpLevelTxt=this.getChild("pvpLevelTxt").asTextField;var e=this.getChild("rewardTitle");e&&(this._rewardTitle=e.asTextField)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return i=e[0].WinUid==Player.inst.uid,this._resultCtrl.selectedPage=i?"win":"lose",i?(this._rewardTitle&&(this._rewardTitle.visible=!1),this.setRewardResBar(e[0].Res)):this._rewardTitle&&(this._rewardTitle.visible=!1),this._showing=t.prototype.open.call(this,i),this._setPvpScore(e[0].Res),[4,this._showing];case 1:return r.sent(),this._showing=null,Pvp.PvpMgr.inst.onEnterPvp(),[2]}})})},e.prototype._setPvpScore=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o,s,a,u,h;return __generator(this,function(l){switch(l.label){case 0:for(e=0,i=0,r=t;i<r.length;i++)if(n=r[i],n.Type==ResType.T_SCORE){e=n.Amount;break}return o=Player.inst.getResource(ResType.T_SCORE),o=0>o?0:o,s=o-e,s=0>s?0:s,a=Pvp.PvpMgr.inst.getPvpLevel(),u=Pvp.PvpMgr.inst.getPvpLevelByScore(s),this._pvpLevelTxt.text="Lv"+u+": ",h=Pvp.PvpMgr.inst.getNextPvpLevelScore(),this._pvpExpProgressBar.setProgress(s,h),this._showing?[4,this._showing]:[3,2];case 1:l.sent(),l.label=2;case 2:return[4,fairygui.GTimers.inst.waitTime(500)];case 3:return l.sent(),[4,this._pvpExpProgressBar.doProgressAnimation(s,o,h)];case 4:return l.sent(),this._pvpLevelTxt.text="Lv"+a+": ",[2]}})})},e}(t.BaseBattleEnd);t.PvpBattleEnd=e,__reflect(e.prototype,"Battle.PvpBattleEnd")}(Battle||(Battle={}));var Battle;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.adjust(this.getChild("bg")),this._trans=this.getTransition("t0"),this._selfName=this.getChild("selfName").asTextField,this._enemyName=this.getChild("enemyName").asTextField,this._selfName.textParser=Core.StringUtils.parseColorText,this._enemyName.textParser=Core.StringUtils.parseColorText,this._selfCountry=this.getChild("selfCountry").asLoader,this._selfCountryBg=this.getChild("selfCountryBg").asLoader,this._enemyCountry=this.getChild("enemyCountry").asLoader,this._enemyCountryBg=this.getChild("enemyCountryBg").asLoader,this._selfRankIcon=this.getChild("selfRankIcon"),this._enemyRankIcon=this.getChild("enemyRankIcon"),this._selfHead=this.getChild("selfHead"),this._enemyHead=this.getChild("enemyHead")},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a=this;return __generator(this,function(u){switch(u.label){case 0:return e.prototype.open.apply(this,i),r=i[0],n=r.getOwnFighter(),o=r.getEnemyFighter(),this._selfName.text=n.name,this._enemyName.text=o.name,this._selfCountry.url=this._campToResUrl(n.camp),this._enemyCountry.url=this._campToResUrl(o.camp),this._selfCountryBg.url=this._campToBgResUrl(n.camp),this._enemyCountryBg.url=this._campToBgResUrl(o.camp),s=r.battleType,s==t.BattleType.LEVEL||s==t.BattleType.LevelHelp?(this._selfHead.visible=!1,this._enemyHead.visible=!1):(this._selfHead.setAll(n.headIcon,n.frameIcon),this._enemyHead.setAll(o.headIcon,o.frameIcon)),this._selfRankIcon.refresh(n.pvpScore),this._enemyRankIcon.refresh(o.pvpScore),[4,new Promise(function(t){a._trans.play(function(){t()},a)})];case 1:return u.sent(),[2]}})})},i.prototype._campToResUrl=function(t){return t==Camp.WEI?"battle_txtWei_png":t==Camp.SHU?"battle_txtShu_png":"battle_txtWu_png"},i.prototype._campToBgResUrl=function(t){return t==Camp.WEI?"battle_nameWei_png":t==Camp.SHU?"battle_nameShu_png":"battle_nameWu_png"},i}(Core.BaseView);t.PvpVsView=e,__reflect(e.prototype,"Battle.PvpVsView")}(Battle||(Battle={}));var Battle;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._card=this.getChild("card"),this._levelText=this.getChild("levelText").asTextField,this._skillDescTxt=this.getChild("skillDescTxt").asTextField,this._bgMask=this.getChild("bgMask").asGraph,this._preLevelBtn=this.getChild("preLevelBtn").asButton,this._nextLevelBtn=this.getChild("nextLevelBtn").asButton,this._newCardLight=this.getChild("newCardLight").asLoader,this._text1=this.getChild("text1").asTextField,this._img1=this.getChild("img1").asLoader,this._img2=this.getChild("img2").asLoader,this._tips=this.getChild("tips").asTextField,this._tips.textParser=Core.StringUtils.parseColorText,this._tips.text=this._tips.text,this._descGroup=[this._levelText,this._skillDescTxt,this._bgMask,this._preLevelBtn,this._nextLevelBtn,this._newCardLight,this._text1,this._img1,this._img2,this._tips],this._visibleDescChild(!1),this._preLevelBtn.addClickListener(this._onPreLevel,this),this._nextLevelBtn.addClickListener(this._onNextLevel,this),Core.LayerManager.inst.topLayer.addChild(this)},e.prototype.setUplevelCtrl=function(){this.getController("type").selectedPage="uplevel",this.adjust(this.getChild("bg"),Core.AdjustType.NO_BORDER)},e.prototype._visibleDescChild=function(t){if(this._descGroup.forEach(function(e){e.visible=t}),t){this._descGroup.forEach(function(t){t.alpha=0,egret.Tween.removeTweens(t)});var e=this;fairygui.GTimers.inst.add(33,15,function(){e._descGroup.forEach(function(t){t.alpha>=1||(t.alpha+=1/15)})},this)}},e.prototype._isDescChildVisible=function(){for(var t=0,e=this._descGroup;t<e.length;t++){var i=e[t];if(!i.visible)return!1}return!0},e.prototype._onPreLevel=function(){this._changeCurLevel(this._curCardViewLevel-1)},e.prototype._updateLevelText=function(t){this._levelText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60069),Core.StringUtils.getZhNumber(t.level)),this._skillDescTxt.text=t.skillDesc,this._curCardViewLevel=t.level},e.prototype._updateCardInfo=function(t){this._card.cardObj=t,this._card.setCardImg(),this._card.setEquip(),this._card.setName(),this._card.setSkill(),this._card.setNumText(),this._card.setNumOffsetText()},e.prototype._changeCurLevel=function(t){var e=this._card.cardObj.getLevelObj(t);e&&(this._updateCardInfo(e),this._updateLevelText(e))},e.prototype._onNextLevel=function(){this._changeCurLevel(this._curCardViewLevel+1)},e.prototype.show=function(t){return __awaiter(this,void 0,void 0,function(){var e,i=this;return __generator(this,function(r){switch(r.label){case 0:return e="uplevel"==this.getController("type").selectedPage?"uplevel_mp3":"newcard_mp3",SoundMgr.inst.playSoundAsync(e),egret.Tween.removeTweens(this._card),this._updateCardInfo(t),this._updateLevelText(t),this._isDescChildVisible()||this._visibleDescChild(!0),[4,new Promise(function(t){i._card.scaleX=0,i._card.scaleY=0;var e=i,r=function(){e._bgMask.removeClickListener(r,e),fairygui.GTimers.inst.callDelay(200,function(){t()},this)};i._bgMask.addClickListener(r,i),egret.Tween.get(i._card).to({scaleX:1,scaleY:1},1500,egret.Ease.elasticOut)})];case 1:return r.sent(),[2]}})})},e.prototype.hide=function(){this.removeFromParent()},e}(Core.BaseView);t.RewardNewCard=e,__reflect(e.prototype,"Battle.RewardNewCard")}(Battle||(Battle={}));var Battle;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._setBonusName=function(t){this.getChild(this.getController("result").selectedPage+"BonusName").asTextField.text=t},e.prototype._getAmountTxt=function(t){var e=this.getChild(this.getController("result").selectedPage+"Res"+t+"AmountTxt");return e?e.asTextField:null},e.prototype._getResImg=function(t){var e=this.getChild(this.getController("result").selectedPage+"Res"+t+"Img");return e?e.asImage:null},e.prototype.show=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a,n;return __generator(this,function(u){switch(u.label){case 0:for(i=0,r=e;i<r.length;i++)if(n=r[i],n.Amount<0){this.getController("result").setSelectedPage("lose");break}for(this._setBonusName(t),o=0;o<e.length&&(s=this._getAmountTxt(o+1),a=this._getResImg(o+1),s&&a);o++)s.visible=!0,a.visible=!0,n=e[o],s.text=n.Amount>0?"+"+n.Amount:n.Amount.toString(),a.texture=Utils.resType2Texture(n.Type);return[4,Core.EffectUtil.showLeftToRight(this)];case 1:return u.sent(),[2]}})})},e}(fairygui.GComponent);t.BonusTips=e,__reflect(e.prototype,"Battle.BonusTips");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.show=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o=this;return __generator(this,function(s){switch(s.label){case 0:return i=this.getController("state"),e?(i.setSelectedPage("normal"),r=this.getTransition("show"),n=this.getChild("title").asTextField,t>0?(n.color=Core.TextColors.green,n.text="+"+t):(n.color=Core.TextColors.red,n.text=""+t)):(i.setSelectedPage("forbid"),r=this.getTransition("show2")),r.playing?[2]:[4,new Promise(function(t){r.play(function(){t()},o)})];case 1:return s.sent(),[2]}})})},e}(fairygui.GComponent);t.GoldGobTips=i,__reflect(i.prototype,"Battle.GoldGobTips")}(Battle||(Battle={}));var Battle;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this._cardList=this.getChild("cardList").asList,this._cardList.itemClass=t.RewardCardItem},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return i=t[0].IsWin,this._resultCtrl.selectedPage=i?"win":"lose",[4,e.prototype.open.call(this,i)];case 1:return r.sent(),this.cardListDoAnimation(this._cardList,t[0].ChangeCards),[2]}})})},i}(t.BaseBattleEnd);t.VideoBattleEnd=e,__reflect(e.prototype,"Battle.VideoBattleEnd")}(Battle||(Battle={}));var Battle;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.center(),this._playBtn=this.getChild("viewBtn").asButton,this._likeBtn=this.getChild("likeBtn").asButton,this._discussBtn=this.getChild("discussBtn").asButton,this.shareWechatBtn=this.getChild("shareWechatBtn").asButton,this._likeBtnmsk=this._likeBtn.getChild("icon2"),this._likeBtnmsk.visible=!1,this._playBtn.addClickListener(this._onPlay,this),this._playBtn.visible=!1,this._likeBtn.addClickListener(this._onLikeVideo,this),this._discussBtn.addClickListener(this._onDiscuss,this),this.shareWechatBtn.addClickListener(this._onShareWX,this)},i.prototype._onPlay=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t.VideoPlayer.inst.playBattle(),this._playBtn.visible=!1,this.getChild("title").visible=!1,this.getChild("top").visible=!1,[2]})})},i.prototype.updatedisNum=function(){this._discussBtn.title=this._video.commentsAmount.toString(),this._videoItem&&this._videoItem.updatedisNum()},i.prototype._setView=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._video=Pvp.VideoCenter.inst.curVideo,this._videoItem=Pvp.VideoCenter.inst.curVideoCom,console.log("video function set view"),this._likeBtn.visible=this._video.isShare,this._discussBtn.visible=this._video.isShare,this.shareWechatBtn.visible=!1,this.getChild("functionBg").visible=this._video.isShare,this._video.isShare&&(this._likeBtn.text=this._video.likeTimes.toString(),this._discussBtn.text=this._video.commentsAmount.toString(),this.getChild("title").text=this._video.title,this._video.isLike?this._likeBtn.getController("isLike").selectedIndex=1:this._likeBtn.getController("isLike").selectedIndex=0,Core.DeviceUtils.isWXGame()&&(this.shareWechatBtn.visible=!0)),[2]})})},i.prototype._onDiscuss=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(r){switch(r.label){case 0:return t={VideoID:this._video.id,CurAmount:0},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_VIDEO_COMMENTS,pb.FetchVideoCommentsArg.encode(t))];case 1:return e=r.sent(),0==e.errcode&&(i=pb.FetchVideoCommentsReply.decode(e.payload),Core.ViewManager.inst.open(ViewName.videoDiscuss,i)),[2]}})})},i.prototype._onLikeVideo=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(r){switch(r.label){case 0:return this._video.isLike?[2]:(t={VideoID:this._video.id},[4,Net.rpcCall(pb.MessageID.C2S_LIKE_VIDEO,pb.LikeVideoArg.encode(t))]);case 1:return e=r.sent(),0==e.errcode&&(i=pb.LikeVideoResp.decode(e.payload),this._video.watchTimes=i.CurWatchTimes,this._video.likeTimes=i.CurLike,this._video.isLike=!0,Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60110)),this._likeBtn.text=this._video.likeTimes.toString(),this._likeBtn.getController("isLike").selectedIndex=1,this._likeBtnmsk.visible=!0,this._likeBtn.getTransition("t0").play(),this._videoItem&&this._videoItem.updateView()),[2]}})})},i.prototype._onShareWX=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._video&&Core.DeviceUtils.isWXGame()&&WXGame.WXShareMgr.inst.wechatShareBattleVideo(this._video.id),[2]})})},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,n=this;return __generator(this,function(o){return e.prototype.open.apply(this,t),this._setView(),this._video?this.visible=!0:this.visible=!1,i=t[0],this.toTopLayer(),r=new egret.Timer(1e3,1),r.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){n.getChild("title").visible=!1,n.getChild("top").visible=!1},this),r.start(),[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseView);t.VideoFunctionView=e,__reflect(e.prototype,"Battle.VideoFunctionView")}(Battle||(Battle={}));var Battle;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.add=function(t,e){var i=t,r=this.getValue(i);r&&r.stop(),this.setValue(i,e)},e.prototype.removeOne=function(t,e){var i=t;this.remove(i)},e.prototype.getOne=function(t){var e=t;return this.getValue(e)},e.prototype.forEach=function(e){t.prototype.forEach.call(this,function(t,i){return e(i),!0})},e.prototype.getByID=function(t){var e=this.getOne(t);return e?[e]:[]},e.prototype.removeByID=function(t){this.removeOne(t,null)},e}(Collection.Dictionary);__reflect(e.prototype,"TextEffectContainer",["IEffectContainer"]);var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.add=function(t,e){this.setValue(t,e)},e.prototype.removeOne=function(t,e){this.remove(t,e)},e.prototype.getOne=function(t){var e=this.getValue(t);return e&&e.length>0?e[0]:null},e.prototype.forEach=function(e){var i=this;t.prototype.keys.call(this).forEach(function(r){var n=t.prototype.getValue.call(i,r);n&&n.forEach(function(t){e(t)})})},e.prototype.getByID=function(t){return this.getValue(t)},e.prototype.removeByID=function(e){t.prototype.remove.call(this,e)},e}(Collection.MultiDictionary);__reflect(i.prototype,"McEffectContainer",["IEffectContainer"]);var r=function(){function r(t){this.playingMovieEffect=new i,this.playingTextEffect=new e,this.parent=t,this.removeEffectFunc=r.defRemoveEffect}return r.prototype.clearEffect=function(){this.playingMovieEffect.forEach(function(t){t.stop()}),this.playingMovieEffect.clear(),this.playingTextEffect.forEach(function(t){t.stop()}),this.playingTextEffect.clear()},r.defRemoveEffect=function(t,e){var i=t.getOne(e);null!=i&&(i.stop(),t.removeOne(e,i))},r.removeAllEffectByID=function(t,e){for(var i=t.getByID(e),r=0,n=i;r<n.length;r++){var o=n[r];o.stop()}t.removeByID(e)},r.prototype.playEffect=function(e,i,r,n,o){void 0===r&&(r=!0),void 0===n&&(n=0),void 0===o&&(o=0);var s,a=null;if(s=this.playingMovieEffect,"number"==typeof e&&(s=this.playingTextEffect),0!=i)if("string"==typeof e)a=new t.MCEffect(e);else{if("number"!=typeof e)return null;a=new t.TextEffect(e,n,o)}if(i>0)return a.play(this.parent,!1,!1,r);if(0>i){var u=void 0;return-1==i?a.play(this.parent,!0,!1,r):-2==i&&(u=a.play(this.parent,!1,!0,r)),s.add(e,a),u}return 0==i&&("-1"===e||-1==e?(s.forEach(function(t){t.stop()}),s.clear()):this.removeEffectFunc(s,e)),null},r.prototype.switchParent=function(t){this.parent=t,this.playingMovieEffect.forEach(function(e){e.resize(t)}),this.playingTextEffect.forEach(function(e){e.resize(t)})},r.prototype.setVisible=function(t){this.playingMovieEffect.forEach(function(e){e.setVisible(t)})},r}();t.EffectPlayer=r,__reflect(r.prototype,"Battle.EffectPlayer")}(Battle||(Battle={}));var Battle;!function(t){var e=function(){function t(t){this.isStop=!1,this._movieId=t;var e=t.split("_");e.length>=2&&parseInt(e[1])>0?this._realMovieId=e[0]:this._realMovieId=t,this._mc=Core.MCFactory.inst.getMovieClip(this._realMovieId,this._realMovieId)}return t.prototype.play=function(t,e,i,r){var n=this;if(null==this._mc)return null;if(this._mc.visible=r,this.isStop)return null;if(e)return t.addChild(this._mc),this._mc.x=t.width/2,this._mc.y=t.height/2,this._mc.gotoAndPlay(1,-1),r&&SoundMgr.inst.playSoundAsync(this._realMovieId+"_mp3"),null;var o=t.localToRoot(t.width/2,t.height/2);this._mc.x=o.x,this._mc.y=o.y,fairygui.GRoot.inst.addChild(this._mc);var s=new Promise(function(e){if(i){var o=n,s=function(){return null==o._mc?void e():(null!=o._mc.parent&&o._mc.parent.removeChild(o._mc),o._mc.scaleX=t.width/125,o._mc.scaleY=t.height/162,o._mc.x=t.width/2,o._mc.y=t.height/2,o._mc.gotoAndStop(o._mc.totalFrames),t.addChild(this._mc),void e())};n._mc.totalFrames<=1?(n._mc.gotoAndPlay(1,1),s.apply(n,null)):(n._mc.once(egret.MovieClipEvent.COMPLETE,s,n),n._mc.gotoAndPlay(1,1))}else n._mc.once(egret.MovieClipEvent.COMPLETE,function(){null!=n._mc&&(n._mc.scaleX=1,n._mc.scaleY=1,Core.MCFactory.inst.revertMovieClip(n._mc),n._mc=null,e())},n),n._mc.gotoAndPlay(1,1);r&&SoundMgr.inst.playSoundAsync(n._realMovieId+"_mp3")});return r?s:null},t.prototype.resize=function(t){null!=this._mc&&(this._mc.removeFromParent(),t.addChild(this._mc),this._mc.scaleX=1,this._mc.scaleY=1,null!=this._mc.parent&&(this._mc.x=this._mc.parent.width/2,this._mc.y=this._mc.parent.height/2))},t.prototype.stop=function(){this.isStop=!0,null!=this._mc&&(this._mc.stop(),this._mc.scaleX=1,this._mc.scaleY=1,Core.MCFactory.inst.revertMovieClip(this._mc),this._mc=null)},t.prototype.setVisible=function(t){this._mc&&(this._mc.visible=t)},t}();t.MCEffect=e,__reflect(e.prototype,"Battle.MCEffect",["Battle.IEffect"])}(Battle||(Battle={}));var Battle;!function(t){var e=function(){function t(t,e,i){this._isStop=!1;var r=Core.StringUtils.TEXT(t);null==r&&(r=""),r=r.replace("x",""+e),r=r.replace("v",""+Math.abs(i)),this._textField=new fairygui.GTextField,this._textField.textParser=Core.StringUtils.parseColorText,this._textField.text=r,this._textField.fontSize=30,this._textField.strokeColor=0,this._textField.stroke=3,this._textField.bold=!0,this._textField.align=fairygui.AlignType.Center,this._textField.verticalAlign=fairygui.VertAlignType.Middle,this._textField.color=Core.TextColors.white,window.gameGlobal.isMultiLan||(this._textField.font="AaKaiTi")}return t.prototype.play=function(t,e,i,r){var n=this;if(this._isStop)return null;LanguageMgr.inst.isChineseLocale()||(this._textField.autoSize=fairygui.AutoSizeType.Shrink,this._textField.setSize(t.width,t.height)),this._textField.fontSize=32,this._textField.fontSize*=t.width/125,t.visible?(this._textField.y=t.height/2,this._textField.x=t.width/2):(this._textField.y=t.y+t.height/2,this._textField.x=t.x+t.width/2,t=t.parent),this._textField.visible=r,t.addChild(this._textField);var o=Core.EffectUtil.showFromCenter(this._textField,300,133,500);if(e)o.then(function(){n._textField.removeFromParent(),egret.callLater(n.play,n,t,e,i,r)});else{var s=new Promise(function(t){o.then(function(){n._textField.removeFromParent(),t()})});if(r)return s}return null},t.prototype.resize=function(t){null!=this._textField&&(this._textField.removeFromParent(),t.addChild(this._textField))},t.prototype.stop=function(){this._isStop=!0},t.prototype.setVisible=function(t){},t}();t.TextEffect=e,__reflect(e.prototype,"Battle.TextEffect",["Battle.IEffect"])}(Battle||(Battle={}));var CardPool;!function(t){var e;!function(t){t[t.Reborn=0]="Reborn",t[t.War=1]="War"}(e=t.BuyType||(t.BuyType={}));var i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.initUI=function(){i.prototype.initUI.call(this),this._buyBtn=this.contentPane.getChild("btnBuy").asButton,this._card.addClickListener(this._onCard,this),this._buyBtn.addClickListener(this._onBuyBtn,this)},r.prototype._updateBuyBtn=function(){if(t.CardPoolMgr.inst.getCollectCard(this._cardObj.cardId).amount>0?this._buyBtn.visible=!1:this._buyBtn.visible=!0,this._buyType==e.Reborn){this._buyBtn.getChild("n11").asLoader.url="common_honorIcon_png";var i=Data.sold_general.get(Reborn.RebornMgr.inst.cardKey).honorPrice;this._buyBtn.title=i.toString(),Player.inst.hasEnoughFeat(i)?this._buyBtn.getChild("title").asTextField.color=16777215:this._buyBtn.getChild("title").asTextField.color=16711680}else this._buyType==e.War&&(this._buyBtn.getChild("n11").asLoader.url="war_fightIcon_png",this._buyBtn.title=this._buyData.fightPrice.toString(),War.MyWarPlayer.inst.contribution>=this._buyData.fightPrice?this._buyBtn.getChild("title").asTextField.color=16777215:this._buyBtn.getChild("title").asTextField.color=16711680)},r.prototype._onBuyBtn=function(){Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70369),this._cardObj.name),this._onBuy,null,this)},r.prototype._onBuy=function(){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(r){if(this._buyType==e.Reborn)Reborn.RebornMgr.inst.onBuyCard();else if(this._buyType==e.War){if(War.MyWarPlayer.inst.contribution<this._buyData.fightPrice)return Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70370)),[2];t=War.WarMgr.inst.buyGoods(this._buyData.type,this._buyData.__id__),t&&(i=new Pvp.GetRewardData,i.addCards(this._cardObj.cardId,1),Core.ViewManager.inst.open(ViewName.getRewardWnd,i),Core.ViewManager.inst.closeView(this))}return[2]})})},r.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return i.prototype.open.apply(this,t),this._buyType=t[2],this._buyData=t[3],this._updateBuyBtn(),[2]})})},r.prototype._onCard=function(){Core.ViewManager.inst.open(ViewName.bigCard,this._cardObj);var t=this._cardObj.sound;t&&t.length>0&&SoundMgr.inst.playSoundAsync(t+"_mp3")},r.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return i.prototype.close.apply(this,t),[2]})})},r}(t.CardInfoWnd);t.BuyCardInfoWnd=i,__reflect(i.prototype,"CardPool.BuyCardInfoWnd")}(CardPool||(CardPool={}));var Collection;!function(t){var e=function(){function e(e){this.dictionary=new t.Dictionary(e)}return e.prototype.contains=function(t){return this.dictionary.containsKey(t)},e.prototype.add=function(e){return this.contains(e)||t.isUndefined(e)?!1:(this.dictionary.setValue(e,e),!0)},e.prototype.intersection=function(t){var e=this;this.forEach(function(i){return t.contains(i)||e.remove(i),!0})},e.prototype.union=function(t){var e=this;t.forEach(function(t){return e.add(t),!0})},e.prototype.difference=function(t){var e=this;t.forEach(function(t){return e.remove(t),!0})},e.prototype.isSubsetOf=function(t){if(this.size()>t.size())return!1;var e=!0;return this.forEach(function(i){return t.contains(i)?!0:(e=!1,!1)}),e},e.prototype.remove=function(t){return this.contains(t)?(this.dictionary.remove(t),!0):!1},e.prototype.forEach=function(t){this.dictionary.forEach(function(e,i){return t(i)})},e.prototype.toArray=function(){return this.dictionary.values()},e.prototype.isEmpty=function(){return this.dictionary.isEmpty()},e.prototype.size=function(){return this.dictionary.size()},e.prototype.clear=function(){this.dictionary.clear()},e.prototype.toString=function(){return t.toString(this.toArray())},e}();t.Set=e,__reflect(e.prototype,"Collection.Set")}(Collection||(Collection={}));var CardPool;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._levelUpHint=this.getChild("levelUpHint").asLoader,this._levelUpHint2=this.getChild("levelUpHint2").asLoader,this._levelUpTrans=this.getTransition("t0"),this._newHint=this.getChild("newHint").asLoader,this._newHint.visible=!1,this._levelUpHint.visible=!1,this._levelUpHint2.visible=!1,this._needObserveLevelup=!1,this._needObserveNew=!1},i.prototype.watchIsNew=function(){var e=this;this._needObserveNew=!0,this._card.watchProp(t.Card.PropIsNew,function(){e._refresh()},this),this._updateNewHint()},i.prototype._updateNewHint=function(){this._newHint.visible=this._needObserveNew&&this.cardObj.isNew},i.prototype.update=function(){this._refresh()},i.prototype._refresh=function(){if(this.displayObject.cacheAsBitmap=!1,this._campignUnlockText.visible=!1,this._card.setWhile(),this._card.setName(),this._cardObj.state==t.CardState.Lock){this._card.showEquipBtn(!1),this._card.setNumText(!1),this._card.setNumOffsetText(!1);var i=this._cardObj.cardId,r=Pvp.PvpMgr.inst.getPvpLevel();r=Math.max(r,2);var n=Pvp.Config.inst.getCardUnlockLevel(i);if(n&&r>=n)this._cardObj.state=t.CardState.Unlock,this._initUnlockSkin(),this._card.setQualityMode(!0);else if(Level.LevelMgr.inst.getCardIdUnlockLevelId(i)>0){var o=Level.LevelMgr.inst.getCardIdUnlockLevelId(i),s=Level.LevelMgr.inst.curLevel;if(s>o)this._cardObj.state=t.CardState.Unlock,this._initUnlockSkin(),this._card.setQualityMode(!0),Core.EventCenter.inst.removeEventListener(GameEvent.ClearLevelEv,this._onCampignLevelChange,this);else{this._initLockSkin(),this._campignUnlockText.visible=!0;var a=Level.LevelMgr.inst.getLevel(o).chapter;this._campignUnlockText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60161),Core.StringUtils.getZhNumber(a)),Core.EventCenter.inst.addEventListener(GameEvent.ClearLevelEv,this._onCampignLevelChange,this)}}else this._initLockSkin()}else this._card.setNumText(),this._card.setNumOffsetText(),this._cardObj.state==t.CardState.Alive?this._initAliveSkin():this._cardObj.state==t.CardState.Dead?this._initDeadSkin():this._cardObj.state==t.CardState.Unlock&&this._initUnlockSkin(),this._card.setQualityMode(!0);this._card.cardObj.rare==CardQuality.LIMITED?this.visibleExpProgress(!1):this.cardObj.collectCard.level>1||this._card.cardObj.amount>0?this.visibleExpProgress(!0):this.visibleExpProgress(!1),this._checkLevelUpHint(),this._updateNewHint(),e.prototype._onPropAmountChange.call(this),this.displayObject.cacheAsBitmap=!0},i.prototype.setData=function(e,i){void 0===i&&(i=!1),this.cardObj=e,this._needObserveLevelup=i,this._refresh(),this._card.setDeskBackground(),this._clearWatchers(),this.watchLevel(),this.watchSkin(),this.watchEquip(),this.watchAmount(),this.watchEnergy(),this._card.watchProp(t.Card.PropState,this._onPropStateChange,this),Core.EventCenter.inst.addEventListener(Core.Event.CloseViewEvt,this._onViewClose,this)},i.prototype._clearWatchers=function(){this.unwatchLevel(),this.unwatchSkin(),this.unwatchEquip(),this.unwatchAmount(),this.unwatchEnergy(),this._card.unwatchProp(t.Card.PropState)},i.prototype._onViewClose=function(t){var e=t.data;e==ViewName.cardpool&&(this._clearWatchers(),Core.EventCenter.inst.removeEventListener(Core.Event.CloseViewEvt,this._onViewClose,this))},i.prototype._onPropAmountChange=function(){this.displayObject.cacheAsBitmap=!1,e.prototype._onPropAmountChange.call(this),this._checkLevelUpHint(),this.displayObject.cacheAsBitmap=!0},i.prototype._checkLevelUpHint=function(){return this._needObserveLevelup?this._cardObj.rare==CardQuality.LIMITED?(this._levelUpHint.visible=!1,void(this._levelUpHint2.visible=!1)):void(this._cardObj.amount>=this._cardObj.maxAmount&&this._cardObj.maxAmount>0?(this.addChild(this._levelUpHint2),this.addChild(this._levelUpHint),this.addChild(this._progressText),this._levelUpHint.visible=!0,this._levelUpHint2.visible=!0,this._levelUpTrans.play(null,null,null,-1)):(this._levelUpHint.visible=!1,this._levelUpHint2.visible=!1,this._levelUpTrans.playing&&this._levelUpTrans.stop())):void 0},i.prototype._onPropEnergyChange=function(){this.displayObject.cacheAsBitmap=!1,e.prototype._onPropEnergyChange.call(this),this.displayObject.cacheAsBitmap=!0},i.prototype._onPropLevelChange=function(){this.displayObject.cacheAsBitmap=!1,this._card.setName(),this._card.setSkill(),this.displayObject.cacheAsBitmap=!0},i.prototype._onPropStateChange=function(){this._refresh()},i.prototype._initLockSkin=function(){this.touchable=!1,this._expProgressBar.visible=!1,this._progressText.visible=!1,this._card.setOwnLockFront(),this._card.setLockNameAndSkill(!0),this._card.setLockCardImg()},i.prototype._initAliveSkin=function(){this._card.setCardImg(),this._card.setEquip(),this._card.setOwnFront(),this._card.setSkill(),this.touchable=!0,this._expProgressBar.visible=!0,this._progressText.visible=!0,this.setProgress()},i.prototype._initDeadSkin=function(){this._expProgressBar.visible=!1,this._progressText.visible=!1,this._card.setCardImg(),this._card.setEquip(),this._card.setGrey(),this._card.setSkill()},i.prototype._initUnlockSkin=function(){this.touchable=!0,this._expProgressBar.visible=!1,this._progressText.visible=!1,this._card.setCardImg(),this._card.setEquip(),this._card.setGrey(),this._card.setName()},i.prototype._onCampignLevelChange=function(){this._refresh()},i.prototype.setRankRewardMode=function(){this._expProgressBar.visible=!1,this._progressText.visible=!1},i.prototype.setRankSeasonMode=function(){this._card.setQualityMode(!1),this._card.setLockNameAndSkill(!1),this._card.setName(),this._card.setNumText(!0),this._card.setNumOffsetText(),this._card.setSkill(),this._card.setOwnBackground(),this._card.setOwnFront(),this._onPropAmountChange()},i}(UI.BaseCardItem);t.CardItem=e,__reflect(e.prototype,"CardPool.CardItem")}(CardPool||(CardPool={}));var CardPool;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._numText=this.getChild("textNum").asTextField,this._observeCamp=0},i.prototype.observeCampCardNum=function(t){void 0===t&&(t=0),this._observeCamp=t,this._updateHintNum(),Core.EventCenter.inst.addEventListener(Core.Event.CardHintNumChangeEv,this._onCardHintNumChange,this)},i.prototype._onCardHintNumChange=function(t){var e=t.data;this._observeCamp&&e!=this._observeCamp||this._updateHintNum()},i.prototype._updateHintNum=function(){var e=t.CardPoolMgr.inst.getCampCardHintNum(this._observeCamp);0>=e?this.visible=!1:e>99?(this.visible=!0,this._numText.text="99+"):(this.visible=!0,this._numText.text=""+e)},i}(fairygui.GComponent);t.CardNumHintCom=e,__reflect(e.prototype,"CardPool.CardNumHintCom");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._numText=this.getChild("textNum").asTextField},i.prototype.observerAvatarNum=function(){this._updateHintNum(),Core.EventCenter.inst.addEventListener(Core.Event.AvatarHintNumChangeEv,this._updateHintNum,this)},i.prototype._updateHintNum=function(){var e=t.CardPoolMgr.inst.avatarHintNum;
0>=e?this.visible=!1:e>99?(this.visible=!0,this._numText.text="99+"):(this.visible=!0,this._numText.text=""+e)},i}(fairygui.GComponent);t.AvatarNumHintCom=i,__reflect(i.prototype,"CardPool.AvatarNumHintCom")}(CardPool||(CardPool={}));var CardPool;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var i=this;e.prototype.initUI.call(this),this.height+=Utils.getResolutionDistance(),this._weiPool=this.getChild("wei").asCom.getChild("cardList").asList,this._shuPool=this.getChild("shu").asCom.getChild("cardList").asList,this._wuPool=this.getChild("wu").asCom.getChild("cardList").asList,this._weiPool.height+=Utils.getResolutionDistance(),this._shuPool.height+=Utils.getResolutionDistance(),this._wuPool.height+=Utils.getResolutionDistance();var r=this.getChild("qun").asCom;this._qunPool=r.getChild("cardList").asList,r.getChild("qunTips").visible=!0,this._campTapCtrl=this.getController("campTap"),this._listx=this.getChild("wei").asCom.x,this._listy=this.getChild("wei").asCom.y,this._weiPool.scrollItemToViewOnClick=!0,this._shuPool.scrollItemToViewOnClick=!0,this._wuPool.scrollItemToViewOnClick=!0,this._qunPool.scrollItemToViewOnClick=!0,this._weiPool.itemClass=t.CardItem,this._weiPool.itemRenderer=this._weiRenderList,this._weiPool.callbackThisObj=this,this._shuPool.itemClass=t.CardItem,this._shuPool.itemRenderer=this._shuRenderList,this._shuPool.callbackThisObj=this,this._wuPool.itemClass=t.CardItem,this._wuPool.itemRenderer=this._wuRenderList,this._wuPool.callbackThisObj=this,this._qunPool.itemClass=t.CardItem,this._qunPool.itemRenderer=this._qunRenderList,this._qunPool.callbackThisObj=this,this._weiTapBtn=this.getChild("weiTapBtn").asButton,this._weiTapBtn.getChild("cardNumHint").asCom.observeCampCardNum(Camp.WEI),this._shuTapBtn=this.getChild("shuTapBtn").asButton,this._shuTapBtn.getChild("cardNumHint").asCom.observeCampCardNum(Camp.SHU),this._wuTapBtn=this.getChild("wuTapBtn").asButton,this._wuTapBtn.getChild("cardNumHint").asCom.observeCampCardNum(Camp.WU),this._qunTapBtn=this.getChild("qunTapBtn").asButton,this._qunTapBtn.getChild("cardNumHint").asCom.observeCampCardNum(Camp.HEROS),this._skillFaqBtn=this.getChild("faqBtn").asButton,this._skillFaqBtn.addClickListener(function(){Core.ViewManager.inst.open(ViewName.skillFaq)},this),this._skillFaqBtn.visible=Home.FunctionMgr.inst.isSkillInstructionOpen(),this._equipBagBtn=this.getChild("equipBtn").asButton,this._equipBagBtn.addClickListener(function(){Equip.EquipMgr.inst.openEquipBagWnd()},this),this._equipBagBtn.visible=Home.FunctionMgr.inst.isEquipOpen(),this._weiPool.addEventListener(fairygui.ItemEvent.CLICK,this._onClickCardItem,this),this._shuPool.addEventListener(fairygui.ItemEvent.CLICK,this._onClickCardItem,this),this._wuPool.addEventListener(fairygui.ItemEvent.CLICK,this._onClickCardItem,this),this._qunPool.addEventListener(fairygui.ItemEvent.CLICK,this._onClickCardItem,this),this._weiTapBtn.addClickListener(this._onSelectWeiCampTap,this),this._shuTapBtn.addClickListener(this._onSelectShuCampTap,this),this._wuTapBtn.addClickListener(this._onSelectWuCampTap,this),this._qunTapBtn.addClickListener(this._onSelectQunCampTap,this),this._campTapCtrl.addAction(SoundMgr.inst.playSoundAction("page_mp3",!0)),Player.inst.addEventListener(Player.ResUpdateEvt,this._onPlayerResUpdate,this),this._pvpLevel=Pvp.PvpMgr.inst.getPvpLevel(),this._cardItems=[],Core.EventCenter.inst.addEventListener(GameEvent.AddLimitedCardEv,function(e){var r=e.data,n=i._getCardListByCamp(r);n&&(n.numItems=0,n.numItems=t.CardPoolMgr.inst.getCollectCardsByCamp(r,!1).length)},this)},i.prototype._onPlayerResUpdate=function(){var t=Pvp.PvpMgr.inst.getPvpLevel();if(t!=this._pvpLevel){for(var e=0;e<this._cardItems.length;e++)this._cardItems[e].update();this._pvpLevel=t}},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a;return __generator(this,function(u){for(e.prototype.open.call(this),i=this,r=function(e,i){e.numItems=t.CardPoolMgr.inst.getCollectCardsByCamp(i,!1).length},this._poolRenderExecutor=new Core.FrameExecutor,n=parseInt(this._campTapCtrl.selectedPage),this._poolRenderExecutor.regist(r,this,this._getCardListByCamp(n),n),o=0,s=[Camp.WEI,Camp.SHU,Camp.WU,Camp.HEROS];o<s.length;o++)a=s[o],a!=n&&this._poolRenderExecutor.regist(r,this,this._getCardListByCamp(a),a);return this._poolRenderExecutor.execute(),[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return e.prototype.close.call(this),this._poolRenderExecutor&&(this._poolRenderExecutor.cancel(),this._poolRenderExecutor=null),this._weiPool.numItems=0,this._shuPool.numItems=0,this._wuPool.numItems=0,this._qunPool.numItems=0,[2]})})},i.prototype._onSelectWeiCampTap=function(){},i.prototype._onSelectShuCampTap=function(){},i.prototype._onSelectWuCampTap=function(){},i.prototype._onSelectQunCampTap=function(){},i.prototype.openPrevInfo=function(t){var e=this._cardItems[t-1];if(e)if(0==e.cardObj.amount)this.openPrevInfo(t-1);else{var i=Core.ViewManager.inst.getView(ViewName.cardInfo);i&&i.open(e.cardObj,t-1,!0)}},i.prototype.openNextInfo=function(t){var e=this._cardItems[t+1];if(e)if(0==e.cardObj.amount)this.openNextInfo(t+1);else{var i=Core.ViewManager.inst.getView(ViewName.cardInfo);i&&i.open(e.cardObj,t+1,!0)}},i.prototype._onClickCardItem=function(t){var e=t.itemObject;e.cardObj.isNew=!1;var i=this._cardItems.indexOf(e);Core.ViewManager.inst.open(ViewName.cardInfo,e.cardObj,i)},i.prototype._renderPool=function(e,i,r){var n=t.CardPoolMgr.inst.getCollectCardsByCamp(e,!1);if(0>i||i>=n.length)return void console.debug("_renderPool error idx=%d",i);var o=n[i],s=r;this._cardItems.push(s),s.setData(o,!0),s.watchIsNew()},i.prototype._weiRenderList=function(t,e){this._renderPool(Camp.WEI,t,e)},i.prototype._shuRenderList=function(t,e){this._renderPool(Camp.SHU,t,e)},i.prototype._wuRenderList=function(t,e){this._renderPool(Camp.WU,t,e)},i.prototype._qunRenderList=function(t,e){this._renderPool(Camp.HEROS,t,e)},i.prototype._backOnClick=function(){Core.ViewManager.inst.open(ViewName.home),Core.ViewManager.inst.closeView(this)},i.prototype._getCardListByCamp=function(t){switch(t){case Camp.WEI:return this._weiPool;case Camp.SHU:return this._shuPool;case Camp.WU:return this._wuPool;case Camp.HEROS:return this._qunPool;default:return null}},i.prototype.getNode=function(t){var i=t.split(":");if("cardPoolItem"==i[0]){var r=this._getCardListByCamp(parseInt(this._campTapCtrl.selectedPage));if(r){var n=r.getChildAt(parseInt(i[1])),o=new fairygui.GGraph;return o.width=n.width,o.height=n.height,o.drawRect(0,Core.TextColors.white,0,Core.TextColors.white,0),o.x=n.x+this._listx+5,o.y=n.y+this._listy,this.addChildAt(o,0),o.once(egret.TouchEvent.TOUCH_TAP,function(){o.removeFromParent(),n.dispatchEventWith(egret.TouchEvent.TOUCH_TAP)},this),o}return null}return e.prototype.getNode.call(this,t)},i}(Core.BaseView);t.CardPoolView=e,__reflect(e.prototype,"CardPool.CardPoolView")}(CardPool||(CardPool={}));var CardPool;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var t=this;e.prototype.initUI.call(this),this.center(),this.modal=!0,this._descText=this.contentPane.getChild("txt2").asTextField,this._descText.textParser=Core.StringUtils.parseColorText,this._cardCom1=this.contentPane.getChild("now").asCom,this._cardCom2=this.contentPane.getChild("new").asCom,this._expProgressBar1=this.contentPane.getChild("expProgressBarNow").asCom,this._expProgressBar2=this.contentPane.getChild("expProgressBarNew").asCom,this._jadeBtn=this.contentPane.getChild("jadeBtn").asButton,this._jadeBtn.addClickListener(this._onJadeBtn,this),this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._closeBtn.addClickListener(function(){Core.ViewManager.inst.closeView(t)},this)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.open.apply(this,t),this._cardObj=t[0],this._refresh(),[2]})})},i.prototype._refresh=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){return this._cardCom1.cardObj=this._cardObj,e=t.CardPoolMgr.inst.getCardData(this._cardObj.cardId,3),i=new t.Card(e),i.skin=this._cardObj.skin,i.equip=this._cardObj.equip,this._cardCom2.cardObj=i,this._setCard(this._cardCom1),this._setCard(this._cardCom2),this._expProgressBar1.setProgress(this._cardObj.amount,this._cardObj.maxAmount),this._expProgressBar1.getChild("text").asTextField.text=this._cardObj.amount+"/"+this._cardObj.maxAmount,this._expProgressBar2.setProgress(0,i.maxAmount),this._expProgressBar2.getChild("text").asTextField.text="0/"+i.maxAmount,r=this._cardObj.getToLevelAmount(3),this._upJade=r[0]*CardJade[CardQuality[this._cardObj.rare]]+r[1]/100,this._jadeBtn.title=this._upJade.toString(),Player.inst.hasEnoughJade(this._upJade)?this._jadeBtn.getChild("title").asTextField.color=16777215:this._jadeBtn.getChild("title").asTextField.color=16711680,[2]})})},i.prototype._setCard=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t.setCardImg(),t.setSkill(),t.setEquip(),t.setNumOffsetText(),t.setName(),t.setNumText(),[2]})})},i.prototype._onJadeBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Player.inst.hasEnoughJade(this._upJade)?(Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70190),this._upJade),this._sendUp,null,this),[2]):(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60085)),[2])})})},i.prototype._sendUp=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,t.CardPoolMgr.inst.upLevelCard(this._cardObj.cardId,!0)];case 1:return e=i.sent(),e&&Core.ViewManager.inst.closeView(this),[2]}})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseWindow);t.CardUpWnd=e,__reflect(e.prototype,"CardPool.CardUpWnd")}(CardPool||(CardPool={}));var CardPool;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var t=this;e.prototype.initUI.call(this),this._goldLabel=this.contentPane.getChild("goldLabel").asLabel,this._goldLabel.textParser=Core.StringUtils.parseColorText,this._expProgressBar=this.contentPane.getChild("expProgressBar").asCom,this._skinBtn=this.contentPane.getChild("skinBtn").asButton,this._skinBtn.visible=Home.FunctionMgr.inst.isSkinOpen(),this._upBtn=this.contentPane.getChild("upBtn").asButton,this._upBtn.visible=Home.FunctionMgr.inst.isCardUpJadeOpen(),this._equipBtn=this.contentPane.getChild("equipBtn").asButton,this._equipBtn.visible=Home.FunctionMgr.inst.isEquipOpen(),this._uplevelBtn=this.contentPane.getChild("uplevelBtn").asButton,this._card.addClickListener(this._onCard,this),this._equipBtn.addClickListener(this._onEquipBtn,this),this._upBtn.addClickListener(this._onUPbtn,this),this._uplevelBtn.addClickListener(this._onUplevel,this),this._skinBtn.addClickListener(function(){Core.ViewManager.inst.open(ViewName.skinView,t._cardObj)},this)},i.prototype._onUPbtn=function(){Core.ViewManager.inst.open(ViewName.cardUpWnd,this._cardObj)},i.prototype._onEquipBtn=function(){Equip.EquipMgr.inst.openEquipSwitchWnd(this._card.cardObj)},i.prototype._onCard=function(){this._skinBtn&&Home.FunctionMgr.inst.isSkinOpen()?Core.ViewManager.inst.open(ViewName.skinView,this._cardObj):Core.ViewManager.inst.open(ViewName.bigCard,this._cardObj);var t=this._cardObj.sound;t&&t.length>0&&SoundMgr.inst.playSoundAsync(t+"_mp3")},i.prototype._onUplevel=function(){return this._cardObj.amount<=0&&this._cardObj.level<=1?void Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60125)):this._cardObj.amount<this._cardObj.maxAmount?void Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60170)):this._cardObj.amount>=this._cardObj.maxAmount&&!this._checkLevelUphRes()?void Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60207)):this._cardObj.getLevelObj(this._cardObj.level+1)?void t.CardPoolMgr.inst.upLevelCard(this._cardObj.cardId,!1):void Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60184))},i.prototype._checkLevelUphRes=function(){var t=this._cardObj;return Player.inst.getResource(ResType.T_GOLD)<t.data.levelupGold?!1:Player.inst.getResource(ResType.T_HORSE)<t.data.levelupHor?!1:Player.inst.getResource(ResType.T_WEAP)<t.data.levelupWeap?!1:Player.inst.getResource(ResType.T_MAT)<t.data.levelupMat?!1:!0},i.prototype.prev=function(){if(!this._isViewMode&&this._expProgressBar&&null!=!this._cardIndex){var t=Core.ViewManager.inst.getView(ViewName.cardpool);t&&t.openPrevInfo(this._cardIndex)}},i.prototype.next=function(){if(!this._isViewMode&&this._expProgressBar&&null!=!this._cardIndex){var t=Core.ViewManager.inst.getView(ViewName.cardpool);t&&t.openNextInfo(this._cardIndex)}},i.prototype._updateEquipBtn=function(){if(Home.FunctionMgr.inst.isEquipOpen())if(""==this._cardObj.equip||void 0==this._cardObj.equip)this._equipBtn.icon="",this._equipBtn.getChild("icon").asLoader.url="equip_equipWndEmpty_png",this._equipBtn.visible=!0;else{var t=Equip.EquipMgr.inst.getEquipData(this._cardObj.equip);this._equipBtn.icon=t.equipIconSmall,this._equipBtn.visible=!0,this._equipBtn.touchable=!0}},i.prototype._updateUpBtn=function(){Home.FunctionMgr.inst.isCardUpJadeOpen()&&(this._cardObj.getToLevelAmount(3)[0]>0&&Pvp.PvpMgr.inst.getPvpLevel()>=11?this._upBtn.visible=!0:this._upBtn.visible=!1)},i.prototype._updateResLabel=function(){var t=this._cardObj.data.levelupGold;this._goldLabel.visible=t>0,this.contentPane.getChild("txtCost").visible=t>0;var e=ResType.T_GOLD,i=t;if(i>0){var r=this._goldLabel,n=Player.inst.getResource(e);i>n?r.title="#c96160c"+n+"#n/"+i:r.title="#c19af27"+n+"#n/"+i}},i.prototype._updateAmountProgress=function(){this._expProgressBar.setProgress(this._cardObj.amount,this._cardObj.maxAmount);var t=this._expProgressBar.getChild("head"),e=Math.min(1,this._cardObj.amount/this._cardObj.maxAmount);t.x=this._expProgressBar.width*e-25,this._expProgressBar.getChild("text").asTextField.text=this._cardObj.amount+"/"+this._cardObj.maxAmount,this._cardObj.amount<this._cardObj.maxAmount||!this._cardObj.getLevelObj(this._cardObj.level+1)?(this._uplevelBtn.grayed=!0,this._uplevelBtn.getTransition("heartbeat").stop()):(this._uplevelBtn.grayed=!1,this._uplevelBtn.getTransition("heartbeat").play(null,null,null,-1)),5==this._cardObj.level?(this._uplevelBtn.visible=!1,this.contentPane.getChild("imgMaxLevel").visible=!this._isViewMode,this._expProgressBar.getChild("text").asTextField.text=this._cardObj.amount+"/"+Core.StringUtils.TEXT(60030)):(this._uplevelBtn.visible=!this._isViewMode,this.contentPane.getChild("imgMaxLevel").visible=!1)},i.prototype._onSkinChange=function(){if(this._refreshCard(),this._skinBtn){this.contentPane.getTransition("skin").play();var t=this._cardObj.getLevelObj(this._curCardViewLevel);this._updateLevelText(t)}},i.prototype._onEquipChange=function(){this._refreshCard(),this._equipBtn&&this._equipBtn.getTransition("equip").play()},i.prototype._onPropLevelChange=function(t){this._changeCurLevel(this._cardObj.level),this._updateResLabel(),this._updateUpBtn()},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){return e.prototype.open.apply(this,i),r=i[0],r.rare==CardQuality.LIMITED?this._expProgressBar.visible=!1:this._expProgressBar.visible=!0,this.contentPane.getChild("imgMaxLevel").visible=!1,this._updateAmountProgress(),this._updateResLabel(),this._updateUpBtn(),this._updateEquipBtn(),this._card.watchProp(t.Card.PropSkin,this._onSkinChange,this),this._card.watchProp(t.Card.PropEquip,this._onEquipChange,this),this._cardObjWatchers.push(Core.Binding.bindHandler(r,[t.Card.PropAmount],this._updateAmountProgress,this)),this._cardObjWatchers.push(Core.Binding.bindHandler(r,[t.Card.PropLevel],this._onPropLevelChange,this)),this._cardObjWatchers.push(Core.Binding.bindHandler(r,[t.Card.PropEquip],this._updateEquipBtn,this)),[2]})})},i.prototype.close=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return e.prototype.close.apply(this,i),this._card.unwatchProp(t.Card.PropSkin),this._card.unwatchProp(t.Card.PropEquip),[2]})})},i}(t.CardInfoWnd);t.MyCardInfoWnd=e,__reflect(e.prototype,"CardPool.MyCardInfoWnd")}(CardPool||(CardPool={}));var CardPool;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this._equipBtn=this.contentPane.getChild("equipBtn").asButton,this._equipBtn.visible=Home.FunctionMgr.inst.isEquipOpen(),this._card.addClickListener(this._onCard,this),this._equipBtn.addClickListener(this._onEquipBtn,this)},e.prototype._onEquipBtn=function(){if(this._card.cardObj.equip&&""!=this._card.cardObj.equip){var t=Equip.EquipMgr.inst.getEquipData(this._card.cardObj.equip);Core.ViewManager.inst.open(ViewName.equipItemWnd,t)}},e.prototype._updateEquipBtn=function(){if(Home.FunctionMgr.inst.isEquipOpen())if(""==this._cardObj.equip||void 0==this._cardObj.equip)this._equipBtn.icon="",this._equipBtn.visible=!1;else{var t=Equip.EquipMgr.inst.getEquipData(this._cardObj.equip);this._equipBtn.icon=t.equipIconSmall,this._equipBtn.visible=!0,this._equipBtn.touchable=!0}},e.prototype._onCard=function(){Core.ViewManager.inst.open(ViewName.bigCard,this._cardObj);var t=this._cardObj.sound;t&&t.length>0&&SoundMgr.inst.playSoundAsync(t+"_mp3")},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.open.apply(this,e),this.contentPane.getChild("imgMaxLevel").visible=!1,this._updateEquipBtn(),[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e}(t.CardInfoWnd);t.OtherCardInfo=e,__reflect(e.prototype,"CardPool.OtherCardInfo")}(CardPool||(CardPool={}));var CardPool;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.center(),this.modal=!0,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._faqList=this.contentPane.getChild("textList").asList,this._closeBtn.addClickListener(function(){Core.ViewManager.inst.closeView(e)},this),this._faqList.removeChildrenToPool();var i=Data.priority.keys,r=this._faqList.addItemFromPool().asCom;r.getChild("mailText").asRichTextField.text="\n"+Core.StringUtils.TEXT(70128),i.forEach(function(t){var i=Data.priority.get(t),r=e._faqList.addItemFromPool().asCom,n="";if(i.priority1){var o=i.priority1,s=o.split(";");""==n?n=e._getLinkText(s,1):n+="，"+e._getLinkText(s,1)}if(i.priority2){var o=i.priority2,s=o.split(";");""==n?n=e._getLinkText(s,2):n+="，"+e._getLinkText(s,2)}if(i.priority3){var o=i.priority3,s=o.split(";");""==n?n=e._getLinkText(s,3):n+="，"+e._getLinkText(s,3)}if(i.priority4){var o=i.priority4,s=o.split(";");""==n?n=e._getLinkText(s,4):n+="，"+e._getLinkText(s,4)}if(i.priority5){var o=i.priority5,s=o.split(";");""==n?n=e._getLinkText(s,5):n+="，"+e._getLinkText(s,5)}if(i.priority6){var o=i.priority6,s=o.split(";");""==n?n=e._getLinkText(s,6):n+="，"+e._getLinkText(s,6)}if(i.priority7){var o=i.priority7,s=o.split(";");""==n?n=e._getLinkText(s,7):n+="，"+e._getLinkText(s,7)}if(i.priority8){var o=i.priority8,s=o.split(";");""==n?n=e._getLinkText(s,8):n+="，"+e._getLinkText(s,8)}if(i.priority9){var o=i.priority9,s=o.split(";");""==n?n=e._getLinkText(s,9):n+="，"+e._getLinkText(s,9)}r.getChild("mailText").asRichTextField.text="<b>"+i.desOpp+"</b> \n"+n+"\n",r.getChild("mailText").asRichTextField.addEventListener(egret.TextEvent.LINK,htmlClickCallback,e)})},e.prototype._getLinkText=function(t,e){var i="";return t.forEach(function(t){var r='<a href="event:skill,'+t+'"><u>'+e+"."+Data.skill.get(t).name+"</u></a>";""==i?i=r:i+="，"+r}),i},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.open.apply(this,e),[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e}(Core.BaseWindow);t.SkillFaqWnd=e,__reflect(e.prototype,"CardPool.SkillFaqWnd")}(CardPool||(CardPool={}));var CardPool;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._tip=this.getChild("tip").asTextField,this._current=this.getChild("current").asLoader,this._skinObj=this.getChild("n6").asCom,this._Using=this.getChild("usingFlag").asLoader},i.prototype.setCur=function(t){this._current.visible=t,t?this.setScale(1,1):this.setScale(.8,.8)},i.prototype.setUsing=function(t){this._Using.visible=t},i.prototype.setHasSkin=function(t){this._hasSkin=t},Object.defineProperty(i.prototype,"hasSkin",{get:function(){return this._hasSkin},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"skinID",{get:function(){return this._skinID},enumerable:!0,configurable:!0}),i.prototype.setSkin=function(e,i,r,n){var o=t.CardPoolMgr.inst.getCardData(i,1),s=t.CardSkinMgr.inst.getSkinConf(e);if(""==e){this._tip.text=Core.StringUtils.TEXT(70113),n="card_b_"+n+"_png";var a=o.name;-1!=a.indexOf("#")&&(a=a.slice(3,a.length-2)),this._skinObj.getChild("nameText").asTextField.text=a}else this._tip.text=s.desc,n="skin_b_"+e+"_png",this._skinObj.getChild("nameText").asTextField.text=s.name;this._skinID=e,Utils.setImageUrlPicture(this._skinObj.getChild("icon").asImage,n)},i}(fairygui.GComponent);t.SkinItemCom=e,__reflect(e.prototype,"CardPool.SkinItemCom");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var t=this;e.prototype.initUI.call(this),this.center(),this.modal=!0,this.adjust(this.contentPane.getChild("bg")),this._skinList=this.contentPane.getChild("skinList").asList,this._setBtn=this.contentPane.getChild("setBtn").asButton,this._setBtn.addClickListener(this._onSet,this),this.contentPane.getChild("bg").addClickListener(function(){Core.ViewManager.inst.closeView(t)},this),this._skinList.scrollPane.addEventListener(fairygui.ScrollPane.SCROLL,this._seletCom,this)},i.prototype._seletCom=function(){for(var t=this._skinList.scrollPane.posX+this._skinList.viewWidth/2,e=this._skinList.numChildren,i=0;e>i;i++){var r=this._skinList.getChildAt(i),n=Math.abs(t-r.x-r.width/2);if(n>r.width)r.setCur(!1),r.setScale(1,1);else{0==n&&(r.setCur(!0),this._curCom=r,this.changeSetBtn(r));var o=1+.1*(1-n/r.width);r.setScale(o,o)}}},i.prototype.changeSetBtn=function(t){t.skinID==this._useSkinID?this._setBtn.visible=!1:(this._setBtn.visible=!0,this._setBtn.grayed=!t.hasSkin,t.hasSkin?this._setBtn.title=Core.StringUtils.TEXT(70118):this._setBtn.title=Core.StringUtils.TEXT(60063))},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.open.apply(this,t),this._cardObj=t[0],t[1]?(this._curSkinID=t[1],this.contentPane.getTransition("openOther").play()):(this._curSkinID=this._cardObj.skin,this.contentPane.getTransition("openSelf").play()),this._useSkinID=this._cardObj.skin,this._hasSkins=this._cardObj.hasSkins,this._hasCard=!(this._cardObj.amount<=0&&this._cardObj.level<=1),this._updateSkinList(),[2]})})},i.prototype._onSet=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return this._hasCard?this._curCom.hasSkin?this._curCom.skinID==this._useSkinID?(Core.ViewManager.inst.close(ViewName.skinView),[2]):(t={CardID:this._cardObj.cardId,Skin:this._curCom.skinID},[4,Net.rpcCall(pb.MessageID.C2S_UPDATE_CARD_SKIN,pb.SkinCard.encode(t))]):(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70126)),[2]):(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60125)),[2]);case 1:return e=i.sent(),0==e.errcode?(this._cardObj.skin=this._curCom.skinID,Core.ViewManager.inst.close(ViewName.skinView)):console.log(e.errcode),[2]}})})},i.prototype._updateSkinList=function(){var e=this;this._skinList.removeChildrenToPool();var i=this._cardObj.cardId,r=0,n=t.CardSkinMgr.inst.getAllSkins(this._cardObj.cardId);n&&(n.forEach(function(n,o){var s,a=e._skinList.addItemFromPool().asCom,u="";""==n?(u=e._cardObj.name,s=e._cardObj.icon):(u=t.CardSkinMgr.inst.getSkinConf(n).name,s=n),a.setSkin(n,i,u,s),a.setUsing(n==e._useSkinID),a.setCur(n==e._curSkinID);var h=-1!=e._hasSkins.indexOf(n);a.setHasSkin(e._hasCard&&h),n==e._curSkinID&&(r=o,e._curCom=a)}),this._skinList.scrollToView(r),this._seletCom())},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseWindow);t.SkinWnd=i,__reflect(i.prototype,"CardPool.SkinWnd")}(CardPool||(CardPool={}));var Core;!function(t){var e=function(){function t(){}return Object.defineProperty(t,"nativeBase64",{get:function(){return"function"==typeof window.atob},enumerable:!0,configurable:!0}),t.decode=function(t){if(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,""),this.nativeBase64)return window.atob(t);for(var e,i,r,n,o,s,a,u=[],h=0;h<t.length;)n=this._keyStr.indexOf(t.charAt(h++)),o=this._keyStr.indexOf(t.charAt(h++)),s=this._keyStr.indexOf(t.charAt(h++)),a=this._keyStr.indexOf(t.charAt(h++)),e=n<<2|o>>4,i=(15&o)<<4|s>>2,r=(3&s)<<6|a,u.push(String.fromCharCode(e)),64!==s&&u.push(String.fromCharCode(i)),64!==a&&u.push(String.fromCharCode(r));return u=u.join("")},t.encode=function(t){if(t=t.replace(/\r\n/g,"\n"),!this.nativeBase64){for(var e,i,r,n,o,s,a,u=[],h=0;h<t.length;)e=t.charCodeAt(h++),i=t.charCodeAt(h++),r=t.charCodeAt(h++),n=e>>2,o=(3&e)<<4|i>>4,s=(15&i)<<2|r>>6,a=63&r,isNaN(i)?s=a=64:isNaN(r)&&(a=64),u.push(this._keyStr.charAt(n)),u.push(this._keyStr.charAt(o)),u.push(this._keyStr.charAt(s)),u.push(this._keyStr.charAt(a));return u=u.join("")}window.btoa(t)},t.decodeBase64AsArray=function(e,i){i=i||1;var r,n,o,s=t.decode(e),a=new Uint32Array(s.length/i);for(r=0,o=s.length/i;o>r;r++)for(a[r]=0,n=i-1;n>=0;--n)a[r]+=s.charCodeAt(r*i+n)<<(n<<3);return a},t.decompress=function(t,e,i){throw new Error("GZIP/ZLIB compressed TMX Tile Map not supported!")},t.decodeCSV=function(t){for(var e=t.replace("\n","").trim().split(","),i=[],r=0;r<e.length;r++)i.push(+e[r]);return i},t._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t}();t.Base64=e,__reflect(e.prototype,"Core.Base64")}(Core||(Core={}));var Core;!function(t){t.TextColors={white:16777215,milkWhite:16511407,grayWhite:13547170,gray:3355443,yellow:16571136,lightYellow:16765813,orangeYellow:16750848,red:16711680,green:65316,blue:47871,grayBlue:3101047,purple:15335679,pink:16724016,black:0,golden:16766720,brownness:6886163},t.ColorsCode={g:65316,b:47871,p:15335679,o:16747008,r:16711680,y:16571136,m:16766121,z:3879969,B:0,w:16777215,l:6886163}}(Core||(Core={}));var UI;!function(t){var e=function(){function t(){this._diyTextures=new Collection.Dictionary,this._loading=new Collection.Dictionary}return Object.defineProperty(t,"inst",{get:function(){return t._inst||(t._inst=new t),t._inst},enumerable:!0,configurable:!0}),t.prototype._fetchDiyTexture=function(t){return __awaiter(this,void 0,void 0,function(){var e,i=this;return __generator(this,function(r){switch(r.label){case 0:return this._diyTextures.containsKey(t)?[2,this._diyTextures.getValue(t)]:this._loading.containsKey(t)?[4,this._loading.getValue(t)]:[3,2];case 1:return r.sent(),[2,this._diyTextures.getValue(t)];case 2:return e=new Promise(function(e){Net.rpcCall(pb.MessageID.C2S_FETCH_DIY_CARD_IMG,pb.TargetCard.encode({CardId:t}),!1,!1).then(function(r){return r?(i._diyTextures.setValue(t,null),i._loading.remove(t),void e()):void 0})}),this._loading.setValue(t,e),[4,e];case 3:return r.sent(),[2,this._diyTextures.getValue(t)]}})})},t.prototype.fetchTexture=function(t,e,i,r){return __awaiter(this,void 0,void 0,function(){var n,o,s,a,u,h;return __generator(this,function(l){switch(l.label){case 0:return n=void 0!=e&&""!=e,Diy.DiyMgr.inst.isDiyCard(t)?(o=this._diyTextures.getValue(t))?[3,2]:(r(t,RES.getRes("card_"+i+"_999_png")),[4,this._fetchDiyTexture(t)]):[3,4];case 1:return o=l.sent(),o&&r(t,o),[3,3];case 2:r(t,o),l.label=3;case 3:return[2];case 4:if(s=i,a="card_"+i+"_"+t+"_png",n&&(a="skin_"+i+"_"+e+"_png"),o=RES.getRes(a),o||(u=void 0,u="s"==i?["m","b"]:"m"==i?["b","s"]:["m","s"],s=u[0],o=n?RES.getRes("skin_"+u[0]+"_"+e+"_png"):RES.getRes("card_"+u[0]+"_"+t+"_png"),o||(s=u[1],o=n?RES.getRes("skin_"+u[0]+"_"+e+"_png"):RES.getRes("card_"+u[1]+"_"+t+"_png"))),o||(o=RES.getRes("card_"+i+"_999_png")),s==i)return[3,8];r(t,o),l.label=5;case 5:return l.trys.push([5,7,,8]),[4,RES.getResAsync(a)];case 6:return o=l.sent(),[3,8];case 7:return h=l.sent(),console.debug(h),[3,8];case 8:return r(t,o,a),[2]}})})},t}();t.CardImgTextureMgr=e,__reflect(e.prototype,"UI.CardImgTextureMgr")}(UI||(UI={}));var UI;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._icon=this.getChild("skillIcon").asLoader,this._skillText=this.getChild("skillText").asRichTextField,this._skillGroup=this.getChild("skillGroup").asGroup},e.prototype.setData=function(t){if(t&&!(t.length<=0)){for(var e=0,i=t;e<i.length;e++){var r=i[e],n=Data.skill.get(r);if(n&&n.desTra&&""!=n.desTra){this._skillText.text=CardPool.CardPoolMgr.inst.formatSkillDesc(n,1);break}}this._skillGroup.width=this._skillText.width+this._skillText.x-this._icon.x}},e}(fairygui.GComponent);t.CastlerSkill=e,__reflect(e.prototype,"UI.CastlerSkill")}(UI||(UI={}));var Core;!function(t){function e(){fairygui.UIConfig.modalLayerAlpha=.7,fairygui.UIConfig.modalLayerColor=t.TextColors.black,t.LayerManager.inst}function i(){if(!window.gameGlobal.debug&&window.gameGlobal.tdAppid&&!t.DeviceUtils.isWXGame()){var e=window.gameGlobal.tdChannel||window.gameGlobal.channel,i=window.gameGlobal.tdAppid,r=window.location.search;r?r+="&td_channelid="+e:r="?td_channelid="+e,window.history.pushState("","uselessTitle",r),window.sequenceNumber=i,window.appDisplayName="",window.DTGAbaseUrl="https://h5.talkingdata.com/websdk",window.DTGARequestUrl="https://h5.udrig.com/g/v1";var n=window.DTGAbaseUrl+"/js/sdk_release.js?v=1.0.5",o=document.createElement("script");o.async=!1,o.src=n,o.type="text/javascript",o.addEventListener("load",function(){o.parentNode.removeChild(o)},!1),document.body.appendChild(o)}}t.init=e,t.loadTD=i}(Core||(Core={}));var UI;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.adjust(this.getChild("bg"),Core.AdjustType.EXCEPT_MARGIN),this.y+=window.support.topMargin,this._forAmount=0,this._choiceCard=[null,null,null,null,null],this._cardList=this.getChild("cardList").asList,this._cardList.itemClass=t.ChoiceCardItem,this._cardList.removeItemCallback=this._onRemoveCardItem,this._forAmountLabel=this.getChild("forAmountLabel").asLabel,this._forAmountLabel.visible=!1,this._forAmountLabel.getChild("title").asTextField.textParser=Core.StringUtils.parseColorText,this._forAmountLabel.title=this._forAmount.toString(),this._title=this.getChild("title").asTextField,this._title.textParser=Core.StringUtils.parseColorText,this._forSubBtn=this.getChild("forSubBtn").asButton,this._forAddBtn=this.getChild("forAddBtn").asButton,this._text1=this.getChild("text1").asTextField,this._text2=this.getChild("text2").asTextField,this._text3=this.getChild("text3").asTextField,this._img1=this.getChild("img1").asLoader,this._text4=this.getChild("text4").asTextField,this.getChild("backBtn").asButton.addClickListener(this._onBack,this),this.getChild("confirmBtn").asButton.addClickListener(this._onConfirm,this),this._cardList.addEventListener(fairygui.ItemEvent.CLICK,this._onClickItem,this),this._forAddBtn.addClickListener(this._onAddFor,this),this._forSubBtn.addClickListener(this._onSubFor,this)
},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.open.apply(this,t),this._choiceCardCtrl=t[0],t.length>1?this._handCardGrid=t[1]:this._handCardGrid=null,this._visableCampaign(this._choiceCardCtrl.visableCampaign()),this._updateForAmountLabel(),this._oldChoiceCards=this._choiceCardCtrl.getChoiceCard(),this._choiceCard=this._oldChoiceCards.concat(),this._setTitle(),this._renderCardList(this._getAllCardObjs()),[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),this._renderCardExecutor.cancel(),this._renderCardExecutor=null,this._cardList.removeChildrenToPool(),this._choiceCardCtrl=null,this._choiceCard=null,this._oldChoiceCards=null,this._handCardGrid=null,[2]})})},i.prototype._setTitle=function(){var t="",e=new Collection.Dictionary;e.setValue(Camp.WEI,"0000ff"),e.setValue(Camp.SHU,"cc0000"),e.setValue(Camp.WU,"006633"),e.setValue(Camp.HEROS,"6633ff"),this._choiceCardCtrl.getTitleCamps().forEach(function(i){""!=t&&(t+=LanguageMgr.inst.isChineseLocale()?Core.StringUtils.TEXT(60007):" "+Core.StringUtils.TEXT(60007)+" "),t+="#c"+e.getValue(i)+Utils.camp2Text(i)+"#n"}),this._title.text=Core.StringUtils.format(Core.StringUtils.TEXT(60187),t,this._getChoiceCardAmount(),this._choiceCardCtrl.getMaxAmount())},i.prototype._getAllCardObjs=function(){var e=this,i=this._choiceCardCtrl.getCamps(),r=[];return i.forEach(function(i){for(var n=CardPool.CardPoolMgr.inst.getCollectCardsByCamp(i),o=0,s=n;o<s.length;o++){var a=s[o];if(a.state!=CardPool.CardState.Lock&&a.state!=CardPool.CardState.Unlock){var u=e._choiceCardCtrl.getCardState(a);u!=t.BaseCardItem.HideState&&r.push(a)}}}),this._choiceCardCtrl.needDiyCard()&&r.push.apply(r,Diy.DiyMgr.inst.getAllCards()),r.sort(function(t,i){var r=e._getCardStatePriority(t),n=e._getCardStatePriority(i);if(r==n){var o=CardPool.CardPoolMgr.inst.getCardData(t.cardId,1),s=CardPool.CardPoolMgr.inst.getCardData(i.cardId,1);return o&&s?o.camp==s.camp?o.cardOrder>s.cardOrder?1:-1:o.camp>s.camp?1:-1:t.cardId>i.cardId?1:-1}return r>n?1:-1}),r},i.prototype._renderCardFrame=function(t){var e=this;t.forEach(function(t){var i=e._choiceCardCtrl.getCardState(t),r=e._cardList.addItemFromPool();r.state=i,r.setData(t,e._choiceCardCtrl.needEnergyProgress(),e._choiceCardCtrl.needExpProgress()),r.watch(),r.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e._onTouchItem,e);var n=e._oldChoiceCards.indexOf(t);n>=0?r.selected=!0:r.selected=!1})},i.prototype._renderCardList=function(t){this._renderCardExecutor=new Core.FrameExecutor;for(var e=0,i=5;t.length>e;){var r=t.slice(e,e+i);this._renderCardExecutor.regist(this._renderCardFrame,this,r),e+=i}this._renderCardExecutor.execute()},i.prototype._getCardStatePriority=function(e){if(this._oldChoiceCards.indexOf(e)>=0)return 0;if(e.state==CardPool.CardState.Dead)return 5;var i=this._choiceCardCtrl.getCardState(e);switch(i){case t.BaseCardItem.NormalState:return 1;case t.BaseCardItem.ForbidState:return 2;case t.BaseCardItem.AttackState:return 3;case t.BaseCardItem.GuardState:return 4;default:return 5}},i.prototype._onRemoveCardItem=function(e){if(e instanceof t.ChoiceCardItem){var i=e;i.unwatch(),i.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onTouchItem,this)}},i.prototype._onAddFor=function(){this._forAmount+=1,this._updateForAmountLabel()},i.prototype._onSubFor=function(){this._forAmount<=0||(this._forAmount-=1,this._updateForAmountLabel())},i.prototype._updateForAmountLabel=function(){this._forAmount<=0?this._forAmountLabel.title="#cr0#n/"+Player.inst.getResource(ResType.T_FORAGE):this._forAmountLabel.title=this._forAmount+"/"+Player.inst.getResource(ResType.T_FORAGE)},i.prototype._getChoiceCardAmount=function(){var t=0;return this._choiceCard.forEach(function(e){e&&t++}),t},i.prototype._onTouchItem=function(t){var e=t.target;e.$touchBegin=!0;var i=fairygui.GRoot.mouseX,r=fairygui.GRoot.mouseY;fairygui.GTimers.inst.callDelay(600,function(){Math.abs(fairygui.GRoot.mouseX-i)>15||Math.abs(fairygui.GRoot.mouseY-r)>20||e.$touchBegin&&Core.ViewManager.inst.open(ViewName.cardInfo,e.cardObj.collectCard)},this)},i.prototype._onClickItem=function(e){var i=e.itemObject;if(i.$touchBegin=null,!(Core.ViewManager.inst.getView(ViewName.cardInfo)&&Core.ViewManager.inst.getView(ViewName.cardInfo).isShow()||i.cardObj.state==CardPool.CardState.Dead||i.state!=t.BaseCardItem.NormalState)){var r=!i.selected;if(r){if(this._choiceCard.indexOf(i.cardObj)<0&&this._getChoiceCardAmount()<this._choiceCardCtrl.getMaxAmount())for(var n=0;n<this._choiceCard.length;n++)if(!this._choiceCard[n]){this._choiceCard[n]=i.cardObj,this._setTitle(),i.selected=r;break}}else for(var n=0;n<this._choiceCard.length;n++)if(this._choiceCard[n]==i.cardObj){this._choiceCard[n]=null,i.selected=r,this._setTitle();break}}},i.prototype._visableCampaign=function(t){this._forAmountLabel.visible=t,this._forSubBtn.visible=t,this._forAddBtn.visible=t,this._text1.visible=t,this._text2.visible=t,this._text3.visible=t,this._img1.visible=t,this._text4.visible=!t,t&&this._forAmount<=0&&(this._forAmount=3,this._updateForAmountLabel())},i.prototype._onBack=function(){Core.ViewManager.inst.closeView(this)},i.prototype._onConfirm=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,r;return __generator(this,function(n){switch(n.label){case 0:if(this._getChoiceCardAmount()<this._choiceCardCtrl.getMinAmount())return t=Core.StringUtils.format(Core.StringUtils.TEXT(60158),this._choiceCardCtrl.getMinAmount()),Core.TipsUtils.showTipsFromCenter(t),[2];if(this._choiceCardCtrl.visableCampaign()&&this._forAmount>Player.inst.getResource(ResType.T_FORAGE))return Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60148)),[2];for(e=!1,i=0;i<this._choiceCard.length;i++)if(this._choiceCard[i]!=this._oldChoiceCards[i]){e=!0;break}return e?[4,this._choiceCardCtrl.onConfirm(this._choiceCard,this._forAmount)]:[3,2];case 1:return(r=n.sent())?(this._handCardGrid&&this._handCardGrid.refresh(),[3,4]):[2];case 2:return[4,this._choiceCardCtrl.onConfirm(this._choiceCard,this._forAmount)];case 3:if(r=n.sent(),!r)return[2];n.label=4;case 4:return Core.ViewManager.inst.closeView(this),[2]}})})},i.prototype.getNode=function(i){var r=i.split(":");if("cardEnergyBar"==r[0]){if(this._cardList){var n=this._cardList.getChildAt(parseInt(r[1]));if(n&&n instanceof t.ChoiceCardItem)return this._cardList.ensureBoundsCorrect(),n.energyProgressBar}return null}if("cardItem"==r[0]){var o=this._cardList.getChildAt(parseInt(r[1]));this._cardList.ensureBoundsCorrect();var s=new fairygui.GGraph;return s.width=o.width,s.height=o.height,s.drawRect(0,Core.TextColors.white,0,Core.TextColors.white,0),s.x=o.x+this._cardList.x+5,s.y=o.y+this._cardList.y,this.addChildAt(s,0),s.once(egret.TouchEvent.TOUCH_TAP,function(){s.removeFromParent(),o.dispatchEventWith(egret.TouchEvent.TOUCH_TAP)},this),s}return e.prototype.getNode.call(this,i)},i}(Core.BaseView);t.ChoiceFightCardView=e,__reflect(e.prototype,"UI.ChoiceFightCardView")}(UI||(UI={}));var UI;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._inputLabel=this.getChild("inputAmount").asLabel,this._goldAmountTxt=this.getChild("goldAmountTxt").asTextField,this._resImg=this.getChild("resImg").asLoader;var i=this.getChild("desc");i&&(this._resDesc=i.asTextField),this._needGold=0,this._amount=0,this.getChild("confirmBtn").asButton.addClickListener(this._onConfirm,this),this.getChild("addBtn").asButton.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onBeginAddAmount,this),this.getChild("subBtn").asButton.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onBeginSubAmount,this)},e.prototype.show=function(t,e){var i=Data.exchange.get(t);i&&(t!=this._curResType&&(this._curResType=t,this._resImg.url=Utils.resType2Icon(t),this._resDesc&&(this._resDesc.text=this._getResDesc(t)),this._onAmountChange(0)),Core.TipsUtils.showTipsFromTarget(this,1,e))},e.prototype._getResDesc=function(t){switch(t){case ResType.T_WEAP:case ResType.T_HORSE:case ResType.T_MAT:return Core.StringUtils.format(Core.StringUtils.TEXT(60151),Utils.resType2Text(t));case ResType.T_FORAGE:return Core.StringUtils.format(Core.StringUtils.TEXT(60221),Utils.resType2Text(t));case ResType.T_BAN:return Core.StringUtils.format(Core.StringUtils.TEXT(60186),Utils.resType2Text(t));case ResType.T_MED:return Core.StringUtils.format(Core.StringUtils.TEXT(60181),Utils.resType2Text(t));default:return""}},e.prototype._onAmountChange=function(t){var e=Data.exchange.get(this._curResType);if(e)if(this._needGold=0,t>0){var i=e.buy*t;this._needGold=i,this._amount=t,this._goldAmountTxt.text="- "+i,this._goldAmountTxt.color=Core.TextColors.red,this._inputLabel.text="+ "+t}else if(0>t){var r=e.sold*-t;this._amount=t,this._goldAmountTxt.text="+ "+r,this._goldAmountTxt.color=Core.TextColors.green,this._inputLabel.text="- "+-t}else this._amount=0,this._goldAmountTxt.text="0",this._goldAmountTxt.color=Core.TextColors.white,this._inputLabel.text="0"},e.prototype._onStopChangeAmount=function(){fairygui.GRoot.inst.nativeStage.removeEventListener(egret.TouchEvent.TOUCH_END,this._onStopChangeAmount,this),fairygui.GTimers.inst.remove(this._changeAmount,this)},e.prototype._onBeginAddAmount=function(){this._changeAmount(1),fairygui.GRoot.inst.nativeStage.addEventListener(egret.TouchEvent.TOUCH_END,this._onStopChangeAmount,this)},e.prototype._onBeginSubAmount=function(){this._changeAmount(-1),fairygui.GRoot.inst.nativeStage.addEventListener(egret.TouchEvent.TOUCH_END,this._onStopChangeAmount,this)},e.prototype._changeAmount=function(t,e){void 0===e&&(e=500),this._onAmountChange(this._amount+t);var i=40;fairygui.GTimers.inst.add(e,1,this._changeAmount,this,t,i)},e.prototype._onConfirm=function(){if(0!=this._amount){if(-this._amount>Player.inst.getResource(this._curResType))return void Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(60101),Utils.resType2Text(this._curResType)));if(this._needGold>Player.inst.getResource(ResType.T_GOLD))return void Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(60101),Utils.resType2Text(ResType.T_GOLD)));Player.inst.exchangeRes(this._curResType,this._amount)}fairygui.GRoot.inst.hidePopup(this)},e}(fairygui.GComponent);t.ExchangeResWnd=e,__reflect(e.prototype,"UI.ExchangeResWnd")}(UI||(UI={}));var UI;!function(t){function e(){fairygui.UIConfig.defaultScrollDecelerationRate=.193,fairygui.UIPackage.addPackage(PkgName.common),fairygui.UIPackage.addPackage(PkgName.bmpfont),fairygui.UIPackage.addPackage(PkgName.cards),fairygui.UIPackage.addPackage(PkgName.login),fairygui.UIPackage.addPackage(PkgName.home),fairygui.UIPackage.addPackage(PkgName.level),fairygui.UIPackage.addPackage(PkgName.card_b),fairygui.UIPackage.addPackage(PkgName.card_m),fairygui.UIPackage.addPackage(PkgName.card_s),fairygui.UIPackage.addPackage(PkgName.card_u),fairygui.UIPackage.addPackage(PkgName.cardpool),fairygui.UIPackage.addPackage(PkgName.battle),fairygui.UIPackage.addPackage(PkgName.treasure),fairygui.UIPackage.addPackage(PkgName.pvp),fairygui.UIPackage.addPackage(PkgName.diy),fairygui.UIPackage.addPackage(PkgName.guide),fairygui.UIPackage.addPackage(PkgName.social),fairygui.UIPackage.addPackage(PkgName.shop),fairygui.UIPackage.addPackage(PkgName.reborn),fairygui.UIPackage.addPackage(PkgName.equip),fairygui.UIPackage.addPackage(PkgName.war),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"tips"),t.TipsCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"handCardGrid"),t.HandCardGrid),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"pvpScoreProgressBar"),t.MaskProgressBar),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.level,"NewLevelItem"),Level.LevelItem),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.level,"chapterItem"),Level.ChapterItem),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.level,"levelTreasure"),Level.ChapterRewardCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.level,"appealItem"),Level.LevelHelpItemCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"resBarBtn"),t.ResBarBtn),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"resLabel"),t.ResLabel),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"resList"),t.ResList),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"rewardResBar"),t.RewardResBar),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"castlerSkill"),t.CastlerSkill),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.cards,"cardRareSmall"),t.CardRareCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.cards,"cardRareMiddle"),t.CardRareCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.cards,"smallCard"),t.CardCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.cards,"middleCard"),t.CardCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.cards,"middleCardBig"),t.CardCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.cards,"valueProgressBar"),t.MaskProgressBar),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.cardpool,"valueProgressBar"),t.MaskProgressBar),window.gameGlobal.isPC,fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.battle,"battleGrid"),Battle.GridView),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.battle,"progress"),t.MaskProgressBar),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.treasure,"treasure"),Treasure.TreasureItemCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.pvp,"dailyTreasure"),Treasure.DailyTreasureItemCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.treasure,"cardCnt"),Treasure.CardRewardCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.treasure,"goldCnt"),Treasure.GoldRewardCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.treasure,"jadeCnt"),Treasure.JadeRewardCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"starAni"),t.StarCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"pvpRankBanner0"),t.BannerCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"pvpRankBanner1"),t.BannerCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"pvpRankBanner2"),t.BannerCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"pvpRankBanner3"),t.BannerCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"pvpRankBanner4"),t.BannerCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"pvpRankBanner5"),t.BannerCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"pvpRankBannerMax"),t.MaxBannerCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"pvpRankBanner"),t.PvpRankBannerCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.battle,"winNew"),Battle.NewBattleWinCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.battle,"loseNew"),Battle.NewBattleLoseCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"emojiChk"),Battle.EmojiTeamChkBtnCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.battle,"emojiView1"),Battle.EmojiListViewCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.battle,"emojiView2"),Battle.EmojiListViewCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"cardNumHint"),CardPool.CardNumHintCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"avatarNumHint"),CardPool.AvatarNumHintCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"levelNumHint"),Level.LevelNumHintCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.pvp,"rankingPlayer"),Pvp.RankPlayerInfoCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.pvp,"rankingPlayerRankSeason"),Pvp.SeasonRankPlayerInfoCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.pvp,"videoCard"),Pvp.VideoCardCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.pvp,"videoDiscuss"),Pvp.VideoDiscussWnd),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.pvp,"videoDiscussItem"),Pvp.VideoDisItem),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.social,"worldChat"),Social.WorldChatWndCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.social,"warChat"),Social.WorldChatWndCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.social,"privateChat"),Social.PrivateChatWndCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.social,"friend"),Social.FriendListWndCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.social,"friendItem"),Social.FriendItemCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.social,"headItemCom"),Social.AvatarItemCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.social,"privItem"),Social.PrivCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.social,"privCom"),Social.PrivCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.social,"headFrameItemCom"),Social.FrameItemCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"privateChatNumHint"),Social.PrivateChatHintCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"applyFriendNumHint"),Social.ApplyFriendHintCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.common,"socialNewHint"),Social.SocialHintCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.home,"bubbleTips"),Social.InviteBattleHintCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.shop,"cardCnt"),Shop.CardCntCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.shop,"goldCnt"),Shop.GoldCntCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.shop,"jadeCnt"),Shop.JadeCntCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.shop,"goldItem"),Shop.GoldItemCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.shop,"jadeItem"),Shop.JadeItemCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.shop,"limitGiftItem"),Shop.GiftItemCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.shop,"purchaseItem"),Shop.GiftItemCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.shop,"advipItem"),Shop.GiftVipCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.shop,"minivipItem"),Shop.GiftVipCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.shop,"treasureItem"),Shop.TreasureItemCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.shop,"freeGold"),Shop.FreeGoldItemCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.shop,"freeJade"),Shop.FreeJadeItemCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.shop,"freeTreasure"),Shop.FreeTreasureItemCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.shop,"gold"),Shop.GoldSellCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.shop,"jade"),Shop.JadeSellCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.shop,"limitGift"),Shop.GiftSellCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.shop,"purchase"),Shop.GiftSellCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.shop,"treasure"),Shop.TreasureSellCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.shop,"free"),Shop.FreeSellCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.pvp,"questBtn"),Quest.QuestBtnCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.pvp,"questItem"),Quest.QuestItem),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.pvp,"questTipItem"),Quest.QuestTipItem),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.level,"levelProgressBar"),t.MaskProgressBar),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.social,"inviteRewardItem"),Social.InviteRewardItem),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.social,"inviteHeadItem"),Social.InviteMemberItem),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.social,"head"),Social.HeadCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.pvp,"rankhandCardGrid"),Pvp.RankHand),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.pvp,"mailRewardItem"),Pvp.MailInfoItem),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.pvp,"advertIcon"),WXGame.WXAdvertIconCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.cards,"skinCom"),CardPool.SkinItemCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.reborn,"refineCardItem"),Reborn.RefineCardItem),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"mainMap"),War.MainMap),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"cityItem"),War.CityCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"playerItem"),War.WarPlayerItem),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"emperorApplyItem"),War.EmperorApplyItem),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"resourceProgressItem"),War.CityInfoBar),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"progress"),t.MaskProgressBar),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"warProgress1"),t.MaskProgressBar),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"warProgress2"),t.MaskProgressBar),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"resourceValueItem"),War.CityInfoCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"cityDetail"),War.CityDetailCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"cityBuild"),War.CityBuildCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"cityAppoint"),War.CityAppointCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"jobItem"),War.CityJobItem),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"questStatus"),War.CurQuestCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"questItem"),War.WarQuestItem),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"cardHeadItem"),War.WarCardHeadCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"gameoverPanel"),War.WarGameOverPanel),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"warStatusPanel"),War.WarHomeTipPanel),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"fightStatusPanel"),War.WarFightStatusPanel),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"cityManageFightPanel"),War.CityManageFightCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"campItem"),War.CampIconCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"cityBuildItem"),War.CityBuildItem),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"noticeFunctionItem"),War.WarNoticeItem),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"countryAppoint"),War.CountryAppointCom),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"playerChooseItem"),War.PlayerChooseItem),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"shopCard"),War.WarShopWindow),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"shopSkin"),War.WarShopWindow),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"shopEquip"),War.WarShopWindow),fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(PkgName.war,"shopRes"),War.WarShopWindow)}t.setPackageItemExtension=e}(UI||(UI={}));var UI;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._grid1=this.getChild("grid1").asButton,this._grid2=this.getChild("grid2").asButton,this._grid3=this.getChild("grid3").asButton,this._grid4=this.getChild("grid4").asButton,this._grid5=this.getChild("grid5").asButton,this._grids=[this._grid1,this._grid2,this._grid3,this._grid4,this._grid5],this._cardItems=[null,null,null,null,null],this._grid1.addClickListener(this._gridOnClick,this),this._grid2.addClickListener(this._gridOnClick,this),this._grid3.addClickListener(this._gridOnClick,this),this._grid4.addClickListener(this._gridOnClick,this),this._grid5.addClickListener(this._gridOnClick,this),Core.EventCenter.inst.addEventListener(GameEvent.BattleBeginEv,function(){fairygui.GTimers.inst.callDelay(1e3,function(){this.displayObject.cacheAsBitmap=!0},this)},this),Core.EventCenter.inst.addEventListener(GameEvent.BattleEndEv,function(){this.displayObject.cacheAsBitmap=!1},this)},e.prototype.clear=function(){this.dataProvider=null,this.itemBuilder=null,this._choiceCardCtrl=null,this._cardItems.forEach(function(t){t&&t.parent&&(t.unwatch(),t.parent.removeChild(t,!0))}),this._cardItems=[null,null,null,null,null]},e.prototype.refresh=function(t){void 0===t&&(t=!1);for(var e=0;e<this._cardItems.length;e++){var i=this.dataProvider.providerHandItemData(e),r=this.getItem(e);!t&&r&&i&&r.cardObj==i||this.setItem(e,i)}},e.prototype._gridOnClick=function(t){Core.ViewManager.inst.open(ViewName.choiceFightCard,this._choiceCardCtrl,this)},e.prototype.fireClick=function(){this._gridOnClick(null)},Object.defineProperty(e.prototype,"choiceCardCtrl",{get:function(){return this._choiceCardCtrl},set:function(t){this.disabled=!1,this._choiceCardCtrl=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disabled",{set:function(t){this._disabled=t,this._grids.forEach(function(e){e.disabled=t})},enumerable:!0,configurable:!0}),e.prototype.setItem=function(t,e){if(!this.itemBuilder)return void console.debug("HandCardGrid addItem no itemBuilder");if(0>t||t>=this._cardItems.length)return void console.debug("HandCardGrid addItem error idx %d",t);var i=this._cardItems[t];if(i&&i.parent&&(i.unwatch(),i.parent.removeChild(i,!0)),e){var r=this.itemBuilder.buildHandItem(t,e);r.x=this._grids[t].x,r.y=this._grids[t].y,r.inHandPoint=new egret.Point(r.x,r.y),this._cardItems[t]=r,this.addChild(r),r.watch()}else this._cardItems[t]=null},Object.defineProperty(e.prototype,"itemNum",{get:function(){return this._cardItems.length},enumerable:!0,configurable:!0}),e.prototype.getItem=function(t){return 0>t||t>=this._cardItems.length?(console.debug("HandCardGrid getItem error idx %d",t),null):this._cardItems[t]},e.prototype.getGrid=function(t){return 0>t||t>=this._grids.length?null:this._grids[t]},e.prototype.getGuideClickNode=function(){var t=this,e=new fairygui.GGraph;return e.graphics.clear(),e.graphics.beginFill(Core.TextColors.white,0),e.graphics.drawRect(0,0,this.width,this.height),e.graphics.endFill(),e.width=this.width,e.height=this.height,this.addChildAt(e,0),e.once(egret.TouchEvent.TOUCH_TAP,function(){t.removeChild(e,!0),t._grids[0].dispatchEventWith(egret.TouchEvent.TOUCH_TAP)},this),e},e}(fairygui.GComponent);t.HandCardGrid=e,__reflect(e.prototype,"UI.HandCardGrid")}(UI||(UI={}));var UI;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._bar=this.getChild("bar").asLoader,this._bar.mask=new egret.Rectangle(0,0,this._bar.width,this._bar.height);var i=this.getChild("bar2");i&&(this._bar2=i.asLoader,this._bar2.mask=new egret.Rectangle(0,0,this._bar2.width,this._bar2.height)),this._progressAniResolve=null},Object.defineProperty(e.prototype,"bar",{get:function(){return this._bar},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ba2",{get:function(){return this._bar2?this._bar2:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"__icon",{set:function(t){this._icon=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{set:function(t){this.setProgress(t,100)},enumerable:!0,configurable:!0}),e.prototype.setProgress=function(t,e){var i=this._bar.mask;0==e?i.width=this._bar.width:(i.width=this._bar.width*(t/e),i.width=i.width>this._bar.width?this._bar.width:i.width),this._bar.mask=i},e.prototype.setProgress2=function(t,e){if(this._bar2){var i=this._bar2.mask;0==e?i.width=this._bar2.width:(i.width=this._bar2.width*(t/e),i.width=i.width>this._bar2.width?this._bar2.width:i.width),this._bar2.mask=i}},e.prototype.doProgressAnimation=function(t,e,i,r){return __awaiter(this,void 0,void 0,function(){var n,o,s=this;
return __generator(this,function(a){switch(a.label){case 0:return this.setProgress(t,i),0==i?[2]:(n=this._bar.mask,o=this._bar.width*(e/i),o=o>this._bar.width?this._bar.width:o,[4,new Promise(function(t){s._progressAniResolve=t,egret.Tween.get(n,{onChange:function(){s._bar.mask=n,s._icon&&(s._icon.x=s._bar.mask.width+62),r&&r(s._bar.mask.width/s._bar.width*i)},onChangeObj:s}).to({width:o},1e3).call(function(){s._progressAniResolve=null,t()},s)})]);case 1:return a.sent(),[2]}})})},e.prototype.stopProgressAnimation=function(){this._progressAniResolve&&(this._progressAniResolve(),this._progressAniResolve=null),egret.Tween.removeTweens(this._bar.mask)},e}(fairygui.GComponent);t.MaskProgressBar=e,__reflect(e.prototype,"UI.MaskProgressBar")}(UI||(UI={}));var UI;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._upTrans=this.getTransition("win"),this._downTrans=this.getTransition("lose"),this._starImg=this.getChild("star").asLoader},e.prototype.playStarUp=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){t._upTrans.play(function(){e()},t)})];case 1:return e.sent(),[2]}})})},e.prototype.playStarDown=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){t._downTrans.play(function(){e()},t)})];case 1:return e.sent(),[2]}})})},e.prototype.show=function(){this.visible=!0,this.alpha=1,this._starImg.visible=!0,this._starImg.alpha=1},e.prototype.hide=function(){this.visible=!1,this.alpha=0,this._starImg.visible=!1,this._starImg.alpha=0},e}(fairygui.GComponent);t.StarCom=e,__reflect(e.prototype,"UI.StarCom");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._stars=new Collection.Dictionary,this.initStars(),this.initRankUI()},e.prototype.initStars=function(){"pvpRankBanner0"==this.packageItem.name?this._starCnt=0:"pvpRankBanner1"==this.packageItem.name?this._starCnt=1:"pvpRankBanner2"==this.packageItem.name?this._starCnt=2:"pvpRankBanner3"==this.packageItem.name?this._starCnt=3:"pvpRankBanner4"==this.packageItem.name?this._starCnt=4:this._starCnt=5;for(var t=1;t<=this._starCnt;t++){var e=this.getChild("star"+t).asCom;e.hide(),this._stars.setValue(t,e)}},e.prototype.initRankUI=function(){this._rankIcon=this.getChild("rankIcon").asLoader,this._pvpTitleText=this.getChild("pvpTitleText").asTextField},Object.defineProperty(e.prototype,"starCnt",{get:function(){return this.starCnt},enumerable:!0,configurable:!0}),e.prototype.refresh=function(t,e){var i=Pvp.Config.inst.getPvpTeam(t);this._rankIcon.url="common_rank"+i+"_png",this._pvpTitleText.text=Pvp.Config.inst.getPvpTitle(t);for(var r=1,n=1;e>=n;n++,r++){var o=this._stars.getValue(n);o&&o.show()}for(var n=r;n<=this._starCnt;n++)this._stars.getValue(n).hide()},e.prototype.playStarUpAnimation=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return(e=this._stars.getValue(t))?(e.show(),[4,e.playStarUp()]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},e.prototype.playStarDownAnimation=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return(e=this._stars.getValue(t))?(e.show(),[4,e.playStarDown()]):[3,2];case 1:i.sent(),e.hide(),i.label=2;case 2:return[2]}})})},e.prototype.show=function(){this.visible=!0,this.alpha=1},e.prototype.hide=function(){this.visible=!1,this.alpha=0},e}(fairygui.GComponent);t.BannerCom=i,__reflect(i.prototype,"UI.BannerCom");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initStars=function(){var t=this.getChild("star1").asCom;this._stars.setValue(1,t),this._starCnt=1,this._starCntText=this.getChild("starText").asTextField},e.prototype.initRankUI=function(){this._pvpTitle=this.getChild("pvpTitleText").asTextField},e.prototype.refresh=function(t,e){this._curStarCnt=e,this._starCntText.text=""+e,this._pvpTitle.text=Core.StringUtils.TEXT(60018)},e.prototype.playStarUpAnimation=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,t.prototype.playStarUpAnimation.call(this,1)];case 1:return e.sent(),this.refresh(0,this._curStarCnt+1),[2]}})})},e.prototype.playStarDownAnimation=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,t.prototype.playStarDownAnimation.call(this,1)];case 1:return e.sent(),this.refresh(0,this._curStarCnt-1),[2]}})})},e}(i);t.MaxBannerCom=r,__reflect(r.prototype,"UI.MaxBannerCom");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._starCntToBannerCom=new Collection.Dictionary;for(var i=0;5>=i;i++){var r=this.getChild("star"+i).asCom;this._starCntToBannerCom.setValue(i,r),r.hide()}this._maxBannerCom=this.getChild("starMax").asCom,this._maxBannerCom.hide(),this._curBannerCom=null},e.prototype.refresh=function(t){this._curBannerCom&&this._curBannerCom.hide();var e=Pvp.PvpMgr.inst.getPvpLevel(t);if(e>=Pvp.Config.inst.getMaxPvpLevel())this._curBannerCom=this._maxBannerCom;else{var i=Pvp.Config.inst.getPvpMaxStar(e);this._curBannerCom=this._starCntToBannerCom.getValue(i)}this._curBannerCom&&(this._curBannerCom.show(),this._curBannerCom.refresh(e,Pvp.PvpMgr.inst.getPvpStarCnt(t)))},Object.defineProperty(e.prototype,"curBannerCom",{get:function(){return this._curBannerCom},enumerable:!0,configurable:!0}),e.prototype.show=function(){this.visible=!0,this.alpha=1},e.prototype.hide=function(){this.visible=!1,this.alpha=0},e}(fairygui.GComponent);t.PvpRankBannerCom=n,__reflect(n.prototype,"UI.PvpRankBannerCom")}(UI||(UI={}));var UI;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.setup_beforeAdd=function(t){e.prototype.setup_beforeAdd.call(this,t,0),this._resType=parseInt(this.data),Player.inst.addEventListener(Player.ResUpdateEvt,this._onResUpdate,this),this.addClickListener(this._onClick,this),this._onResUpdate()},i.prototype._onResUpdate=function(){var t=Player.inst.getResource(this._resType);0>=t?(t=0,this.titleColor=Core.TextColors.red):this.titleColor=Core.TextColors.green,this.title=t.toString()},i.prototype._onClick=function(){i._exchangeWnd||(i._exchangeWnd=fairygui.UIPackage.createObject(PkgName.common,"exchangeRes",t.ExchangeResWnd)),i._exchangeWnd.show(this._resType,this)},i}(fairygui.GButton);t.ResBarBtn=e,__reflect(e.prototype,"UI.ResBarBtn")}(UI||(UI={}));var UI;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._defColor=this.titleColor},e.prototype.setData=function(t){this.icon=Utils.resType2Icon(t.Type),t.Amount<0?(this.title="x"+-t.Amount,this.titleColor=Core.TextColors.red):(this.title="x"+t.Amount,this.titleColor=this._defColor),this.width=this._titleObject.x+this._titleObject.width},e}(fairygui.GLabel);t.ResLabel=e,__reflect(e.prototype,"UI.ResLabel")}(UI||(UI={}));var UI;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._list=this.getChild("list").asList},e.prototype.setData=function(t){var e=this;t&&(t.sort(function(t,e){return Utils.resTypePriority(t.Type)<Utils.resTypePriority(e.Type)?-1:1}),this._list.removeChildren(),t.forEach(function(t){if(t.Type!=ResType.T_SCORE){var i=e._list.addItem();i.setData(t)}}),this._list.resizeToFit(),this.width=this._list.width*this._list.scaleX)},e}(fairygui.GComponent);t.ResList=e,__reflect(e.prototype,"UI.ResList")}(UI||(UI={}));var UI;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._resList=this.getChild("resList")},e.prototype.setData=function(t){t&&(this._resList.setData(t),this.width=this._resList.x+this._resList.width)},e}(fairygui.GLabel);t.RewardResBar=e,__reflect(e.prototype,"UI.RewardResBar")}(UI||(UI={}));var UI;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._text=this.getChild("text").asTextField,this._text.textParser=Core.StringUtils.parseColorText},e.prototype.show=function(t){var e=this;return this._text.text=t,this.y=fairygui.GRoot.inst.height/2,this.x=fairygui.GRoot.inst.width/2-this.width/2,new Promise(function(t){e.getTransition("t0").play(function(){t()},e)})},e}(fairygui.GComponent);t.TipsCom=e,__reflect(e.prototype,"UI.TipsCom",["Core.ITipsCom"])}(UI||(UI={}));var Diy;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.nextNum=function(t){var e=this;return new Promise(function(i){var r=e._numSize/t,n=e.displayObject.scrollRect.y,o=0;fairygui.GTimers.inst.add(25,t,function(){o++;var s=e.displayObject.scrollRect;o>=t?(s.y=n+e._numSize,e.displayObject.scrollRect=s,i()):(s.y+=r,e.displayObject.scrollRect=s)},e)})},e.prototype.playEffect=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,r,r,r,r;return __generator(this,function(a){switch(a.label){case 0:for(this._numSize=t.height,i=this._numSize*(20+e+1),this.width=this._numSize,this.height=i,r=0;20+e+1>r;r++)n=r%10,o=new fairygui.GTextField,o.width=this._numSize,o.height=this._numSize,o.text=n+"",o.fontSize=t.fontSize,o.color=Core.TextColors.white,o.y=r*this._numSize,o.font=t.font,this.addChild(o);this.x=t.x,this.y=t.y,t.parent.addChild(this),this.displayObject.scrollRect=new egret.Rectangle(0,0,this._numSize,this._numSize),s=14,r=0,a.label=1;case 1:return 10>r?[4,this.nextNum(s)]:[3,4];case 2:a.sent(),s--,a.label=3;case 3:return r++,[3,1];case 4:r=0,a.label=5;case 5:return 5>r?[4,this.nextNum(s)]:[3,8];case 6:a.sent(),a.label=7;case 7:return r++,[3,5];case 8:r=0,a.label=9;case 9:return 5>r?[4,this.nextNum(s)]:[3,12];case 10:a.sent(),s++,a.label=11;case 11:return r++,[3,9];case 12:r=0,a.label=13;case 13:return e>r?(s+=2,s>14&&(s=14),[4,this.nextNum(s)]):[3,16];case 14:a.sent(),a.label=15;case 15:return r++,[3,13];case 16:return this.parent&&this.parent.removeChild(this),[2]}})})},e}(fairygui.GComponent);t.DiyScrollNum=e,__reflect(e.prototype,"Diy.DiyScrollNum")}(Diy||(Diy={}));var Diy;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.modal=!0,this._levelTxt=this.getChild("levelTxt").asTextField,this._levelList=this.getChild("levelList").asList,this._skillDescTxt=this.getChild("skillDescTxt").asTextField,this._skillDescTxt.textParser=Core.StringUtils.parseColorText,this._pvpLevelCtrl=this.getController("pvpLevel"),this.getChild("preListBtn").asButton.addClickListener(this._onPreSkillList,this),this.getChild("nextListBtn").asButton.addClickListener(this._onNextSkillList,this),this.getChild("confirmBtn").asButton.addClickListener(this._onConfirm,this),this.getChild("cancelBtn").asButton.addClickListener(this._onCancel,this),this._pvpLevelCtrl.addEventListener(fairygui.StateChangeEvent.CHANGED,this._onPvpLevelChanged,this),this._pvpLevelCtrl.addAction(SoundMgr.inst.playSoundAction("page_mp3",!0))},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a,u;return __generator(this,function(h){switch(h.label){case 0:for(this._skillIdx=i[0],this._curViewLevel=1,r=i[1],n=i[2],o=Pvp.PvpMgr.inst.getPvpLevel(),this._skillDescTxt.text="",s=1;o>=s;s++)a=t.DiyMgr.inst.getLevelDiySkills(s),u=this._levelList.addItem().asCom.getChild("list").asList,this._pvpLevelCtrl.addPage(s.toString()),this._renderSkillList(u,r,n,a);return this._updateLevelText(),[4,e.prototype.open.apply(this,i)];case 1:return h.sent(),this.x=this.parent.width/2-this.width/2+10,this.y=402,Core.PopUpUtils.addPopUp(this,3),[2]}})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,Core.PopUpUtils.removePopUp(this,4)];case 1:return i.sent(),e.prototype.close.apply(this,t),this._levelList.removeChildren(),this._pvpLevelCtrl.clearPages(),[2]}})})},i.prototype._updateLevelText=function(){this._levelTxt.text=Core.StringUtils.getZhNumber(this._curViewLevel)+"阶"},i.prototype._is2SkillBan=function(t,e){if(t==e)return!0;var i=Data.diy.get(t),r=Data.diy.get(e);if(!i||!r)return!1;for(var n=0;n<i.ban.length;n++)if(e==i.ban[n])return!0;for(var n=0;n<r.ban.length;n++)if(t==r.ban[n])return!0;return i.min_single>r.max_single?!0:i.min_total>r.max_total?!0:r.min_single>i.max_single?!0:r.min_total>i.max_total?!0:!1},i.prototype._renderSkillList=function(e,i,r,n){var o=this;n.forEach(function(n){var s=e.addItem().asButton;s.data=n;var a=n.__id__;s.title=t.DiyMgr.inst.getDiySkillName(a),a==i?(s.selected=!0,o._curDiySkillId=s.data.__id__,o._skillDescTxt.text=t.DiyMgr.inst.getDiySkillDesc(o._curDiySkillId)):a==r?(s.touchable=!1,s.getController("button").selectedPage="otherSelected"):r&&0!=r&&o._is2SkillBan(a,r)&&(s.disabled=!0)}),e.addEventListener(fairygui.ItemEvent.CLICK,this._onClickSkillItem,this)},i.prototype._onClickSkillItem=function(e){var i=e.itemObject.asButton;this._curDiySkillId=i.data.__id__,this._skillDescTxt.text=t.DiyMgr.inst.getDiySkillDesc(this._curDiySkillId)},i.prototype._onCancel=function(){Core.ViewManager.inst.closeView(this)},i.prototype._onPreSkillList=function(){this._curViewLevel<=1||(this._curViewLevel-=1,this._levelList.scrollToView(this._curViewLevel-1,!0))},i.prototype._onNextSkillList=function(){this._curViewLevel>=this._levelList.numItems||(this._curViewLevel+=1,this._levelList.scrollToView(this._curViewLevel-1,!0))},i.prototype._onPvpLevelChanged=function(){this._curViewLevel=parseInt(this._pvpLevelCtrl.selectedPage),this._updateLevelText()},i.prototype._onConfirm=function(){Core.ViewManager.inst.getView(ViewName.diy).onConfirmChoiceSkill(this._skillIdx,this._curDiySkillId),Core.ViewManager.inst.closeView(this)},i}(Core.BaseWindow);t.DiySkillPanel=e,__reflect(e.prototype,"Diy.DiySkillPanel")}(Diy||(Diy={}));var Diy;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._uploadImgData="",t}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.adjust(this.getChild("bg")),this._weaponCtrl=this.getController("weapon"),this._wineAmountTxt=this.getChild("wineAmountTxt").asTextField,this._bookAmountTxt=this.getChild("bookAmountTxt").asTextField,this._cardImg=this.getChild("cardImg").asLoader,this._uploadImgBtn=this.getChild("uploadImgBtn").asButton,this._nameInput=this.getChild("nameInput").asLabel,this._addSkillBtn1=this.getChild("addSkillBtn1").asButton,this._addSkillBtn2=this.getChild("addSkillBtn2").asButton,this._upNumText=this.getChild("upNumText").asTextField,this._downNumText=this.getChild("downNumText").asTextField,this._leftNumText=this.getChild("leftNumText").asTextField,this._rightNumText=this.getChild("rightNumText").asTextField,this._upNumOffset=this.getChild("upNumOffset").asTextField,this._downNumOffset=this.getChild("downNumOffset").asTextField,this._leftNumOffset=this.getChild("leftNumOffset").asTextField,this._rightNumOffset=this.getChild("rightNumOffset").asTextField,this._singleNumText=this.getChild("singleNumText").asTextField,this._totalNumText=this.getChild("totalNumText").asTextField,this._saveBtn=this.getChild("saveBtn").asButton,this._addSkillBtn1.getChild("title").asTextField.textParser=Core.StringUtils.parseColorText,this._addSkillBtn2.getChild("title").asTextField.textParser=Core.StringUtils.parseColorText,this.getChild("backBtn").asButton.addClickListener(this._onBack,this),this.getChild("confirmBtn").asButton.addClickListener(this._onConfirm,this),this._uploadImgBtn.addClickListener(this._onUpLoadImg,this),this._saveBtn.addClickListener(this._onSave,this),this._addSkillBtn1.addClickListener(this._onChoiceSkill1,this),this._addSkillBtn2.addClickListener(this._onChoiceSkill2,this)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.open.apply(this,t),this._reset(),[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),this._uploadImgData=null,[2]})})},i.prototype._reset=function(){this._diySkillId1=0,this._diySkillId2=0,this._needWine1=0,this._needWine2=0,this._needBook1=0,this._needBook2=0,this._curCardData=null,this._updateNeedResTxt(),this._saveBtn.disabled=!0,this._visibleNumOffset(!1),this._uploadImgBtn.touchable=!0,this._updateChoiceSkill(),this._nameInput.title="",this._updateNumText(0,0,0,0),this._addSkillBtn1.touchable=!0,this._addSkillBtn2.touchable=!0,this._uploadImgBtn.touchable=!0,this._nameInput.touchable=!0},i.prototype._visibleNumOffset=function(t){this._upNumOffset.visible=t,this._downNumOffset.visible=t,this._leftNumOffset.visible=t,this._rightNumOffset.visible=t},i.prototype._updateChoiceSkill=function(){var e=0,i=0,r=0,n=0,o=function(o,s){if(s>0){var a=Data.diy.get(s);0>=e?(e=a.min_single,i=a.max_single,r=a.min_total,n=a.max_total):(e=e>a.min_single?e:a.min_single,i=i<a.max_single?i:a.max_single,r=r>a.min_total?r:a.min_total,n=n<a.max_total?n:a.max_total),o.title=t.DiyMgr.inst.getDiySkillName(s),o.getChild("icon").visible=!1}else o.title="",o.getChild("icon").visible=!0};o(this._addSkillBtn1,this._diySkillId1),o(this._addSkillBtn2,this._diySkillId2),this._updateNumRange(e,i,r,n)},i.prototype._updateNumText=function(t,e,i,r){this._upNumText.text=t>0?t.toString():"",this._downNumText.text=e>0?e.toString():"",this._leftNumText.text=i>0?i.toString():"",this._rightNumText.text=r>0?r.toString():""},i.prototype._updateNumRange=function(t,e,i,r){this._singleNumText.text=t+" ~ "+e,this._totalNumText.text=i+" ~ "+r},i.prototype._updateNeedResTxt=function(){this._wineAmountTxt.text="x"+(this._needWine1+this._needWine2),this._bookAmountTxt.text="x"+(this._needBook1+this._needBook2)},i.prototype._onChoiceSkill1=function(){this._onChoiceSkill(1)},i.prototype._onChoiceSkill2=function(){this._onChoiceSkill(2)},i.prototype._onChoiceSkill=function(t){if(1==t||2==t){var e=Core.ViewManager.inst,i=0,r=0;1==t?(r=this._diySkillId2,i=this._diySkillId1):(r=this._diySkillId1,i=this._diySkillId2),e.open(ViewName.diySkillPanel,t,i,r)}},i.prototype._onSave=function(){this._reset(),this._saveBtn.disabled=!0},i.prototype._onUpLoadImg=function(){Core.TipsUtils.showTipsFromCenter("更换形象功能尚未开放！")},i.prototype._selectedImgHandler=function(t,e,i){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(r){switch(r.label){case 0:return e=t,[4,t._loadSelectedImgData(i)];case 1:return e._uploadImgData=r.sent(),[2]}})})},i.prototype._loadSelectedImgData=function(t){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(i){switch(i.label){case 0:return[4,new Promise(function(i){getImageData(t,function(t,r){egret.BitmapData.create("arraybuffer",r,function(t){var i=e._cardImg.displayObject;i.$setBitmapData(t)}),i(egret.Base64Util.encode(r))},e)})];case 1:return[2,i.sent()]}})})},i.prototype._checkCondition=function(){return this._needBook1+this._needBook2>Player.inst.getResource(ResType.T_BOOK)?(Core.TipsUtils.showTipsFromCenter("你的书不够"),!1):this._needWine1+this._needWine2>Player.inst.getResource(ResType.T_WINE)?(Core.TipsUtils.showTipsFromCenter("你的酒不够"),!1):this._nameInput.text&&0!=this._nameInput.text.trim().length?this._nameInput.text.trim().length>=8?(Core.TipsUtils.showTipsFromCenter("你的名字太长了"),!1):!this._diySkillId1||this._diySkillId1<=0||!this._diySkillId2||this._diySkillId2<=0?(Core.TipsUtils.showTipsFromCenter("请选好两个技能"),!1):!0:(Core.TipsUtils.showTipsFromCenter("请输入名字"),!1)},i.prototype._playScrollNumEffect=function(e,i){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return r=new t.DiyScrollNum,[4,r.playEffect(e,i)];case 1:return n.sent(),e.text=i.toString(),[2]}})})},i.prototype._playDiyDoneEffect=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return this._updateNumText(0,0,0,0),Core.MaskUtils.showTransMask(),e=[],e.push(this._playScrollNumEffect(this._upNumText,t.MinUp)),e.push(this._playScrollNumEffect(this._downNumText,t.MinDown)),e.push(this._playScrollNumEffect(this._leftNumText,t.MinLeft)),e.push(this._playScrollNumEffect(this._rightNumText,t.MinRight)),[4,Promise.all(e)];case 1:return i.sent(),this._visibleNumOffset(!0),Core.MaskUtils.hideTransMask(),[2]}})})},i.prototype._doDiy=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return this._checkCondition()?this._curCardData?[4,t.DiyMgr.inst.doAgainDiy(this._curCardData.CardId)]:[3,2]:[2];case 1:return e=i.sent(),[3,4];case 2:return[4,t.DiyMgr.inst.doDiy(this._nameInput.text.trim(),this._diySkillId1,this._diySkillId2,this._weaponCtrl.selectedPage,this._uploadImgData)];case 3:e=i.sent(),i.label=4;case 4:return e?(this._curCardData=e,[4,this._playDiyDoneEffect(e)]):[2];case 5:return i.sent(),this._saveBtn.disabled=!1,this._addSkillBtn1.touchable=!1,this._addSkillBtn2.touchable=!1,this._uploadImgBtn.touchable=!1,this._nameInput.touchable=!1,[2]}})})},i.prototype._onConfirm=function(){Core.TipsUtils.confirm("are you 确定 ?",this._doDiy,null,this)},i.prototype.onConfirmChoiceSkill=function(t,e){var i=Data.diy.get(e);if(null!=i){if(1==t)this._diySkillId1=e,this._needWine1=i.wine,this._needBook1=i.book;else{if(2!=t)return;this._diySkillId2=e,this._needWine2=i.wine,this._needBook2=i.book}this._updateChoiceSkill(),this._updateNeedResTxt()}},i.prototype._onBack=function(){Core.ViewManager.inst.closeView(this)},i}(Core.BaseView);t.DiyView=e,__reflect(e.prototype,"Diy.DiyView")}(Diy||(Diy={}));var Equip;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(t){this._equipIcon=this.getChild("equipIcon").asLoader,this._cardIcon=this.getChild("cardIcon").asLoader,this._cardIconBg=this.getChild("cardIconBg").asLoader,this._cardIcon.visible=!1,this._cardIconBg.visible=!1},e.prototype.setEquip=function(t){this._equipData=t,this._equipIcon.url=this._equipData.equipIcon,this._equipData.hasEquip?(this.grayed=!1,0!=this._equipData.ownerCardID?(this._cardIcon.visible=!0,this._cardIconBg.visible=!0,this._cardIcon.url="avatar_"+this._equipData.ownerCardID+"_png"):(this._cardIcon.visible=!1,this._cardIconBg.visible=!1)):(this.grayed=!0,this._cardIcon.visible=!1,this._cardIconBg.visible=!1)},Object.defineProperty(e.prototype,"equip",{get:function(){return this._equipData},enumerable:!0,configurable:!0}),e}(fairygui.GComponent);t.EquipItem=e,__reflect(e.prototype,"Equip.EquipItem");var i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.initUI=function(){var t=this;i.prototype.initUI.call(this),this.center(),this.modal=!0,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._closeBtn.addClickListener(function(){Core.ViewManager.inst.closeView(t)},this),this._equipList=this.contentPane.getChild("equipList").asList,this._equipList.itemClass=e,this._equipList.addEventListener(fairygui.ItemEvent.CLICK,this._onEquipItem,this)},r.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return i.prototype.open.apply(this,t),this._refreshEquipList(),[2]})})},r.prototype._refreshEquipList=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r=this;return __generator(this,function(n){return this._equipList.removeChildrenToPool(),e=t.EquipMgr.inst.myEquip,i=t.EquipMgr.inst.myEquipIds,i.forEach(function(t){var i=r._equipList.addItemFromPool().asCom;i.setEquip(e.getValue(t))}),this.contentPane.getChild("emptyHintText").visible=e.size()<=0,[2]})})},r.prototype._onEquipItem=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=t.itemObject,Core.ViewManager.inst.open(ViewName.equipItemWnd,e.equip),[2]})})},r.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return i.prototype.close.apply(this,t),[2]})})},r}(Core.BaseWindow);t.EquipBagWnd=i,__reflect(i.prototype,"Equip.EquipBagWnd")}(Equip||(Equip={}));var Equip;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.toTopLayer(),this.center(),this.adjust(this.contentPane.getChild("closeBg")),this.contentPane.getChild("closeBg").addClickListener(function(){Core.ViewManager.inst.closeView(e)},this),this._equipList=this.contentPane.getChild("list").asList,this._equipList.touchable=!0,this._equipCom=this._equipList.addItemFromPool().asCom,this._equipDesc=this._equipCom.getChild("desc").asRichTextField,this._equipDesc.addEventListener(egret.TextEvent.LINK,htmlClickCallback,this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){return t.prototype.open.apply(this,e),this.toTopLayer(),i=e[0],this._refresh(i),[2]})})},e.prototype._refresh=function(t){this._equipCom.getChild("icon").asLoader.url=t.equipIcon,this._equipCom.getChild("name").asTextField.text=t.equipName,this._equipDesc.text=t.getSkillDesc()},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e}(Core.BaseWindow);t.EquipItemWnd=e,__reflect(e.prototype,"Equip.EquipItemWnd")}(Equip||(Equip={}));var Equip;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var i=this;e.prototype.initUI.call(this),this.center(),this.modal=!0,this._newEquipCom=this.contentPane.getChild("newEquip").asCom,this._newEquipIcon=this._newEquipCom.getChild("equipIcon").asLoader,this._newEquipName=this.contentPane.getChild("newEquipName").asTextField,this._newEquipDesc=this.contentPane.getChild("newEquipDesc").asRichTextField,this._nowEquipCom=this.contentPane.getChild("nowEquip").asCom,this._nowEquipIcon=this._nowEquipCom.getChild("equipIcon").asLoader,this._nowEquipName=this.contentPane.getChild("nowEquipName").asTextField,this._nowEquipDesc=this.contentPane.getChild("nowEquipDesc").asRichTextField,this._newEquipDesc.asRichTextField.addEventListener(egret.TextEvent.LINK,htmlClickCallback,this),this._nowEquipDesc.asRichTextField.addEventListener(egret.TextEvent.LINK,htmlClickCallback,this),this._confirmBtn=this.contentPane.getChild("confirmBtn").asButton,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._closeBtn.addClickListener(function(){Core.ViewManager.inst.closeView(i)},this),this._confirmBtn.addClickListener(this._onConfirmBtn,this),this._equipList=this.contentPane.getChild("equipList").asList,this._equipList.itemClass=t.EquipItem,this._equipList.addEventListener(fairygui.ItemEvent.CLICK,this._onEquipItem,this),this._nowEquipCom.getChild("cardIcon").visible=!1,this._nowEquipCom.getChild("cardIconBg").visible=!1,this._newEquipCom.getChild("cardIcon").visible=!1,this._newEquipCom.getChild("cardIconBg").visible=!1},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){return e.prototype.open.apply(this,i),this._setNewEquip(null),r=t.EquipMgr.inst.getEquipData(i[0]),this._cardID=i[1],this._setNowEquip(r),this._refreshEquipList(),this._setConfirmBtn(!1),[2]})})},i.prototype._refreshEquipList=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n;return __generator(this,function(o){for(this._equipList.removeChildrenToPool(),e=t.EquipMgr.inst.myEquipIds,i=t.EquipMgr.inst.myEquip,r=0;r<e.length;r++)n=this._equipList.addItemFromPool().asCom,n.setEquip(i.getValue(e[r])),n.getController("button").selectedIndex=0;return this.contentPane.getChild("emptyHintText").visible=i.size()<=0,[2]})})},i.prototype._setNewEquip=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._newEquip=t,null==this._newEquip?(this._newEquipDesc.text="",this._newEquipName.text="",this._newEquipIcon.url=""):(this._newEquipDesc.text=this._nowEquip.getSkillDesc(),this._newEquipName.text=this._newEquip.equipName),[2]})})},i.prototype._setNowEquip=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._nowEquip=t,null==this._nowEquip?(this._nowEquipDesc.text="",this._nowEquipName.text=Core.StringUtils.format(Core.StringUtils.TEXT(60269)),this._nowEquipIcon.url=""):(this._nowEquipDesc.text=this._nowEquip.getSkillDesc(),this._nowEquipName.text=this._nowEquip.equipName,this._nowEquipIcon.url=this._nowEquip.equipIcon),[2]})})},i.prototype._setConfirmBtn=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._confirmBtn.touchable=t,this._confirmBtn.grayed=!t,[2]})})},i.prototype._onEquipItem=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=t.itemObject,this._seletCom&&(this._seletCom.getController("button").selectedIndex=0),e.getController("button").selectedIndex=3,this._seletCom=e,this._nowEquip==e.equip?this._setConfirmBtn(!1):this._setConfirmBtn(!0),this._newEquip=e.equip,this._newEquipCom.getChild("equipIcon").asLoader.url=e.equip.equipIcon,this._newEquipName.text=e.equip.equipName,this._newEquipDesc.text=this._newEquip.getSkillDesc(),[2]})})},i.prototype._onConfirmBtn=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){return 0!=this._newEquip.ownerCardID?(t=CardPool.CardPoolMgr.inst.getCollectCard(this._newEquip.ownerCardID),null!=this._nowEquip?(this._jade=40,Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70185),this._newEquip.equipName,t.name,40),this._confirm,null,this)):(this._jade=20,Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70184),this._newEquip.equipName,t.name,20),this._confirm,null,this))):null!=this._nowEquip?(this._jade=20,Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70183),20),this._confirm,null,this)):(this._jade=0,e=CardPool.CardPoolMgr.inst.getCollectCard(this._cardID),Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70187),this._newEquip.equipName,e.name),this._confirm,null,this)),[2]})})},i.prototype._confirm=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r;
return __generator(this,function(n){switch(n.label){case 0:return Player.inst.hasEnoughJade(this._jade)?(t={EquipID:this._newEquip.equipID,OwnerCardID:this._cardID},[4,Net.rpcCall(pb.MessageID.C2S_WEAR_EQUIP,pb.Equip.encode(t))]):(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70119)),[2]);case 1:return e=n.sent(),0==e.errcode&&(0!=this._newEquip.ownerCardID&&(i=CardPool.CardPoolMgr.inst.getCollectCard(this._newEquip.ownerCardID),i.equip=""),this._newEquip.ownerCardID=this._cardID,null!=this._nowEquip&&(this._nowEquip.ownerCardID=0),r=CardPool.CardPoolMgr.inst.getCollectCard(this._cardID),r.equip=this._newEquip.equipID,this._nowEquip=this._newEquip,Core.ViewManager.inst.closeView(this)),[2]}})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseWindow);t.EquipSwitchWnd=e,__reflect(e.prototype,"Equip.EquipSwitchWnd")}(Equip||(Equip={}));var Guide;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this._myParent=Core.LayerManager.inst.topLayer,this.adjust(this.getChild("bg")),this._btnWei=this.getChild("btnWei").asButton,this._btnShu=this.getChild("btnShu").asButton,this._btnWu=this.getChild("btnWu").asButton,this._btnWei.addClickListener(this._onChooseWei,this),this._btnShu.addClickListener(this._onChooseShu,this),this._btnWu.addClickListener(this._onChooseWu,this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.open.apply(this,e),this._callback=e[0],[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),this._callback=null,[2]})})},e.prototype._onChooseWei=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._callback&&this._callback(Camp.WEI),Core.ViewManager.inst.closeView(this),this._onCreateRole(),[2]})})},e.prototype._onChooseShu=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._callback&&this._callback(Camp.SHU),Core.ViewManager.inst.closeView(this),this._onCreateRole(),[2]})})},e.prototype._onChooseWu=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._callback&&this._callback(Camp.WU),Core.ViewManager.inst.closeView(this),this._onCreateRole(),[2]})})},e.prototype._onCreateRole=function(){Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.ON_CREATE_ROLE,{userId:""+Player.inst.uid,userName:Player.inst.name,level:1,serverId:1,serverName:"commonServer"})},e}(Core.BaseView);t.GuideHome=e,__reflect(e.prototype,"Guide.GuideHome")}(Guide||(Guide={}));var Guide;!function(t){var e=function(){function t(t,e,i,r){this.x=t,this.y=e,this.w=i,this.h=r}return t}();__reflect(e.prototype,"Block");var i=function(t){function i(e,i){var r=t.call(this)||this;return r._bgs=[],r._deductRecs=[],r.width=e,r.height=i,r.touchEnabled=!1,r}return __extends(i,t),i.prototype.beginDraw=function(){this.removeAllChild()},i.prototype.fillColumn=function(t){var i=this;t.forEach(function(t){if(!(t.h<=0||t.w<=0)){for(var r=i._deductRecs.sort(function(t,e){return t.x-e.x}),n=[],o=!0,s=0,a=r;s<a.length;s++){var u=a[s];if(!(u.x>=t.x+t.w||u.x+u.width<=t.x||u.y>=t.y+t.h||u.y+u.height<=t.y)){u.x>t.x&&(o=!1,i.addBg(t.x,t.y,u.x-t.x,t.h),t.w-=u.x-t.x,t.x=u.x);var h=u.x+u.width-t.x;if(h>=t.w&&(h=t.w),n.push(new e(t.x,t.y,h,t.h)),t.w-=h,t.x+=h,t.w<=0)break}}t.w>0&&i.addBg(t.x,t.y,t.w,t.h),o&&n.length<=1||n.length>0&&i.fillRow(n)}})},i.prototype.fillRow=function(t){var i=this;t.forEach(function(t){if(!(t.h<=0||t.w<=0)){for(var r=i._deductRecs.sort(function(t,e){return t.y-e.y}),n=[],o=0,s=r;o<s.length;o++){var a=s[o];if(!(a.x>=t.x+t.w||a.x+a.width<=t.x||a.y>=t.y+t.h||a.y+a.height<=t.y)){a.y>t.y&&(i.addBg(t.x,t.y,t.w,a.y-t.y),t.h-=a.y-t.y,t.y=a.y);var u=a.y+a.height-t.y;if(u>=t.h&&(u=t.h),n.push(new e(t.x,t.y,t.w,u)),t.h-=u,t.y+=u,t.h<=0)break}}t.h>0&&i.addBg(t.x,t.y,t.w,t.h),n.length>0&&i.fillColumn(n)}})},i.prototype.endDraw=function(){try{this._deductRecs.length<=0?this.addBg(0,0,this.width,this.height):this.fillRow([new e(0,0,this.width,this.height)]),this._deductRecs=[]}catch(t){console.error("guide endDraw",t)}},i.prototype.draw=function(t){this._deductRecs.push(t)},i.prototype.destroy=function(){this.removeChildren(),this._bgs=[]},i.prototype.removeAllChild=function(){for(;this.numChildren;){var t=this.removeChildAt(0);this._bgs.push(t)}},i.prototype.addBg=function(t,e,i,r){var n;this._bgs.length?(n=this._bgs.pop(),n.graphics.clear()):n=new egret.Shape,n.graphics.beginFill(0,0),n.graphics.drawRect(t,e,i,r),n.graphics.endFill(),this.addChild(n)},i}(egret.Sprite);t.GuideMaskBackgroud=i,__reflect(i.prototype,"Guide.GuideMaskBackgroud")}(Guide||(Guide={}));var Guide;!function(t){var e=function(e){function i(){var i=e.call(this)||this;i.touchEnabled=!0;egret.MainContext.instance.stage;i.width=fairygui.GRoot.inst.getDesignStageWidth(),i.height=fairygui.GRoot.inst.getDesignStageHeight(),i.x=fairygui.GRoot.inst.width/2-i.width/2,i.y=fairygui.GRoot.inst.height/2-i.height/2,i._bg=new t.GuideMaskBackgroud(i.width,i.height),i.addChild(i._bg),i._touchMask1=new egret.Shape,i._touchMask1.touchEnabled=!0,i._touchMask1.visible=!1,i.addChild(i._touchMask1),i._textKuang=new egret.Bitmap(RES.getRes("guide_textKuang_png")),i._textKuang.visible=!1,i.addChild(i._textKuang);var r=new egret.Rectangle(30,26,i._textKuang.width-60,i._textKuang.height-52);i._textKuang.scale9Grid=r,i._textArrow=new egret.Bitmap(RES.getRes("guide_textArrow_png")),i._textArrow.visible=!1,i.addChild(i._textArrow),i._textBg=new egret.Bitmap(RES.getRes("guide_textBg_png")),i._textBg.visible=!1,i.addChild(i._textBg),i._dragCardArrow=fairygui.UIPackage.createObjectFromURL("ui://kzx2kelphyug0").asImage,i._dragCardArrow.setPivot(.5,1,!0);var n=RES.getRes("effect_click_mc_json"),o=RES.getRes("effect_click_tex_png"),s=new egret.MovieClipDataFactory(n,o),a=s.generateMovieClipData("click");return i._hand=new egret.MovieClip(a),i._hand.gotoAndStop(1),i._hand.touchEnabled=!1,i._hand.visible=!1,i.addChild(i._hand),i._txt=new egret.TextField,window.gameGlobal.isPC?(i._txt.size=35,i._txt.lineSpacing=5):(i._txt.size=23,i._txt.lineSpacing=4),i._txt.visible=!1,i._txt.textColor=Core.TextColors.black,window.gameGlobal.isMultiLan?LanguageMgr.inst.isChineseLocale()||(i._txt.wordWrap=!0):i._txt.fontFamily="AaKaiTi",i.addChild(i._txt),i}return __extends(i,e),i.prototype.show=function(){null==this.parent&&Core.LayerManager.inst.maskLayer.displayObject.addChild(this)},i.prototype.hide=function(){this.parent&&(this.touchEnabled=!0,this.parent.removeChild(this),this._touchMask1.visible=!1,this._textBg.visible=!1,this._textKuang.visible=!1,this._textArrow.visible=!1,this._textArrow.width=this._textArrow.texture.$sourceWidth,this._txt.visible=!1,this._dragCardArrow.visible=!1,this._hand.visible=!1,this._hand.gotoAndStop(1),egret.Tween.removeTweens(this._hand),this._hand.alpha=1,this._touchMask2&&(this.removeChild(this._touchMask2),this._touchMask2=null),this._dragCardArrow.parent&&this._dragCardArrow.parent.removeChild(this._dragCardArrow))},i.prototype._makeTouchMask=function(t){t.graphics.clear(),t.graphics.beginFill(Core.TextColors.white,0),t.graphics.drawRect(0,0,t.width,t.height),t.graphics.endFill()},i.prototype.caclMaskTarget=function(t,e){this._touchMask1.visible=!0;var i=t.localToRoot(0,0);i.x-=this.x,i.y-=this.y;var r=new egret.Rectangle(i.x-1,i.y-1,t.width+2,t.height+2);return this._bg.beginDraw(),e||(r=new egret.Rectangle(0,0,this.width,this.height)),this._bg.draw(r),this._bg.endDraw(),this._touchMask1.x=r.x,this._touchMask1.y=r.y,this._touchMask1.width=r.width,this._touchMask1.height=r.height,this._makeTouchMask(this._touchMask1),i},i.prototype.setTalkData=function(t,e,i,r,n,o){void 0===o&&(o=!0),this._textBg.visible=!0,this._textKuang.visible=!0,this._txt.visible=!0,this._bg.touchChildren=!1;var s;t?(s=this.caclMaskTarget(t,o),this._textArrow.visible=!0):(this._bg.beginDraw(),this._bg.endDraw());var a=320;if(window.gameGlobal.isPC&&(a=500),n&&n>0&&(a=n),this._txt.width=0/0,this._txt.height=0/0,this._txt.textFlow=Core.StringUtils.parseColorText(e),this._txt.width>a&&(this._txt.textFlow=[],this._txt.width=a,this._txt.textFlow=Core.StringUtils.parseColorText(e)),this._textBg.width=this._txt.width+30,this._textBg.height=this._txt.height+20,i&&r&&i>=0&&r>=0)this._textBg.x=i,this._textBg.y=r;else if(t){var u=40;window.gameGlobal.isPC&&(u=54),this._textBg.x=this.width/2-this._textBg.width/2,this._textBg.y=s.y-this._textBg.height-u,this._textBg.y<2+window.support.topMargin&&(this._textBg.y=s.y+t.height+u)}else this._textBg.x=this.width/2-this._textBg.width/2,this._textBg.y=this.height/2-this._textBg.height/2;if(this._txt.x=this._textBg.x+15,this._txt.y=this._textBg.y+10,this._textKuang.width=this._textBg.width+22,this._textKuang.height=this._textBg.height+24,this._textKuang.x=this._textBg.x-12,this._textKuang.y=this._textBg.y-15,t){this._textArrow.width>this._textKuang.height&&(this._textArrow.width=this._textKuang.height-1),this._textArrow.anchorOffsetX=this._textArrow.width/2;var h=this._textKuang.x+this._textKuang.width/2,l=this._textKuang.y+this._textKuang.height-this._textArrow.width,c=s.x+t.width/2,d=s.y;this._textKuang.y>s.y&&(d=s.y+t.height);var p=Math.sqrt(Math.pow(h-c,2)+Math.pow(l-d,2));this._textArrow.height=p,this._textArrow.rotation=180*Math.atan2(d-l,c-h)/Math.PI-90,this._textArrow.x=h,this._textArrow.y=l}},i.prototype.setClickData=function(t,e,i,r,n){var o=this;this._hand.visible=!0,e&&""!=e?this.setTalkData(t,e,i,r,n):this.caclMaskTarget(t,!0),this._bg.touchChildren=!0;var s=new egret.Point;t.localToRoot(0,0,s),s.x-=this.x,s.y-=this.y,this._hand.x=s.x+t.width/2,this._hand.y=s.y+t.height/2,this._hand.gotoAndPlay(1,-1),this._touchMask1.once(egret.TouchEvent.TOUCH_TAP,function(){if(o._targetOnclickCallback){var t=o._targetOnclickCallback;o._targetOnclickCallback=null,t.apply(o._targetOnclickThisArg)}},this)},i.prototype.addTargetClickListener=function(t,e){this._targetOnclickCallback=t,this._targetOnclickThisArg=e},i.prototype.setDragCardData=function(t,e,i,r,n,o,s){r&&""!=r&&(this.setTalkData(i,r,n,o,s,!1),this._touchMask1.visible=!1),this.touchEnabled=!1,this._hand.visible=!0,this._dragCardArrow.visible=!0;var a=t.localToRoot(0,0),u=new egret.Rectangle(a.x-3,a.y-3,t.width+6,t.height+6),h=e.localToRoot(0,0),l=new egret.Rectangle(h.x-3,h.y-3,e.width+6,e.height+6);this._bg.destroy();var c=u.x+u.width/2,d=u.y+u.height/2,p=l.x+l.width/2,_=l.y+l.height/2,g=Math.sqrt(Math.pow(c-p,2)+Math.pow(d-_,2));this._dragCardArrow.height=g,this._dragCardArrow.rotation=180*Math.atan2(_-d,p-c)/Math.PI+90;var f=t.parent.rootToLocal(c,d);this._dragCardArrow.x=f.x,this._dragCardArrow.y=f.y,t.parent.addChild(this._dragCardArrow),t.parent.swapChildren(this._dragCardArrow,t),this._hand.gotoAndStop(this._hand.totalFrames),this._hand.x=u.x+u.width/2-this.x,this._hand.y=u.y+u.height/2-this.y;var m=l.x+l.width/2-this.x,y=l.y+l.height/2-this.y,C=.6;g=Math.sqrt(Math.pow(m-this._hand.x,2)+Math.pow(y-this._hand.y,2)),egret.Tween.get(this._hand,{loop:!0}).wait(300).to({x:m,y:y},g/C).wait(400).to({alpha:0},200)},i}(egret.DisplayObjectContainer);t.GuideView=e,__reflect(e.prototype,"Guide.GuideView")}(Guide||(Guide={}));var Home;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.adjust(this.getChild("bg")),this._archiveBtn1=this.getChild("archiveBtn1").asButton,this._archiveBtn1.data="1",this._archiveBtn2=this.getChild("archiveBtn2").asButton,this._archiveBtn2.data="2",this._archiveBtn3=this.getChild("archiveBtn3").asButton,this._archiveBtn3.data="3",this._delArchiveBtn1=this.getChild("delArchiveBtn1").asButton,this._delArchiveBtn1.data="1",this._delArchiveBtn2=this.getChild("delArchiveBtn2").asButton,this._delArchiveBtn2.data="2",this._delArchiveBtn3=this.getChild("delArchiveBtn3").asButton,this._delArchiveBtn3.data="3",this._archiveBtn1.addClickListener(this._loginAvatar,this),this._archiveBtn2.addClickListener(this._loginAvatar,this),this._archiveBtn3.addClickListener(this._loginAvatar,this),this._delArchiveBtn1.addClickListener(this._delAvatarArchive,this),this._delArchiveBtn2.addClickListener(this._delAvatarArchive,this),this._delArchiveBtn3.addClickListener(this._delAvatarArchive,this)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){return e.prototype.open.apply(this,t),i=t[0],this._updateArchive(1,i),this._updateArchive(2,i),this._updateArchive(3,i),[2]})})},i.prototype._updateArchive=function(t,e){var i,r,n;if(e)for(var o=0,s=e.Archives;o<s.length;o++){var a=s[o];if(a.ID==t){i=a;break}}if(1==t?(r=this._archiveBtn1,n=this._delArchiveBtn1):2==t?(r=this._archiveBtn2,n=this._delArchiveBtn2):(r=this._archiveBtn3,n=this._delArchiveBtn3),i){r.getController("archive").selectedPage="old";var u=new Date(1e3*i.LastTime);r.title=u.getFullYear().toString().substr(2)+"-"+(u.getMonth()+1)+"-"+u.getDate()+" "+u.getHours()+":"+u.getMinutes(),n.visible=!0}else r.getController("archive").selectedPage="new",n.visible=!1},i.prototype._loginAvatar=function(e){t.HomeMgr.inst.onPlayerLogin(parseInt(e.target.data))},i.prototype._delAvatarArchive=function(e){return __awaiter(this,void 0,void 0,function(){var i,r=this;return __generator(this,function(n){return i=parseInt(e.target.data),Core.TipsUtils.confirm(Core.StringUtils.TEXT(60113),function(){t.HomeMgr.inst.delPlayerArchive(i).then(function(t){t&&r._updateArchive(i,null)})},null,this),[2]})})},i}(Core.BaseView);t.ArchiveView=e,__reflect(e.prototype,"Home.ArchiveView")}(Home||(Home={}));var Home;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.center(),this.modal=!0,this._cmdText=this.getChild("cmdText").asTextField,this._soundVolumeBtn=this.getChild("soundVolumeBtn").asButton,this._musicVolumeBtn=this.getChild("musicVolumeBtn").asButton,this._codeText=this.getChild("codText").asTextField,this._errorText=this.getChild("warning").asTextField,this._languageBtn=this.getChild("languageBtn").asButton,this._languageBtn.title=LanguageMgr.inst.getLanguageDescription(LanguageMgr.inst.cur),this.getChild("closeBtn").asButton.addClickListener(this._onClose,this),this.getChild("confirmBtn").asButton.addClickListener(this._onConfirm,this),this._soundVolumeBtn.addClickListener(this._onSoundChange,this),this._musicVolumeBtn.addClickListener(this._onMusicChange,this),this.setSound(SoundMgr.inst.soundLevel),this.setMusic(SoundMgr.inst.musicLevel),Data.text.get(13145)&&"版署版本"==Data.text.get(13145).cn&&(this.getChild("qqtext").visible=!1,this._cmdText.visible=!1),(Core.DeviceUtils.isWXGame()||Core.DeviceUtils.isiOS()&&!IOS_EXAMINE_VERSION||Core.DeviceUtils.isAndroid())&&(this.getChild("cmdBg").visible=!0,this._codeText.visible=!0,this.getChild("qqtext").visible=!0,this.setSize(400,430),this._cmdText.visible=!1),window.gameGlobal.debug||(this._cmdText.visible=!1),Core.DeviceUtils.isWXGame()&&WXGame.WXGameMgr.inst.isExamineVersion&&(this._cmdText.visible=!0),Core.DeviceUtils.isiOS()&&IOS_EXAMINE_VERSION&&(this._cmdText.visible=!0),this._cmdText.visible=!0,window.gameGlobal.isMultiLan?(this._languageBtn.visible=!0,this._languageBtn.addClickListener(this._onSwitchLanguage,this),"lzd_handjoy"!=window.gameGlobal.channel||IOS_EXAMINE_VERSION?(this.getChild("qqtext").visible=!1,this.setSize(400,300)):(this.getChild("qqtext").visible=!0,this.getChild("qqtext").asRichTextField.text=Core.StringUtils.TEXT(70199),this.setSize(400,460))):this._languageBtn.visible=!1,this.pivotX=.5,this.pivotY=.5},i.prototype.onClickLink=function(t){console.debug(t.text)},i.prototype.setSound=function(t){t=Math.floor(t);for(var e=0;4>e;e++)this._soundVolumeBtn.getChild("icon"+e).visible=!1;this._soundVolumeBtn.getChild("icon"+t).visible=!0},i.prototype.setMusic=function(t){t=Math.floor(t);for(var e=0;4>e;e++)this._musicVolumeBtn.getChild("icon"+e).visible=!1;this._musicVolumeBtn.getChild("icon"+t).visible=!0},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,e.prototype.open.apply(this,t)];case 1:return i.sent(),this._codeText.text="",[4,Core.PopUpUtils.addPopUp(this,7)];case 2:return i.sent(),[2]}})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(r){switch(r.label){case 0:return[4,new Promise(function(t){egret.Tween.get(i).to({scaleX:0,scaleY:0},300,egret.Ease.backIn).call(function(){t()},i)})];case 1:return r.sent(),[4,e.prototype.close.apply(this,t)];case 2:return r.sent(),[2]}})})},i.prototype._onSoundChange=function(){var t=SoundMgr.inst.soundLevel+1;t>3&&(t=0),SoundMgr.inst.soundLevel=t,this.setSound(t),SoundMgr.inst.playSoundAsync("click_mp3")},i.prototype._onMusicChange=function(){var t=SoundMgr.inst.musicLevel+1;t>3&&(t=0),SoundMgr.inst.musicLevel=t,this.setMusic(t)},i.prototype._onSwitchLanguage=function(){Core.ViewManager.inst.open(ViewName.switchLanWnd)},i.prototype._onClose=function(){Core.ViewManager.inst.closeView(this)},i.prototype._onConfirm=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return""==this._codeText.text?[3,2]:[4,t.HomeMgr.inst.exchangeGiftCode(this._codeText.text)];case 1:return e=o.sent(),0==e?this._onClose():2==e?Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60168)):3==e?Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60152)):Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60098)),[2];case 2:return""!=this._cmdText.text?[3,3]:(this._onClose(),[2]);case 3:if("addcard all"!=this._cmdText.text)return[3,8];i=Data.hero_say.keys,r=0,o.label=4;case 4:return r<i.length?[4,t.HomeMgr.inst.doGmCommand("addcard "+i[r]+" 330")]:[3,7];case 5:o.sent(),o.label=6;case 6:return r++,[3,4];case 7:return Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60106)),[3,11];case 8:return"share app"!=this._cmdText.text?[3,9]:(Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.SHARE_APP2WECHAT,{title:Core.StringUtils.TEXT(60059),description:Core.StringUtils.TEXT(60247),url:"https://itunes.apple.com/cn/app/id1371944201?mt=8",scene:0}),[3,11]);case 9:return[4,t.HomeMgr.inst.doGmCommand(this._cmdText.text)];case 10:n=o.sent(),o.label=11;case 11:return[2]}})})},i}(Core.BaseWindow);t.CmdWnd=e,__reflect(e.prototype,"Home.CmdWnd")}(Home||(Home={}));var Home;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),window.gameGlobal.isMultiLan||(this._myParent=Core.LayerManager.inst.topLayer)},e}(Core.BaseView);t.ConnectHintView=e,__reflect(e.prototype,"Home.ConnectHintView")}(Home||(Home={}));var Home;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.modal=!0,this.center(),this._text=this.getChild("txt").asRichTextField},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){return t.prototype.open.apply(this,e),i=e[0],parseInt(i)?this._text.text=Core.StringUtils.TEXT(parseInt(i)):this._text.text=i,[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e}(Core.BaseWindow);t.DescTipsWnd=e,__reflect(e.prototype,"Home.DescTipsWnd")}(Home||(Home={}));var Home;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.adjust(this.getChild("bg")),this._backBtn=this.getChild("backBtn").asButton,this._setupBtn=this.getChild("setupBtn").asButton,this._campignBtn=this.getChild("campignBtn").asButton,this._levelBtn=this.getChild("levelBtn").asButton,this._matchBtn=this.getChild("matchBtn").asButton,this._cardPoolBtn=this.getChild("cardPoolBtn").asButton,this._levelBtn.addClickListener(Level.LevelMgr.inst.onEnterLevel,Level.LevelMgr.inst),this._cardPoolBtn.addClickListener(CardPool.CardPoolMgr.inst.onEnterCardPool,CardPool.CardPoolMgr.inst),this._matchBtn.addClickListener(this._onEnterPvp,this),this._campignBtn.addClickListener(this._onEnterCampign,this),this._setupBtn.addClickListener(this._onSetup,this),this._backBtn.addClickListener(this._onPlayerLogout,this),window.gameGlobal.debug||(this._setupBtn.visible=!1)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.open.apply(this,t),Pvp.PvpMgr.inst.isOpen()?this._matchBtn.grayed=!1:this._matchBtn.grayed=!0,[2]})})},i.prototype._onSetup=function(){Core.ViewManager.inst.open(ViewName.cmdWnd)},i.prototype._onEnterCampign=function(){},i.prototype._onEnterPvp=function(){Pvp.PvpMgr.inst.onEnterPvp()},i.prototype._onPlayerLogout=function(){t.HomeMgr.inst.onPlayerLogout()},i}(Core.BaseView);t.HomeView=e,__reflect(e.prototype,"Home.HomeView")}(Home||(Home={}));var Home;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e)},e.prototype.initLanguage=function(t,e){this.title=e,this._lanCode=t},Object.defineProperty(e.prototype,"lanCode",{get:function(){return this._lanCode},enumerable:!0,configurable:!0}),e}(fairygui.GButton);t.LanguageSwitchItem=e,__reflect(e.prototype,"Home.LanguageSwitchItem");var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.initUI=function(){t.prototype.initUI.call(this),this.center(),this.modal=!0,this._closeBtn=this.getChild("closeBtn").asButton,this._languageList=this.getChild("languageList").asList,this._confirmBtn=this.getChild("confirmBtn").asButton,this._closeBtn.addClickListener(this._onClose,this),this._confirmBtn.addClickListener(this._onConfirm,this)},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a;return __generator(this,function(u){switch(u.label){case 0:return[4,t.prototype.open.apply(this,i)];case 1:u.sent(),r=LanguageMgr.inst.supportedLanguage,n=0;for(o in r)s=r[o],a=fairygui.UIPackage.createObject(PkgName.home,"languageItem",e).asCom,a.initLanguage(o,s),this._languageList.addChild(a),o==LanguageMgr.inst.cur&&(this._languageList.selectedIndex=n),n++;return[2]}})})},i.prototype._onClose=function(){Core.ViewManager.inst.closeView(this)},i.prototype._onConfirm=function(){var t=this._languageList.getChildAt(this._languageList.selectedIndex);t.lanCode!=LanguageMgr.inst.cur&&(LanguageMgr.inst.cur=t.lanCode,window.location.reload())},i.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),this._languageList.removeChildren(0,-1,!0),[2]})})},i}(Core.BaseWindow);t.LanguageSwitchWnd=i,__reflect(i.prototype,"Home.LanguageSwitchWnd")}(Home||(Home={}));var Home;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var t=this;e.prototype.initUI.call(this),this._myParent=Core.LayerManager.inst.maskLayer,this.center(),this.modal=!0,this._accountText=this.getChild("account").asTextField,this._passwordText=this.getChild("password").asTextField,this._errorText=this.getChild("warning").asTextField,this.getChild("acceptBtn").addClickListener(this._onLogin,this),this.getChild("closeBtn").addClickListener(function(){Core.ViewManager.inst.closeView(t)},this)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return[4,e.prototype.open.apply(this,t)];case 1:return r.sent(),this._errorText.text="",i=egret.localStorage.getItem("account"),""==this._accountText.text&&(i?(this._accountText.text=i,this._passwordText.text=GameAccount.inst.getPassword(i)):(this._accountText.text="",this._passwordText.text="")),[2]}})})},i.prototype._onLogin=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return e=this._accountText.text.trim(),i=this._passwordText.text,e.length>0?(Core.ViewManager.inst.closeView(this),[4,t.HomeMgr.inst.onAccountLoginWithPwd(e,i)]):[3,2];case 1:return r=n.sent(),0==r?GameAccount.inst.setPassword(e,i):1==r?Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60155)):Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60133)),[3,3];case 2:Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60122)),n.label=3;case 3:return[2]}})})},i}(Core.BaseWindow);t.LoginAcountWnd=e,__reflect(e.prototype,"Home.LoginAcountWnd")}(Home||(Home={}));var Home;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){if(e.prototype.initUI.call(this),this._myParent=Core.LayerManager.inst.maskLayer,window.gameGlobal.isMultiLan){var t=new fairygui.GLoader;t.url="loading_logoName_png",t.autoSize=!1,t.fill=fairygui.LoaderFillType.ScaleMatchWidth,t.x=0,t.y=58,t.addRelation(this.getChild("bg"),fairygui.RelationType.Top_Top),this.addChild(t),this.adjust(this.getChild("bg"),Core.AdjustType.NO_BORDER),t.width=Math.min(fairygui.GRoot.inst.getDesignStageWidth(),this.getChild("bg").width)}else this.adjust(this.getChild("bg"),Core.AdjustType.NO_BORDER);this._facebookBtn=this.getChild("facebookBtn").asButton,this._touristBtn=this.getChild("touristBtn").asButton,this._googleBtn=this.getChild("googleBtn").asButton,this._bg=this.getChild("bg").asLoader,this._bg.url=(window.gameGlobal.logoUrl||"loading_logo_lzd_jpg").replace("png","jpg"),this._facebookBtn.addClickListener(this._onFacebookLogin,this),this._touristBtn.addClickListener(this._onTouristLogin,this),this._googleBtn.addClickListener(this._onGooglePlusLogin,this),window.gameGlobal.isFbAdvert?(this._facebookBtn.visible=!0,this._googleBtn.visible=!1,this._touristBtn.visible=!1,this._facebookBtn.x=122):Core.DeviceUtils.isAndroid()?(this._facebookBtn.visible=!0,this._googleBtn.visible=!0,this._touristBtn.visible=!1):(this._facebookBtn.visible=!0,this._googleBtn.visible=!1,IOS_EXAMINE_VERSION?this._touristBtn.visible=!0:this._touristBtn.visible=!1,this._facebookBtn.x=122)},i.prototype._onFacebookLogin=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return this._callback?[4,platform.login({loginType:"facebook"})]:[3,4];case 1:return r.sent(),[4,platform.getUserInfo()];case 2:return(e=r.sent())?(Core.ViewManager.inst.open(ViewName.connectView),[4,t.HomeMgr.inst.onSdkAccountLogin(e)]):[2];case 3:i=r.sent(),Core.ViewManager.inst.close(ViewName.connectView),0==i&&(this._callback(),this._callback=null),r.label=4;case 4:return[2]}})})},i.prototype._onGooglePlusLogin=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return this._callback?[4,platform.login({loginType:"google"})]:[3,4];case 1:return r.sent(),[4,platform.getUserInfo()];case 2:return(e=r.sent())?(Core.ViewManager.inst.open(ViewName.connectView),[4,t.HomeMgr.inst.onSdkAccountLogin(e)]):[2];case 3:i=r.sent(),Core.ViewManager.inst.close(ViewName.connectView),0==i&&(this._callback(),this._callback=null),r.label=4;case 4:return[2]}})})},i.prototype._onTouristLogin=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return this._callback?(Core.ViewManager.inst.open(ViewName.connectView),[4,t.HomeMgr.inst.onTouristLogin()]):[3,2];case 1:e=i.sent(),Core.ViewManager.inst.close(ViewName.connectView),0!=e||(this._callback(),this._callback=null),i.label=2;case 2:return[2]}})})},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,e.prototype.open.apply(this,t)];case 1:return i.sent(),this._callback=t[0],[2]}})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,e.prototype.close.apply(this,t)];case 1:return i.sent(),[2]}})})},i}(Core.BaseView);t.LoginFacebook=e,__reflect(e.prototype,"Home.LoginFacebook")}(Home||(Home={}));var Home;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this.addClickListener(this._onClick,this)},e.prototype.setNoticeId=function(t,e){this._noticeId=t,this._callback=e,this.title=Data.notice_config.get(t).title},e.prototype._onClick=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._callback&&this._callback(this._noticeId),[2]})})},Object.defineProperty(e.prototype,"noticeId",{get:function(){return this._noticeId},enumerable:!0,configurable:!0}),e}(fairygui.GButton);__reflect(e.prototype,"NoticeChkCom");var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.modal=!0,this.center(),this._myParent=Core.LayerManager.inst.topLayer,this._textList=this.getChild("textList").asList,this._titleList=this.getChild("pageList").asList,this._text=this._textList.getChildAt(0).asCom.getChild("mailText").asRichTextField,this._closeBtn=this.getChild("closeBtn").asButton,this._closeBtn.addClickListener(function(){Core.ViewManager.inst.closeView(e)},this)},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,n,o=this;return __generator(this,function(s){switch(s.label){case 0:return[4,t.prototype.open.apply(this,i)];case 1:return s.sent(),r=Data.notice_config.keys,n=null,r.forEach(function(t){var i=fairygui.UIPackage.createObject(PkgName.login,"noticeChk",e);i.setNoticeId(t,function(t){o._onChooseNotice(t)}),o._titleList.addChild(i),n||(n=i)}),n&&(this._onChooseNotice(n.noticeId),n.getController("button").setSelectedPage("down")),[2]}})})},i.prototype._onChooseNotice=function(t){this._text.text="\n"+Data.notice_config.get(t).content},i.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,t.prototype.close.apply(this,e)];case 1:return i.sent(),Core.ViewManager.inst.closeView(this),[2]}})})},i.tryOpenNoticePanel=function(){return __awaiter(this,void 0,void 0,function(){var t;
return __generator(this,function(e){switch(e.label){case 0:return t=Data.notice_config.keys,t.length<=0?[2]:[3,1];case 1:return[4,Core.ViewManager.inst.open(ViewName.noticeView)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},i}(Core.BaseWindow);t.LoginNoticeView=i,__reflect(i.prototype,"Home.LoginNoticeView")}(Home||(Home={}));var Home;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var t=this;e.prototype.initUI.call(this),this._myParent=Core.LayerManager.inst.maskLayer,this.center(),this.modal=!0,this._accountText=this.getChild("account").asTextField,this._passwordText=this.getChild("password").asTextField,this._password2Text=this.getChild("password2").asTextField,this._errorText=this.getChild("warning").asTextField,this.getChild("acceptBtn").addClickListener(this._onRegister,this),this.getChild("closeBtn").addClickListener(function(){Core.ViewManager.inst.closeView(t)},this)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,e.prototype.open.apply(this,t)];case 1:return i.sent(),this._errorText.text="",this._accountText.text="",this._passwordText.text="",this._password2Text.text="",[2]}})})},i.prototype._onRegister=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return e=this._accountText.text.trim(),e.length<=0?[2]:(i=this._passwordText.text,r=this._password2Text.text,i!=r?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60134)),[2]):i.length>8||i.length<4?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60143)),[2]):[4,t.HomeMgr.inst.onRegister(e,i)]);case 1:return n=o.sent(),0==n?Core.ViewManager.inst.closeView(this):101==n?Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60167)):Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60118)),[2]}})})},i}(Core.BaseWindow);t.LoginRegisterWnd=e,__reflect(e.prototype,"Home.LoginRegisterWnd")}(Home||(Home={}));var Home;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this._myParent=Core.LayerManager.inst.maskLayer,this.adjust(this.getChild("bg"),Core.AdjustType.NO_BORDER),this._nameTextInput=this.getChild("nameTextInput").asTextField,this._bg=this.getChild("bg").asLoader,this._bg.url=(window.gameGlobal.logoUrl||"loading_logo_lzd_jpg").replace("png","jpg");var t=egret.localStorage.getItem("account");null!=t?this._nameTextInput.text=t:this._nameTextInput.text=Core.StringUtils.TEXT(60086),this._touchTips=this.getChild("touchTips").asTextField,this._touchMask=this.getChild("touchMask").asGraph,this._touchMask.asGraph.addClickListener(this._onEnter,this),this._registerBtn=this.getChild("registerBtn").asButton,this._registerBtn.addClickListener(function(){Core.ViewManager.inst.open(ViewName.loginRegister)},this),this.getChild("nameTextBg").asLoader.addClickListener(function(){Core.ViewManager.inst.open(ViewName.loginAcount)},this),window.gameGlobal.isSDKLogin&&this.showAccountLoginComs(!1),Core.DeviceUtils.isWXGame()?this.getChild("isnbTxt").asTextField.visible=!0:this.getChild("goodTxt").asTextField.y=this.getChild("isnbTxt").asTextField.y,window.gameGlobal.isMultiLan?this.adjust(this.getChild("bg"),Core.AdjustType.EXACT_FIT):this.adjust(this.getChild("bg"),Core.AdjustType.NO_BORDER)},i.prototype.showAccountLoginComs=function(t){this._nameTextInput.visible=t,this.getChild("nameTextBg").visible=t,this._touchMask.touchable=t,this._registerBtn.visible=t,this._touchTips.visible=t},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i.prototype._onEnter=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a,u,h;return __generator(this,function(l){switch(l.label){case 0:return SoundMgr.inst.playSoundAsync("click_mp3",.01),i="",r=fairygui.GRoot.contentScaleFactor,n=e.stageX/r,o=e.stageY/r,s=this._nameTextInput.width,a=this._nameTextInput.height,"debug"!=window.gameGlobal.channel?[3,1]:(i=this._nameTextInput.text.trim(),[3,5]);case 1:return[4,platform.getUserInfo()];case 2:return u=l.sent(),u?[3,4]:[4,t.HomeMgr.inst.enterLogin(null)];case 3:l.sent(),l.label=4;case 4:i=u.channel_id,console.log("tdChannel "+i),0==i.length&&(i=this._nameTextInput.text.trim(),console.log("tdChannel "+i)),l.label=5;case 5:return i.length>0?(h=GameAccount.inst.getPassword(i),[4,t.HomeMgr.inst.onAccountLogin(i,h)]):[3,7];case 6:l.sent(),l.label=7;case 7:return[2]}})})},i}(Core.BaseWindow);t.LoginView=e,__reflect(e.prototype,"Home.LoginView")}(Home||(Home={}));var Home;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var i=this;e.prototype.initUI.call(this),this.center(),this.modal=!0,this._searchInput=this.getChild("searchInput").asTextField,this._errorText=this.getChild("warning").asTextField,this.getChild("confirmBtn").addClickListener(this._onModifyName,this),this.getChild("modifyBtn").addClickListener(this._onModifyName,this),this.getChild("randomNameBtn").addClickListener(this._randomName,this),this.getChild("randomNameBtn").asButton.visible=t.FunctionMgr.inst.isRandomNameOpen(),this.getChild("closeBtn").addClickListener(function(){Core.ViewManager.inst.closeView(i)},this)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return Core.ViewManager.inst.isShow(ViewName.battle)&&this.toTopLayer(),e.prototype.open.apply(this,t),this._errorText.text="",this._searchInput.text="",Player.inst.isNewbieName(Player.inst.name)?(this.getChild("txt").text=Core.StringUtils.TEXT(60229),this.getChild("title").text=Core.StringUtils.TEXT(60035),this.getChild("confirmBtn").visible=!0,this.getChild("modifyBtn").visible=!1,this.getChild("closeBtn").visible=!1):(this.getChild("txt").text=Core.StringUtils.TEXT(60163),this.getChild("title").text=Core.StringUtils.TEXT(60084),this.getChild("confirmBtn").visible=!1,this.getChild("modifyBtn").visible=!0,this.getChild("closeBtn").visible=!0),[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i.prototype._randomName=function(){if(window.gameGlobal.isMultiLan){var t="",e=Data.name_en_1.keys,i=Data.name_en_1.get(e[Core.RandomUtils.randInt(e.length)]),r=i.name;e=Data.name_en_2.keys;var n=Data.name_en_2.get(e[Core.RandomUtils.randInt(e.length)]),o=n.name;t=r+" "+o,this._searchInput.text=t}else{var s=void 0;s=0==Math.round(Math.random())?[Data.name1,Data.name2,Data.name3]:[Data.name3,Data.name4,Data.name5];for(var a="",u=0,h=s;u<h.length;u++){var l=h[u],e=l.keys,c=e[Core.RandomUtils.randInt(e.length)];a+=l.get(c).value}this._searchInput.text=a}},i.prototype._onModifyName=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,i,o=this;return __generator(this,function(s){switch(s.label){case 0:if(e=this._searchInput.text.trim(),e.length<=0)return this._errorText.text=Core.StringUtils.TEXT(60102),[2];if(window.gameGlobal.isMultiLan){if(Core.StringUtils.utf8Length(e)>18)return this._errorText.text=Core.StringUtils.TEXT(70198),[2]}else if(e.length>10)return this._errorText.text=Core.StringUtils.TEXT(60173),[2];return-1!=e.indexOf("#c")?(this._errorText.text=Core.StringUtils.TEXT(60166),[2]):Player.inst.isNewbieName(e)?(this._errorText.text=Core.StringUtils.TEXT(60166),[2]):e==Player.inst.name?(this._errorText.text=Core.StringUtils.TEXT(60165),[2]):Player.inst.isNewbieName(Player.inst.name)?[4,t.HomeMgr.inst.modifyName(e)]:[3,2];case 1:return i=s.sent(),101==i?(this._errorText.text=Core.StringUtils.TEXT(60166),[2]):0!=i?(this._errorText.text=Core.StringUtils.TEXT(60185),[2]):(0==i&&(Player.inst.name=e,Core.ViewManager.inst.closeView(this)),[3,7]);case 2:return Player.inst.hasEnoughJade(50)?[4,new Promise(function(t){Core.TipsUtils.confirm(Core.StringUtils.TEXT(60105)+("#cp"+e+"#n?"),function(){t(!0)},function(){t(!1)},o)})]:[3,6];case 3:return(r=s.sent())?(n="",-1!=Player.inst.name.indexOf("#c")&&(n=Player.inst.name.slice(0,8)),[4,t.HomeMgr.inst.updateName(e,n)]):[3,5];case 4:if(i=s.sent(),101==i)return this._errorText.text=Core.StringUtils.TEXT(60166),[2];if(-2==i)return this._errorText.text=Core.StringUtils.TEXT(60185),[2];if(1==i)return this._errorText.text=Core.StringUtils.TEXT(60180),[2];if(4==i)return this._errorText.text=Core.StringUtils.TEXT(60211),[2];0==i&&(n&&""!=n&&(e=n+e+"#n"),Player.inst.name=e,Core.ViewManager.inst.closeView(this)),s.label=5;case 5:return[3,7];case 6:return this._errorText.text=Core.StringUtils.TEXT(60180),[2];case 7:return[2]}})})},i}(Core.BaseWindow);t.ModifyNameWnd=e,__reflect(e.prototype,"Home.ModifyNameWnd")}(Home||(Home={}));var Home;!function(t){var e;!function(t){t[t.TEAM=1]="TEAM",t[t.BATTLE=2]="BATTLE",t[t.CARDPOOL=3]="CARDPOOL",t[t.LEVEL=4]="LEVEL"}(e||(e={}));var i=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._inScroll=0,t._viewNames=[ViewName.team,ViewName.cardpool,ViewName.match,ViewName.social,ViewName.level],t}return __extends(i,e),i.prototype.initUI=function(){var i=this;e.prototype.initUI.call(this),this.adjust(this.getChild("bg")),this.getChild("topBg").height+=window.support.topMargin,this.getChild("bottomBg").height+=window.support.bottomMargin,this._cardPoolBtn=this.getChild("cardPoolBtn").asButton,this._matchBtn=this.getChild("matchBtn").asButton,this._levelBtn=this.getChild("levelBtn").asButton,this._teamBtn=this.getChild("teamBtn").asButton,this._socialBtn=this.getChild("societyBtn").asButton;var r=this;this._cardPoolBtn.addClickListener(function(){r.openCardPoolView(),r._onScrollEnd()},this),this._matchBtn.addClickListener(function(){r.openPvpView(),r._onScrollEnd()},this),this._levelBtn.addClickListener(function(){r.openLevelView(),r._onScrollEnd()},this),this._teamBtn.addClickListener(function(){r.openTeamView(),r._onScrollEnd()},this),this._socialBtn.addClickListener(function(){r.openSocialView(),r._onScrollEnd()},this),this._listCtrl=this.getController("homeListCtrl"),this._homeList=this.getChild("baseList").asList,this._homeList.height=Math.floor(this._homeList.height+Utils.getResolutionDistance()),this._cardPoolCom=this._homeList.getChild("cards").asCom,this._cardPoolCom.height=this._homeList.height,this._matchCom=this._homeList.getChild("pvp").asCom,this._matchCom.height=this._homeList.height,this._levelCom=this._homeList.getChild("level").asCom,this._levelCom.height=this._homeList.height,this._teamCom=this._homeList.getChild("team").asCom,this._teamCom.height=this._homeList.height,this._socialCom=this._homeList.getChild("society").asCom,this._socialCom.height=this._homeList.height,this._goldText=this.getChild("goldText").asTextField,this._jadeText=this.getChild("jadeText").asTextField,this._bowlderText=this.getChild("bowlderText").asTextField,this._nameText=this.getChild("nameText").asTextField,this._nameText.textParser=Core.StringUtils.parseColorText,this._headIcon=this.getChild("head").asCom,this._treasureAni0=this.getTransition("t0"),this._treasureAni1=this.getTransition("t1"),this._treasureAni2=this.getTransition("t2"),this._treasureAni3=this.getTransition("t3"),this._treasureImg=this.getChild("boxImg").asLoader,this._headIcon.addClickListener(this._onDetail,this),this._listCtrl.addAction(SoundMgr.inst.playSoundAction("page_mp3",!0)),this._listCtrl.addEventListener(fairygui.StateChangeEvent.CHANGED,this._onListChanged,this),this._homeList.scrollPane.addEventListener(fairygui.ScrollPane.SCROLL,this._onListDrag,this),this._homeList.scrollPane.addEventListener(fairygui.ScrollPane.SCROLL_END,this._onScrollEnd,this),Player.inst.addEventListener(Player.ResUpdateEvt,this._onResUpdate,this),Player.inst.addEventListener(Player.LoginEvt,function(){i._levelOpen=!1,i._pvpOpen=!1,i._teamOpen=!1,i._cardpoolOpen=!1,i._socialOpen=!1},this),this._nameText.text=Player.inst.name,Core.EventCenter.inst.addEventListener(GameEvent.ModifyNameEv,function(t){i._nameText.text=t.data},this),this._headIcon.setHead(Player.inst.avatarUrl),this._headIcon.setFrame(Player.inst.frameUrl),Core.EventCenter.inst.addEventListener(GameEvent.ModifyAvatarEv,function(t){i._headIcon.setHead(t.data)},this),Core.EventCenter.inst.addEventListener(GameEvent.ModifyFrameEv,function(t){i._headIcon.setFrame(Player.inst.frameUrl)},this),Core.DeviceUtils.isWXGame()?this.getChild("avatarNumHint").asCom.visible=!1:(this.getChild("avatarNumHint").asCom.visible=!0,this.getChild("avatarNumHint").asCom.observerAvatarNum()),this._cardPoolBtn.getChild("cardNumHint").asCom.observeCampCardNum(),this._levelBtn.getChild("levelNumHint").asCom.observeLevelNum(),this._socialBtn.getChild("socialNumHint").asCom.observerSocialHintNum(),this._pvpOpen=!1,this._levelOpen=!1,this._cardpoolOpen=!1,this._teamOpen=!1,this._inScroll=0,this._onResUpdate(),this._homeList.selectedIndex=2,this._inviteBattleCom=this.getChild("inviteBattleHint").asCom,this._inviteBattleCom.visible=!1,Core.EventCenter.inst.addEventListener(GameEvent.BeInviteBattleEv,function(t){i._inviteBattleCom.visible=!0;var e=t.data;i._inviteBattleCom.setInfo(e[0],e[1])},this),this.getChild("bowlderText").visible=t.hasBowlderRes(),this.getChild("bowlderIcon").visible=t.hasBowlderRes()},i.prototype._onSetup=function(){Core.ViewManager.inst.open(ViewName.cmdWnd)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(r){switch(r.label){case 0:return e.prototype.open.apply(this,t),this._levelOpen||this._cardpoolOpen||this._teamOpen||this._pvpOpen||this._socialOpen?[2]:(this._homeList.scrollToView(2),[4,this.openPvpView()]);case 1:return r.sent(),Pvp.PvpMgr.inst.onEnterPvp(),fairygui.GTimers.inst.callDelay(1e3,function(){return __awaiter(i,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.openCardPoolView()];case 1:return t.sent(),[4,this.openSocialView()];case 2:return t.sent(),[2]}})})},this),[2]}})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),this._levelOpen=!1,this._teamOpen=!1,this._pvpOpen=!1,this._cardpoolOpen=!1,[2]})})},i.prototype.tryPlayTreasureAddAnimation=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n,o;return __generator(this,function(s){switch(s.label){case 0:return t=Core.ViewManager.inst.getView(ViewName.match),(e=t.getLatestAddTreasureCom())&&(i=e.treasure)?(r=t.latestTreasurePos,n=null,n=0==r?this._treasureAni0:1==r?this._treasureAni1:2==r?this._treasureAni2:this._treasureAni3,e.hideContent(),e.touchable=!1,o=i.getRareType(),this._treasureImg.url="treasure_box"+o+"_png",[4,new Promise(function(t){n.play(function(){t()})})]):[3,2];case 1:s.sent(),t.clearLatestAddTreasureCom(),e.touchable=!0,e.refresh(e.treasure),s.label=2;case 2:return[2]}})})},i.prototype._tryTriggerGuide=function(t){fairygui.GTimers.inst.callLater(function(){Core.EventCenter.inst.dispatchEventWith(GameEvent.OpenHomeEv,!1,t)},this)},i.prototype.openPvpView=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._pvpOpen?[3,2]:(this._pvpOpen=!0,console.log("open pvp view"),[4,Core.ViewManager.inst.open(ViewName.match,this._matchCom)]);case 1:t.sent(),t.label=2;case 2:return this.getCurView()==ViewName.match&&this._tryTriggerGuide(ViewName.match),[2]}})})},i.prototype.openTeamView=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return this._teamOpen?[3,3]:(this._teamOpen=!0,[4,Pvp.PvpMgr.inst.onEnterPvp()]);case 1:return t=i.sent(),console.log(""+t),[4,Core.ViewManager.inst.open(ViewName.team)];case 2:i.sent(),e=Core.ViewManager.inst.getView(ViewName.team),e.refresh(t[0],t[1]),e.addToParent(this._teamCom),e.height=this._homeList.height,i.label=3;case 3:return this.getCurView()==ViewName.team&&this._tryTriggerGuide(ViewName.team),[2]}})})},i.prototype.openCardPoolView=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this._cardpoolOpen?[3,2]:(this._cardpoolOpen=!0,[4,CardPool.CardPoolMgr.inst.onEnterCardPool()]);case 1:e.sent(),t=Core.ViewManager.inst.getView(ViewName.cardpool),t.addToParent(this._cardPoolCom),t.height=this._homeList.height,e.label=2;case 2:return this._teamOpen?[3,4]:[4,this.openTeamView()];case 3:e.sent(),e.label=4;case 4:return this.getCurView()==ViewName.cardpool&&this._tryTriggerGuide(ViewName.cardpool),[2]}})})},i.prototype.openLevelView=function(t){return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return this._levelOpen&&!t?[3,3]:(this._levelOpen=!0,[4,Level.LevelMgr.inst.onEnterLevel()]);case 1:return i.sent(),[4,Core.ViewManager.inst.open(ViewName.level)];case 2:i.sent(),e=Core.ViewManager.inst.getView(ViewName.level),e.addToParent(this._levelCom),e.height=this._homeList.height,i.label=3;case 3:return this.getCurView()==ViewName.level&&this._tryTriggerGuide(ViewName.level),[2]}})})},i.prototype.openSocialView=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this._socialOpen?[3,2]:(this._socialOpen=!0,[4,Core.ViewManager.inst.open(ViewName.social)]);case 1:e.sent(),t=Core.ViewManager.inst.getView(ViewName.social),this.getCurView()==ViewName.social&&t.refresh(),t.visible=!0,t.addToParent(this._socialCom),e.label=2;case 2:return this._levelOpen?[3,4]:[4,this.openLevelView()];case 3:e.sent(),e.label=4;case 4:return[2]}})})},i.prototype.hideOtherView=function(){for(var t=0;t<this._viewNames.length;t++){var e=this._viewNames[t],i=e==this.getCurView(),r=Core.ViewManager.inst.getView(e);r&&r.setVisible(i)}},i.prototype.showAllView=function(){for(var t=0;t<this._viewNames.length;t++){var e=this._viewNames[t],i=Core.ViewManager.inst.getView(e);i&&i.setVisible(!0)}},i.prototype.getCurView=function(){var t=this._listCtrl.selectedIndex;return this._viewNames[t]||""},i.prototype._onListChanged=function(){Core.EventCenter.inst.dispatchEventWith(Core.Event.HomeListChangedEvt,!1,this.getCurView()),this._inScroll<3&&this.hideOtherView()},i.prototype._onScrollEnd=function(){this.hideOtherView(),this._inScroll=0},i.prototype._onListDrag=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this._inScroll>=3?[2]:(this._inScroll++,this._inScroll>=3?(this.showAllView(),t=this._listCtrl.selectedIndex,1!=t?[3,3]:this._cardpoolOpen?[3,2]:[4,this.openCardPoolView()]):[3,5]);case 1:e.sent(),this.showAllView(),e.label=2;case 2:return[3,5];case 3:return 2!=t?[3,5]:this._levelOpen?[3,5]:[4,this.openLevelView()];case 4:e.sent(),this.showAllView(),e.label=5;case 5:return[2]}})})},i.prototype._onDetail=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,Social.FriendMgr.inst.fetchPlayerInfo(Player.inst.uid)];case 1:return t=e.sent(),t&&Core.ViewManager.inst.open(ViewName.selfInfo,Player.inst.uid,t),[2]}})})},i.prototype._onResUpdate=function(){this._goldText.text=""+Player.inst.getResource(ResType.T_GOLD),this._jadeText.text=""+Player.inst.getResource(ResType.T_JADE),this._bowlderText.text=""+Player.inst.getResource(ResType.T_BOWLDER)},i}(Core.BaseView);t.NewHomeView=i,__reflect(i.prototype,"Home.NewHomeView")}(Home||(Home={}));var Home;!function(t){function e(t){return __awaiter(this,void 0,void 0,function(){var e,n=this;return __generator(this,function(o){switch(o.label){case 0:return e=new egret.CustomFilter(i,r,{time:0}),t.filters=[e],[4,new Promise(function(t){egret.Tween.get(e.uniforms).to({time:1},1e3).call(function(){t()},n)})];case 1:return o.sent(),[2]}})})}var i="attribute vec2 aVertexPosition;\nvarying vec2 vTextureCoord;\nvoid main() {\n    vTextureCoord = aVertexPosition;\n    gl_Position = vec4(aVertexPosition * 2.0 - 1.0, 0.0, 1.0);\n}",r="precision mediump float;\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float time; // Ranges from 0.0 to 1.0\nconst float MIN_AMOUNT = -0.16;\nconst float MAX_AMOUNT = 1.3;\nfloat amount = time * (MAX_AMOUNT - MIN_AMOUNT) + MIN_AMOUNT;\nconst float PI = 3.141592653589793;\nconst float scale = 512.0;\nconst float sharpness = 3.0;\nfloat cylinderCenter = amount;\nfloat cylinderAngle = 2.0 * PI * amount;\nconst float cylinderRadius = 1.0 / PI / 2.0;\nvec3 hitPoint(float hitAngle, float yc, vec3 point, mat3 rrotation) {\nfloat hitPoint = hitAngle / (2.0 * PI);\npoint.y = hitPoint;\nreturn rrotation * point;\n}\nvec4 antiAlias(vec4 color1, vec4 color2, float distance) {\ndistance *= scale;\nif (distance < 0.0) return color2;\nif (distance > 2.0) return color1;\nfloat dd = pow(1.0 - distance / 2.0, sharpness);\nreturn ((color2 - color1) * dd) + color1;\n}\nfloat distanceToEdge(vec3 point) {\nfloat dx = abs(point.x > 0.5 ? 1.0 - point.x : point.x);\nfloat dy = abs(point.y > 0.5 ? 1.0 - point.y : point.y);\nif (point.x < 0.0) dx = -point.x;\nif (point.x > 1.0) dx = point.x - 1.0;\nif (point.y < 0.0) dy = -point.y;\nif (point.y > 1.0) dy = point.y - 1.0;\nif ((point.x < 0.0 || point.x > 1.0) && (point.y < 0.0 || point.y > 1.0)) return sqrt(dx * dx + dy * dy);\nreturn min(dx, dy);\n}\nvec4 seeThrough(float yc, vec2 p, mat3 rotation, mat3 rrotation) {\nfloat hitAngle = PI - (acos(yc / cylinderRadius) - cylinderAngle);\nvec3 point = hitPoint(hitAngle, yc, rotation * vec3(p, 1.0), rrotation);\nif (yc <= 0.0 && (point.x < 0.0 || point.y < 0.0 || point.x > 1.0 || point.y > 1.0)) {\n//return texture2D(targetTex, vTextureCoord);\nreturn vec4(0.0, 0.0, 0.0, 0.0);\n}\nif (yc > 0.0) return texture2D(uSampler, p);\nvec4 color = texture2D(uSampler, point.xy);\nvec4 tcolor = vec4(0.0);\nreturn antiAlias(color, tcolor, distanceToEdge(point));\n}\nvec4 seeThroughWithShadow(float yc, vec2 p, vec3 point, mat3 rotation, mat3 rrotation) {\nfloat shadow = distanceToEdge(point) * 30.0;\nshadow = (1.0 - shadow) / 3.0;\nif (shadow < 0.0) shadow = 0.0;\nelse shadow *= amount;\nvec4 shadowColor = seeThrough(yc, p, rotation, rrotation);\nshadowColor.r -= shadow;\nshadowColor.g -= shadow;\nshadowColor.b -= shadow;\nreturn shadowColor;\n}\nvec4 backside(float yc, vec3 point) {\nvec4 color = texture2D(uSampler, point.xy);\nfloat gray = (color.r + color.b + color.g) / 15.0;\ngray += (8.0 / 10.0) * (pow(1.0 - abs(yc / cylinderRadius), 2.0 / 10.0) / 2.0 + (5.0 / 10.0));\ncolor.rgb = vec3(gray);\nreturn color;\n}\nvoid main(void) {\nconst float angle = 30.0 * PI / 180.0;\nfloat c = cos(-angle);\nfloat s = sin(-angle);\nmat3 rotation = mat3(\nc, s, 0,\n-s, c, 0,\n0.12, 0.258, 1\n);\nc = cos(angle);\ns = sin(angle);\nmat3 rrotation = mat3(\nc, s, 0,\n-s, c, 0,\n0.15, -0.5, 1\n);\nvec3 point = rotation * vec3(vTextureCoord, 1.0);\nfloat yc = point.y - cylinderCenter;\nif (yc < -cylinderRadius) {\n//gl_FragColor = behindSurface(yc, point, rrotation);\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);return;\n}\nif (yc > cylinderRadius) {\ngl_FragColor = texture2D(uSampler, vTextureCoord);\nreturn;\n}\nfloat hitAngle = (acos(yc / cylinderRadius) + cylinderAngle) - PI;\nfloat hitAngleMod = mod(hitAngle, 2.0 * PI);\nif ((hitAngleMod > PI && amount < 0.5) || (hitAngleMod > PI/2.0 && amount < 0.0)) {\ngl_FragColor = seeThrough(yc, vTextureCoord, rotation, rrotation);\nreturn;\n}\npoint = hitPoint(hitAngle, yc, point, rrotation);\nif (point.x < 0.0 || point.y < 0.0 || point.x > 1.0 || point.y > 1.0) {\ngl_FragColor = seeThroughWithShadow(yc, vTextureCoord, point, rotation, rrotation);\nreturn;\n}\nvec4 color = backside(yc, point);\nvec4 otherColor;\nif (yc < 0.0) {\nfloat shado = 1.0 - (sqrt(pow(point.x - 0.5, 2.0) + pow(point.y - 0.5, 2.0)) / 0.71);\nshado *= pow(-yc / cylinderRadius, 3.0);\nshado *= 0.5;\notherColor = vec4(0.0, 0.0, 0.0, shado);\n} else {\notherColor = texture2D(uSampler, vTextureCoord);\n}\ncolor = antiAlias(color, otherColor, cylinderRadius - abs(yc));\nvec4 cl = seeThroughWithShadow(yc, vTextureCoord, point, rotation, rrotation);\nfloat dist = distanceToEdge(point);\ngl_FragColor = antiAlias(color, cl, dist);\n}";t.playPageFlipAni=e}(Home||(Home={}));var Home;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.adjust(this.getChild("panel"),Core.AdjustType.EXCEPT_MARGIN),this.y+=window.support.topMargin,this._closeBtn=this.getChild("closeBtn").asButton,this._beginBtn=this.getChild("beginBtn").asButton,this._nextBtn=this.getChild("nextBtn").asButton,this._completeBtn=this.getChild("completeBtn").asButton,this._rewardBtn=this.getChild("rewardBtn").asButton,this._answerList=this.getChild("answerList").asList,this._closeBtn.addClickListener(function(){e.close()},this),this._beginBtn.addClickListener(function(){e.begin()},this),this._nextBtn.addClickListener(function(){e.next()},this),this._completeBtn.addClickListener(function(){e.complete()},this),this._rewardBtn.addClickListener(function(){e.reward()},this),this._answerList.addClickListener(function(){e._answerList.getSelection().length>0?e._index==Data.question.keys.length?e._completeBtn.visible=!0:e._nextBtn.visible=!0:(e._nextBtn.visible=!1,e._completeBtn.visible=!1)},this)},e.prototype.reward=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r;return __generator(this,function(n){switch(n.label){case 0:return this._rewardBtn.enabled=!1,[4,Net.rpcCall(pb.MessageID.C2S_GET_SURVEY_REWARD,null)];case 1:return t=n.sent(),0==t.errcode&&(e=pb.OpenTreasureReply.decode(t.payload),i=new Treasure.TreasureReward,i.gold=e.GoldAmount,e.CardIDs.forEach(function(t){i.addCardId(t)}),Core.ViewManager.inst.open(ViewName.treasureRewardInfo,i,new Treasure.TreasureItem(-1,"BX6004")),r=Core.ViewManager.inst.getView(ViewName.match),r.hideQuestion(),this.close()),this._rewardBtn.enabled=!0,[2]}})})},e.prototype.begin=function(){this.getController("page").setSelectedIndex(2),this.initQuestion(1),this._completeBtn.visible=!1,this._answers=new Array(Data.question.keys.length)},e.prototype.next=function(){var t=this._answerList.getSelection();this._answers[this._index-1]=t,this.initQuestion(this._index+1)},e.prototype.complete=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r;return __generator(this,function(n){switch(n.label){case 0:for(t=this._answerList.getSelection(),this._answers[this._index-1]=t,e=new pb.SurveyAnswer,e.Answers=[],i=0;i<Data.question.keys.length;i++)r=new pb.Answer,r.QuestionID=i+1,r.AnswerIDs=this._answers[i],e.Answers.push(r);return[4,Net.rpcCall(pb.MessageID.C2S_COMPLETE_SURVEY,pb.SurveyAnswer.encode(e))];case 1:return n.sent(),this.getController("page").setSelectedIndex(1),[2]}})})},e.prototype.initQuestion=function(t){this._index=t;var e=Data.question.keys.length,i=Data.question.get(t);this._nextBtn.visible=!1,this._answerList.clearSelection(),this.getChild("progressTxt").asTextField.text=t+"/"+e;var r=this.getChild("question").asTextField;r.text=i.question,1==i.type?this._answerList.selectionMode=fairygui.ListSelectionMode.Single:this._answerList.selectionMode=fairygui.ListSelectionMode.Multiple_SingleClick;for(var n=["answerA","answerB","answerC","answerD","answerE","answerF","answerG","answerH"],o=0;o<n.length;o++){var s=i[n[o]],a=this._answerList.getChildAt(o).asCom.getChild("optionTxt").asTextField;s?(a.text=s,this._answerList.getChildAt(o).asCom.visible=!0):this._answerList.getChildAt(o).asCom.visible=!1}},e.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(n){switch(n.label){case 0:return t.prototype.open.call(this,i),e.IsComplete&&this.getController("page").setSelectedIndex(1),this.scaleX=.5,this.scaleY=.5,[4,new Promise(function(t){egret.Tween.get(r).to({scaleX:1,scaleY:1},300,egret.Ease.backOut).call(function(){t()})})];case 1:return n.sent(),[2]}})})},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){egret.Tween.get(t).to({scaleX:0,scaleY:0},300,egret.Ease.backIn).call(function(){this.hide(),e()},t)})];case 1:return e.sent(),[2]}})})},e.IsComplete=!1,e}(Core.BaseWindow);t.SurveyView=e,__reflect(e.prototype,"Home.SurveyView")}(Home||(Home={}));var Level;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._chapterNameTxt=this.getChild("chapterNameTxt").asTextField,this._levelList=this.getChild("levelList").asList,this._rewardCom=this.getChild("reward").asCom,this._rewardCom.y+=.1*(fairygui.GRoot.inst.getDesignStageHeight()-800),this._rewardCom.addClickListener(this._onClickReward,this),this._levelList.removeItemCallback=this._onLevelItemRemove},i.prototype.canOpenTreasure=function(){return this._rewardCom.canOpen},i.prototype._onLevelItemRemove=function(t){t.displayObject.cacheAsBitmap=!1},i.prototype._onClickReward=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o,s,a,u,h;return __generator(this,function(l){switch(l.label){case 0:return e=t.LevelMgr.inst.getChapter(this._chapterId),i=e.levelObjs,r=i[i.length-1],n=Data.level.get(r.id).reward_box,this._rewardCom.canOpen?[4,Net.rpcCall(pb.MessageID.C2S_OPEN_LEVEL_TREASURE,pb.OpenLevelTreasureArg.encode({ChapterID:this._chapterId}))]:[3,2];case 1:return o=l.sent(),0==o.errcode&&(t.LevelMgr.inst.onChapterTreasureOpen(this._chapterId),this._rewardCom.refresh(this._chapterId),s=pb.OpenTreasureReply.decode(o.payload),a=new Treasure.TreasureReward,a.gold=s.GoldAmount,s.CardIDs.forEach(function(t){a.addCardId(t)}),Core.ViewManager.inst.open(ViewName.treasureRewardInfo,a,new Treasure.TreasureItem(-1,n)),t.LevelMgr.inst.subLevelHintNum()),[3,3];case 2:u=Data.treasure_config.get(n).reward[0],h=Data.treasure_config.get(n).goldMin,Core.ViewManager.inst.open(ViewName.levelTreasureInfo,u,h,this._rewardCom),l.label=3;case 3:return[2]}})})},i.prototype.setName=function(t,e){this._chapterId=t,this._rewardCom.refresh(this._chapterId),this._chapterNameTxt.text=Core.StringUtils.format(Core.StringUtils.TEXT(60087),Core.StringUtils.getZhNumber(t),e)},i.prototype.setLevels=function(t){this._levelList.removeChildren(0,-1,!0);for(var e=0;e<t.length;e++){var i=t[e],r=this._levelList.addItem();r.setData(e,i)}},i.prototype.clearLevel=function(){this._levelList.removeChildren(0,-1,!0)},i}(fairygui.GComponent);t.ChapterItem=e,__reflect(e.prototype,"Level.ChapterItem")}(Level||(Level={}));var Level;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._title=this.getChild("txt1").asTextField,this._progressTitle=this.getChild("boxProgress").asCom.getChild("text").asTextField,this._progressBar=this.getChild("boxProgress").asCom.getChild("bar").asLoader,this._progressBottom=this.getChild("boxProgress").asCom.getChild("bottom").asLoader,this._stateCtrl=this.getController("button"),this._tran0=this.getTransition("t0"),Core.EventCenter.inst.addEventListener(GameEvent.ClearLevelEv,this._onLevelClear,this),Player.inst.addEventListener(Player.PvpMaxScoreChangeEvt,this._onPvpMaxScoreChange,this)
},i.prototype.refresh=function(e){this._chapterId=e;var i=t.LevelMgr.inst.getChapter(this._chapterId),r=i.levelObjs,n=t.LevelMgr.inst.curLevel,o=0;r.forEach(function(e){e.state==t.LevelState.Clear&&o++});var s=r[0].unlockPvpLevel,a=Player.inst.getResource(ResType.T_MAX_SCORE),u=Pvp.PvpMgr.inst.getPvpLevel(a);if(n<r[0].id||s>u)this._stateCtrl.setSelectedPage("lock"),1==this._chapterId?this._title.text=Core.StringUtils.format(Core.StringUtils.TEXT(60092),Pvp.Config.inst.getPvpTitle(r[0].unlockPvpLevel)):this._title.text=Core.StringUtils.format(Core.StringUtils.TEXT(60175),Core.StringUtils.getZhNumber(this._chapterId-1),Pvp.Config.inst.getPvpTitle(r[0].unlockPvpLevel)),this._progressBar.width=0,this._progressTitle.text="0/"+r.length,this._tran0.stop(),this._canOpen=!1;else if(n>=r[0].id&&n<=r[r.length-1].id){this._stateCtrl.setSelectedPage("unlock");var h=t.LevelMgr.inst.getChapterUnlockCardId(this._chapterId);if(h){var l=CardPool.CardPoolMgr.inst.getCardData(h,1);this._title.text=Core.StringUtils.format(Core.StringUtils.TEXT(60089),l.name)}else this._title.text="";this._progressBar.width=o/r.length*this._progressBottom.width,this._progressTitle.text=o+"/"+r.length,this._tran0.stop(),this._canOpen=!1}else t.LevelMgr.inst.isChapterTreasureOpen(this._chapterId)?(this._stateCtrl.setSelectedPage("got"),this._title.text=Core.StringUtils.TEXT(60053),this._progressBar.width=this._progressBottom.width,this._progressTitle.text=o+"/"+r.length,this._tran0.stop(),this._canOpen=!1):(this._stateCtrl.setSelectedPage("open"),this._title.text=Core.StringUtils.TEXT(60052),this._progressBar.width=this._progressBottom.width,this._progressTitle.text=o+"/"+r.length,this._tran0.play(null,null,null,-1),this._canOpen=!0)},i.prototype._onLevelClear=function(e){var i=e.data,r=t.LevelMgr.inst.getLevel(i);if(r&&r.chapter==this._chapterId){var n=this._canOpen;this.refresh(this._chapterId),!n&&this._canOpen&&t.LevelMgr.inst.addLevelHintNum()}},i.prototype._onPvpMaxScoreChange=function(){this.refresh(this._chapterId)},Object.defineProperty(i.prototype,"canOpen",{get:function(){return this._canOpen},enumerable:!0,configurable:!0}),i}(fairygui.GComponent);t.ChapterRewardCom=e,__reflect(e.prototype,"Level.ChapterRewardCom")}(Level||(Level={}));var Level;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this._goldCom=this.contentPane.getChild("gold").asCom,this._cardCom=this.contentPane.getChild("card").asCom,this.contentPane.getChild("bg").asLoader.addClickListener(this._onTouchBegin,this),this._cardCom.addClickListener(this._onClickCard,this),this.contentPane.getChild("closeBtn").addClickListener(function(){Core.ViewManager.inst.closeView(e)},this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s;return __generator(this,function(a){return t.prototype.open.apply(this,e),i=e[0],r=e[1],n=e[2],this._cardId=i,this.contentPane.getChild("bottom").asLoader.addRelation(n,fairygui.RelationType.Top_Bottom),this.contentPane.getChild("bottom").asLoader.addRelation(n,fairygui.RelationType.Center_Center),o=CardPool.CardPoolMgr.inst.getCardData(i,1),s=new CardPool.Card(o),this._cardCom.setCardObj(s),this._cardCom.count=1,this._cardCom.hideNewHint(),this._goldCom.count=r,[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e.prototype._onTouchBegin=function(){Core.ViewManager.inst.closeView(this)},e.prototype._onClickCard=function(){var t=CardPool.CardPoolMgr.inst.getCardData(this._cardId,1),e=new CardPool.Card(t);e&&Core.ViewManager.inst.open(ViewName.cardInfoOther,e)},e}(Core.BaseWindow);t.ChapterTreasureInfoWnd=e,__reflect(e.prototype,"Level.ChapterTreasureInfoWnd")}(Level||(Level={}));var Level;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){var i=this;t.prototype.constructFromXML.call(this,e),this._headCom=this.getChild("head").asCom,this._nameText=this.getChild("nameText").asTextField,this._nameText.textParser=Core.StringUtils.parseColorText,this._titleText=this.getChild("title").asTextField,this._vedioBtn=this.getChild("vedioBtn").asButton,this._stateCtrl=this.getController("win"),this._stateCtrl.setSelectedPage("notWin"),this._vedioBtn.addClickListener(function(){return __awaiter(i,void 0,void 0,function(){var t,e,i,r;return __generator(this,function(n){switch(n.label){case 0:return this._data?(t={VideoID:this._data.VideoID},[4,Net.rpcCall(pb.MessageID.C2S_WATCH_HELP_VIDEO,pb.WatchHelpVideoArg.encode(t))]):[3,5];case 1:if(e=n.sent(),0!=e.errcode)return[3,5];i=pb.VideoBattleData.decode(e.payload),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,Battle.VideoPlayer.inst.play(i)];case 3:return n.sent(),[3,5];case 4:return r=n.sent(),console.log(r),[3,5];case 5:return[2]}})})},this)},e.prototype.setData=function(t){this._nameText.text=t.HelperName,(t.HelperHeadFrame||""==t.HelperHeadFrame)&&(t.HelperHeadFrame="1"),this._headCom.setAll(t.HelperHeadImgUrl,"headframe_"+t.HelperHeadFrame+"_png"),this._titleText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60076),t.HelpCnt),t.IsWin?this._stateCtrl.setSelectedPage("win"):this._stateCtrl.setSelectedPage("notWin"),this._data=t},e}(fairygui.GComponent);t.LevelHelpItemCom=e,__reflect(e.prototype,"Level.LevelHelpItemCom");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.center(),this.modal=!0,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._helpList=this.contentPane.getChild("applyList").asList,this._wechatBtn=this.contentPane.getChild("wechatBtn").asButton;var e=this;this._closeBtn.addClickListener(function(){Core.ViewManager.inst.closeView(e)},e),this._wechatBtn.addClickListener(this._onWechatHelp,this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s=this;return __generator(this,function(a){switch(a.label){case 0:return t.prototype.open.apply(this,e),this.contentPane.getChild("emptyHintText").visible=!1,this._wechatBtn.visible=!0,i=e[0],r={LevelID:i},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_LEVEL_HELP_RECORD,pb.TargetLevel.encode(r))];case 1:return n=a.sent(),0==n.errcode&&(o=pb.LevelHelpRecord.decode(n.payload),o.Records.length>0?o.Records.forEach(function(t){var e=fairygui.UIPackage.createObject(PkgName.level,"appealItem").asCom;e.setData(t),s._helpList.addChild(e),t.IsWin&&(s._wechatBtn.visible=!1)}):this.contentPane.getChild("emptyHintText").visible=!0),this._levelId=i,[2]}})})},e.prototype._onWechatHelp=function(){Core.DeviceUtils.isWXGame()&&WXGame.WXShareMgr.inst.wechatShareLevelHelp(this._levelId)},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),this._helpList.removeChildren(),[2]})})},e}(Core.BaseWindow);t.LevelHelpWnd=i,__reflect(i.prototype,"Level.LevelHelpWnd")}(Level||(Level={}));var Level;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){var i=this;e.prototype.constructFromXML.call(this,t),this._bgImg=this.getChild("levelBtn").asCom.getChild("bgImg").asLoader,this._levelNameTxt=this.getChild("levelBtn").asCom.getChild("levelNameTxt").asTextField,this._left=this.getChild("left").asLoader,this._right=this.getChild("right").asLoader,this._helpBtn=this.getChild("appealBtn").asButton,this._t0=this.getTransition("t0"),this.getChild("levelBtn").asButton.addClickListener(this._onLevel,this),Core.DeviceUtils.isWXGame()?(this._helpBtn.addClickListener(function(){Core.ViewManager.inst.open(ViewName.levelHelpWnd,i._levelObj.id)},this),this._helpBtn.visible=!0):this._helpBtn.visible=!1,window.gameGlobal.isMultiLan&&(LanguageMgr.inst.isChineseLocale()||(this._levelNameTxt.fontSize=20)),LanguageMgr.inst.isChineseLocale()||(this._levelNameTxt.x=46,this._levelNameTxt.setSize(387,41),this._levelNameTxt.fontSize=20)},Object.defineProperty(i.prototype,"levelObj",{get:function(){return this._levelObj},enumerable:!0,configurable:!0}),i.prototype.setData=function(t,e){this._levelNameTxt.text=Core.StringUtils.format(Core.StringUtils.TEXT(60090),Core.StringUtils.getZhNumber(t+1),e.name),this._updateState(e.state),this._levelObj=e,this._helpBtn.visible=e.help&&Core.DeviceUtils.isWXGame()},i.prototype._onLevel=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o;return __generator(this,function(s){switch(s.label){case 0:return this._levelObj?(e=Player.inst.getResource(ResType.T_MAX_SCORE),i=Pvp.PvpMgr.inst.getPvpLevel(e),i<this.levelObj.unlockPvpLevel?(r=Core.StringUtils.format(Core.StringUtils.TEXT(60231),Pvp.Config.inst.getPvpTitle(this.levelObj.unlockPvpLevel)),Core.TipsUtils.showTipsFromCenter(r),[2]):this._levelObj.state==t.LevelState.Clear&&Home.FunctionMgr.inst.isLevelVideoOpen()?[4,Net.rpcCall(pb.MessageID.C2S_FETCH_LEVEL_VIDEO_ID,pb.FetchLevelVideoIDArg.encode({LevelID:this._levelObj.id}))]:[3,2]):[3,3];case 1:if(n=s.sent(),0==n.errcode&&(o=pb.FetchLevelVideoIDRely.decode(n.payload),o.VideoID))return Core.ViewManager.inst.open(ViewName.levelVideo,o.VideoID,this.levelObj),[2];s.label=2;case 2:t.LevelMgr.inst.beginLevelBattle(this.levelObj),s.label=3;case 3:return[2]}})})},i.prototype._updateState=function(e){switch(this.touchable=!0,this._levelNameTxt.color=Core.TextColors.black,e){case t.LevelState.Lock:this._levelNameTxt.color=5722449,this.touchable=!1,this._left.visible=!1,this._right.visible=!1,this._t0.playing&&this._t0.stop();break;case t.LevelState.UnLock:this._levelNameTxt.color=16777215,this._bgImg.url="level_levelItemBg3_png",this._left.visible=!0,this._right.visible=!0,this._t0.play(null,null,null,-1);break;case t.LevelState.Clear:this._levelNameTxt.color=16777215,this._bgImg.url="level_levelItemBg2_png",this._left.visible=!1,this._right.visible=!1,this._t0.playing&&this._t0.stop()}},i}(fairygui.GComponent);t.LevelItem=e,__reflect(e.prototype,"Level.LevelItem")}(Level||(Level={}));var Level;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._numText=this.getChild("textNum").asTextField,this._chapterIdInfo=new Collection.Dictionary},i.prototype.observeLevelNum=function(){this._updateHintNum(),Core.EventCenter.inst.addEventListener(Core.Event.LevelHintNumChangeEv,this._onLevelHintNumChange,this)},i.prototype._onLevelHintNumChange=function(t){this._updateHintNum()},i.prototype._updateHintNum=function(){var e=t.LevelMgr.inst.getTotalLevelHintNum();0>=e?this.visible=!1:e>99?(this.visible=!0,this._numText.text="99+"):(this.visible=!0,this._numText.text=""+e)},i}(fairygui.GComponent);t.LevelNumHintCom=e,__reflect(e.prototype,"Level.LevelNumHintCom")}(Level||(Level={}));var Level;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.center(),this.modal=!0,this._title=this.getChild("txt2").asTextField,this._playBtn=this.getChild("playBtn").asButton,this._fightBtn=this.getChild("fightBtn").asButton,this._closeBtn=this.getChild("closeBtn").asButton,this._playBtn.addClickListener(this._onPlay,this),this._fightBtn.addClickListener(this._onFight,this),this._closeBtn.addClickListener(this._onClose,this)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.open.apply(this,t),this._videoID=t[0],this._levelObj=t[1],this._title.text=Core.StringUtils.format(Core.StringUtils.TEXT(60108),this._videoID),[2]})})},i.prototype._onPlay=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return 0==this._videoID?[3,5]:(e={VideoID:this._videoID},[4,Net.rpcCall(pb.MessageID.C2S_WATCH_HELP_VIDEO,pb.WatchHelpVideoArg.encode(e))]);case 1:if(i=o.sent(),0!=i.errcode)return[3,5];r=pb.VideoBattleData.decode(i.payload),o.label=2;case 2:return o.trys.push([2,4,,5]),t.LevelMgr.inst.curVideoLevel=this._levelObj,[4,Battle.VideoPlayer.inst.play(r)];case 3:return o.sent(),[3,5];case 4:return n=o.sent(),console.log(n),[3,5];case 5:return this._onClose(),[2]}})})},i.prototype._onFight=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._levelObj&&t.LevelMgr.inst.beginLevelBattle(this._levelObj),this._onClose(),[2]})})},i.prototype._onClose=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._videoID=0,Core.ViewManager.inst.closeView(this),[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseWindow);t.LevelVideoView=e,__reflect(e.prototype,"Level.LevelVideoView")}(Level||(Level={}));var Level;!function(t){var e=function(t){function e(e){var i=t.call(this)||this;return i._view=e,i}return __extends(e,t),e.prototype.enter=function(t){this._view.resetCptBtn()},e}(fairygui.ControllerAction);__reflect(e.prototype,"LevelPageChangeAction");var i=function(i){function r(){var t=null!==i&&i.apply(this,arguments)||this;return t._inScroll=!1,t}return __extends(r,i),r.prototype.initUI=function(){i.prototype.initUI.call(this),this._chapterList=this.getChild("chapterList").asList,this._chapterPageCtrl=this.getController("chapterPage"),this._chapterPageCtrl.addAction(SoundMgr.inst.playSoundAction("page_mp3",!0)),this._chapterPageCtrl.addAction(new e(this)),this._chapterList.scrollPane.addEventListener(fairygui.ScrollPane.SCROLL,this.onScroll,this),this._chapterList.scrollPane.addEventListener(fairygui.ScrollPane.SCROLL_END,this.onScrollEnd,this);var r=t.LevelMgr.inst.getChapterNum();this._chapterList.numItems=r;for(var n=0;r>n;n++)this._chapterPageCtrl.addPage(n.toString());this._preCptBtn=this.getChild("preCptBtn").asButton,this._nextCptBtn=this.getChild("nextCptBtn").asButton,this._chapterPageCtrl.selectedIndex=0,this._preCptBtn.addClickListener(this._preCptOnClick,this),this._nextCptBtn.addClickListener(this._nextCptOnClick,this),this.onScrollEnd()},r.prototype.onScroll=function(){this._inScroll||(this._inScroll=!0,this._forEachChapter(function(t,e){e.visible=!0}))},r.prototype.onScrollEnd=function(){var t=this;this._inScroll=!1,this._forEachChapter(function(e,i){var r=e==t._chapterPageCtrl.selectedIndex;i.visible=r})},r.prototype.resetCptBtn=function(){this._preCptBtn.visible=!0,this._nextCptBtn.visible=!0,0==this._chapterPageCtrl.selectedIndex?this._preCptBtn.visible=!1:this._chapterPageCtrl.selectedIndex==this._chapterPageCtrl.pageCount-1&&(this._nextCptBtn.visible=!1)},r.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return i.prototype.open.apply(this,t),[4,this.refresh()];case 1:return e.sent(),[2]}})})},r.prototype.refresh=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n=this;return __generator(this,function(o){return this._renderChapterExecutor&&(this._renderChapterExecutor.cancel(),this._renderChapterExecutor=null),this._forEachChapter(function(t,e){e.clearLevel()}),e=-1,r=[],this._forEachChapter(function(n,o){var s=t.LevelMgr.inst.getChapter(n+1);s&&(o.setName(s.id,s.name),0>e&&(!s.isClear()||o.canOpenTreasure())?(e=n,i=[o,s]):r.push([o,s]))}),this._renderChapterExecutor=new Core.FrameExecutor,i&&this._renderChapterExecutor.regist(this._renderChapter,this,i[0],i[1]),r.forEach(function(t){n._renderChapterExecutor.regist(n._renderChapter,n,t[0],t[1])}),this._renderChapterExecutor.execute(),e>0&&(this._chapterPageCtrl.setSelectedIndex(e),this._chapterList.scrollToView(e,!0)),[2]})})},r.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return i.prototype.close.apply(this,t),this._renderChapterExecutor.cancel(),this._renderChapterExecutor=null,this._forEachChapter(function(t,e){e.clearLevel()}),[2]})})},r.prototype._renderChapter=function(t,e){t.setLevels(e.levelObjs)},r.prototype._forEachChapter=function(t){for(var e=0;e<this._chapterList.numItems;e++){var i=this._chapterList.getChildAt(e);i.height=this.height-76,i&&t.call(this,e,i)}},r.prototype._preCptOnClick=function(){var t=this._chapterPageCtrl.selectedIndex-1;t=0>t?0:t,this._chapterPageCtrl.selectedIndex=t},r.prototype._nextCptOnClick=function(){var t=this._chapterPageCtrl.selectedIndex+1;t=t>this._chapterPageCtrl.pageCount-1?this._chapterPageCtrl.pageCount-1:t,this._chapterPageCtrl.selectedIndex=t},r.prototype._backOnClick=function(){Core.ViewManager.inst.open(ViewName.home),Core.ViewManager.inst.closeView(this)},r}(Core.BaseView);t.LevelView=i,__reflect(i.prototype,"Level.LevelView")}(Level||(Level={}));var Pvp;!function(t){var e=function(){function e(t,e){this._poolList=t,this._poolCtrl=e,this._poolCtrl.addAction(SoundMgr.inst.playSoundAction("page_mp3",!0))}return Object.defineProperty(e.prototype,"oldfightPool",{get:function(){return this._oldfightPool},set:function(t){this._oldfightPool=t},enumerable:!0,configurable:!0}),e.prototype.getCurFightPool=function(){var t=this._poolList.getChildAt(this._poolCtrl.selectedIndex).asCom;return t.dataProvider},e.prototype.buildHandItem=function(t,e){if(!e)return null;var i=fairygui.UIPackage.createObject(PkgName.cards,"smallCard").asCom;return i.displayObject.cacheAsBitmap=!1,i.cardObj=e,i.setNumText(),i.setName(),i.setSkill(),i.setCardImg(),i.setEquip(),i.setNumText(),i.setNumOffsetText(),i.setOwnFront(),i.setDeskBackground(),i.touchable=!1,i.displayObject.cacheAsBitmap=!0,i},e.prototype.refresh=function(e){for(var i,r=[],n=0;n<this._poolList.numItems;n++){var o=this._poolList.getChildAt(n).asCom;o.itemBuilder=this;var s=e[n];o.dataProvider=s,o.choiceCardCtrl=new t.FightPoolChoiceCardCtrl(s),s.isFight?(i=o,this._poolCtrl.selectedIndex=n,this._oldfightPool=s):r.push(o),o.refresh()}this._renderExecutor=new Core.FrameExecutor,i&&this._renderExecutor.regist(i.refresh,i);for(var a=0,u=r;a<u.length;a++){var h=u[a];this._renderExecutor.regist(h.refresh,h)}this._renderExecutor.execute()},e.prototype.clear=function(){this._renderExecutor&&(this._renderExecutor.cancel(),this._renderExecutor=null);for(var t=0;t<this._poolList.numItems;t++){var e=this._poolList.getChildAt(t).asCom;e.clear(),e.dataProvider=null}this._oldfightPool=null},e.prototype.fireClick=function(){var t=this._poolList.getChildAt(this._poolCtrl.selectedIndex).asCom;t.fireClick()},e.prototype.prePool=function(){var t=this._poolCtrl.selectedIndex-1;t=0>t?0:t,this._poolCtrl.selectedIndex=t},e.prototype.nextPool=function(){var t=this._poolCtrl.selectedIndex+1;t=t>this._poolCtrl.pageCount-1?this._poolCtrl.pageCount-1:t,this._poolCtrl.selectedIndex=t},e}();t.CampPoolList=e,__reflect(e.prototype,"Pvp.CampPoolList",["UI.IHandItemBuilder"])}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.center(),this.modal=!0,this._icon=this.getChild("resource1").asLoader,this._num=this.getChild("cardRemaining").asTextField,this._nameText=this.getChild("name").asTextField,this._tipText=this.getChild("tip").asTextField,this._treasureIcon=this.getChild("treausre").asLoader,this._typeCtr=this.getController("type"),this.adjust(this.getChild("bg")),this.getChild("bg").addClickListener(this._play,this),this._callback=null},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.open.apply(this,e),this._rewardData=e[0],this._callback=e[1],this._play(),[2]})})},e.prototype._play=function(){var t=this;if(this.getTransition("t0").play(),this._reward&&(Core.ViewManager.inst.open(ViewName.treasureRewardInfo,this._reward,this._treasureItem),this._reward=null),this._rewardData.gold>0)this._typeCtr.selectedIndex=0,this._icon.url="common_goldIconBig_png",this._num.text=this._rewardData.gold.toString(),this._rewardData.gold=0;else if(this._rewardData.jade>0)this._typeCtr.selectedIndex=0,this._icon.url="common_jadeIconBig_png",this._num.text=this._rewardData.jade.toString(),this._rewardData.jade=0;else if(this._rewardData.bowlder>0)this._typeCtr.selectedIndex=0,this._icon.url="common_bowlderIconBig_png",this._num.text=this._rewardData.bowlder.toString(),this._rewardData.bowlder=0;else if(this._rewardData.feat>0)this._typeCtr.selectedIndex=0,this._icon.url="common_honorIconBig_png",this._num.text=this._rewardData.feat.toString(),this._rewardData.feat=0;else if(this._rewardData.fame>0)this._typeCtr.selectedIndex=0,this._icon.url="common_fameIconBig_png",this._num.text=this._rewardData.fame.toString(),this._rewardData.fame=0;else if(this._rewardData.cardKeys.length>0){this._typeCtr.selectedIndex=1;var e=this._rewardData.cardKeys.shift(),i=CardPool.CardPoolMgr.inst.getCardData(e,1);if(i){var r=new CardPool.Card(i);r.amount=1;var n=this.getChild("card");n.count=this._rewardData.cards.getValue(e),n.setCardObj(r),n.enableClick(!0)}}else if(this._rewardData.skins.length>0){this._typeCtr.selectedIndex=2;var o=this._rewardData.skins.shift(),s=CardPool.CardSkinMgr.inst.getSkinConf(o),a=s.general,u=CardPool.CardPoolMgr.inst.getCollectCard(a);if(u){var h=this.getChild("skin").asCom;h.getChild("nameText").asTextField.text=s.name,Utils.setImageUrlPicture(h.getChild("cardImg").asImage,"skin_m_"+o+"_png"),h.addClickListener(function(){Core.ViewManager.inst.open(ViewName.skinView,u,o)},this)}}else if(this._rewardData.headFrame.length>0){this._typeCtr.selectedIndex=3;var l=this.getChild("headFrame").asCom,c=this._rewardData.headFrame.shift();Utils.setImageUrlPicture(l.getChild("headFrame").asImage,"headframe_"+c+"_png"),l.getChild("newHint").visible=!1}else if(this._rewardData.other.length>0){this._typeCtr.selectedIndex=4;var d=this._rewardData.other.shift();this._treasureIcon.url=d.url,this._nameText.text=d.name,d.desc?this._tipText.text=d.desc:this._tipText.text=""}else if(this._rewardData.treasures.length>0){this._typeCtr.selectedIndex=4;var p=this._rewardData.treasures.shift(),_=this._rewardData.treasureIds.shift(),g=Data.treasure_config.get(_);this._nameText.text=g.title,this._tipText.text="",this._treasureIcon.url="treasure_box"+g.rare+"_png",this._reward=new Treasure.TreasureReward,this._treasureItem=new Treasure.TreasureItem(-1,_),this._reward.gold=p.GoldAmount,this._reward.jade=p.Jade,p.CardIDs.forEach(function(e){t._reward.addCardId(e)}),this._reward.shareId=p.ShareHid}else Core.ViewManager.inst.closeView(this)},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),this._callback&&(this._callback(),this._callback=null),[2]})})},e}(Core.BaseWindow);t.GetRewardWnd=e,__reflect(e.prototype,"Pvp.GetRewardWnd");var i=function(){function t(t,e,i){this._name=t,this._url=e,i&&(this._desc=i)}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this._url},set:function(t){this._url=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"desc",{get:function(){return this._desc},set:function(t){this._desc=t},enumerable:!0,configurable:!0}),t}();t.OtherData=i,__reflect(i.prototype,"Pvp.OtherData");var r=function(){function t(){this._jade=0,this._gold=0,this._bowlder=0,this._feat=0,this._fame=0,this._cardKeys=new Array,this._cards=new Collection.Dictionary,this._treasures=new Array,this._skins=new Array,this._headFrames=new Array,this._treasureIds=new Array,this._other=new Array}return Object.defineProperty(t.prototype,"jade",{get:function(){return this._jade},set:function(t){this._jade=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bowlder",{get:function(){return this._bowlder},set:function(t){this._bowlder=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gold",{get:function(){return this._gold},set:function(t){this._gold=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"feat",{get:function(){return this._feat},set:function(t){this._feat=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fame",{get:function(){return this._fame},set:function(t){this._fame=t},enumerable:!0,configurable:!0}),t.prototype.addOther=function(t,e,r){var n=new i(t,e,r);this._other.push(n)},Object.defineProperty(t.prototype,"other",{get:function(){return this._other},enumerable:!0,configurable:!0}),t.prototype.addCards=function(t,e){this._cardKeys.push(t),this._cards.setValue(t,e)},Object.defineProperty(t.prototype,"cardKeys",{get:function(){return this._cardKeys},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cards",{get:function(){return this._cards},enumerable:!0,configurable:!0}),t.prototype.addTreasureId=function(t){this._treasureIds.push(t)},Object.defineProperty(t.prototype,"treasureIds",{get:function(){return this._treasureIds},enumerable:!0,configurable:!0}),t.prototype.addTreasure=function(t){this._treasures.push(t)},Object.defineProperty(t.prototype,"treasures",{get:function(){return this._treasures},enumerable:!0,configurable:!0}),t.prototype.addSkins=function(t){this._skins.push(t)},Object.defineProperty(t.prototype,"skins",{get:function(){return this._skins},enumerable:!0,configurable:!0}),t.prototype.addHeadFrame=function(t){this._headFrames.push(t)},Object.defineProperty(t.prototype,"headFrame",{get:function(){return this._headFrames},enumerable:!0,configurable:!0}),t.prototype.getrewardNum=function(){var t=0;this._gold>=0&&(t+=1),this._jade>=0&&(t+=1)},t}();t.GetRewardData=r,__reflect(r.prototype,"Pvp.GetRewardData")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var i=this;e.prototype.initUI.call(this),this.center(),this.modal=!0,this._mailList=this.getChild("mailList").asList,this._mailList.scrollPane.addEventListener(fairygui.ScrollPane.PULL_UP_RELEASE,this._getMail,this),this._mailList.addEventListener(fairygui.ItemEvent.CLICK,this._onMail,this),this._allGetBtn=this.getChild("getBtn").asButton,this.getChild("closeBtn").asButton.addClickListener(function(){Core.ViewManager.inst.closeView(i)},this),this._allGetBtn.addClickListener(this._onGetAll,this),t.MailMgr.inst.addEventListener(t.MailMgr.SetGetAllBtn,this._setGetAllBtn,this)},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return e.prototype.open.apply(this,i),this._mailList.numItems=0,t.MailMgr.inst.mailDataInit(i[0]),this.getChild("emptyHintText").visible=t.MailMgr.inst.mailNum<=0,this._allGetBtn.visible=!1,this._refreshMailList(),t.MailMgr.inst.mailNum>0&&this._mailList.scrollToView(0),[2]})})},i.prototype._refreshMailList=function(){this._mailList.removeChildrenToPool();for(var e=0;e<t.MailMgr.inst.mailNum;e++){var i=this._mailList.addItemFromPool();this._updateMailItem(e,i.asCom)}},i.prototype._updateMailItem=function(e,i){var r=t.MailMgr.inst.getMail(e),n=t.MailMgr.inst.getMailContentProcessor(r.MailType);n&&n.updateMailCom(r,i.getChild("title").asTextField,i.getChild("text").asTextField),i.getChild("time").asTextField.text=Core.StringUtils.format(Core.StringUtils.TEXT(60051),Core.StringUtils.secToString(Math.floor(Date.now()/1e3-r.Time),"dhm")),r.IsRead?i.getController("c1").selectedIndex=1:i.getController("c1").selectedIndex=0},i.prototype._getMail=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return t.MailMgr.inst.hasMore?(e={MinMailID:t.MailMgr.inst.mailNum},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_MAIL_LIST,pb.FetchMailListArg.encode(e))]):[3,2];case 1:i=r.sent(),0==i.errcode&&(t.MailMgr.inst.addMailData(pb.MailList.decode(i.payload)),this._mailList.numItems=t.MailMgr.inst.mailNum),this._refreshMailList(),r.label=2;case 2:return[2]}})})},i.prototype._onMail=function(t){var e=this._mailList.getChildIndex(t.itemObject);e=this._mailList.childIndexToItemIndex(e),Core.ViewManager.inst.open(ViewName.mailInfo,e)},i.prototype._onGetAll=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t.MailMgr.inst.getAllReward(),[2]})})},i.prototype._setGetAllBtn=function(){t.MailMgr.inst.haveNoRead()||t.MailMgr.inst.dispatchEventWith(t.MailMgr.MailRedDot,!1,!1),this._refreshMailList()},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseWindow);t.MailWnd=e,__reflect(e.prototype,"Pvp.MailWnd");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this.addClickListener(this._onClick,this)},i.prototype.setRewawrd=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r,n;return __generator(this,function(o){return this._rewardType=t.Type,this._cardId=t.CardID,this._rewardId=t.ItemID,e=null,i=null,this._rewardType==pb.MailReward.RewardType.Card?e=t.CardID:this._rewardType==pb.MailReward.RewardType.HeadFrame?e=t.ItemID:this._rewardType==pb.MailReward.RewardType.CardSkin?(r=CardPool.CardSkinMgr.inst.getSkinConf(t.ItemID),e=r.head):this._rewardType==pb.MailReward.RewardType.Treasure?(n=Data.treasure_config.get(t.ItemID),e=n.rare):this._rewardType==pb.MailReward.RewardType.Emoji&&(e=t.EmojiTeam),i=Reward.RewardMgr.inst.getRewardIcon(this._rewardType,Reward.RewardIconSize.T_NORMAL,e),this.getChild("rewardIcon1").asLoader.url=i,this.getChild("cnt1").asTextField.text=t.Amount.toString(),[2]})})},i.prototype._onClick=function(){if(this._rewardType==pb.MailReward.RewardType.CardSkin){var e=CardPool.CardSkinMgr.inst.getSkinConf(this._rewardId),i=CardPool.CardPoolMgr.inst.getCollectCard(e.general);Core.ViewManager.inst.open(ViewName.skinView,i,this._rewardId)}else if(this._rewardType==pb.MailReward.RewardType.Treasure){var r=Data.treasure_config.get(this._rewardId);if(r.jadeMin<=0){var n=new Treasure.TreasureItem(-1,this._rewardId);this._treasure=n,Core.ViewManager.inst.open(ViewName.dailyTreasureInfo,this)}else{var o=new t.SeasonTreasureInfo(r);Core.ViewManager.inst.open(ViewName.rankSeasonTreasureInfo,this,o)}}else if(this._rewardType==pb.MailReward.RewardType.Card){var s=CardPool.CardPoolMgr.inst.getCardData(this._cardId,1),a=new CardPool.Card(s);Core.ViewManager.inst.open(ViewName.cardInfoOther,a)}},Object.defineProperty(i.prototype,"treasure",{get:function(){return this._treasure},enumerable:!0,configurable:!0}),i}(fairygui.GComponent);t.MailInfoItem=i,__reflect(i.prototype,"Pvp.MailInfoItem");var r=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var t=this;
e.prototype.initUI.call(this),this.center(),this.modal=!0,this._rewardList=this.getChild("rewardList").asList,this._mailTitle=this.getChild("mailTitle").asTextField,this._mailText=this.getChild("mailList").asList.getChildAt(0).asCom.getChild("mailText").asTextField,this._mailText.funcParser=Core.StringUtils.parseFuncText,this._getBtn=this.getChild("getBtn").asButton,this.getChild("backBtn").asButton.addClickListener(function(){Core.ViewManager.inst.closeView(t)},this),this.getChild("closeBtn").asButton.addClickListener(function(){Core.ViewManager.inst.closeView(t),Core.ViewManager.inst.close(ViewName.mail)},this),this._getBtn.addClickListener(this._onGetBtn,this),this._getBtn.touchable=!0},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,n,o=this;return __generator(this,function(s){switch(s.label){case 0:return e.prototype.open.apply(this,i),this._rewardList.removeChildrenToPool(),this._rewardData=new t.GetRewardData,this._index=i[0],this._mailData=t.MailMgr.inst.getMail(this._index),r=t.MailMgr.inst.getMailContentProcessor(this._mailData.MailType),r&&r.updateMailCom(this._mailData,this._mailTitle,this._mailText),this._mailData.Rewards.forEach(function(t){var e=o._rewardList.addItemFromPool().asCom;e.setRewawrd(t),t.Type==pb.MailReward.RewardType.Treasure&&o._rewardData.addTreasureId(t.ItemID)}),this._mailData.Rewards.length>0?this.getChild("mailList").height=250:this.getChild("mailList").height=330,this._mailData.IsRead?[3,2]:this._mailData.Rewards.length>0&&!this._mailData.IsReward?[3,2]:(n={ID:this._mailData.ID},[4,Net.rpcCall(pb.MessageID.C2S_READ_MAIL,pb.ReadMailArg.encode(n))]);case 1:s.sent(),this._mailData.IsRead=!0,t.MailMgr.inst.dispatchEventWith(t.MailMgr.SetGetAllBtn),s.label=2;case 2:return this._setGetBtn(),[2]}})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i.prototype._setGetBtn=function(){var t=this.getChild("line"),e=this.getChild("recievedFlag");if(t.visible=!0,e.visible=!1,this._getBtn.visible=!0,null==this._mailData.Rewards||0==this._mailData.Rewards.length)this._getBtn.text=Core.StringUtils.TEXT(60024),t.visible=!1;else{var i=this._mailData.IsReward;i?(this._getBtn.visible=!1,e.visible=!0):this._getBtn.text=Core.StringUtils.TEXT(60022)}},i.prototype._onGetBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return null==this._mailData.Rewards||0==this._mailData.Rewards.length?Core.ViewManager.inst.closeView(this):this._onGetReward(),[2]})})},i.prototype._onGetReward=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n=this;return __generator(this,function(o){switch(o.label){case 0:return e={ID:this._mailData.ID},[4,Net.rpcCall(pb.MessageID.C2S_GET_MAIL_REWARD,pb.GetMailRewardArg.encode(e))];case 1:return i=o.sent(),0==i.errcode&&(t.MailMgr.inst.getReward(this._mailData.ID,!0),t.MailMgr.inst.dispatchEventWith(t.MailMgr.SetGetAllBtn),this._setGetBtn(),r=pb.MailRewardReply.decode(i.payload),this._rewardData.gold=r.Gold,this._rewardData.jade=r.Jade,this._rewardData.feat=r.Feats,this._rewardData.fame=r.Prestige,r.Cards.forEach(function(t){n._rewardData.addCards(t.CardID,t.Amount)}),r.CardSkins.forEach(function(t){n._rewardData.addSkins(t)}),r.HeadFrames.forEach(function(t){n._rewardData.addHeadFrame(t)}),r.TreasureRewards.forEach(function(t){n._rewardData.addTreasure(t)}),Core.ViewManager.inst.open(ViewName.getRewardWnd,this._rewardData)),[2]}})})},i}(Core.BaseWindow);t.MailInfoWnd=r,__reflect(r.prototype,"Pvp.MailInfoWnd")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var i=this;this._isAppstoreExamine=IOS_EXAMINE_VERSION,e.prototype.initUI.call(this),this._guideGroup=this.getChild("guide").asGroup,this._guideProgressTxt=this.getChild("guideProgressTxt").asTextField,this.getChild("btnMatch").asButton.visible=!1,this.getChild("techBtn").touchable=!1;var r=new egret.Timer(200,1);r.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){i.getChild("techBtn").touchable=!0},this),r.start(),this._questBtn=this.getChild("questBtn").asButton,this._mailBtn=this.getChild("mailBtn").asButton,this._mailBtn.addClickListener(this._onMail,this),this._mailBtn.getChild("mailHint").visible=!1,this._rankSeasonBtn=this.getChild("rankSeasonBtn").asCom,this._seasonTimeText=this._rankSeasonBtn.getChild("time").asTextField,this._seasonStarNum=this._rankSeasonBtn.getChild("cnt").asTextField,this._rankSeasonBtn.addClickListener(this._onSeason,this),this._rebornBtn=this.getChild("rebornBtn").asButton,this._rebornBtn.addClickListener(this._onRebornBtn,this),this._rankSeasonCardBtn=this.getChild("rankSeasonCardBtn").asButton,this._rankSeasonCardBtn.addClickListener(this._onRankCardBtn,this),this._moreFunctionList=this.getChild("moreFunction").asList,this._commonFunctionList=this.getChild("commonFunction").asList,this._moreFunctionList.foldInvisibleItems=!0,this._commonFunctionList.foldInvisibleItems=!0,this._gameCenterBtn=this._moreFunctionList.getChild("gameCenterBtn").asButton,this._appLikeBtn=this._moreFunctionList.getChild("appLikeBtn").asButton,this._wechatFriendBtn=this._moreFunctionList.getChild("wechatFriendBtn").asButton,this._publicPlatformBtn=this._moreFunctionList.getChild("publicPlatformBtn").asButton,this._inviteBtn=this._commonFunctionList.getChild("inviteBtn").asButton,this._appStoreShareBtn=this._commonFunctionList.getChild("appstoreShareBtn").asButton,this._setupBtn=this._commonFunctionList.getChild("setupBtn").asButton,this._warBtn=this._commonFunctionList.getChild("warBtn").asButton,this._warBtn.addClickListener(function(){War.WarMgr.inst.openWarHome()},this),this._setupBtn.visible=!0,this._setupBtn.addClickListener(this._onSetup,this),this._inviteBtn.asCom.getChild("rewardHint").visible=!1,this._appStoreShareBtn.addClickListener(function(){window.sharePlatform.getShareType()==ShareType.SHARE_FACEBOOK?Core.ViewManager.inst.open(ViewName.shareFacebookReward):Core.ViewManager.inst.open(ViewName.shareReward)},this),this.getChild("btnMatch").asButton.addClickListener(this._onMatch,this),this.getChild("techBtn").asButton.addClickListener(this._onMatch,this),this.getChild("rankListBtn").asCom.addClickListener(this._onRankList,this),this.getChild("videoBtn").asButton.addClickListener(this._onWatchVideo,this),this.getChild("btnMatch").y+=window.support.topMargin+Utils.getResolutionDistance()/3,this.getChild("techBtn").y+=window.support.topMargin+Utils.getResolutionDistance()/3,this.getChild("treasures").y+=window.support.topMargin+Utils.getResolutionDistance()/2,this._treasure1=this.getChild("treasures").asCom.getChild("treasure1").asCom,this._treasure2=this.getChild("treasures").asCom.getChild("treasure2").asCom,this._treasure3=this.getChild("treasures").asCom.getChild("treasure3").asCom,this._treasure4=this.getChild("treasures").asCom.getChild("treasure4").asCom,this._treasureAni0=this.getChild("treasures").asCom.getTransition("t0"),this._treasureAni1=this.getChild("treasures").asCom.getTransition("t1"),this._treasureAni2=this.getChild("treasures").asCom.getTransition("t2"),this._treasureAni3=this.getChild("treasures").asCom.getTransition("t3"),this._TreasureAni4=this.getChild("treasures").asCom.getTransition("t4"),this._treasureImg=this.getChild("treasures").asCom.getChild("boxImg").asLoader,this._pos2Treasure=new Collection.Dictionary,this._pos2Treasure.setValue(0,this._treasure1),this._treasure1.pos=0,this._pos2Treasure.setValue(1,this._treasure2),this._treasure2.pos=1,this._pos2Treasure.setValue(2,this._treasure3),this._treasure3.pos=2,this._pos2Treasure.setValue(3,this._treasure4),this._treasure4.pos=3,this._treasure1.refresh(null),this._treasure2.refresh(null),this._treasure3.refresh(null),this._treasure4.refresh(null),this._latestTreasurePos=-1,this._dailyTreasure=this.getChild("dailyTreasure").asCom,this._pvpRankBanner=this.getChild("pvpRankBanner").asCom,this._pvpRankBanner.y+=window.support.topMargin,this._appLikeBtn.visible=!1,this._pvpRankBanner.addClickListener(function(){SoundMgr.inst.playSoundAsync("click_mp3"),Core.ViewManager.inst.open(ViewName.rankRewardView)},this),this._publicPlatformBtn.addClickListener(function(){Core.ViewManager.inst.open(ViewName.wechatPlatform)},this),this._appLikeBtn.visible=!1,this._appLikeBtn.addClickListener(function(){egret.localStorage.setItem("showReview","true"),Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.OPEN_APP_COMMENT),i._appLikeBtn.visible=!1},this),this._updatePvpInfo(),Core.DeviceUtils.isWXGame()?(this._wechatFriendBtn.addClickListener(function(){Core.ViewManager.inst.open(ViewName.wxgameFriendRankView,"friends")},this),this._inviteBtn.addClickListener(function(){i._onInvite()},this)):Core.DeviceUtils.isiOS()&&this._gameCenterBtn.addClickListener(function(){Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.SHOW_GAME_CENTER_RANK)},this),this._wechatFriendBtn.visible=!1,this._inviteBtn.visible=!1,this.getChild("mailBtn").visible=!1,this.getChild("advert1").visible=!1,this.getChild("advert2").visible=!1,this._gameCenterBtn.visible=!1,this._appStoreShareBtn.visible=!1,this._rankSeasonBtn.visible=!1,this._rankSeasonCardBtn.visible=!1,this._warBtn.visible=!1;var n=this;this.getChild("shopBtn").asButton.addClickListener(function(){Core.ViewManager.inst.open(ViewName.shopView)},this),Core.EventCenter.inst.addEventListener(GameEvent.ShopFreeAvailableEv,function(){n.getChild("shopBtn").asButton.getChild("freeFlag").visible=!0},this),Core.EventCenter.inst.addEventListener(GameEvent.ShopFreeUnavailableEv,function(){n.getChild("shopBtn").asButton.getChild("freeFlag").visible=!1},this),this.getChild("shopBtn").visible=!1,Core.EventCenter.inst.addEventListener(Core.Event.AddTreasureEvt,this._onAddTreasureItem,this),Core.EventCenter.inst.addEventListener(Core.Event.DelTreasureEvt,this._onDelTreasureItem,this),Core.EventCenter.inst.addEventListener(Core.Event.UpdateTreasureEvt,this._onUpdateTreasureItem,this),Core.EventCenter.inst.addEventListener(Core.Event.UpdateDailyTreasureEvt,this._onUpdateDailyTreasureItem,this),Core.EventCenter.inst.addEventListener(Core.Event.ReConnectEv,this._refreshTreasures,this),Core.EventCenter.inst.addEventListener(GameEvent.UpdateSeasonTime,this._setSeasonTime,this),Core.EventCenter.inst.addEventListener(GameEvent.SeasonBegin,this._setSeasonBtn,this),Core.EventCenter.inst.addEventListener(GameEvent.SeasonEnd,this._closeSeasonBtn,this),Core.EventCenter.inst.addEventListener(GameEvent.RankCardUpdate,this._setRankHandCardBtn,this),Core.EventCenter.inst.addEventListener(GameEvent.ShowRankCard,this._showRankHandCardBtn,this),Player.inst.addEventListener(Player.ResUpdateEvt,this._updatePvpInfo,this),t.MailMgr.inst.addEventListener(t.MailMgr.MailRedDot,this._mailRedDot,this),Core.EventCenter.inst.addEventListener(Social.InviteDataMgr.UpdateInviteHit,this._inviteDot,this),Core.NativeMsgCenter.inst.addListener(Core.NativeMessage.ON_START_MATCH,function(){console.log("native onStartMatch"),n._onMatch()},null),this._setGuideProgress(),this._initAdertIcons(),window.gameGlobal.isMultiLan&&(this._publicPlatformBtn.visible=!1)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return e.prototype.open.apply(this,t),i=t[0],this.addToParent(i),this.height=i.height,[4,this._refreshTreasures()];case 1:return r.sent(),[2]}})})},i.prototype.setVisible=function(t){e.prototype.setVisible.call(this,t),Core.DeviceUtils.isWXGame()&&WXGame.WXAdvertMgr.inst.onMatchViewVisible(t)},i.prototype._initAdertIcons=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return Core.DeviceUtils.isWXGame()?(t=this.getChild("advert1").asCom,e=this.getChild("advert2").asCom,[4,WXGame.WXAdvertMgr.inst.genAdertIcons(t,e)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},i.prototype.getTreasureCom=function(t){return this._pos2Treasure.getValue(t)},i.prototype._onWatchVideo=function(){Core.ViewManager.inst.open(ViewName.videoRecord)},i.prototype._onVideoHall=function(){Core.ViewManager.inst.open(ViewName.videoHall)},i.prototype._onRankCardBtn=function(){t.PvpMgr.inst.showRankHand()},i.prototype._refreshTreasures=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n=this;return __generator(this,function(o){switch(o.label){case 0:return[4,Treasure.TreasureMgr.inst().fetchTreasures(RewardType.REWARD)];case 1:for(t=o.sent(),t.forEach(function(t){var e=t.pos,i=n._pos2Treasure.getValue(e);i.refresh(t)}),e=0;4>e;++e)i=this._pos2Treasure.getValue(e),r=i.treasure,r&&(Treasure.TreasureMgr.inst().getTreasure(r.id)||i.refresh(null));return Treasure.TreasureMgr.inst().resCurActivatingTreasure(),[2]}})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i.prototype._showComponentsAfterGuide=function(){return window.gameGlobal.isFbAdvert?(Net.rpcPush(pb.MessageID.C2S_GET_FBADVERT_REWARD,null),void Core.TipsUtils.alert(Core.StringUtils.TEXT(60251),function(){Core.DeviceUtils.isAndroid()?window.location.href="https://play.google.com/store/apps/details?id=com.openew.game.lzd.handjoy":Core.DeviceUtils.isiOS()&&window.location.reload()},this,Core.StringUtils.TEXT(60252))):(this.getChild("rankListBtn").asCom.visible=!0,this.getChild("dailyTreasure").asCom.visible=!0,this.getChild("btnMatch").asButton.visible=!0,this.getChild("videoBtn").asButton.visible=!0,this.getChild("shopBtn").asButton.visible=!0,this.getChild("questBtn").asButton.visible=!0,this._rebornBtn.visible=Home.FunctionMgr.inst.isFeatOpen(),this._mailBtn.visible=!0,void(window.gameGlobal.isMultiLan?(this._wechatFriendBtn.visible=!1,this._publicPlatformBtn.visible=!1,this._gameCenterBtn.visible=!1,this._inviteBtn.visible=!1,this.getChild("advert1").asCom.visible=!1,this.getChild("advert2").asCom.visible=!1,window.sharePlatform.getShareType()==ShareType.SHARE_FACEBOOK&&(this._appStoreShareBtn.visible=""!=window.sharePlatform.getShareLink())):(Core.DeviceUtils.isWXGame()?(this._wechatFriendBtn.visible=!0,this._publicPlatformBtn.visible=!0,this._inviteBtn.visible=!0,this.getChild("advert1").asCom.visible=!0,this.getChild("advert2").asCom.visible=!0):Core.DeviceUtils.isiOS()&&(this._isAppstoreExamine||(this._appStoreShareBtn.visible=!0,this._appLikeBtn.visible=!("true"==egret.localStorage.getItem("showReview"))),this._gameCenterBtn.visible=!0),this._setWarBtn(),this._setSeasonBtn(),this._setRankHandCardBtn())))},i.prototype._closeSeasonBtn=function(){this._rankSeasonBtn.visible=!1,this._rankSeasonCardBtn.visible=!1},i.prototype._setWarBtn=function(){if(Home.FunctionMgr.inst.isWorldWarOpen()){var e=t.PvpMgr.inst.getPvpLevelByScore(Player.inst.getResource(ResType.T_MAX_SCORE)),i=t.Config.inst.getPvpTeam(e);this._warBtn.visible=i>=5}else this._warBtn.visible=!1},i.prototype._setSeasonBtn=function(){this._rankSeasonBtn.visible=Player.inst.isSeason},i.prototype._setSeasonTime=function(t){this._seasonTimeText.text=""+Core.StringUtils.secToString(t.data,"dhms"),this._seasonStarNum.text=""+Player.inst.getResource(ResType.SeasonWinDiff)},i.prototype._setRankHandCardBtn=function(){var t=Player.inst.isSeasonPvpChooseCard;t?this._rankSeasonCardBtn.visible=!0:this._rankSeasonCardBtn.visible=!1},i.prototype._showRankHandCardBtn=function(t){this._rankSeasonCardBtn.visible=t.data},i.prototype._setGuideProgress=function(){var t=Player.inst.getResource(ResType.T_SCORE);return t>0?(this._guideGroup.visible=!1,void this._showComponentsAfterGuide()):(Player.inst.addEventListener(Player.ResUpdateEvt,this._onGuideProgressUpdate,this),void this._onGuideProgressUpdate())},i.prototype._onSetup=function(){Core.ViewManager.inst.open(ViewName.cmdWnd)},i.prototype._onGuideProgressUpdate=function(){var t=Player.inst.getResource(ResType.T_GUIDE_PRO);return t>=Guide.MaxGuideProgress?(this._guideGroup.visible=!1,this._showComponentsAfterGuide(),void Player.inst.removeEventListener(Player.ResUpdateEvt,this._onGuideProgressUpdate,this)):void(this._guideProgressTxt.text=t+"/"+Guide.MaxGuideProgress)},i.prototype.hideQuestion=function(){},i.prototype._checkQuestion=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(r){switch(r.label){case 0:return this._isAppstoreExamine?[2]:(t=egret.localStorage.getItem("questionComplete3"+Player.inst.uid),"true"==t?[2]:[4,Net.rpcCall(pb.MessageID.C2S_FETCH_SURVEY_INFO,null)]);case 1:return e=r.sent(),0!=e.errcode?[2]:(i=pb.SurveyInfo.decode(e.payload),i.IsReward&&egret.localStorage.setItem("questionComplete3"+Player.inst.uid,"true"),i.IsComplete&&(Home.SurveyView.IsComplete=!0),[2])}})})},i.prototype._updatePvpInfo=function(){this._pvpRankBanner.refresh(Player.inst.getResource(ResType.T_SCORE));var e=t.PvpMgr.inst.getPvpLevel();e>=2&&this._checkQuestion(),this._setWarBtn()},i.prototype._mailRedDot=function(t){this._mailBtn.getChild("mailHint").visible=t.data},i.prototype._inviteDot=function(t){this._inviteBtn.getChild("rewardHint").visible=t.data},i.prototype._onSeason=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_FETCH_SEASON_PVP_INFO,null)];case 1:return t=i.sent(),0==t.errcode&&(e=pb.SeasonPvpInfo.decode(t.payload),Core.ViewManager.inst.open(ViewName.rankSeason,e)),[2]}})})},i.prototype._onRebornBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.open(ViewName.rebornShopView),[2]})})},i.prototype._onMatch=function(){var e=(t.PvpMgr.inst.getPvpLevel(),t.PvpMgr.inst.fightCamp),i=t.PvpMgr.inst.fightPool;return console.log("match",i,t.PvpMgr.inst),i?i.getCardAmout()<5&&!Player.inst.isSeason?void Core.TipsUtils.showTipsFromCenter(""+Utils.camp2Text(e)+Core.StringUtils.TEXT(60142)):void t.PvpMgr.inst.beginMatch():void 0},i.prototype._onInvite=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_FETCH_WX_INVITE_FRIENDS,null)];case 1:return t=i.sent(),0==t.errcode&&(e=pb.WxInviteFriendsReply.decode(t.payload),Core.ViewManager.inst.open(ViewName.inviteRewardWnd,e)),[2]}})})},i.prototype._onMail=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(r){switch(r.label){case 0:return t={MinMailID:0},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_MAIL_LIST,pb.FetchMailListArg.encode(t))];case 1:return e=r.sent(),0==e.errcode&&(i=pb.MailList.decode(e.payload),Core.ViewManager.inst.open(ViewName.mail,i)),[2]}})})},i.prototype._onRankList=function(){Core.ViewManager.inst.open(ViewName.rankListWnd)},i.prototype._onEnterDiy=function(){Core.ViewManager.inst.open(ViewName.diy)},i.prototype._onBack=function(){Core.ViewManager.inst.open(ViewName.home),Core.ViewManager.inst.closeView(this)},i.prototype._onAddTreasureItem=function(t){var e=t.treasureItem,i=this._pos2Treasure.getValue(e.pos);i.refresh(e),t.isInit||(this._latestTreasurePos=e.pos)},i.prototype._onDelTreasureItem=function(t){var e=t.treasureItem,i=this._pos2Treasure.getValue(e.pos);i.refresh(null)},i.prototype._onUpdateTreasureItem=function(t){var e=this,i=this._pos2Treasure.keys();i.forEach(function(t){var i=e._pos2Treasure.getValue(t);i.refresh(i.treasure)}),Treasure.TreasureMgr.inst().resCurActivatingTreasure()},i.prototype._onUpdateDailyTreasureItem=function(t){var e=t.treasureItem;this._dailyTreasure.refresh(e)},i.prototype.getLatestAddTreasureCom=function(){return this._latestTreasurePos>=0?this._pos2Treasure.getValue(this._latestTreasurePos):null},Object.defineProperty(i.prototype,"latestTreasurePos",{get:function(){return this._latestTreasurePos},enumerable:!0,configurable:!0}),i.prototype.clearLatestAddTreasureCom=function(){this._latestTreasurePos=-1},i.prototype.tryPlayTreasureAddAnimation=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n,o,s=this;return __generator(this,function(a){switch(a.label){case 0:return t=Core.ViewManager.inst.getView(ViewName.match),(e=t.getLatestAddTreasureCom())&&(i=e.treasure)?(r=t.latestTreasurePos,n=null,n=0==r?this._treasureAni0:1==r?this._treasureAni1:2==r?this._treasureAni2:this._treasureAni3,e.hideContent(),e.touchable=!1,o=i.getRareType(),this._treasureImg.url="treasure_box"+o+"_png",[4,new Promise(function(t){n.play(function(){t()})})]):[3,3];case 1:return a.sent(),t.clearLatestAddTreasureCom(),e.touchable=!0,e.refresh(e.treasure),[4,new Promise(function(t){s._TreasureAni4.play(function(){t()})})];case 2:a.sent(),a.label=3;case 3:return[2]}})})},i}(Core.BaseView);t.MatchView=e,__reflect(e.prototype,"Pvp.MatchView")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.adjust(this.getChild("background")),this.center(),this.modal=!0,this._cancelMatchBtn=this.getChild("cancelMatchBtn").asButton,this._cancelMatchBtn.addClickListener(t.PvpMgr.inst.cancelMatch,t.PvpMgr.inst)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return SoundMgr.inst.playBgMusic("matching_mp3"),e.prototype.open.apply(this,t),this._cancelMatchBtn.visible=!0,[4,fairygui.GTimers.inst.waitTime(1)];case 1:return i.sent(),this.getTransition("shake").play(null,null,null,-1),[2]}})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(r){switch(r.label){case 0:return[4,new Promise(function(t){egret.Tween.get(i).to({scaleX:0,scaleY:0},300,egret.Ease.backIn).call(function(){t()},i)})];case 1:return r.sent(),[4,e.prototype.close.apply(this,t)];case 2:return r.sent(),this.getTransition("shake").stop(),[2]}})})},i.prototype.readyFight=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return this._cancelMatchBtn.visible=!1,[4,fairygui.GTimers.inst.waitTime(2e3)];case 1:return e.sent(),this.getTransition("shake").stop(),this.getTransition("open").play(function(){Core.ViewManager.inst.closeView(t)},this),[4,fairygui.GTimers.inst.waitTime(1e3)];case 2:return e.sent(),[2]}})})},i}(Core.BaseWindow);t.MatchingWnd=e,__reflect(e.prototype,"Pvp.MatchingWnd")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(t){this._cardList=[null,null,null,null,null]},e.prototype.addCard=function(t){for(var e=function(e){var r=null;if(null==i._cardList[e]){var n=i.getChild("grid"+(e+1)).asCom;return r=fairygui.UIPackage.createObject(PkgName.cards,"cardItem",CardPool.CardItem),r.setData(t,!0),r.setRankSeasonMode(),r.x=n.x,r.y=n.y-5,r.addClickListener(function(){Core.ViewManager.inst.open(ViewName.cardInfo,r.cardObj)},i),i.addChild(r),i._cardList[e]=r,"break"}return i._cardList[e].visible?void 0:(r.setData(t,!0),r.setRankSeasonMode(),i._cardList[e].visible=!0,"break")},i=this,r=0;r<this._cardList.length;r++){var n=e(r);if("break"===n)break}},e.prototype._setCard=function(t,e){t.cardObj=e,t.setName(),t.setOwnBackground(),t.setOwnFront(),t.setCardImg(),t.setEquip(),t.setSkill(),t.setNumOffsetText(),t.setNumText(!0)},e.prototype.delCard=function(t){for(var e=0;e<this._cardList.length;e++)if(null!=this._cardList[e]&&this._cardList[e].cardObj==t){this.removeChild(this._cardList[e]),this._cardList[e]=null;break}},e.prototype.delAllCard=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){for(t=0;t<this._cardList.length;t++)e=this._cardList[t],null!=e&&this.delCard(e.cardObj);return[2]})})},Object.defineProperty(e.prototype,"cardIds",{get:function(){for(var t=new Array,e=0;e<this._cardList.length;e++){var i=this._cardList[e];null!=i&&null!=i.cardObj&&t.push(i.cardObj.cardId)}return t},enumerable:!0,configurable:!0}),e}(fairygui.GComponent);t.RankHand=e,__reflect(e.prototype,"Pvp.RankHand");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var t=this;e.prototype.initUI.call(this),this.modal=!0,this.center(),this.adjust(this.contentPane.getChild("background")),this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._closeBtn.addClickListener(function(){Core.ViewManager.inst.closeView(t)},this),this._campCtr=this.contentPane.getController("c2"),this._btnWei=this.contentPane.getChild("btnWei").asButton,this._btnShu=this.contentPane.getChild("btnShu").asButton,this._btnWu=this.contentPane.getChild("btnWu").asButton,this._btnNext=this.contentPane.getChild("nextBtn").asButton,this._btnNext.addClickListener(this._onNext,this),this._fightBtn=this.contentPane.getChild("fightBtn").asButton,this._fightBtn.addClickListener(this._onFight,this),this._refreshBtn=this.contentPane.getChild("refreshBtn").asButton,this._refreshFreeBtn=this.contentPane.getChild("refreshFreeBtn").asButton,this._refreshBtn.addClickListener(this._onRefreshBtn,this),this._refreshFreeBtn.addClickListener(this._onRefreshBtn,this),this._cardList=this.contentPane.getChild("cardList").asList,this._cardList.itemClass=CardPool.CardItem,this._cardList.addEventListener(fairygui.ItemEvent.CLICK,this._onListCard,this),this._rankHand=this.contentPane.getChild("handCard").asCom},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){return e.prototype.open.apply(this,t),this._curCards=[],this._rankHand.delAllCard(),i=t[0],i?(this.contentPane.getController("c1").selectedIndex=1,this._refreshCardList(i)):(this.contentPane.getController("c1").selectedIndex=0,this._campCtr.selectedIndex=t[1]-1),[2]})})},i.prototype._refreshCardList=function(t){var e=this;t.FreeRefreshCnt>0?(this._refreshFreeBtn.visible=!0,this._refreshBtn.visible=!1):t.JadeRefreshCnt>0?(this._refreshFreeBtn.visible=!1,this._refreshBtn.visible=!0,this._refreshBtn.grayed=!1,this._refreshBtn.touchable=!0):(this._refreshFreeBtn.visible=!1,this._refreshBtn.visible=!0,this._refreshBtn.grayed=!0,this._refreshBtn.touchable=!1);var i=t.CardIDs;this._cardList.removeChildrenToPool(),i.forEach(function(t){var i=e._cardList.addItemFromPool(),r=CardPool.CardPoolMgr.inst.getCollectCard(t);i.setData(r,!0),i.setRankSeasonMode(),i.getController("select").selectedIndex=0,i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e._onTouchCard,e)})},i.prototype._onListCard=function(t){var e=t.itemObject;this._touchBegin=!1;var i=e.cardObj.cardId,r=this._curCards.indexOf(i);if(-1==r){if(this._curCards.length>=5)return;e.getController("select").selectedIndex=1,this._curCards.push(i),this._rankHand.addCard(e.cardObj)}else e.getController("select").selectedIndex=0,this._curCards.splice(r,1),this._rankHand.delCard(e.cardObj)},i.prototype._onTouchCard=function(t){var e=this,i=t.target;this._touchBegin=!0;var r=fairygui.GRoot.mouseX,n=fairygui.GRoot.mouseY;fairygui.GTimers.inst.callDelay(600,function(){Math.abs(fairygui.GRoot.mouseX-r)>15||Math.abs(fairygui.GRoot.mouseY-n)>20||e._touchBegin&&(e._touchBegin=!1,Core.ViewManager.inst.open(ViewName.cardInfo,i.cardObj))},this)},i.prototype._onNext=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(r){switch(r.label){case 0:return t={Camp:this._campCtr.selectedIndex+1},[4,Net.rpcCall(pb.MessageID.C2S_SEASON_PVP_CHOOSE_CAMP,pb.SeasonPvpChooseCampArg.encode(t))];case 1:return e=r.sent(),0==e.errcode&&(i=pb.SeasonPvpChooseCardData.decode(e.payload),this._refreshCardList(i),this.contentPane.getController("c1").selectedIndex=1),[2]}})})},i.prototype._onRefreshBtn=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return Core.TipsUtils.confirm(Core.StringUtils.TEXT(70182),function(){t._onRefresh()},null),[2]})})},i.prototype._onRefresh=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_REFRESH_SEASON_PVP_CHOOSE_CARD,null)];case 1:return t=i.sent(),0==t.errcode&&(e=pb.SeasonPvpChooseCardData.decode(t.payload),this._refreshCardList(e),this._rankHand.delAllCard(),this._curCards=[]),[2]}})})},i.prototype._onFight=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return e=this._rankHand.cardIds,5!=e.length?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60142)),[2]):[4,Net.rpcCall(pb.MessageID.C2S_SEASON_PVP_CHOOSE_CARD,pb.SeasonPvpChooseCardArg.encode({CardIDs:e}))];case 1:return i=r.sent(),0==i.errcode&&(Core.EventCenter.inst.dispatchEventWith(GameEvent.ShowRankCard,!1,!0),this.contentPane.getController("c1").selectedIndex=0,Core.ViewManager.inst.closeView(this),t.PvpMgr.inst.beginMatch()),[2]}})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseWindow);t.RankFirstWnd=i,__reflect(i.prototype,"Pvp.RankFirstWnd")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.center(),this.modal=!0,this.adjust(this.contentPane.getChild("closeBg")),this.contentPane.getChild("closeBg").addClickListener(function(){Core.ViewManager.inst.closeView(e)},this),this._titleText=this.contentPane.getChild("txt").asTextField,this._titleText2=this.contentPane.getChild("txt2").asTextField,this._titleText3=this.contentPane.getChild("txt3").asTextField,this._rankHand=this.contentPane.getChild("handCard")},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){switch(n.label){case 0:return t.prototype.open.apply(this,e),[4,this._rankHand.delAllCard()];case 1:return n.sent(),i=e[0],r=Utils.rankChangeType2Text(i.ChangeType),this._titleText.text=Core.StringUtils.format(Core.StringUtils.TEXT(r[1]),i.ChangeCurPro,i.ChangeMaxPro),this._titleText2.text=Core.StringUtils.TEXT(70026)+"："+i.WinCnt,this._setCards(i.CardIDs),[2]}})})},e.prototype._setCards=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){for(e=0;e<t.length;e++)i=t[e],r=CardPool.CardPoolMgr.inst.getCollectCard(i),this._rankHand.addCard(r);return[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e}(Core.BaseWindow);t.RankHandWnd=e,__reflect(e.prototype,"Pvp.RankHandWnd")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._orderText=this.getChild("orderText").asTextField,this._changeText=this.getChild("rankChangeText").asTextField,this._campImg=this.getChild("campImg").asLoader,this._nameText=this.getChild("nameText").asTextField,this._nameText.textParser=Core.StringUtils.parseColorText,this._bg=this.getChild("bg").asLoader,this._scoreTextBg=this.getChild("scoreImg").asLoader,this._uid=null
},e.prototype.clearContent=function(){this._orderText.text="-",this._changeText.text="-",this._campImg.visible=!1,this._nameText.text=Core.StringUtils.TEXT(60071)},e.prototype.refreshBase=function(t,e,i,r,n){this._uid=i,3>=t?(this._orderText.fontSize=40,1==t?this._scoreTextBg.url="pvp_ranking1_png":2==t?this._scoreTextBg.url="pvp_ranking2_png":this._scoreTextBg.url="pvp_ranking3_png"):(this._orderText.fontSize=24,this._scoreTextBg.url="pvp_rankingMore_png"),this._uid==Player.inst.uid&&(this._bg.color=16777215),this._orderText.text=""+t,this._changeText.visible=!0,-1==e?this._changeText.visible=!1:0==e?(this._changeText.text="▲",this._changeText.color=815380):t>e?(this._changeText.text="▼"+(t-e),this._changeText.color=9049099):t==e?(this._changeText.text="-",this._changeText.color=0):(this._changeText.text="▲"+(e-t),this._changeText.color=815380),this._nameText.text=r,this._campImg.visible=!0,n==Camp.WEI?this._campImg.url="guide_wei_png":n==Camp.SHU?this._campImg.url="guide_shu_png":this._campImg.url="guide_wu_png"},e.prototype.fetchAndShowDetail=function(t){return __awaiter(this,void 0,void 0,function(){var t,e,i,r;return __generator(this,function(n){switch(n.label){case 0:return console.debug(""+this._uid),null==this._uid?[3,3]:[4,Net.rpcCall(pb.MessageID.C2S_FETCH_RANK_USER,pb.FetchRankUserArg.encode({Uid:this._uid}))];case 1:return t=n.sent(),0!=t.errcode?[3,3]:(e=pb.RankUser.decode(t.payload),i=[],e.FightCards.forEach(function(t){i.push(t)}),[4,Social.FriendMgr.inst.fetchPlayerInfo(this._uid)]);case 2:r=n.sent(),r&&Core.ViewManager.inst.open(ViewName.friendInfo,this._uid,r),n.label=3;case 3:return[2]}})})},e}(fairygui.GComponent);t.BaseRankPlayerInfoCom=e,__reflect(e.prototype,"Pvp.BaseRankPlayerInfoCom");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._rankImg=this.getChild("rankImg").asLoader,this._rankTitleText=this.getChild("rankTitleText").asTextField,this._scoreText=this.getChild("scoreText").asTextField,window.gameGlobal.isMultiLan&&(this._rankTitleText.fontSize=12),this.clearContent()},i.prototype.clearContent=function(){this.displayObject.cacheAsBitmap=!1,e.prototype.clearContent.call(this),this._rankImg.visible=!1,this._rankTitleText.text="",this._scoreText.text="-",this.displayObject.cacheAsBitmap=!0},i.prototype._refresh=function(i,r,n,o,s,a){this.displayObject.cacheAsBitmap=!1,e.prototype.refreshBase.call(this,i,r,n,o,a),this._scoreText.text=""+t.PvpMgr.inst.getPvpStarCnt(s);var u=t.PvpMgr.inst.getPvpLevel(s);this._rankTitleText.text=t.Config.inst.getPvpTitle(u),this._rankImg.visible=!0;var h=t.Config.inst.getPvpTeam(u);this._rankImg.url="common_rank"+h+"_png",this.displayObject.cacheAsBitmap=!0},i.prototype.refresh=function(t){var e=t.Uid,i=t.Rank,r=t.LastRank,n=t.Name,o=t.PvpScore,s=t.Camp;this._refresh(i,r,e,n,o,s)},i.prototype.refreshByData=function(t,e){var i=t.uid,r=t.name,n=t.score,o=t.camp;this._refresh(e,-1,i,r,n,o)},i.prototype.fetchAndShowDetail=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.fetchAndShowDetail.call(this,t),[2]})})},i}(e);t.RankPlayerInfoCom=i,__reflect(i.prototype,"Pvp.RankPlayerInfoCom");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._starCnt=this.getChild("cnt").asTextField},e.prototype.clearContent=function(){this.displayObject.cacheAsBitmap=!1,t.prototype.clearContent.call(this),this._starCnt.text="",this.displayObject.cacheAsBitmap=!0},e.prototype._refresh=function(e,i,r,n,o,s){this.displayObject.cacheAsBitmap=!1,t.prototype.refreshBase.call(this,e,i,r,n,s),this._starCnt.text=""+o,this.displayObject.cacheAsBitmap=!0},e.prototype.refresh=function(t){var e=t.Uid,i=t.Rank,r=t.LastRank,n=t.Name,o=t.WinDiff,s=t.Camp;this._refresh(i,r,e,n,o,s)},e.prototype.fetchAndShowDetail=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.fetchAndShowDetail.call(this,e),[2]})})},e}(e);t.SeasonRankPlayerInfoCom=r,__reflect(r.prototype,"Pvp.SeasonRankPlayerInfoCom");var n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.initUI=function(){var t=this;e.prototype.initUI.call(this),this.adjust(this.contentPane.getChild("panel"),Core.AdjustType.EXCEPT_MARGIN),this.modal=!0,this._initialized=!1,this.center(),this.y+=window.support.topMargin/2,this._updateTimeText=this.contentPane.getChild("updateTime").asTextField,this._rankList=this.contentPane.getChild("rankList").asList,this._friendList=this.contentPane.getChild("friendList").asList,this._seasonRankList=this.contentPane.getChild("rankSeasonList").asList,this._selfInfo=this.contentPane.getChild("selfInfo").asCom,this._selfSeasonCom=this.contentPane.getChild("selfInfoRankSeason").asCom,this._selfInfo.clearContent(),this._selfSeasonCom.clearContent(),this.contentPane.getChild("closeBtn").asButton.addClickListener(this._onClickClose,this),this._rankList.addEventListener(fairygui.ItemEvent.CLICK,this._onClickItem,this),this._friendList.addEventListener(fairygui.ItemEvent.CLICK,this._onClickItem,this),this._seasonRankList.addEventListener(fairygui.ItemEvent.CLICK,this._onClickItem,this),this._rankList.itemClass=i,this._rankList.itemRenderer=this._renderWorldRank,this._rankList.callbackThisObj=this,this._rankList.setVirtual(),this._seasonRankList.itemClass=r,this._seasonRankList.itemRenderer=this._renderSeasonRank,this._seasonRankList.callbackThisObj=this,this._seasonRankList.setVirtual(),this._worldRankBtn=this.contentPane.getChild("worldChk").asButton,this._friendRankBtn=this.contentPane.getChild("friendChk").asButton,this._rankSeasonBtn=this.contentPane.getChild("rankSeasonChk").asButton,this._friendRankBtn.addClickListener(function(){t.initFriendList()},this),this._worldRankBtn.addClickListener(function(){t.initWorldList()},this),this._rankSeasonBtn.addClickListener(function(){t.initSeasonRankList()},this),this._rankInfo=null,this._seasonRankInfo=null,this._selfWorldRankinfo=null,LanguageMgr.inst.isChineseLocale()||(this.contentPane.getChild("updateTxt").asTextField.align=fairygui.AlignType.Center,this.contentPane.getChild("updateTxt2").asTextField.align=fairygui.AlignType.Center),this._rankSeasonBtn.visible=Home.FunctionMgr.inst.isRankSeasonOpen()},n.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.open.apply(this,t),this.initWorldList(),this.contentPane.getController("switch").selectedIndex=0,Core.ViewManager.inst.getView(ViewName.newHome).setVisible(!1),[2]})})},n.prototype.initFriendList=function(){return __awaiter(this,void 0,void 0,function(){var e,r,n,o,s,a;return __generator(this,function(u){switch(u.label){case 0:return this._friendList.removeChildren(0,-1,!0),this._selfInfo.clearContent(),[4,Social.FriendMgr.inst.fetchFriendList()];case 1:for(e=u.sent(),r=[],e&&null!=e.friends&&e.friends.forEach(function(t){r.push(t.toData())}),r.push({uid:Player.inst.uid,name:Player.inst.name,score:Player.inst.getResource(ResType.T_SCORE),camp:t.PvpMgr.inst.fightCamp}),r=r.sort(function(t,e){return t.score>e.score?-1:1}),n=0;n<r.length;++n)o=r[n],s=n+1,a=fairygui.UIPackage.createObject(PkgName.pvp,"rankingPlayer",i),a.refreshByData(o,s),this._friendList.addChild(a),o.uid==Player.inst.uid&&this._selfInfo.refreshByData(o,s);return[2]}})})},n.prototype.initWorldList=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o,s=this;return __generator(this,function(a){switch(a.label){case 0:return e=new Date,i=e.getDate(),this._rankInfo&&!t.PvpMgr.inst.pvpRankNeedRefresh?[3,2]:[4,Net.rpcCall(pb.MessageID.C2S_FETCH_RANK,null)];case 1:if(r=a.sent(),0!=r.errcode)return[2];n=pb.RankInfo.decode(r.payload),this._rankInfo=n,o=!1,this._rankList.numItems=0,this._updateTimeText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60091),Core.StringUtils.secToDate(n.UpdateTime,"mdh")),n.Items.forEach(function(t){var e=t;e.Uid==Player.inst.uid&&(s._selfWorldRankinfo=e)}),this._rankList.numItems=this._rankInfo.Items.length,t.PvpMgr.inst.pvpRankNeedRefresh=!1,a.label=2;case 2:return this._selfWorldRankinfo?this._selfInfo.refresh(this._selfWorldRankinfo):this._selfInfo.clearContent(),[2]}})})},n.prototype.initSeasonRankList=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r=this;return __generator(this,function(n){switch(n.label){case 0:return this._seasonRankInfo&&!t.PvpMgr.inst.pvpSeasonRankNeedRefresh?[3,2]:[4,Net.rpcCall(pb.MessageID.C2S_FETCH_SEASON_RANK,null)];case 1:if(e=n.sent(),0!=e.errcode)return[2];i=pb.RankInfo.decode(e.payload),this._seasonRankInfo=i,this._seasonRankList.numItems=0,i.Items.forEach(function(t){var e=t;e.Uid==Player.inst.uid&&(r._selfSeasonRankInfo=e)}),this._seasonRankList.numItems=i.Items.length,t.PvpMgr.inst.pvpSeasonRankNeedRefresh=!1,this._selfSeasonRankInfo?this._selfSeasonCom.refresh(this._selfSeasonRankInfo):this._selfSeasonCom.clearContent(),n.label=2;case 2:return[2]}})})},n.prototype._renderWorldRank=function(t,e){var i=this._rankInfo.Items[t],r=e;r.refresh(i)},n.prototype._renderSeasonRank=function(t,e){var i=this._seasonRankInfo.Items[t],r=e;r.refresh(i)},Object.defineProperty(n.prototype,"initialized",{get:function(){return this._initialized},set:function(t){this._initialized=t},enumerable:!0,configurable:!0}),n.prototype._onClickClose=function(){Core.ViewManager.inst.closeView(this)},n.prototype._onClickItem=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return e=t.itemObject,[4,e.fetchAndShowDetail(this)];case 1:return i.sent(),[2]}})})},n.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),Core.ViewManager.inst.getView(ViewName.newHome).setVisible(!0),[2]})})},n}(Core.BaseWindow);t.RankListWnd=n,__reflect(n.prototype,"Pvp.RankListWnd")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._rankTitleText=this.getChild("RankName").asTextField,this._rankTitleText.textParser=Core.StringUtils.parseColorText,this._rankIcon=this.getChild("rankIcon").asLoader,this._rewardList=this.getChild("resultList").asList,this._rankTitleTrans=this.getTransition("t0"),this._rewardList.itemClass=CardPool.CardItem,this._rewardList.itemRenderer=this._renderRewardList,this._rewardList.callbackThisObj=this,this._cardItems=[],this._rewardList.addEventListener(fairygui.ItemEvent.CLICK,this._onClickCardItem,this)},i.prototype.initWithPvpLevel=function(e){this._rewardList.numItems=0,this._pvpLevel=e;var i=t.Config.inst.getPvpTeamName(e);this._rankTitleText.text=""+i;var r=t.Config.inst.getPvpTeam(e);this._rankIcon.url="common_rank"+r+"_png";var n=t.Config.inst.getUnlockCard(e);this._rewardList.numItems=n.length},i.prototype._renderRewardList=function(e,i){var r=t.Config.inst.getUnlockCard(this._pvpLevel);if(0>e||e>=r.length)return void console.debug("_renderRewardList error idx=%d",e);var n=r[e],o=i,s=CardPool.CardPoolMgr.inst.getCollectCard(n);o.setData(s),o.setRankRewardMode(),this._cardItems.push(o)},i.prototype._onClickCardItem=function(t){var e=t.itemObject;Core.ViewManager.inst.open(ViewName.cardInfo,e.cardObj)},i.prototype.update=function(){for(var t=0,e=this._cardItems;t<e.length;t++){var i=e[t];i.update(),i.setRankRewardMode()}},i.prototype.playRankTitleAnimation=function(t){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(i){switch(i.label){case 0:return[4,new Promise(function(i){e._rankTitleTrans.play(function(){t.touchable=!0,i()},e)})];case 1:return i.sent(),[2]}})})},i.prototype.destroy=function(){this._rewardList.numItems=0,this._cardItems.forEach(function(t){t.dispose(),console.log("	... dispose")}),this._cardItems=[],this.dispose(),console.log("dispose...")},i}(fairygui.GComponent);t.RankRewardCom=e,__reflect(e.prototype,"Pvp.RankRewardCom")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.adjust(this.getChild("bg"),Core.AdjustType.EXCEPT_MARGIN),this.y+=window.support.topMargin,this._list=this.getChild("resultList").asList,this._btnClose=this.getChild("btnClose").asButton,this._listItems=new Collection.Dictionary,this._pvpLevel=t.PvpMgr.inst.getPvpLevel(),this._curRewardLevel=0,this._rewardPvpLevels=[],this._onClosePlayTreasureAni=!1,this._btnClose.addClickListener(this._onClickClose,this),Player.inst.addEventListener(Player.ResUpdateEvt,this._onPlayerResUpdate,this),this._initList()},i.prototype._initList=function(){for(var e=Data.rank.keys,i=e.length-1;i>=0;i--){var r=e[i],n=t.Config.inst.getUnlockCard(r);if(n.length>0){this._rewardPvpLevels.push(r);var o=fairygui.UIPackage.createObject(PkgName.pvp,"rankRewardCard",t.RankRewardCom).asCom;o.initWithPvpLevel(r),this._list.addChild(o),this._listItems.setValue(r,o)}}},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a,u,h;return __generator(this,function(l){switch(l.label){case 0:return e.prototype.open.apply(this,i),this._onClosePlayTreasureAni=i[0],r=t.PvpMgr.inst.getPvpLevel(),n=t.Config.inst.getMiniLevelInPvpTeam(t.Config.inst.getPvpTeam(r)),(o=this._listItems.getValue(n))?(this._list.touchable=!1,this._list.scrollToView(this._list.getChildIndex(o)),[4,o.playRankTitleAnimation(this._list)]):[3,2];case 1:return l.sent(),[3,3];case 2:this._list.scrollToView(this._list.numItems-1),l.label=3;case 3:return Player.inst.hasGetVipExperience&&(Player.inst.hasGetVipExperience=!1,s=new t.GetRewardData,a=Payment.PayMgr.inst.getProducts(),u=a.getValue("advip"),h=Core.StringUtils.TEXT(70191)+"\n\n"+Core.StringUtils.TEXT(60023)+": "+Core.StringUtils.secToString(Player.inst.vipTime,"hm"),s.addOther(u.name,"shop_"+u.icon+"_png",h),Core.ViewManager.inst.open(ViewName.getRewardWnd,s)),[2]}})})},i.prototype.close=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return[4,e.prototype.close.apply(this,i)];case 1:return n.sent(),r=t.PvpMgr.inst.getPvpLevel(),r>=5&&"true"!=egret.localStorage.getItem("showReview")&&(egret.localStorage.setItem("showReview","true"),console.log("OPEN_APP_COMMENT"),Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.OPEN_APP_COMMENT)),!Core.DeviceUtils.isWXGame()&&Player.inst.isNewbieName(Player.inst.name)&&r>=2&&Core.ViewManager.inst.open(ViewName.modifyName),[2]}})})},i.prototype._onClickClose=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i=this;return __generator(this,function(r){switch(r.label){case 0:return t=this.getController("page").selectedIndex,[4,new Promise(function(e){i._list.getChildAt(t).asCom.getTransition("t1").play(function(){e()})})];case 1:return r.sent(),[4,new Promise(function(e){i.getTransition("t1").play(function(){i._list.getChildAt(t).asCom.getTransition("t1").playReverse(),e()})})];case 2:return r.sent(),[4,Core.ViewManager.inst.closeView(this)];case 3:return r.sent(),1!=this._onClosePlayTreasureAni?[3,5]:(e=Core.ViewManager.inst.getView(ViewName.match),[4,e.tryPlayTreasureAddAnimation()]);case 4:r.sent(),r.label=5;case 5:return[2]}})})},i.prototype._onPlayerResUpdate=function(){var e=t.PvpMgr.inst.getPvpLevel();if(e!=this._pvpLevel){for(var i=this._listItems.keys(),r=0,n=i;r<n.length;r++){var o=n[r],s=this._listItems.getValue(o);s.update()}this._pvpLevel=e}},i}(Core.BaseView);t.RankRewardView=e,__reflect(e.prototype,"Pvp.RankRewardView")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this._goldText=this.getChild("goldCnt").asTextField,this._jadeText=this.getChild("jadeCnt").asTextField,this._cardText=this.getChild("cardCnt").asTextField,this._rareCardNumText=this.getChild("txt1").asTextField,this._boxName=this.getChild("txt2").asTextField,this._effBox0=this.getChild("box0").asLoader,this._effBox1=this.getChild("box1").asLoader,this.center(),this.modal=!0,this.adjust(this.getChild("closeBg")),this.getChild("closeBtn").addClickListener(this._onClose,this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){return t.prototype.open.apply(this,e),this._treasureCom=e[1],this._treasureData=e[1],this._goldText.text="x"+this._treasureData.getMinGoldCnt(),this._jadeText.text="x"+this._treasureData.getMinJadeCnt(),this._cardText.text="x"+this._treasureData.getCardNum(),this._boxName.text=""+this._treasureData.getName(),i=this._treasureData.getRareCardNum(),0>=i?this._rareCardNumText.visible=!1:(this._rareCardNumText.visible=!0,this._rareCardNumText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60130),i)),r=this._treasureData.getRareType(),this._effBox0.url="treasure_"+r+"0_png",this._effBox1.url="treasure_"+r+"1_png",[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e.prototype._onClose=function(t){Core.ViewManager.inst.closeView(this)},e}(Core.BaseWindow);t.RankSeasonTreasureInfo=e,__reflect(e.prototype,"Pvp.RankSeasonTreasureInfo")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.initUI=function(){var t=this;e.prototype.initUI.call(this),this.adjust(this.getChild("bg"),Core.AdjustType.EXCEPT_MARGIN),this.y+=window.support.topMargin,this._wnd=this.getChild("resultList").asList.addItemFromPool().asCom,this._timeText=this._wnd.getChild("time").asTextField,this._totalCnt=this._wnd.getChild("totalCnt").asTextField,this._winCnt=this._wnd.getChild("winCnt").asTextField,this._offensiveRate=this._wnd.getChild("offensiveRate").asTextField,this._defensiveRate=this._wnd.getChild("defensiveRate").asTextField,this._treasureName=this._wnd.getChild("treasureName").asTextField,this._seasonStarNum=this._wnd.getChild("title").asTextField,this._treasureBox=this._wnd.getChild("n22").asLoader,this._treasureBox.addClickListener(this._onTreasure,this),this._treasureBox1=this._wnd.getChild("n35").asLoader,this._treasureBox1.addClickListener(function(){Core.ViewManager.inst.open(ViewName.dailyTreasureInfo,t)},this),this._skinReward=this._wnd.getChild("skinReward").asCom,this._skinDesc=this._wnd.getChild("skinDesc").asTextField,this._headFrame=this._wnd.getChild("headFrame").asCom,this._headFrameDesc=this._wnd.getChild("headFrameDesc").asTextField,this._closeBtn=this.getChild("btnClose").asButton,this._closeBtn.addClickListener(this._onCloseBtn,this)},r.prototype.open=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return __awaiter(this,void 0,void 0,function(){var n,o,s,a,u,h,l,c,d,p;return __generator(this,function(_){for(e.prototype.open.apply(this,r),n=t.PvpMgr.inst.getPvpLevel(),o=t.Config.inst.getPvpTeam(n),this._skinId="SK03201",s=CardPool.CardSkinMgr.inst.getSkinConf(this._skinId),this._cardId=s.general,this._skinReward.getChild("nameText").asTextField.text=s.name,this._skinReward.getChild("nameText").visible=!0,this._skinDesc.text=s.desc,Utils.setImageUrlPicture(this._skinReward.getChild("cardImg").asImage,"skin_m_"+this._skinId+"_png"),this._skinReward.addClickListener(this._onSkinBtn,this),a=Data.headFrame_config.get("4"),this._headFrameDesc.text=a.desc,Utils.setImageUrlPicture(this._headFrame.getChild("headFrame").asImage,"headframe_4_png"),Utils.setImageUrlPicture(this._wnd.getChild("headIcon").asImage,Player.inst.avatarUrl),this._headFrame.getChild("newHint").visible=!1,this._wnd.getChild("rankLevel").asTextField.text=t.Config.inst.getPvpTitle(n),this._wnd.getChild("rankIcon").asLoader.url="common_rank"+o+"_png",this._seasonStarNum.text=Player.inst.getResource(ResType.SeasonWinDiff).toString(),u=r[0],this._time=u.LimitTime,fairygui.GTimers.inst.remove(this._updateTime,this),fairygui.GTimers.inst.add(1e3,this._time,this._updateTime,this),this._totalCnt.text=(u.FirstHandAmount+u.BackHandAmount).toString(),this._winCnt.text=(u.FirstHandWinAmount+u.BackHandWinAmount).toString(),0==u.FirstHandAmount?this._offensiveRate.text=Core.StringUtils.TEXT(70112):this._offensiveRate.text=Math.round(u.FirstHandWinAmount/u.FirstHandAmount*100)+"%",0==u.BackHandAmount?this._defensiveRate.text=Core.StringUtils.TEXT(70112):this._defensiveRate.text=Math.round(u.BackHandWinAmount/u.BackHandAmount*100)+"%",h=Data.season_reward.keys,l=Player.inst.getResource(ResType.SeasonWinDiff),c=h.length-1;c>=0;c--)if(d=Data.season_reward.get(h[c]),d.team>0&&l>=d.winFlag){this._treasureData=new i(Data.treasure_config.get(d.treasure)),this._treasureBox.url="treasure_box"+this._treasureData.rare+"_png",this._treasureName.text=this._treasureData.title,this._treasureBox.data=this._treasureData;break}return p=new Treasure.TreasureItem(-1,Data.season_reward.get(5).treasure),this._treasure=p,[2]})})},r.prototype._onSkinBtn=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t=CardPool.CardPoolMgr.inst.getCollectCard(this._cardId),Core.ViewManager.inst.open(ViewName.skinView,t,this._skinId),[2]})})},r.prototype._onTreasure=function(t){var e=t.target;Core.ViewManager.inst.open(ViewName.rankSeasonTreasureInfo,this,e.data)},r.prototype._onCloseBtn=function(){Core.ViewManager.inst.closeView(this)},r.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},r.prototype._updateTime=function(){this._timeText.text=""+Core.StringUtils.secToString(this._time,"dhms"),this._time-=1,this._time<=0&&(this._timeText.text=Core.StringUtils.TEXT(70120),fairygui.GTimers.inst.remove(this._updateTime,this))},Object.defineProperty(r.prototype,"treasure",{get:function(){return this._treasure},enumerable:!0,configurable:!0}),r}(Core.BaseWindow);t.RankSeasonWnd=e,__reflect(e.prototype,"Pvp.RankSeasonWnd");var i=function(){function t(t){this._treasureData=t}return Object.defineProperty(t.prototype,"rare",{get:function(){return this._treasureData.rare},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"title",{get:function(){return this._treasureData.title},enumerable:!0,configurable:!0}),t.prototype.getName=function(){return this._treasureData.title},t.prototype.getMinGoldCnt=function(){return this._treasureData.goldMin},t.prototype.getMaxGoldCnt=function(){return this._treasureData.goldMax},t.prototype.getMinJadeCnt=function(){return this._treasureData.jadeMin},t.prototype.getMaxJadeCnt=function(){return this._treasureData.jadeMax},t.prototype.getCardNum=function(){return this._treasureData.cardCnt},t.prototype.getRareCardNum=function(){var t=0;return t=this._treasureData.cardStar5+this._treasureData.cardStar4+this._treasureData.cardStar3},t.prototype.getRareType=function(){return this._treasureData.rare},t}();t.SeasonTreasureInfo=i,__reflect(i.prototype,"Pvp.SeasonTreasureInfo")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.modal=!0,this.center(),this._rankIconImg=this.contentPane.getChild("rankIcon").asLoader,this._rankTitleText=this.contentPane.getChild("rankLevel").asTextField,this._confirmBtn=this.contentPane.getChild("confirmBtn").asButton,this._onClosePlayTreasureAni=!1,this._confirmBtn.addClickListener(this._onConfirm,this)},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a;return __generator(this,function(u){switch(u.label){case 0:return[4,e.prototype.open.apply(this,i)];case 1:return u.sent(),this._onClosePlayTreasureAni=i[0],1==this._onClosePlayTreasureAni&&(r=Core.ViewManager.inst.getView(ViewName.match),n=r.getLatestAddTreasureCom(),n&&(o=n.treasure,o&&(n.hideContent(),n.touchable=!1))),s=t.PvpMgr.inst.getPvpLevel(),a=t.Config.inst.getPvpTeam(s),this._rankIconImg.url="common_rank"+a+"_png",this._rankTitleText.text=t.Config.inst.getPvpTitle(s),[2]}})})},i.prototype._onConfirm=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,Core.ViewManager.inst.closeView(this)];case 1:return i.sent(),e=t.PvpMgr.inst.getPvpLevel(),[4,Core.ViewManager.inst.open(ViewName.rankRewardView,this._onClosePlayTreasureAni)];case 2:return i.sent(),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60174)+t.Config.inst.getPvpTitle(e)),[2]}})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,e.prototype.close.apply(this,t)];case 1:return i.sent(),[2]}})})},i}(Core.BaseWindow);t.RankupTipsWnd=e,__reflect(e.prototype,"Pvp.RankupTipsWnd");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this._cardList=this.contentPane.getChild("resultList").asList},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r=this;return __generator(this,function(n){switch(n.label){case 0:return[4,t.prototype.open.apply(this,e)];case 1:return n.sent(),i=e[1],i.forEach(function(t){var e=CardPool.CardPoolMgr.inst.getCardData(t,1);if(e){var i=new CardPool.Card(e);i.amount=1;var n=fairygui.UIPackage.createObject(PkgName.treasure,"cardCnt",Treasure.CardRewardCom).asCom;n.count=1,n.setCardObj(i),n.enableClick(!0),r._cardList.addChild(n)}}),[2]}})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),this._cardList.removeChildren(),[2]})})},e}(e);t.RankupRewardTipsWnd=i,__reflect(i.prototype,"Pvp.RankupRewardTipsWnd")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var e=this;this._weiPoolList=new t.CampPoolList(this.getChild("weiPoolList").asList,this.getController("weiPoolCtrl")),this._shuPoolList=new t.CampPoolList(this.getChild("shuPoolList").asList,this.getController("shuPoolCtrl")),this._wuPoolList=new t.CampPoolList(this.getChild("wuPoolList").asList,this.getController("wuPoolCtrl")),this._fightCampCtrl=this.getController("campCtrl"),this._weiPoolClickWnd=this.getChild("weiPoolClickWnd").asLoader,this._shuPoolClickWnd=this.getChild("shuPoolClickWnd").asLoader,this._wuPoolClickWnd=this.getChild("wuPoolClickWnd").asLoader,this.getChild("weiPrePoolBtn").asButton.addClickListener(this._onWeiPrePool,this),this.getChild("weiNextPoolBtn").asButton.addClickListener(this._onWeiNextPool,this),this.getChild("shuPrePoolBtn").asButton.addClickListener(this._onShuPrePool,this),this.getChild("shuNextPoolBtn").asButton.addClickListener(this._onShuNextPool,this),this.getChild("wuPrePoolBtn").asButton.addClickListener(this._onWuPrePool,this),this.getChild("wuNextPoolBtn").asButton.addClickListener(this._onWuNextPool,this),this._fightCampCtrl.addEventListener(fairygui.StateChangeEvent.CHANGED,this._onFightCampChanged,this),Core.EventCenter.inst.addEventListener(Core.Event.HomeListChangedEvt,this._onHomeListChanged,this),Core.EventCenter.inst.addEventListener(GameEvent.FightPoolUpdateCardEv,this._onFightPoolUpdateCard,this),this._weiPoolClickWnd.addClickListener(function(){e._weiPoolList.fireClick()},this),this._shuPoolClickWnd.addClickListener(function(){e._shuPoolList.fireClick()},this),this._wuPoolClickWnd.addClickListener(function(){e._wuPoolList.fireClick()},this)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.open.apply(this,t),this.refresh.apply(this,t),[2]})})},i.prototype.refresh=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o,s,a,u=this;return __generator(this,function(h){if(e=t[0],this._curFightCamp=e,this._lastFightCamp=e,i=t[1],this._changeFightCampCtrl(e),this._renderPoolsExecutor=new Core.FrameExecutor,r=this._getPoolList(e),!r)return[2];for(this._renderPoolsExecutor.regist(r.refresh,r,i.getValue(e)),n=0,o=[Camp.WEI,Camp.SHU,Camp.WU];n<o.length;n++)s=o[n],s!=e&&(a=this._getPoolList(s),this._renderPoolsExecutor.regist(a.refresh,a,i.getValue(s)));return egret.callLater(function(){u._renderPoolsExecutor.execute()},this),this._updateFightCampAndPool(),[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),this._renderPoolsExecutor&&(this._renderPoolsExecutor.cancel(),this._renderPoolsExecutor=null),this._weiPoolList.clear(),this._shuPoolList.clear(),this._wuPoolList.clear(),[2]})})},i.prototype._changeFightCampCtrl=function(t){switch(t){case Camp.WEI:this._fightCampCtrl.selectedIndex=0;break;case Camp.SHU:this._fightCampCtrl.selectedIndex=1;break;case Camp.WU:this._fightCampCtrl.selectedIndex=2;break;default:return}},i.prototype._onFightPoolUpdateCard=function(t){this._changeFightCampCtrl(t.data.camp)},i.prototype._onFightCampChanged=function(){var e=this._getFightCamp();e!=this._curFightCamp&&(this._curFightCamp=e),t.PvpMgr.inst.fightCamp=e},i.prototype._getFightCamp=function(){switch(this._fightCampCtrl.selectedIndex){case 0:return Camp.WEI;case 1:return Camp.SHU;case 2:return Camp.WU;default:return Camp.WEI}},i.prototype._getPoolList=function(t){switch(t){case Camp.WEI:return this._weiPoolList;case Camp.SHU:return this._shuPoolList;case Camp.WU:return this._wuPoolList;default:return null}},i.prototype._getFightPool=function(t){var e=this._getPoolList(t);return e.getCurFightPool()},i.prototype._prePool=function(t){this._getPoolList(t).prePool()},i.prototype._nextPool=function(t){this._getPoolList(t).nextPool()},i.prototype._onWeiPrePool=function(){this._prePool(Camp.WEI)},i.prototype._onWeiNextPool=function(){this._nextPool(Camp.WEI)},i.prototype._onShuPrePool=function(){this._prePool(Camp.SHU)},i.prototype._onShuNextPool=function(){this._nextPool(Camp.SHU)},i.prototype._onWuPrePool=function(){this._prePool(Camp.WU)},i.prototype._onWuNextPool=function(){this._nextPool(Camp.WU)},i.prototype._updateFightPool=function(){var e=this,i=[];[Camp.WEI,Camp.SHU,Camp.WU].forEach(function(t){var r=e._getPoolList(t),n=e._getFightPool(t);!n||r.oldfightPool&&r.oldfightPool.id==n.id||(i.push({PoolId:n.id,Camp:t}),r.oldfightPool=n)}),(i.length>0||this._curFightCamp!=this._lastFightCamp)&&(this._lastFightCamp=this._curFightCamp,t.PvpMgr.inst.updateFightPool(i,this._curFightCamp))},i.prototype._updateFightCampAndPool=function(){var e=this._getFightCamp(),i=this._getFightPool(e);i&&e&&(t.PvpMgr.inst.fightPool=i,t.PvpMgr.inst.fightCamp=e)
},i.prototype._onHomeListChanged=function(){this._updateFightPool(),this._updateFightCampAndPool()},i}(Core.BaseView);t.TeamView=e,__reflect(e.prototype,"Pvp.TeamView")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){var i=this;t.prototype.constructFromXML.call(this,e),this._nameText=this.getChild("nameText").asTextField,this._nameText.textParser=Core.StringUtils.parseColorText,this._image=this.getChild("cardImg").asLoader,this._frame=this.getChild("frameImg").asLoader,this._bg=this.getChild("baseImg").asLoader,this._nameBg=this.getChild("nameBg").asLoader,this._equipBtn=this.getChild("equipBtn").asButton,this._cardId=null,this._skinId=null,this._equipId=null,this.addClickListener(function(){if(i._cardId){var t=Data.pool.get(i._cardId);console.debug(t);var e=new CardPool.Card(t);e.level=t.level,i._skinId&&(e.skin=i._skinId),i._equipId&&(e.equip=i._equipId),Core.ViewManager.inst.open(ViewName.cardInfoOther,e)}},this)},e.prototype.setCardId=function(t,e){var i=this,r=t.GCardID,n=t.Skin,o=t.Equip,s=Data.pool.get(r);if(s){var a=s.icon,u=s.name;this._nameText.text=u;var h=this._image.width,l=this._image.height;if(UI.CardImgTextureMgr.inst.fetchTexture(a,n,"s",function(t,e){i._image.texture=e,i._image.width=h,i._image.height=l}),""==o)this._equipBtn.visible=!1;else{this._equipBtn.visible=!0;var c=Data.item.get(o);this._equipBtn.icon="equip_"+c.iconSmall+"_png",e?this._equipBtn.getChild("bg").asLoader.url="equip_equipWnd_png":this._equipBtn.getChild("bg").asLoader.url="equip_equipWndEnemy_png"}var d=s.rare;this._frame.url="cards_deck_s"+d+"_png",99==d?this._nameBg.url="pvp_name_limited_png":this._nameBg.url="pvp_name_normal_png",this._cardId=r,this._skinId=n,this._equipId=o}},e}(fairygui.GComponent);t.VideoCardCom=e,__reflect(e.prototype,"Pvp.VideoCardCom")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._nameTxt=this.getChild("name").asTextField,this._nameTxt.textParser=Core.StringUtils.parseColorText,this._messageTxt=this.getChild("messageTxt").asTextField,this._likeBtn=this.getChild("likeBtn").asButton,this._timeTxt=this.getChild("time").asTextField,this._headCom=this.getChild("head").asCom,this._likeBtn.addClickListener(this._onLikeBtn,this),this._headCom.addClickListener(this._onHead,this)},i.prototype._onLikeBtn=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return this._disObj.isLike?[2]:[3,1];case 1:return e={VideoID:this._disObj.videoID,CommentsID:this._disObj.discussID},[4,Net.rpcCall(pb.MessageID.C2S_LIKE_VIDEO_COMMENTS,pb.LikeVideoCommentsArg.encode(e))];case 2:i=n.sent(),0==i.errcode&&(r=pb.LikeVideoCommentsReply.decode(i.payload),this._disObj.isLike=!0,this._disObj.likeNum+=1,t.DiscussDataMgr.inst.addDisussData(this._disObj),this._likeBtn.getTransition("t0").play(),this._updateCom()),n.label=3;case 3:return[2]}})})},i.prototype._updateCom=function(){this._nameTxt.text=this._disObj.userName,this._messageTxt.text=this._disObj.content,this._likeBtn.title=this._disObj.likeNum.toString(),this._headCom.setAll(this._disObj.headImage,this._disObj.frameImage),this._timeTxt.text=Core.StringUtils.format(Core.StringUtils.TEXT(60051),Core.StringUtils.secToString(Math.floor(Date.now()/1e3-this._disObj.time),"dhm")),this._disObj.isLike?this._likeBtn.getController("isLike").selectedIndex=1:this._likeBtn.getController("isLike").selectedIndex=0},i.prototype._onHead=function(){return __awaiter(this,void 0,void 0,function(){var t,t;return __generator(this,function(e){switch(e.label){case 0:return this._disObj.uid?this._disObj.uid!=Player.inst.uid?[3,2]:[4,Social.FriendMgr.inst.fetchPlayerInfo(Player.inst.uid)]:[2];case 1:return t=e.sent(),t&&Core.ViewManager.inst.open(ViewName.selfInfo,Player.inst.uid,t),[3,4];case 2:return[4,Social.FriendMgr.inst.fetchPlayerInfo(this._disObj.uid)];case 3:t=e.sent(),t&&Core.ViewManager.inst.open(ViewName.friendInfo,this._disObj.uid,t),e.label=4;case 4:return[2]}})})},i.prototype.setComValue=function(t){this._disObj=t,this._updateCom()},i}(fairygui.GComponent);t.VideoDisItem=e,__reflect(e.prototype,"Pvp.VideoDisItem")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.adjust(this.getChild("bg")),this._sendBtn=this.getChild("sendBtn").asButton,this._inputText=this.getChild("inputText").asTextInput,this._discussCnt=this.getChild("discussCnt").asTextField,this._titleTxt=this.getChild("titleTxt").asTextField,this._chatletList=this.getChild("chatletList").asList,this._chatletList.itemRenderer=this._renderListItem,this._chatletList.numItems=0,this._chatletList._scrollPane.addEventListener(fairygui.ScrollPane.PULL_UP_RELEASE,this._releaseList,this),this.getChild("bg").addClickListener(this._close,this),this.getChild("closeBtn").asButton.addClickListener(this._close,this),this._sendBtn.addClickListener(this._onSendBtn,this)},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return e.prototype.open.apply(this,i),Core.ViewManager.inst.isShow(ViewName.battle)?Core.LayerManager.inst.topLayer.addChild(this):Core.LayerManager.inst.mainLayer.addChild(this),t.DiscussDataMgr.inst.reDisussDataMgr(),this._itemNum=0,this._curAmount=0,this._more=!0,this._chatletList.numItems=0,this._video=t.VideoCenter.inst.curVideo,this._parentCom=t.VideoCenter.inst.curVideoCom,this._discussCnt.text=Core.StringUtils.format(Core.StringUtils.TEXT(60060),this._video.commentsAmount),this._titleTxt.text=this._video.title,this._updateDiscuss(i[0]),[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i.prototype._releaseList=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(r){switch(r.label){case 0:return this._more?(t={VideoID:this._video.id,CurAmount:this._curAmount},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_VIDEO_COMMENTS,pb.FetchVideoCommentsArg.encode(t))]):[3,2];case 1:e=r.sent(),0==e.errcode&&(i=pb.FetchVideoCommentsReply.decode(e.payload),this._updateDiscuss(i)),r.label=2;case 2:return[2]}})})},i.prototype._updateDiscuss=function(e){return __awaiter(this,void 0,void 0,function(){var i,r=this;return __generator(this,function(n){return i=0,e.CommentsList.forEach(function(e){var n=new t.DiscussData(r._video.id,e);t.DiscussDataMgr.inst.addDisussData(n),i+=1}),this._itemNum=t.DiscussDataMgr.inst.discussNum,this._chatletList.numItems=this._itemNum,this._itemNum<=0?this.getChild("emptyHintText").asTextField.visible=!0:this.getChild("emptyHintText").asTextField.visible=!1,this._curAmount+=i,this._more=e.HasMore,[2]})})},i.prototype._renderListItem=function(e,i){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return r=i,[4,r.setComValue(t.DiscussDataMgr.inst.getDiscussData4Index(e))];case 1:return n.sent(),[2]}})})},i.prototype._onSendBtn=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o,s;return __generator(this,function(a){switch(a.label){case 0:return e=this._inputText.text,e=e.trim(),e.length<=0?[2]:(i={VideoID:this._video.id,Content:e},[4,Net.rpcCall(pb.MessageID.C2S_COMMENTS_VIDEO,pb.CommentsVideoArg.encode(i))]);case 1:return r=a.sent(),0==r.errcode?(this._inputText.text="",n=pb.CommentsVideoReply.decode(r.payload),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60074)),o=new pb.VideoComments,o.Content=e,o.HeadImgUrl=Player.inst.avatarUrl,o.ID=n.CommentsID,o.Name=Player.inst.name,o.IsLike=!1,o.Like=0,o.Time=Date.now(),o.Uid=Player.inst.uid,o.HeadFrame=Player.inst.frameID,s=new t.DiscussData(this._video.id,o),t.DiscussDataMgr.inst.addDisussData(s),this._itemNum=t.DiscussDataMgr.inst.discussNum,this._chatletList.numItems=this._itemNum,this._video.commentsAmount+=1,this._discussCnt.text=Core.StringUtils.format(Core.StringUtils.TEXT(60060),this._video.commentsAmount),this._parentCom.updatedisNum(),this.getChild("emptyHintText").asTextField.visible=!1):101==r.errcode&&Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60210)),[2]}})})},i.prototype._close=function(){Core.ViewManager.inst.close(ViewName.videoDiscuss)},i}(Core.BaseView);t.VideoDiscussWnd=e,__reflect(e.prototype,"Pvp.VideoDiscussWnd")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var i=this;e.prototype.initUI.call(this),this.adjust(this.getChild("panel"),Core.AdjustType.EXCEPT_MARGIN),this.y+=window.support.topMargin/2,this._closeBtn=this.getChild("closeBtn").asButton,this._leftBtn=this.getChild("leftBtn").asButton,this._rightBtn=this.getChild("rightBtn").asButton,this._videoList=this.getChild("rankList").asList,this._searchBtn=this.getChild("searchBtn").asButton,this._curTeam=Math.max(t.Config.MIN_RANK_TAEM,t.Config.inst.getPvpTeam(t.PvpMgr.inst.getPvpLevel())),this._leftBtn.addClickListener(this._onFetchPrevTeam,this),this._rightBtn.addClickListener(this._onFetchNextTeam,this),this._closeBtn.addClickListener(function(){Core.ViewManager.inst.closeView(i)},this),this._searchBtn.addClickListener(function(){Core.ViewManager.inst.open(ViewName.videoSearch)},this),this._videoList.itemClass=t.VideoHallItemCom,this._videoList.itemRenderer=this._renderVideoRecord,this._videoList.callbackThisObj=this,this._videoList.setVirtual(),this._videos=[]},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return this.setVisible(!0),e.prototype.open.apply(this,t),this._refresh(this._curTeam),[2]})})},i.prototype._refresh=function(e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return this.getChild("rankImg").asLoader.url="common_rank"+e+"_png",this.getChild("rankImg1").asLoader.url="common_rank"+e+"_png",this.getChild("rankTitleText").asTextField.text=t.Config.inst.getPvpTeamName(t.Config.inst.getMiniLevelInPvpTeam(e)),[4,t.VideoCenter.inst.getPublishVideos(e,!0)];case 1:return i=r.sent(),this._videoList.numItems=0,this._videos=i,this._videoList.numItems=i.length,this._curTeam=e,this._curTeam>=t.Config.MAX_RANK_TEAM?this._rightBtn.visible=!1:this._rightBtn.visible=!0,this._curTeam<=t.Config.MIN_RANK_TAEM?this._leftBtn.visible=!1:this._leftBtn.visible=!0,i.length>0?this.getChild("emptyHintText").visible=!1:this.getChild("emptyHintText").visible=!0,[2]}})})},i.prototype.beginRefreshItem=function(){},i.prototype.endRefreshItem=function(){},i.prototype._renderVideoRecord=function(t,e){var i=this._videos[t];if(i){var r=e;r.setVideo(i,this)}},i.prototype._onFetchNextTeam=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return SoundMgr.inst.playSoundAsync("page_mp3"),e=Math.min(this._curTeam+1,t.Config.MAX_RANK_TEAM),e==this._curTeam?[3,2]:[4,this._refresh(e)];case 1:i.sent(),i.label=2;case 2:return[2]}})})},i.prototype._onFetchPrevTeam=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return SoundMgr.inst.playSoundAsync("page_mp3"),e=Math.max(this._curTeam-1,t.Config.MIN_RANK_TAEM),e==this._curTeam?[3,2]:[4,this._refresh(e)];case 1:i.sent(),i.label=2;case 2:return[2]}})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),this._videoList.numItems=0,[2]})})},i}(Core.BaseWindow);t.VideoHallWnd=e,__reflect(e.prototype,"Pvp.VideoHallWnd")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){var i=this;e.prototype.constructFromXML.call(this,t),this._videoId=this.getChild("id").asTextField,this._hostNameText=this.getChild("name1").asTextField,this._guestNameText=this.getChild("name2").asTextField,this._hostNameText.textParser=Core.StringUtils.parseColorText,this._guestNameText.textParser=Core.StringUtils.parseColorText,this._hostResultText=this.getChild("resultTxt1").asLoader,this._guestResultText=this.getChild("resultTxt2").asLoader,this._watchTimeText=this.getChild("viewNum").asTextField,this._timeText=this.getChild("time").asTextField,this._playBtn=this.getChild("viewBtn").asButton,this._shareWechatBtn=this.getChild("shareWechatBtn").asButton,this._discussBtn=this.getChild("discussBtn").asButton,this._likeBtn=this.getChild("likeBtn").asButton,this._titleText=this.getChild("titleTxt").asTextField,this._likeBtnmsk=this._likeBtn.getChild("n9"),this._hostCardComs=[],this._guestCardComs=[],this._likeBtnmsk.visible=!1,this._discussBtn.addClickListener(this._onDiscuss,this),this._likeBtn.addClickListener(this._onLikeVideo,this);for(var r=1;5>=r;++r){var n=this.getChild("card"+r).asCom;this._hostCardComs.push(n)}for(var r=6;10>=r;++r){var n=this.getChild("card"+r).asCom;this._guestCardComs.push(n)}this._video=null,this._playBtn.addClickListener(this._onPlayVideo,this),this._shareWechatBtn.addClickListener(function(){if(i._video){console.log("++++ ",fairygui.GRoot.contentScaleFactor);var t=i._shareWechatBtn.localToGlobal(0,0),e=t.x/fairygui.GRoot.contentScaleFactor+30,r=t.y/fairygui.GRoot.contentScaleFactor-30;Core.ViewManager.inst.openPopup(ViewName.videoShareOption,i._video,e,r)}},this),this._shareWechatBtn.visible=Home.FunctionMgr.inst.isVideoToChatOpen()},i.prototype.updatedisNum=function(){this._discussBtn.title=this._video.commentsAmount.toString()},i.prototype.setVideo=function(t,e){this._hostWnd=e,this.displayObject.cacheAsBitmap=!1,this._video=t,this._videoId.text=""+t.id;var i=t.hostFighter.cards,r=!1;this._video.winner==this._video.hostFighter.uid?(this._hostResultText.url="cards_base1_s_png",this._guestResultText.url="cards_base2_s_png",r=!0):(this._hostResultText.url="cards_base2_s_png",this._guestResultText.url="cards_base1_s_png",r=!1);for(var n=0;n<i.length;++n){var o=i[n];this._hostCardComs[n]&&this._hostCardComs[n].setCardId(o,r)}for(var s=t.guestFighter.cards,n=0;n<s.length;++n){var o=s[n];this._guestCardComs[n]&&this._guestCardComs[n].setCardId(o,!r)}this._updateVideoInfo()},i.prototype._updateVideoInfo=function(){null!=this._hostWnd&&this._hostWnd.beginRefreshItem(),this.displayObject.cacheAsBitmap=!1,this._setName(this._hostNameText,this._video.hostFighter.name),this._setName(this._guestNameText,this._video.guestFighter.name),this._watchTimeText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60050),this._video.watchTimes),this._timeText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60051),Core.StringUtils.secToString(Math.floor(Date.now()/1e3-this._video.timeStamp),"dhm")),this._video.isShare?(this._discussBtn.title=this._video.commentsAmount.toString(),this._likeBtn.title=this._video.likeTimes.toString(),this._titleText.text=this._video.title):(this._titleText.text=Core.StringUtils.TEXT(60067),this._discussBtn.title="0",this._likeBtn.title="0"),this._video.isLike?this._likeBtn.getController("isLike").selectedIndex=1:this._likeBtn.getController("isLike").selectedIndex=0,this._likeBtn.getChild("n9").visible=this._video.isLike,this.displayObject.cacheAsBitmap=!0,null!=this._hostWnd&&this._hostWnd.endRefreshItem()},i.prototype._onPlayVideo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this._video?[4,t.VideoCenter.inst.playVideo(this._video,this)]:[3,2];case 1:e.sent()&&this._updateVideoInfo(),e.label=2;case 2:return[2]}})})},i.prototype._onHostDetail=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this._video.hostFighter.uid?[4,Social.FriendMgr.inst.fetchPlayerInfo(this._video.hostFighter.uid)]:[3,2];case 1:t=e.sent(),t?Core.ViewManager.inst.open(ViewName.selfInfo,this._video.hostFighter.uid,t):Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60202)),e.label=2;case 2:return[2]}})})},i.prototype._onGuestDetail=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this._video.guestFighter.uid?[4,Social.FriendMgr.inst.fetchPlayerInfo(this._video.guestFighter.uid)]:[3,2];case 1:t=e.sent(),t?Core.ViewManager.inst.open(ViewName.selfInfo,this._video.guestFighter.uid,t):Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60202)),e.label=2;case 2:return[2]}})})},i.prototype._onDiscuss=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return t.VideoCenter.inst.setCurVideo(this._video,this),e={VideoID:this._video.id,CurAmount:0},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_VIDEO_COMMENTS,pb.FetchVideoCommentsArg.encode(e))];case 1:return i=n.sent(),0==i.errcode&&(r=pb.FetchVideoCommentsReply.decode(i.payload),Core.ViewManager.inst.open(ViewName.videoDiscuss,r)),[2]}})})},i.prototype._onLikeVideo=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(r){switch(r.label){case 0:return this._video.isLike?[2]:(t={VideoID:this._video.id},[4,Net.rpcCall(pb.MessageID.C2S_LIKE_VIDEO,pb.LikeVideoArg.encode(t))]);case 1:return e=r.sent(),0==e.errcode&&(i=pb.LikeVideoResp.decode(e.payload),this._video.watchTimes=i.CurWatchTimes,this._video.likeTimes=i.CurLike,this._video.isLike=!0,Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60110)),this._likeBtnmsk.visible=!0,this._likeBtn.getTransition("t0").play(),this._updateVideoInfo()),[2]}})})},i.prototype._setName=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.text=e,e!=this._video.sharePlayerName?t.stroke=1:t.stroke=2,[2]})})},i.prototype.dispose=function(){this._video=null,this._hostWnd=null,e.prototype.dispose.call(this)},i.prototype.updateView=function(){this._updateVideoInfo()},i}(fairygui.GComponent);t.VideoItemCom=e,__reflect(e.prototype,"Pvp.VideoItemCom");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._shareBtn=this.getChild("shareBtn").asButton,this._shareBtn.addClickListener(this._onShareVideo,this)},e.prototype._onShareVideo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._video.isShare?[2]:(Core.ViewManager.inst.open(ViewName.videoUpload,this._video,this),[2])})})},e.prototype.shareOK=function(t){this._video.isShare=!0,Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60199)),this._video.title=t,this._updateVideoInfo()},e.prototype._updateVideoInfo=function(){t.prototype._updateVideoInfo.call(this),null!=this._hostWnd&&this._hostWnd.beginRefreshItem(),this.displayObject.cacheAsBitmap=!1,this._video.isShare?(this._shareBtn.title=Core.StringUtils.TEXT(60049),this._shareBtn.getController("button").setSelectedPage("down"),this.getController("share").selectedIndex=1):(this._shareBtn.title=Core.StringUtils.TEXT(60017),this.getController("share").selectedIndex=0),this.displayObject.cacheAsBitmap=!0,null!=this._hostWnd&&this._hostWnd.endRefreshItem()},e}(e);t.VideoRecordItemCom=i,__reflect(i.prototype,"Pvp.VideoRecordItemCom");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._likeBtn=this.getChild("likeBtn").asButton},e}(e);t.VideoHallItemCom=r,__reflect(r.prototype,"Pvp.VideoHallItemCom");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),console.log(e)},e}(e);t.VideoUpload=n,__reflect(n.prototype,"Pvp.VideoUpload");var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._bgImg1=this.getChild("bg1").asLoader,this._bgImg2=this.getChild("bg2").asLoader,this._shareWechatBtn.visible=!1,this._likeBtn.visible=!1,this._discussBtn.visible=!1,this.scaleX=.8,this.scaleY=.8,this._bgImg1.scaleY=.82,this._bgImg1.setXY(0,20),this._bgImg2.visible=!1,this._titleText.visible=!1,this._timeText.setXY(150,210)},e}(e);t.VideoShareItemCom=o,__reflect(o.prototype,"Pvp.VideoShareItemCom")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var i=this;e.prototype.initUI.call(this),this.adjust(this.getChild("panel"),Core.AdjustType.EXCEPT_MARGIN),this.y+=window.support.topMargin/2,this._page=1,this._curTeam=Math.max(t.Config.MIN_RANK_TAEM,t.Config.inst.getPvpTeam(t.PvpMgr.inst.getPvpLevel())),this._closeBtn=this.getChild("closeBtn").asButton,this._videoList=this.getChild("rankList").asList,this._friendChk=this.getChild("friendChk").asButton,this._worldChk=this.getChild("worldChk").asButton,this._worldList=this.getChild("worldList").asList,this._searchBtn=this.getChild("searchBtn").asButton,this._worldChk.addClickListener(this._onSelfBtn,this),this._friendChk.addClickListener(this._onWorldList,this),this._closeBtn.addClickListener(function(){Core.ViewManager.inst.closeView(i)},this),this._searchBtn.addClickListener(function(){Core.ViewManager.inst.open(ViewName.videoSearch)},this),this._videos=[],this._worldVideos=[],this._videoList.itemClass=t.VideoRecordItemCom,this._videoList.itemRenderer=this._renderVideoRecord,this._videoList.callbackThisObj=this,this._videoList.setVirtual(),this._worldList.setVirtual(),this._worldList.itemRenderer=this._renderWorldRecord,this._worldList.callbackThisObj=this,this._worldList.itemClass=t.VideoHallItemCom},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return this.setVisible(!0),e.prototype.open.apply(this,i),this.getController("switch").selectedIndex=0,[4,t.VideoCenter.inst.getSelfVideos(this._page)];case 1:return r=n.sent(),this._videos=r,this._videoList.numItems=this._videos.length,this._worldList.numItems=0,r.length>0?this.getChild("emptyHintText").visible=!1:this.getChild("emptyHintText").visible=!0,[2]}})})},i.prototype.beginRefreshItem=function(){},i.prototype.endRefreshItem=function(){},i.prototype._renderVideoRecord=function(t,e){var i=this._videos[t];if(i){var r=e;r.setVideo(i,this)}},i.prototype._renderWorldRecord=function(t,e){var i=this._worldVideos[t];if(i){var r=e;r.setVideo(i,this)}},i.prototype._onSelfBtn=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,t.VideoCenter.inst.getSelfVideos(this._page)];case 1:return e=i.sent(),this._videos=e,this._videoList.numItems=this._videos.length,this._videoList.refreshVirtualList(),[2]}})})},i.prototype._onWorldList=function(){this._refresh(this._curTeam)},i.prototype._refresh=function(e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return[4,t.VideoCenter.inst.getPublishVideos(e,!0)];case 1:return i=r.sent(),this._worldList.numItems=0,this._worldVideos=i,this._worldList.numItems=i.length,this._curTeam=e,this._worldList.refreshVirtualList(),i.length>0?this.getChild("emptyHintText2").visible=!1:this.getChild("emptyHintText2").visible=!0,[2]}})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),this._page=1,this._videoList.numItems=0,this._videos=[],[2]})})},i}(Core.BaseView);t.VideoRecordWnd=e,__reflect(e.prototype,"Pvp.VideoRecordWnd")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.center(),this.modal=!0,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._confirmBtn=this.contentPane.getChild("confirmBtn").asButton,this._searchInput=this.contentPane.getChild("searchInput").asTextInput,this._warningText=this.contentPane.getChild("warning").asTextField,this._closeBtn.addClickListener(function(){Core.ViewManager.inst.closeView(e)},this),this._confirmBtn.addClickListener(this._onSearch,this),this._searchInput.addEventListener(egret.Event.FOCUS_IN,function(){e._warningText.text=""},this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.open.apply(this,e),this._warningText.text="",[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),this._searchInput.text="",[2]})})},e.prototype._onSearch=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r;return __generator(this,function(n){switch(n.label){case 0:return(t=Core.StringUtils.stringToLong(this._searchInput.text))?(e={VideoID:t},[4,Net.rpcCall(pb.MessageID.C2S_WATCH_VIDEO,pb.WatchVideoArg.encode(e))]):(this._warningText.text=Core.StringUtils.TEXT(60156),[2]);case 1:return i=n.sent(),0!=i.errcode?[3,3]:(Core.ViewManager.inst.closeView(this),r=pb.WatchVideoResp.decode(i.payload),[4,Battle.VideoPlayer.inst.play(r.VideoData)]);case 2:return n.sent(),this._warningText.text="",[3,4];case 3:return this._warningText.text=Core.StringUtils.TEXT(60114),[2];case 4:return[2]}})})},e}(Core.BaseWindow);t.VideoSearchWnd=e,__reflect(e.prototype,"Pvp.VideoSearchWnd")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this._shareToFriendBtn=this.contentPane.getChild("privateChatBtn").asButton,this._shareToWorld=this.contentPane.getChild("worldChatBtn").asButton,this._shareToWeChat=this.contentPane.getChild("wechatBtn").asButton,this._shareToFriendBtn.addClickListener(this._onShareToFriend,this),this._shareToWorld.addClickListener(this._onShareToWorld,this),this._shareToWeChat.addClickListener(this._onShareToWeChat,this),Core.DeviceUtils.isWXGame()||(this._shareToWeChat.visible=!1,this._shareToWeChat.enabled=!1,this.contentPane.getChild("bottom").asLoader.height=133)},e.prototype._onShareToFriend=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return Core.ViewManager.inst.open(ViewName.friendOptionList,function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return e?[4,Social.ChatMgr.inst.sendPrivateChat(e.uid,e.name,e.headImgUrl,this._shareText)]:[3,2];case 1:t.sent(),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60256)),Core.ViewManager.inst.close(ViewName.videoShareOption),t.label=2;case 2:return[2]}})})}),[2]})})},e.prototype._onShareToWorld=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,Social.ChatMgr.inst.sendChat(Social.ChatChannel.WORLD,this._shareText)];case 1:return t=e.sent(),t&&(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60256)),Core.ViewManager.inst.close(ViewName.videoShareOption)),[2]}})})},e.prototype._onShareToWeChat=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._video&&Core.DeviceUtils.isWXGame()&&WXGame.WXShareMgr.inst.wechatShareBattleVideo(this._video.id),Core.ViewManager.inst.closeView(this),[2]})})},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return[4,t.prototype.open.apply(this,e)];case 1:return r.sent(),this._video=e[0],this.x=e[1],this.y=e[2],this.y+this.height>fairygui.GRoot.inst.getDesignStageHeight()&&(this.y=fairygui.GRoot.inst.getDesignStageHeight()-this.height),i="",i=this._video.title?this._video.title:Core.StringUtils.TEXT(70217),this._shareText=i+"\n#fcom,"+this._video.id+"(100,180)#e",[2]}})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,t.prototype.close.apply(this,e)];case 1:return i.sent(),[2]}})})},e}(Core.BaseWindow);t.VideoShareOptWnd=e,__reflect(e.prototype,"Pvp.VideoShareOptWnd")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.center(),this.modal=!0,this._closeBtn=this.getChild("closeBtn").asButton,this._confirmBtn=this.getChild("confirmBtn").asButton,this._searchInput=this.getChild("searchInput").asTextInput,this._hostResultText=this.getChild("resultTxt1").asLoader,this._guestResultText=this.getChild("resultTxt2").asLoader,this._hostNameText=this.getChild("name1").asTextField,this._guestNameText=this.getChild("name2").asTextField,this._hostNameText.textParser=Core.StringUtils.parseColorText,this._guestNameText.textParser=Core.StringUtils.parseColorText,this._closeBtn.addClickListener(this._onClose,this),this._confirmBtn.addClickListener(this._onShareVideo,this),this._hostCardComs=[],this._guestCardComs=[];for(var e=1;5>=e;++e){var i=this.getChild("card"+e).asCom;this._hostCardComs.push(i)}for(var e=6;10>=e;++e){var i=this.getChild("card"+e).asCom;this._guestCardComs.push(i)}},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.open.apply(this,e),this._setVideo(e[0]),this._parentVideo=e[1],[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e.prototype._setVideo=function(t){this._video=t;var e=t.hostFighter.cards,i=!1;t.winner==t.hostFighter.uid&&(i=!0);for(var r=0;r<e.length;++r){var n=e[r];this._hostCardComs[r]&&this._hostCardComs[r].setCardId(n,i)}for(var o=t.guestFighter.cards,r=0;r<o.length;++r){var n=o[r];this._guestCardComs[r]&&this._guestCardComs[r].setCardId(n,!i)}this._video.winner==this._video.hostFighter.uid?(this._hostResultText.url="cards_base1_s_png",this._guestResultText.url="cards_base2_s_png"):(this._hostResultText.url="cards_base2_s_png",this._guestResultText.url="cards_base1_s_png"),this._hostNameText.text=this._video.hostFighter.name,this._guestNameText.text=this._video.guestFighter.name},e.prototype._onShareVideo=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(r){switch(r.label){case 0:return t=this._searchInput.text,t=t.trim(),t.length<=0?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60169)),[2]):(e={VideoID:this._video.id,Name:t},[4,Net.rpcCall(pb.MessageID.C2S_SHARE_VIDEO,pb.ShareVideoArg.encode(e))]);
case 1:return i=r.sent(),0==i.errcode?(this._parentVideo.shareOK(t),this._searchInput.text="",this._onClose()):101==i.errcode&&Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60209)),[2]}})})},e.prototype._onClose=function(){Core.ViewManager.inst.close(ViewName.videoUpload)},e}(Core.BaseWindow);t.VideoUploadWnd=e,__reflect(e.prototype,"Pvp.VideoUploadWnd")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.center(),this.modal=!0,this._titleImg=this.contentPane.getChild("titleImg").asLoader,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._list=this.contentPane.getChild("wechatList").asList,this._pageUpBtn=this.contentPane.getChild("rightBtn").asButton,this._pageDownBtn=this.contentPane.getChild("leftBtn").asButton,this._inviteBtn=this.contentPane.getChild("inviteBtn").asButton,this._groupRankBtn=this.contentPane.getChild("groupRankBtn").asButton,this._closeBtn.addClickListener(function(){Core.ViewManager.inst.closeView(e)},this),this._pageUpBtn.addClickListener(function(){wx.getOpenDataContext().postMessage({cmd:"pageUp"})},this),this._pageDownBtn.addClickListener(function(){wx.getOpenDataContext().postMessage({cmd:"pageDown"})},this),this._inviteBtn.addClickListener(function(){WXGame.WXShareMgr.inst.wechatInvite()},this),this._groupRankBtn.addClickListener(function(){WXGame.WXShareMgr.inst.wechatGrpRank()},this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a,u,h,l,c,d;return __generator(this,function(p){switch(p.label){case 0:t.prototype.open.apply(this,e),i=e[0],p.label=1;case 1:return p.trys.push([1,3,,4]),[4,platform.getUserInfo()];case 2:return r=p.sent(),"friends"==i?(this._titleImg.url="pvp_wechatTitle_png",wx.getOpenDataContext().postMessage({cmd:"display",type:i,show:!0,openId:r.channel_userid})):"group"==i&&(this._titleImg.url="pvp_wechatGroupTitle_png",n=e[1],wx.getOpenDataContext().postMessage({cmd:"display",type:i,show:!0,shareTicket:n,openId:r.channel_userid})),this._rankBitmap||(o=this._list.width,s=wx.getSystemInfoSync(),a=s.windowWidth,u=s.windowHeight,h=u/a*o,this._rankBitmap=WXGame.WXGameMgr.getOpenDataContextBitmap(o,h)),l=new egret.Texture,l._setBitmapData(this._rankBitmap.$bitmapData),c=new fairygui.GImage,c.texture=l,c.x=this._list.x,c.y=this._list.y,c.width=this._rankBitmap.width,c.height=this._rankBitmap.height,this._rankBitmapImage=c,this.addChild(this._rankBitmapImage),this._rankBitmapImage.blendMode=egret.BlendMode.NORMAL,[3,4];case 3:return d=p.sent(),console.log(d),[3,4];case 4:return[2]}})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),this._rankBitmapImage.parent&&this._rankBitmapImage.parent.removeChild(this._rankBitmapImage),wx.getOpenDataContext().postMessage({cmd:"display",show:!1}),[2]})})},e}(Core.BaseWindow);t.WXGameFriendRankView=e,__reflect(e.prototype,"Pvp.WXGameFriendRankView")}(Pvp||(Pvp={}));var Pvp;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.adjust(this.getChild("bg")),this._closeBtn=this.getChild("closeBtn").asButton,this.center(),this._closeBtn.addClickListener(this._onClose,this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.open.apply(this,e),this.getChild("n3").visible=Core.DeviceUtils.isWXGame(),Core.DeviceUtils.isWXGame()?this.getChild("n0").asLoader.url="common_wechatPlatformBg_png":this.getChild("n0").asLoader.url="common_wechatPlatformBg2_png",[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e.prototype._onClose=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.closeView(this),[2]})})},e}(Core.BaseView);t.WechatPlatform=e,__reflect(e.prototype,"Pvp.WechatPlatform")}(Pvp||(Pvp={}));var Quest;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(i){e.prototype.constructFromXML.call(this,i),this._completeBar=this.getChild("boxProgress"),this._completeBar.setProgress(0,0),this._boxIcon=this.getChild("treasureIcon").asLoader,this._nextTxt=this.getChild("nextTxt").asTextField,this._hint=this.getChild("hint").asCom,this._hint.getChild("textNum").text="",this._hint.visible=!1,this.addClickListener(this._onQuest,this),t.QuestMgr.inst.addEventListener(t.QuestMgr.UpdateQuestButton,this._updateQuestBtn,this),t.QuestMgr.inst.addEventListener(t.QuestMgr.UpdateQuestHint,this._showRedDot,this),t.QuestMgr.inst.addEventListener(t.QuestMgr.UpdateTimer,this._updateTimer,this)},i.prototype._updateQuestBtn=function(t){this._setQuestBtn()},i.prototype._updateTimer=function(){this._nextTxt.text=t.QuestMgr.inst.getQuestTimer},i.prototype._setQuestBtn=function(){var e=(Data.treasure_config.get(t.QuestMgr.inst.getTreasureModelID),t.QuestMgr.inst.getCompleteNum),i=t.QuestMgr.inst.getQuestNum,r=t.QuestMgr.inst.getIsRewardNum,n=r>=i;t.QuestMgr.inst.canReward?(this.getChild("bottom").asLoader.url="pvp_functionBottom2_png",this._hint.visible=!0):(this.getChild("bottom").asLoader.url="pvp_functionBottom_png",this._hint.visible=!1),this._completeBar.getChild("text").text=e+"/"+i,n?(this._boxIcon.grayed=!0,this._nextTxt.visible=!0,this._completeBar.visible=!1):(this._boxIcon.grayed=!1,this._nextTxt.visible=!1,this._completeBar.visible=!0),this._completeBar.setProgress(e,i)},i.prototype._showRedDot=function(){this._hint.visible=!0},i.prototype._onQuest=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return Core.ViewManager.inst.open(ViewName.questView),t.QuestMgr.inst.updateView(),[2]})})},i}(fairygui.GButton);t.QuestBtnCom=e,__reflect(e.prototype,"Quest.QuestBtnCom")}(Quest||(Quest={}));var Quest;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._refreshBtn=this.getChild("refreshBtn").asButton,this._questBar=this.getChild("boxProgress"),this._rewardNum=this.getChild("rewardCnt2").asTextField,this._rewardIcon=this.getChild("rewardIcon1").asLoader,this._refreshBtn.visible=!1,this.addClickListener(this._completeQuest,this),this._refreshBtn.addClickListener(this._refreshQuest,this)},i.prototype._completeQuest=function(){var e=this,i=t.QuestMgr.inst.getQuestReward(this._questObj.getID);i.then(function(t){t&&e.getTransition("t0").play()})},i.prototype._refreshQuest=function(){var e=this;Core.TipsUtils.confirm(Core.StringUtils.TEXT(60245),function(){t.QuestMgr.inst.refreshQuest(e._questObj.getID)},null,this)},i.prototype._getMissionIcon=function(t){return"lzd_handjoy"==window.gameGlobal.channel?Reward.RewardMgr.inst.getRewardIcon(Reward.RewardType.T_BOWLDER):Reward.RewardMgr.inst.getRewardIcon(Reward.RewardType.T_JADE)},i.prototype._getMissionRewardNum=function(t){return"lzd_handjoy"==window.gameGlobal.channel?t.bowlder:t.jade},i.prototype.setQuest=function(e){this._questObj=e;var i=Data.quest_config.get(e.getMissionID);this._questBar.setProgress(e.getCurCnt,i.process),e.getCurCnt>=i.process?(this._refreshBtn.visible=!1,this._questBar.getChild("text").text=Core.StringUtils.TEXT(60052),this._questBar.getChild("text").asTextField.color=6749952,this._questBar.getChild("bar").asLoader.url="common_barGreen_png"):(this._questBar.getChild("text").text=e.getCurCnt+"/"+i.process,this._questBar.getChild("text").asTextField.color=16777215,this._questBar.getChild("bar").asLoader.url="common_barYellow_png",this._refreshBtn.visible=t.QuestMgr.inst.getCanRefresh),this._rewardIcon.url=this._getMissionIcon(i),this.getChild("text").text=i.text,this.getChild("title").text=i.title,this.getChild("rewardCnt2").text=this._getMissionRewardNum(i),e.getIsReward?(this.getController("c1").selectedIndex=1,this._refreshBtn.visible=!1,this._questBar.getChild("bar").asLoader.url="common_barGrey_png",this.touchable=!1):(this.touchable=!0,this.getController("c1").selectedIndex=0)},i.prototype.playTrans=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){t.getTransition("t1").play(function(){e()})})];case 1:return e.sent(),[2]}})})},i.prototype.hideRefreshBtn=function(){this._refreshBtn.visible=!1},i}(fairygui.GComponent);t.QuestItem=e,__reflect(e.prototype,"Quest.QuestItem")}(Quest||(Quest={}));var Quest;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._questBar=this.getChild("boxProgress"),this._questText=this.getChild("text").asTextField,this._questTitle=this.getChild("title").asTextField},e.prototype.setQuest=function(t){this._questObj=t;var e=Data.quest_config.get(t.getMissionID);t.getCurCnt>=e.process?(this._questBar.getChild("text").text=Core.StringUtils.TEXT(60052),this._questBar.getChild("text").asTextField.color=6749952,this._questBar.getChild("bar").asLoader.url="common_barGreen_png"):(this._questBar.getChild("text").text=t.getCurCnt+"/"+e.process,this._questBar.getChild("text").asTextField.color=16777215,this._questBar.getChild("bar").asLoader.url="common_barYellow_png"),this._questBar.setProgress(t.getCurCnt,e.process),this.getChild("text").text=e.text,this.getChild("title").text=e.title,this.getTransition("entry").play()},Object.defineProperty(e.prototype,"getID",{get:function(){return this._questObj.getID},enumerable:!0,configurable:!0}),e}(fairygui.GComponent);t.QuestTipItem=e,__reflect(e.prototype,"Quest.QuestTipItem")}(Quest||(Quest={}));var Quest;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.center(),this.y=0,this._isShow=!1,this._tipList=this.getChild("n0").asList,this._tipList.removeChildrenToPool(),t.QuestMgr.inst.addEventListener(t.QuestMgr.ShowTip,this._showTip,this),this._tipItemList=new Array},i.prototype._showTipView=function(t){return __awaiter(this,void 0,void 0,function(){var e,e,i=this;return __generator(this,function(r){switch(r.label){case 0:return Core.ViewManager.inst.isShow(ViewName.battle)?(fairygui.GTimers.inst.add(500,1,function(){i._showTipView(t)},this),[3,3]):[3,1];case 1:return this._isShow&&fairygui.GTimers.inst.remove(this._closeView,this),[4,fairygui.GTimers.inst.add(3e3,1,this._closeView,this)];case 2:if(r.sent(),this._isShow=!0,this._tipItemList.length<1)return e=this._tipList.addItemFromPool(),e.setQuest(t),this._tipItemList.push(e),[2];this._tipItemList.forEach(function(e){return e.visible&&e.getID==t.getID?void e.setQuest(t):void 0}),this._tipItemList.forEach(function(e){return e.visible?void 0:void e.setQuest(t)}),e=this._tipList.addItemFromPool(),e.setQuest(t),this._tipItemList.push(e),r.label=3;case 3:return[2]}})})},i.prototype._showTip=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=t.data,this._showTipView(e),[2]})})},i.prototype._closeView=function(){Core.ViewManager.inst.closeView(this),this._tipList.removeChildrenToPool(),this._isShow=!1},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.open.apply(this,t),[2]})})},i.prototype.colse=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseView);t.QuestTipView=e,__reflect(e.prototype,"Quest.QuestTipView")}(Quest||(Quest={}));var Quest;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.center(),this.modal=!0,this._closeBtn=this.getChild("closeBtn").asButton,this._questList=this.getChild("questList").asList,this._boxQuest=this.getChild("questBox").asButton,this._dailyTreasure=this.getChild("dailyTreasure").asTextField,this._dailyGold=this.getChild("dailyGold").asTextField,this._boxBar=this._boxQuest.getChild("boxProgress"),this._nextTxt=this._boxQuest.getChild("nextTxt").asTextField,this._closeBtn.addClickListener(this._onClose,this),this._boxQuest.addClickListener(this._onBox,this),this._questList.removeChildrenToPool(),this._questItemList=new Collection.Dictionary,t.QuestMgr.inst.addEventListener(t.QuestMgr.UpdateTreasure,this._updateView,this),t.QuestMgr.inst.addEventListener(t.QuestMgr.UpdateQuest,this._updateQuest,this),t.QuestMgr.inst.addEventListener(t.QuestMgr.HideRefresh,this._hideRefresh,this),t.QuestMgr.inst.addEventListener(t.QuestMgr.UpdateQuestList,this._updateQuestList,this)},i.prototype._updateTimer=function(){this._nextTxt.text=t.QuestMgr.inst.getQuestTimer},i.prototype._updateView=function(){this._treasureLab=Data.treasure_config.get(t.QuestMgr.inst.getTreasureModelID);var e=t.QuestMgr.inst.getCurCnt,i=this._treasureLab.quest_unlockCnt;this._boxBar.setProgress(e,i),this._boxBar.getChild("text").text=e+"/"+i,this._boxQuest.getChild("txt1").text=Core.StringUtils.format(Core.StringUtils.TEXT(60218),i),this._boxQuest.getChild("boxName").text=this._treasureLab.title;var r=new Treasure.TreasureItem(-1,t.QuestMgr.inst.getTreasureModelID);this._treasure=r,this._boxQuest.getChild("boxIcon").asLoader.url=r.image,e>=i?this._boxQuest.getChild("boxIconBg").asLoader.visible=!0:this._boxQuest.getChild("boxIconBg").asLoader.visible=!1},i.prototype._updateQuestList=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:e=t.QuestMgr.inst.getQuestList,this._questList.removeChildrenToPool(),this._questItemList=new Collection.Dictionary,i=new Array,e.forEach(function(t,e){i.push(e)}),r=0,n.label=1;case 1:return r<i.length?[4,this._setQuest(i[r])]:[3,4];case 2:n.sent(),n.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},i.prototype._updateQuest=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=t.data,this._setQuest(e),[2]})})},i.prototype._setQuest=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return this._questItemList.containsKey(t.getID)||(e=this._questList.addItemFromPool(),this._questItemList.setValue(t.getID,e)),[4,this._questItemList.getValue(t.getID).setQuest(t)];case 1:return i.sent(),[4,this._questItemList.getValue(t.getID).playTrans()];case 2:return i.sent(),[2]}})})},i.prototype._hideRefresh=function(){this._questItemList.forEach(function(t,e){e.hideRefreshBtn()})},i.prototype._onBox=function(){return t.QuestMgr.inst.getCurCnt<this._treasureLab.quest_unlockCnt?void Core.ViewManager.inst.open(ViewName.dailyTreasureInfo,this):void t.QuestMgr.inst.getTreasureReward()},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.open.apply(this,t),this._onResUpdate(),[2]})})},i.prototype.colse=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i.prototype._onClose=function(){Core.ViewManager.inst.closeView(this)},Object.defineProperty(i.prototype,"treasure",{get:function(){return this._treasure},enumerable:!0,configurable:!0}),i.prototype._onResUpdate=function(){var t=24;Player.inst.hasPrivilege(Priv.REWARD_ADD_TREASURE)&&(t+=2),this._dailyGold.text=Core.StringUtils.format(Core.StringUtils.TEXT(70123),Player.inst.getResource(ResType.PvpTreasureCnt),t),this._dailyTreasure.text=Core.StringUtils.format(Core.StringUtils.TEXT(70122),Player.inst.getResource(ResType.PvpGoldCnt),24)},i}(Core.BaseWindow);t.QuestView=e,__reflect(e.prototype,"Quest.QuestView")}(Quest||(Quest={}));var Reborn;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.center(),this.modal=!0,this.adjust(this.contentPane.getChild("closeBg")),this.contentPane.getChild("closeBg").addClickListener(this._onCloseBtn,this),this._skinCom=this.contentPane.getChild("skin").asCom,this._buyBtn=this.contentPane.getChild("btnBuy").asButton,this._buyBtn.addClickListener(this._onBuyBtn,this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){return t.prototype.open.apply(this,e),this._key=e[0],this._type=e[1],this._buyData=e[2],this._type==CardPool.BuyType.Reborn||this._type==CardPool.BuyType.War&&(i=CardPool.CardSkinMgr.inst.getSkinConf(this._buyData.skinId),this._skinCom.setSkin(this._buyData.skinId,i.general,i.name,i.resource),this._buyBtn.title=this._buyData.fightPrice.toString(),this._buyBtn.getChild("n11").asLoader.url="war_fightIcon_png",CardPool.CardSkinMgr.inst.hasSkin(i.general,this._buyData.skinId)?this._buyBtn.visible=!1:this._buyBtn.visible=!0,War.MyWarPlayer.inst.contribution>=this._buyData.fightPrice?this._buyBtn.getChild("title").asTextField.color=16777215:this._buyBtn.getChild("title").asTextField.color=16711680),[2]})})},e.prototype._onCloseBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.closeView(this),[2]})})},e.prototype._onBuyBtn=function(){return __awaiter(this,void 0,void 0,function(){var t,e=this;return __generator(this,function(i){return this._type==CardPool.BuyType.Reborn||this._type==CardPool.BuyType.War&&(t=CardPool.CardSkinMgr.inst.getSkinConf(this._buyData.skinId),Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70369),t.name),function(){e._onBuy()},null,this)),[2]})})},e.prototype._onBuy=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){return War.MyWarPlayer.inst.contribution<this._buyData.fightPrice?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70370)),[2]):(t=War.WarMgr.inst.buyGoods(this._buyData.type,this._buyData.__id__),t&&(e=new Pvp.GetRewardData,e.addSkins(this._buyData.skinId),Core.ViewManager.inst.open(ViewName.getRewardWnd,e),Core.ViewManager.inst.closeView(this)),[2])})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e}(Core.BaseWindow);t.BuySkinInfo=e,__reflect(e.prototype,"Reborn.BuySkinInfo")}(Reborn||(Reborn={}));var Reborn;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var t=this;e.prototype.initUI.call(this),this.center(),this.modal=!0,this.adjust(this.contentPane.getChild("closeBg")),this.contentPane.getChild("closeBg").addClickListener(function(){Core.ViewManager.inst.closeView(t)},this),this._equipCom=this.contentPane.getChild("priv").asCom,this._nameText=this._equipCom.getChild("name").asTextField,this._nameText.textParser=Core.StringUtils.parseColorText,this._buyBtn=this.contentPane.getChild("btnBuy").asButton,this._btnBuyFree=this.contentPane.getChild("btnBuyFree").asButton,this._equipIcon=this._equipCom.getChild("icon").asLoader,this._descText=this._equipCom.getChild("desc").asRichTextField,this._descText.addEventListener(egret.TextEvent.LINK,htmlClickCallback,this),this._buyBtn.addClickListener(this._onBuyBtn,this),this._btnBuyFree.addClickListener(this._onBuyBtn,this)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,r;return __generator(this,function(n){return e.prototype.open.apply(this,t),this._key=t[0],this._type=t[1],this._buyData=t[2],this._type==CardPool.BuyType.Reborn?(i=Data.sold_equip.get(this._key),r=Equip.EquipMgr.inst.getEquipData(i.equipId),this._nameText.text=r.equipName,this._descText.text=r.getSkillDesc(),this._equipIcon.url=r.equipIcon,this._buyBtn.visible=!1,this._btnBuyFree.visible=!Equip.EquipMgr.inst.hasEquip(i.equipId),Player.inst.hasEnoughEquipMoney()?this._btnBuyFree.getChild("title").asTextField.color=16777215:this._btnBuyFree.getChild("title").asTextField.color=16711680):this._type==CardPool.BuyType.War&&(r=Equip.EquipMgr.inst.getEquipData(this._buyData.equipId),this._nameText.text=r.equipName,this._descText.text=r.getSkillDesc(),this._equipIcon.url=r.equipIcon,this._btnBuyFree.visible=!1,this._buyBtn.visible=!Equip.EquipMgr.inst.hasEquip(r.equipID),this._buyBtn.title=this._buyData.fightPrice.toString(),this._buyBtn.getChild("n11").asLoader.url="war_fightIcon_png",War.MyWarPlayer.inst.contribution>=this._buyData.fightPrice?this._buyBtn.getChild("title").asTextField.color=16777215:this._buyBtn.getChild("title").asTextField.color=16711680),[2]})})},i.prototype._onCloseBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.closeView(this),[2]})})},i.prototype._onBuyBtn=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(i){return this._type==CardPool.BuyType.Reborn?Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70189),this._nameText.text),function(){t.RebornMgr.inst.onBuyEquip()},null,this):this._type==CardPool.BuyType.War&&Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70369),this._nameText.text),function(){e._onBuy()},null,this),[2]})})},i.prototype._onBuy=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(r){return War.MyWarPlayer.inst.contribution<this._buyData.fightPrice?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70370)),[2]):(t=War.WarMgr.inst.buyGoods(this._buyData.type,this._buyData.__id__),t&&(e=new Pvp.GetRewardData,i=Equip.EquipMgr.inst.getEquipData(this._buyData.equipId),e.addOther(i.equipName,i.equipIcon),Core.ViewManager.inst.open(ViewName.getRewardWnd,e),Core.ViewManager.inst.closeView(this)),[2])})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseWindow);t.RebornEquipInfo=e,__reflect(e.prototype,"Reborn.RebornEquipInfo");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){this._priceText=this.getChild("price").asTextField,this._equipIcon=this.getChild("icon").asLoader,this._equipName=this.getChild("title").asTextField,this._buyCtr=this.getController("c1"),this.addClickListener(this._onBox,this)},i.prototype.setEquip=function(t){this._key=t;var e=Data.sold_equip.get(this._key),i=Equip.EquipMgr.inst.getEquipData(e.equipId);this._equipIcon.url=i.equipIcon,this._equipName.text=i.equipName,i.hasEquip?this._buyCtr.selectedIndex=1:this._buyCtr.selectedIndex=0},i.prototype._onBox=function(){t.RebornMgr.inst.openEquipInfo(this._key)},i}(fairygui.GButton);t.EquipItem=i,__reflect(i.prototype,"Reborn.EquipItem")}(Reborn||(Reborn={}));var Reborn;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){this._priceText=this.getChild("price").asTextField,this._card=this.getChild("card").asCom,this._buyCtr=this.getController("c1"),this.addClickListener(this._onBox,this)},i.prototype.setCard=function(t){this._key=t;var e=Data.sold_general.get(t);this._price=e.honorPrice,this._priceText.text=this._price.toString();var i=CardPool.CardPoolMgr.inst.getCollectCard(e.cardId);0==i.amount?this._buyCtr.selectedIndex=0:this._buyCtr.selectedIndex=1;var r=CardPool.CardPoolMgr.inst.getCardData(e.cardId,1),n=new CardPool.Card(r);this._card.cardObj=n,this._card.setName(),this._card.setOwnBackground(),this._card.setOwnFront(),this._card.setCardImg(),this._card.setEquip()},i.prototype._onBox=function(){t.RebornMgr.inst.openCardInfo(this._key,this._card.cardObj)},i}(fairygui.GButton);t.FeatCardItem=e,__reflect(e.prototype,"Reborn.FeatCardItem")}(Reborn||(Reborn={}));var Reborn;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var t=this;e.prototype.initUI.call(this),this.center(),this.modal=!0,this.adjust(this.contentPane.getChild("closeBg")),this.contentPane.getChild("closeBg").addClickListener(function(){Core.ViewManager.inst.closeView(t)},this),this._privCom=this.contentPane.getChild("priv").asCom,this._nameText=this._privCom.getChild("name").asTextField,this._nameText.textParser=Core.StringUtils.parseColorText,this._buyBtn=this.contentPane.getChild("btnBuy").asButton,this._privIcon=this._privCom.getChild("icon").asLoader,this._descText=this._privCom.getChild("desc").asTextField,this._buyBtn.addClickListener(this._onBuy,this)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){return e.prototype.open.apply(this,t),this._key=t[0],i=Data.sold_priv.get(this._key),this._fame=i.famePrice,r=Data.priv_config.get(this._key),this._nameText.text=r.name,this._descText.text=r.desc,this._privIcon.url="reborn_"+r.icon+"_png",this._buyBtn.getChild("title").asTextField.text=this._fame.toString(),this._buyBtn.visible=!Player.inst.hasPrivilege(this._key),Player.inst.hasEnoughFame(this._fame)?this._buyBtn.getChild("title").asTextField.color=16777215:this._buyBtn.getChild("title").asTextField.color=16711680,[2]})})},i.prototype._onCloseBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.closeView(this),[2]})})},i.prototype._onBuy=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t.RebornMgr.inst.onBuyPriv(),[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseWindow);t.PrivInfo=e,__reflect(e.prototype,"Reborn.PrivInfo");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){this._priceText=this.getChild("price").asTextField,this._privIcon=this.getChild("icon").asLoader,this._privName=this.getChild("title").asTextField,this._buyCtr=this.getController("c1"),this.addClickListener(this._onBox,this)},i.prototype.setPriv=function(t){this._key=t;var e=Data.sold_priv.get(t);this._fame=e.famePrice,this._priceText.text=this._fame.toString(),this._privIcon.url="reborn_"+Data.priv_config.get(t).icon+"_png",this._privName.text=Data.priv_config.get(t).name,Player.inst.hasPrivilege(this._key)?this._buyCtr.selectedIndex=1:this._buyCtr.selectedIndex=0},i.prototype._onBox=function(){t.RebornMgr.inst.openPrivInfo(this._key)},i}(fairygui.GButton);t.PrivItem=i,__reflect(i.prototype,"Reborn.PrivItem")}(Reborn||(Reborn={}));var Reborn;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.adjust(this.getChild("bg"),Core.AdjustType.EXCEPT_MARGIN),this.y+=window.support.topMargin,this._shopList=this.getChild("shopList").asList,this._closeBtn=this.getChild("closeBtn").asButton,this._honoText=this.getChild("honorCnt").asTextField,this._fameText=this.getChild("fameCnt").asTextField,this._closeBtn.addClickListener(this._onCloseBtn,this),this._shopList.foldInvisibleItems=!0;var i=fairygui.UIPackage.createObject(PkgName.reborn,"rebornFunction").asCom;this._shopList.addChild(i),this._rebornBtn=i.getChild("list").asList.getChild("reborn").asButton,this._refineBtn=i.getChild("list").asList.getChild("refine").asButton,this._rebornBtn.addClickListener(this._onRebornBtn,this),this._refineBtn.addClickListener(this._onRefineBtn,this);var r=fairygui.UIPackage.createObject(PkgName.reborn,"card").asCom;this._cardList=r.getChild("list").asList,this._shopList.addChild(r);var n=fairygui.UIPackage.createObject(PkgName.reborn,"priv").asCom;this._privList=n.getChild("list").asList,this._shopList.addChild(n);var o=fairygui.UIPackage.createObject(PkgName.reborn,"equip").asCom;this._equipList=o.getChild("list").asList,this._shopList.addChild(o),this._equipNum=o.getChild("n9").asTextField,this._cardList.itemClass=t.FeatCardItem,this._privList.itemClass=t.PrivItem,this._equipList.itemClass=t.EquipItem},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return e.prototype.open.apply(this,i),this._shopList._scrollPane.scrollTop(),[4,t.RebornMgr.inst.refresh()];case 1:return r.sent(),this._refresh(),Core.EventCenter.inst.addEventListener(GameEvent.BuyRebornGoods,this._refresh,this),[2]}})})},i.prototype._refresh=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o=this;return __generator(this,function(s){return this._honoText.text=Player.inst.getResource(ResType.T_FEAT).toString(),this._fameText.text=Player.inst.getResource(ResType.T_FAME).toString(),e=this._rebornBtn.getChild("n1").asTextField,t.RebornMgr.inst.remainDay>0?(e.visible=!0,this._rebornBtn.getChild("n1").asTextField.text=Core.StringUtils.format(Core.StringUtils.TEXT(70166),t.RebornMgr.inst.remainDay)):e.visible=!1,this._rebornBtn.getChild("honorText").asTextField.text=t.RebornMgr.inst.rebornFeats.toString(),this._rebornBtn.getChild("fameText").asTextField.text=t.RebornMgr.inst.fames.toString(),this._refineBtn.getChild("honorText").asTextField.text=t.RebornMgr.inst.refineFeats.toString(),this._cardList.removeChildrenToPool(),this._privList.removeChildrenToPool(),this._equipList.removeChildrenToPool(),i=Data.sold_general.keys,i.forEach(function(t){var e=o._cardList.addItemFromPool().asCom;e.setCard(t)}),r=Data.sold_priv.keys,r.forEach(function(t){var e=o._privList.addItemFromPool();e.setPriv(t)}),n=Data.sold_equip.keys,n.forEach(function(t){var e=o._equipList.addItemFromPool();e.setEquip(t)}),this._equipNum.text=Core.StringUtils.format(Core.StringUtils.TEXT(70181),Player.inst.getResource(ResType.T_EQUIP)),[2]})})},i.prototype._onRebornBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t.RebornMgr.inst.maxTeam<t.RebornMgr.inst.canRebornTeam?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70148)),[2]):(Core.ViewManager.inst.open(ViewName.rebornWnd),[2])})})},i.prototype._onRefineBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.open(ViewName.refineInfoWnd),[2]})})},i.prototype._onCloseBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.closeView(this),[2]
})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return Core.EventCenter.inst.removeEventListener(GameEvent.BuyRebornGoods,this._refresh,this),e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseView);t.RebornShopView=e,__reflect(e.prototype,"Reborn.RebornShopView")}(Reborn||(Reborn={}));var Reborn;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.adjust(this.contentPane.getChild("bg")),this._rebornList=this.contentPane.getChild("n27").asList,this._data1=this._rebornList.getChild("data1").asCom,this._data3=this._rebornList.getChild("data3").asCom,this._data4=this._rebornList.getChild("data4").asCom,this._rebornList._scrollPane.addEventListener(fairygui.ScrollPane.SCROLL_END,this._scrollUpdate,this),this._cardList=this._data4.getChild("cardList").asList,this._treasureIcon=this._data3.getChild("treasureIcon").asLoader,this._rebornBtn=this._data4.getChild("rebornBtn").asButton,this._btnClose=this.contentPane.getChild("btnClose").asButton,this._rebornBtn.addClickListener(this._onRebornBtn,this),this._btnClose.addClickListener(this._onClose,this),this._treasureIcon.addClickListener(this._onBox,this),this._treasureIcon.touchable=!0},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return e.prototype.open.apply(this,i),this._rebornList._scrollPane.scrollTop(),this._team=t.RebornMgr.inst.team,this._page=0,this._rebornList.getChildAt(0).asCom.getTransition("enter").play(),this._refresh(),this._refreshCard(),[2]})})},i.prototype._refresh=function(){for(var e=t.RebornMgr.inst.rebornCards,i=Data.card_caculation.keys,r=0;r<i.length;r++){var n=this._data3.getChild("rare"+i[r]).asCom,o=n.getChild("cardRare").asCom;o.setRare(i[r]),n.getChild("cardCnt").asTextField.text=e.getValue(i[r])+"(x"+Data.card_caculation.get(i[r]).honor+")",n.getChild("honorCnt").asTextField.text=(e.getValue(i[r])*Data.card_caculation.get(i[r]).honor).toString()}var s=this._data3.getChild("goldCom").asCom;s.getChild("title").asTextField.text=t.RebornMgr.inst.upLevGold.toString(),s.getChild("fameCnt").asTextField.text=t.RebornMgr.inst.upLevGod2Fame.toString();var a=this._data3.getChild("allCom").asCom;a.getChild("fameCnt").asTextField.text=t.RebornMgr.inst.reborn2Fame.toString(),this._data3.getChild("cnt2").asTextField.text=t.RebornMgr.inst.rebornFeats.toString(),this._data3.getChild("cnt3").asTextField.text=t.RebornMgr.inst.fames.toString();var u=Data.reborn_treausre.get(t.RebornMgr.inst.canRebornTeam).treasure;this._treasureData=Data.treasure_config.get(u),this._treasureIcon.url="treasure_box"+this._treasureData.rare+"_png",this._data3.getChild("cnt1").asTextField.text=this._treasureData.title;var h=new Treasure.TreasureItem(-1,u);this._treasure=h},i.prototype._refreshCard=function(){var e=this;this._cardList.removeChildrenToPool();var i=t.RebornMgr.inst.rebornHeros;i.forEach(function(t){var i=CardPool.CardPoolMgr.inst.getCardData(t,2);if(i){var r=e._cardList.addItemFromPool(),n=new CardPool.Card(i);r.cardObj=n,r.setName(),r.setOwnBackground(),r.setOwnFront(),r.setCardImg(),r.setSkill(),r.setNumOffsetText(),r.setNumText(!0),r.addClickListener(function(){Core.ViewManager.inst.open(ViewName.cardInfoOther,r.cardObj)},e)}});var r=t.RebornMgr.inst.rebornHeros2;r.forEach(function(t){var i=CardPool.CardPoolMgr.inst.getCardData(t,1);if(i){var r=e._cardList.addItemFromPool(),n=new CardPool.Card(i);r.cardObj=n,r.setName(),r.setOwnBackground(),r.setOwnFront(),r.setCardImg(),r.setSkill(),r.setNumOffsetText(),r.setNumText(!0),r.addClickListener(function(){Core.ViewManager.inst.open(ViewName.cardInfoOther,r.cardObj)},e)}})},i.prototype._onRebornBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._team<t.RebornMgr.inst.canRebornTeam?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70148)),[2]):t.RebornMgr.inst.remainDay>0?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70166),t.RebornMgr.inst.remainDay)),[2]):(Core.TipsUtils.confirm(Core.StringUtils.TEXT(70150),this._reborn,null,this),[2])})})},i.prototype._reborn=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,t.RebornMgr.inst.onReborn()];case 1:return e=i.sent(),e&&this._onClose(),[2]}})})},i.prototype._onBox=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.open(ViewName.dailyTreasureInfo,this),[2]})})},i.prototype._scrollUpdate=function(t){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t=this.contentPane.getController("page").selectedIndex,this._page!=t&&(this._page=t,this._rebornList.getChildAt(t).asCom.getTransition("enter").play()),[2]})})},i.prototype._onClose=function(){Core.ViewManager.inst.closeView(this)},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},Object.defineProperty(i.prototype,"treasure",{get:function(){return this._treasure},enumerable:!0,configurable:!0}),i}(Core.BaseWindow);t.RebornWnd=e,__reflect(e.prototype,"Reborn.RebornWnd")}(Reborn||(Reborn={}));var Reborn;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.center(),this.modal=!0,this._refineList=this.contentPane.getChild("n86").asList,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._openBtn=this.contentPane.getChild("openBtn").asButton,this._closeBtn.addClickListener(this._onCloseBtn,this),this._openBtn.addClickListener(this._onRefineCard,this)},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a,u,h,l;return __generator(this,function(c){for(e.prototype.open.apply(this,i),r=t.RebornMgr.inst.refineRareDic,n=Data.card_caculation.keys,o=1;o<=n.length;o++)s=this._refineList.getChild("lv"+o).asCom,a=0,r.containsKey(o)&&(a=r.getValue(o)),u=s.getChild("cardRare").asCom,u.setRare(o),s.getChild("cardCnt").asTextField.text=a+"（x"+Data.card_caculation.get(n[o-1]).honor+"）",h=a*Data.card_caculation.get(o).honor,s.getChild("honorCnt").asTextField.text="x"+h;return l=this._refineList.getChild("all").asCom,this._refineFeats=t.RebornMgr.inst.refineFeats,l.getChild("honorCnt").asTextField.text=this._refineFeats.toString(),[2]})})},i.prototype._onRefineCard=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return this._refineFeats<=0?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70171)),[2]):(e=t.RebornMgr.inst.onAllRefineCard(),e&&Core.ViewManager.inst.closeView(this),[2])})})},i.prototype._onCloseBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.closeView(this),[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseWindow);t.RefineInfoWnd=e,__reflect(e.prototype,"Reborn.RefineInfoWnd")}(Reborn||(Reborn={}));var Reborn;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(t){this._priceText=this.getChild("price").asTextField,this._selectedMask=this.getChild("selectedMask").asCom,this._cardCom=this.getChild("card").asCom},e.prototype.setCard=function(t){this._priceText.text=t.amount.toString(),this._cardCom.cardObj=t,this._cardCom.setCardImg(),this._cardCom.setName()},e}(fairygui.GButton);t.RefineCardItem=e,__reflect(e.prototype,"Reborn.RefineCardItem");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.adjust(this.contentPane.getChild("bg"),Core.AdjustType.EXCEPT_MARGIN),this._cardList=this.contentPane.getChild("cardList").asList,this._allBtn=this.contentPane.getChild("allBtn").asButton,this._confirmBtn=this.contentPane.getChild("n35").asButton,this._allBtn.addClickListener(this._onAllBtn,this),this._confirmBtn.addClickListener(this._onConfirmBtn,this),this._btnClose=this.contentPane.getChild("btnClose").asButton,this._btnClose.addClickListener(this._onClose,this)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.open.apply(this,t),this._refresh(),[2]})})},i.prototype._refresh=function(){var e=this;this._cardList.removeChildrenToPool();var i=t.RebornMgr.inst.refineCardIndexs,r=t.RebornMgr.inst.refineCards;i.forEach(function(t){var i=r.getValue(t),n=e._cardList.addItemFromPool();n.setCard(i.card)})},i.prototype._onConfirmBtn=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t=this._cardList.getSelection(),t.length<=0?(Core.TipsUtils.showTipsFromCenter(""),[2]):[2]})})},i.prototype._onAllBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._cardList.selectAll(),[2]})})},i.prototype._onClose=function(){Core.ViewManager.inst.closeView(this)},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseWindow);t.RefineWnd=i,__reflect(i.prototype,"Reborn.RefineWnd")}(Reborn||(Reborn={}));var Shop;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){var i=this;t.prototype.constructFromXML.call(this,e),this._cardCom=this.getChild("card").asCom,this._titleText=this.getChild("title").asTextField,this.addClickListener(function(){i._cardObj&&Core.ViewManager.inst.open(ViewName.cardInfoOther,i._cardObj)},this)},e.prototype.setCardInfo=function(t,e){var i=Data.pool.get(t),r=new CardPool.Card(i);this._cardCom.cardObj=r,this._cardCom.setName(),this._cardCom.setOwnBackground(),this._cardCom.setOwnFront(),this._cardCom.setCardImg(),this._cardCom.setEquip(),this._cardCom.visibleRareStars(!0),this._titleText.text="x"+e,this._cardObj=r},e}(fairygui.GComponent);t.CardCntCom=e,__reflect(e.prototype,"Shop.CardCntCom")}(Shop||(Shop={}));var Shop;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.center(),this.modal=!0,this._nameText=this.contentPane.getChild("name").asTextField,this._goldCntText=this.contentPane.getChild("goldCnt").asTextField,this._cardImg=this.contentPane.getChild("icon").asLoader,this._btnBuy=this.contentPane.getChild("btnBuy").asButton,this._btnShare=this.contentPane.getChild("shareBtn").asButton,this._btnOpen=this.contentPane.getChild("btnOpen").asButton,this._jadeSkipBtn=this.contentPane.getChild("jadeSkipBtn").asButton,this._btnBuy.addClickListener(function(){e._onBuy(!1)},this),this._btnShare.addClickListener(this._onShare,this),this._jadeSkipBtn.addClickListener(this._onSkipAdvert,this),this.contentPane.getChild("closeBtn").addClickListener(function(){Core.ViewManager.inst.closeView(e)},this),this.adjust(this.contentPane.getChild("closeBg")),this.contentPane.getChild("closeBg").addClickListener(function(){Core.ViewManager.inst.closeView(e)},this),this._jadeSkipBtn.icon=Player.inst.getSkipAdvertResIcon()},e.prototype._onBuy=function(t){void 0===t&&(t=!1),"lzd_handjoy"==window.gameGlobal.channel&&(t=!1),this._buyCallback&&this._buyCallback(t),Core.ViewManager.inst.closeView(this)},e.prototype._onSkipAdvert=function(){return Player.inst.hasEnoughResToSkipAdvert()||Player.inst.isVip?void this._onBuy(!0):void Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60085))},e.prototype._onShare=function(){var t=this;return Player.inst.isVip?void this._onSkipAdvert():void(Core.DeviceUtils.isWXGame()&&(WXGame.WXShareMgr.inst.wechatShareFreeItem(this._freeId,pb.ShopFreeAdsType.GoldAds,WXGame.WXShareType.SHARE_FREE_GOLD),WXGame.WXGameMgr.inst.registerOnShowCallback(function(){setTimeout(function(){t._onBuy(!1),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60212))},WXGame.WXShareMgr.inst.shareDelayOpTime)})))},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){return t.prototype.open.apply(this,e),i=e[0],r=e[1],n=e[2],this._freeId=e[3],Player.inst.isVip?this._jadeSkipBtn.title=Core.StringUtils.TEXT(70114):this._jadeSkipBtn.title="3",console.log("++++++++ ",n,this._freeId),Player.inst.hasEnoughResToSkipAdvert()?this._jadeSkipBtn.titleColor=16776960:this._jadeSkipBtn.titleColor=16711680,LanguageMgr.inst.isChineseLocale()?this._nameText.text=Core.StringUtils.TEXT(60022)+(i.desc+"?"):this._nameText.text=Core.StringUtils.TEXT(60022)+(" "+i.desc+"?"),this._goldCntText.text="x"+i.soldGold,""!=i.icon&&(this._cardImg.url=i.icon),this._buyCallback=r,this._jadeSkipBtn.visible=!0,Core.DeviceUtils.isWXGame()?(this._btnBuy.visible=!1,this._btnOpen.visible=!1,WXGame.WXGameMgr.inst.isExamineVersion?(this._btnShare.visible=!1,this._jadeSkipBtn.x=95):(this._btnShare.visible=!0,this._jadeSkipBtn.x=15)):adsPlatform.isAdsOpen()?(this._btnShare.visible=!1,this._btnOpen.visible=!1,this._btnBuy.visible=!0):"lzd_handjoy"==window.gameGlobal.channel?(this._btnShare.visible=!1,this._btnOpen.visible=!1,this._btnBuy.visible=!1,this._jadeSkipBtn.visible=!0,this._jadeSkipBtn.x=95,this._jadeSkipBtn.title=Core.StringUtils.TEXT(70114)):(this._btnShare.visible=!1,this._btnOpen.visible=!1,this._btnBuy.visible=!1,this._jadeSkipBtn.visible=!1),[2]})})},e.prototype._onClose=function(t){var e=t.stageX/fairygui.GRoot.contentScaleFactor,i=t.stageY/fairygui.GRoot.contentScaleFactor;e>=this.x&&e<=this.x+this.width&&i>=this.y&&i<=this.y+this.height||Core.ViewManager.inst.closeView(this)},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),this._buyCallback=null,this.root.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onClose,this),[2]})})},e}(Core.BaseWindow);t.FreeGoldInfoWnd=e,__reflect(e.prototype,"Shop.FreeGoldInfoWnd");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.center(),this.modal=!0,this._nameText=this.contentPane.getChild("name").asTextField,this._goldCntText=this.contentPane.getChild("goldCnt").asTextField,this._cardImg=this.contentPane.getChild("icon").asLoader,this._btnBuy=this.contentPane.getChild("btnBuy").asButton,this._btnShare=this.contentPane.getChild("shareBtn").asButton,this._btnOpen=this.contentPane.getChild("btnOpen").asButton,this._btnBuy.addClickListener(function(){e._onBuy(!1)},this),this._btnOpen.addClickListener(this._onBuy,this),this._btnShare.addClickListener(this._onShare,this),this.contentPane.getChild("closeBtn").addClickListener(function(){Core.ViewManager.inst.closeView(e)},this),this.adjust(this.contentPane.getChild("closeBg")),this.contentPane.getChild("closeBg").addClickListener(function(){Core.ViewManager.inst.closeView(e)},this),adsPlatform.isAdsOpen()?(this._btnShare.visible=!1,this._btnOpen.visible=!1,this._btnBuy.visible=!0):this._btnBuy.visible=!1},e.prototype._onBuy=function(t){void 0===t&&(t=!1),this._buyCallback&&this._buyCallback(t),Core.ViewManager.inst.closeView(this)},e.prototype._onShare=function(){var t=this;Core.DeviceUtils.isWXGame()&&(WXGame.WXShareMgr.inst.wechatShareFreeItem(this._freeId,pb.ShopFreeAdsType.JadeAds,WXGame.WXShareType.SHARE_FREE_JADE),WXGame.WXGameMgr.inst.registerOnShowCallback(function(){setTimeout(function(){t._onBuy(!1),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60212))},WXGame.WXShareMgr.inst.shareDelayOpTime)}))},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){return t.prototype.open.apply(this,e),i=e[0],r=e[1],n=e[2],this._freeId=e[3],console.log("++++++++ ",n,this._freeId),this._nameText.text=Core.StringUtils.TEXT(60022)+(i.desc+"?"),this._goldCntText.text="x"+i.soldJade,""!=i.icon&&(this._cardImg.url=i.icon),this._buyCallback=r,this._btnOpen.visible=!1,this._btnBuy.visible=!0,this._btnShare.visible=!1,!adsPlatform.isAdsOpen()&&Core.DeviceUtils.isWXGame()&&(this._btnBuy.visible=!1,n?(this._btnShare.visible=!1,this._btnOpen.visible=!0):(this._btnShare.visible=!0,this._btnOpen.visible=!1)),[2]})})},e.prototype._onClose=function(t){var e=t.stageX/fairygui.GRoot.contentScaleFactor,i=t.stageY/fairygui.GRoot.contentScaleFactor;e>=this.x&&e<=this.x+this.width&&i>=this.y&&i<=this.y+this.height||Core.ViewManager.inst.closeView(this)},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),this._buyCallback=null,this.root.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onClose,this),[2]})})},e}(Core.BaseWindow);t.FreeJadeInfoWnd=i,__reflect(i.prototype,"Shop.FreeJadeInfoWnd");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.center(),this.modal=!0,this._rareCardNumText=this.contentPane.getChild("txt1").asTextField,this._nameText=this.contentPane.getChild("treasureName").asTextField,this._btnBuy=this.contentPane.getChild("btnBuy").asButton,this._btnShare=this.contentPane.getChild("shareBtn").asButton,this._btnOpen=this.contentPane.getChild("btnOpen").asButton,this._jadeSkipBtn=this.contentPane.getChild("jadeSkipBtn").asButton,this._effBox0=this.contentPane.getChild("box0").asLoader,this._effBox1=this.contentPane.getChild("box1").asLoader,this._openTrans0=this.contentPane.getTransition("t0"),this._rewardList=this.contentPane.getChild("rewardList").asList,this._btnBuy.addClickListener(function(){e._onBuy(!1)},this),this._btnOpen.addClickListener(this._onBuy,this),this._btnShare.addClickListener(this._onShare,this),this._jadeSkipBtn.addClickListener(this._onSkipAdvert,this),this.contentPane.getChild("closeBtn").addClickListener(function(){Core.ViewManager.inst.closeView(e)},this),this.adjust(this.contentPane.getChild("closeBg")),this.contentPane.getChild("closeBg").addClickListener(function(){Core.ViewManager.inst.closeView(e)},this),this._jadeSkipBtn.icon=Player.inst.getSkipAdvertResIcon()},e.prototype._onBuy=function(t){void 0===t&&(t=!1),"lzd_handjoy"==window.gameGlobal.channel&&(t=!1),this._buyCallback&&this._buyCallback(t),Core.ViewManager.inst.closeView(this)},e.prototype._onShare=function(){var t=this;return Player.inst.isVip?void this._onSkipAdvert():void(Core.DeviceUtils.isWXGame()&&(WXGame.WXShareMgr.inst.wechatShareFreeItem(this._freeId,pb.ShopFreeAdsType.TreasureAds,WXGame.WXShareType.SHARE_FREE_TREASURE),WXGame.WXGameMgr.inst.registerOnShowCallback(function(){setTimeout(function(){t._onBuy(!1),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60212))},WXGame.WXShareMgr.inst.shareDelayOpTime)})))},e.prototype._onSkipAdvert=function(){return Player.inst.hasEnoughResToSkipAdvert()||Player.inst.isVip?void this._onBuy(!0):void Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60085))},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a,u,h=this;return __generator(this,function(l){return t.prototype.open.apply(this,e),i=e[0],this._buyCallback=e[1],r=e[2],this._freeId=e[3],console.log("++++++++ ",r,this._freeId),n=i.treasureId,o=new Treasure.TreasureItem(-1,n),this._nameText.text=o.getName(),s=Treasure.TreasureReward.genRewardItemComsByTreasure(o),s.forEach(function(t){h._rewardList.addChild(t)}),this._rewardList.height=50*Math.ceil(s.length/2),a=o.getRareCardNum(),0>=a?this._rareCardNumText.visible=!1:(this._rareCardNumText.visible=!0,this._rareCardNumText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60130),a)),u=o.getRareType(),this._effBox0.url="treasure_"+u+"0_png",this._effBox1.url="treasure_"+u+"1_png",this._jadeSkipBtn.visible=!0,Player.inst.hasEnoughResToSkipAdvert()||Player.inst.isVip?(this._jadeSkipBtn.titleColor=16776960,Player.inst.isVip?this._jadeSkipBtn.text=Core.StringUtils.TEXT(70114):this._jadeSkipBtn.text="3"):this._jadeSkipBtn.titleColor=16711680,Core.DeviceUtils.isWXGame()?(this._btnBuy.visible=!1,this._btnOpen.visible=!1,WXGame.WXGameMgr.inst.isExamineVersion?(this._btnShare.visible=!1,this._jadeSkipBtn.x=125):(this._btnShare.visible=!0,this._jadeSkipBtn.x=35)):adsPlatform.isAdsOpen()?(this._btnShare.visible=!1,this._btnOpen.visible=!1,this._btnBuy.visible=!0):"lzd_handjoy"==window.gameGlobal.channel?(this._btnShare.visible=!1,this._btnOpen.visible=!1,this._btnBuy.visible=!1,this._jadeSkipBtn.visible=!0,this._jadeSkipBtn.x=125,this._jadeSkipBtn.title=Core.StringUtils.TEXT(70114)):(this._btnShare.visible=!1,this._btnOpen.visible=!1,this._btnBuy.visible=!1,this._jadeSkipBtn.visible=!1),[2]})})},e.prototype._onClose=function(t){var e=t.stageX/fairygui.GRoot.contentScaleFactor,i=t.stageY/fairygui.GRoot.contentScaleFactor;e>=this.x&&e<=this.x+this.width&&i>=this.y&&i<=this.y+this.height||Core.ViewManager.inst.closeView(this)},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),this._buyCallback=null,this.root.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onClose,this),this._rewardList.removeChildren(0,-1,!0),[2]})})},e}(Core.BaseWindow);t.FreeTreasureInfoWnd=r,__reflect(r.prototype,"Shop.FreeTreasureInfoWnd");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.center(),this.modal=!0,this._rareCardNumText=this.contentPane.getChild("txt1").asTextField,this._nameText=this.contentPane.getChild("treasureName").asTextField,this._btnShare=this.contentPane.getChild("shareBtn").asButton,this._effBox0=this.contentPane.getChild("box0").asLoader,this._effBox1=this.contentPane.getChild("box1").asLoader,this._openTrans0=this.contentPane.getTransition("t0"),this._rewardList=this.contentPane.getChild("rewardList").asList,this._btnShare.addClickListener(this._onShare,this),this.contentPane.getChild("closeBtn").addClickListener(function(){Core.ViewManager.inst.closeView(e)},this),this.adjust(this.contentPane.getChild("closeBg")),this.contentPane.getChild("closeBg").addClickListener(function(){Core.ViewManager.inst.closeView(e)},this)},e.prototype._shareComplete=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t&&(this._buyCallback&&this._buyCallback(!1),Core.ViewManager.inst.closeView(this)),[2]})})},e.prototype._onShare=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return t=window.sharePlatform.getShareLink(),""==t?[3,2]:[4,window.sharePlatform.shareAppMsg(Core.StringUtils.TEXT(60254),t,"")];case 1:e=i.sent(),this._shareComplete(e),i.label=2;case 2:return[2]}})})},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a,u,h=this;return __generator(this,function(l){return t.prototype.open.apply(this,e),i=e[0],this._buyCallback=e[1],r=e[2],this._freeId=e[3],n=i.treasureId,o=new Treasure.TreasureItem(-1,n),this._nameText.text=o.getName(),s=Treasure.TreasureReward.genRewardItemComsByTreasure(o),s.forEach(function(t){h._rewardList.addChild(t)}),this._rewardList.height=50*Math.ceil(s.length/2),a=o.getRareCardNum(),0>=a?this._rareCardNumText.visible=!1:(this._rareCardNumText.visible=!0,this._rareCardNumText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60130),a)),u=o.getRareType(),this._effBox0.url="treasure_"+u+"0_png",this._effBox1.url="treasure_"+u+"1_png",[2]})})},e.prototype._onClose=function(t){var e=t.stageX/fairygui.GRoot.contentScaleFactor,i=t.stageY/fairygui.GRoot.contentScaleFactor;e>=this.x&&e<=this.x+this.width&&i>=this.y&&i<=this.y+this.height||Core.ViewManager.inst.closeView(this)},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),this._buyCallback=null,this.root.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onClose,this),this._rewardList.removeChildren(0,-1,!0),[2]})})},e}(Core.BaseWindow);t.FreeTreasureInfoFacebookWnd=n,__reflect(n.prototype,"Shop.FreeTreasureInfoFacebookWnd")}(Shop||(Shop={}));var Shop;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._nameText=this.getChild("name").asTextField,this._iconImg=this.getChild("icon").asLoader,this._priceText=this.getChild("price").asTextField,this._cntText=this.getChild("cnt").asTextField;var i=this;this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){i.getTransition("t0").play()},this),this.addClickListener(this.onClick,this),Core.DeviceUtils.isWXGame()&&WXGame.WXGameMgr.inst.isExamineVersion?this._titleText=Core.StringUtils.TEXT(60027):this._titleText=Core.StringUtils.TEXT(60037),LanguageMgr.inst.isChineseLocale()||(this._nameText.fontSize=14)},e.prototype.setData=function(t){this._remainTime=t.RemainTime,this._remainTime>0?this._startCountDown():(this._stopCountDown(),this._priceText.text=this._titleText),this._data=t},Object.defineProperty(e.prototype,"host",{get:function(){return this._host},set:function(t){this._host=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remainTime",{get:function(){return this._remainTime},enumerable:!0,configurable:!0}),e.prototype._execCountDown=function(){return this._remainTime--,this._remainTime<=0?(this._priceText.text=this._titleText,void this._stopCountDown()):void(this._priceText.text=Core.StringUtils.secToString(this._remainTime,"hm"))},e.prototype._startCountDown=function(){this._stopCountDown(),this._priceText.text=Core.StringUtils.secToString(this._remainTime,"hm"),fairygui.GTimers.inst.add(1e3,this._remainTime,this._execCountDown,this)},e.prototype._stopCountDown=function(){fairygui.GTimers.inst.remove(this._execCountDown,this)},e.prototype._fetchReward=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return"lzd_handjoy"==window.gameGlobal.channel&&(t=!1),e={Type:this._data.Type,ID:this._data.ID,IsConsumeJade:t},[4,Net.rpcCall(pb.MessageID.C2S_WATCH_SHOP_FREE_ADS,pb.WatchShopFreeAdsArg.encode(e))];case 1:return i=n.sent(),0==i.errcode?(r=pb.WatchShopFreeAdsReply.decode(i.payload),this._handleReward(r.RewardPayload),this.setData(r.NextAds),this._host&&this._host.onFreeBuy(),[2,!0]):[2,!1]}})})},e.prototype._onFreeBuy=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return this._remainTime>0?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60196)),[2]):t||Player.inst.isVip?[4,this._fetchReward(!0)]:[3,2];case 1:return r.sent(),[3,11];case 2:return Core.DeviceUtils.isWXGame()?[4,this._fetchReward(!1)]:[3,4];case 3:return r.sent(),[3,11];case 4:return adsPlatform.isAdsOpen()?[4,adsPlatform.isAdsReady()]:[3,9];case 5:return e=r.sent(),e.success?[4,adsPlatform.showRewardAds()]:(Core.TipsUtils.showTipsFromCenter(e.reason),[2]);case 6:return i=r.sent(),i?[4,this._fetchReward(!1)]:[3,8];case 7:r.sent()&&Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60192)),r.label=8;case 8:return[3,11];case 9:return[4,this._fetchReward(!1)];case 10:r.sent(),r.label=11;case 11:return[2]}})})},Object.defineProperty(e.prototype,"canGetForShare",{get:function(){return adsPlatform.isAdsOpen()?!1:this._data.CanGet},set:function(t){this._data.CanGet=t,this.onClick()},enumerable:!0,configurable:!0}),e.prototype._handleReward=function(t){},e.prototype.onClick=function(){},e}(fairygui.GComponent);t.FreeItemComBase=e,__reflect(e.prototype,"Shop.FreeItemComBase");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setData=function(e){t.prototype.setData.call(this,e);var i=e.ID,r=Data.free_gold.get(i);r&&(this._nameText.text=r.desc,this._iconImg.url=r.icon,this._cntText.text="x"+r.soldGold)},e.prototype._handleReward=function(t){var e=pb.WatchShopFreeAdsReply.GoldReward.decode(t),i=Core.ViewManager.inst.getView(ViewName.shopView);i.onBuyGold(e.GoldAmount)},e.prototype.onClick=function(){var t=this;if(this._remainTime>0)return void Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60196));Core.ViewManager.inst.close(ViewName.freeGoldInfoWnd);var e=Data.free_gold.get(this._data.ID);e&&Core.ViewManager.inst.open(ViewName.freeGoldInfoWnd,e,function(e){t._onFreeBuy(e)},this._data.CanGet,this._data.ID)},e}(e);t.FreeGoldItemCom=i,__reflect(i.prototype,"Shop.FreeGoldItemCom");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setData=function(e){t.prototype.setData.call(this,e);var i=e.ID,r=Data.free_jade.get(i);r&&(this._nameText.text=r.desc,this._iconImg.url=r.icon,this._cntText.text="x"+r.soldJade)},e.prototype._handleReward=function(t){var e=pb.WatchShopFreeAdsReply.JadeReward.decode(t),i=Core.ViewManager.inst.getView(ViewName.shopView);i.onBuyJade(e.JadeAmount)},e.prototype.onClick=function(){var t=this;if(this._remainTime>0)return void Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60196));Core.ViewManager.inst.close(ViewName.freeJadeInfoWnd);var e=Data.free_jade.get(this._data.ID);e&&Core.ViewManager.inst.open(ViewName.freeJadeInfoWnd,e,function(e){t._onFreeBuy(e)},this._data.CanGet,this._data.ID)},e}(e);t.FreeJadeItemCom=r,__reflect(r.prototype,"Shop.FreeJadeItemCom");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setData=function(e){t.prototype.setData.call(this,e);var i=e.ID,r=null;if(r=e.Type==pb.ShopFreeAdsType.JadeAds?Data.free_good_treasure.get(i):Data.free_treasure.get(i)){var n=r.treasureId,o=new Treasure.TreasureItem(-1,n);this._nameText.text=o.getName(),this._iconImg.url=o.image}},e.prototype._handleReward=function(t){var e=pb.OpenTreasureReply.decode(t),i=new Treasure.TreasureReward;i.gold=e.GoldAmount,i.jade=e.Jade,e.CardIDs.forEach(function(t){i.addCardId(t)}),i.shareId=e.ShareHid;var r=null;r=this._data.Type==pb.ShopFreeAdsType.JadeAds?Data.free_good_treasure.get(this._data.ID):Data.free_treasure.get(this._data.ID),Core.ViewManager.inst.open(ViewName.treasureRewardInfo,i,new Treasure.TreasureItem(-1,r.treasureId),function(){var t=Core.ViewManager.inst.getView(ViewName.shopView);t.onBuyTreasure()})},e.prototype.onClick=function(){var t=this;
if(this._remainTime>0)return void Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60196));var e=ViewName.freeTreasureInfoWnd;"lzd_handjoy"==window.gameGlobal.channel&&this._data.Type==pb.ShopFreeAdsType.JadeAds&&""!=window.sharePlatform.getShareLink()&&(e=ViewName.freeTreasureInfoFacebookWnd),Core.ViewManager.inst.close(e);var i=null;i=this._data.Type==pb.ShopFreeAdsType.JadeAds?Data.free_good_treasure.get(this._data.ID):Data.free_treasure.get(this._data.ID),i&&Core.ViewManager.inst.open(e,i,function(e){t._onFreeBuy(e)},this._data.CanGet,this._data.ID)},e}(e);t.FreeTreasureItemCom=n,__reflect(n.prototype,"Shop.FreeTreasureItemCom")}(Shop||(Shop={}));var Shop;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._list=this.getChild("list").asList,this._freeTypeToItem=new Collection.Dictionary},e.prototype.setFreeSellData=function(t){var e=this;this._list.removeChildren(),this._freeTypeToItem.clear(),t.sort(function(t,e){return t.Type-e.Type}),t.forEach(function(t){var i=t.Type,r=null;i==pb.ShopFreeAdsType.GoldAds?r=fairygui.UIPackage.createObject(PkgName.shop,"freeGold").asCom:i==pb.ShopFreeAdsType.TreasureAds?r=fairygui.UIPackage.createObject(PkgName.shop,"freeTreasure").asCom:i==pb.ShopFreeAdsType.JadeAds&&(r=fairygui.UIPackage.createObject(PkgName.shop,"freeTreasure").asCom),r&&(r.setData(t),r.host=e,e._list.addChild(r),e._freeTypeToItem.setValue(i,r))})},e.prototype.updateFreeItemCanGetState=function(t,e){var i=this._freeTypeToItem.getValue(e);i&&(console.log("updateFreeItemCanGetState --> true"),i.canGetForShare=!0)},e.prototype.playTrans=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){t.getTransition("t0").play(function(){e()})})];case 1:return e.sent(),[2]}})})},e.prototype.onFreeBuy=function(){var t=!1;this._freeTypeToItem.forEach(function(e,i){i.remainTime<=0&&(t=!0)}),t||Core.EventCenter.inst.dispatchEventWith(GameEvent.ShopFreeUnavailableEv)},e}(fairygui.GComponent);t.FreeSellCom=e,__reflect(e.prototype,"Shop.FreeSellCom")}(Shop||(Shop={}));var Shop;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.adjust(this.getChild("bg"),Core.AdjustType.EXCEPT_MARGIN),this.y+=window.support.topMargin,this._goldAni=this.getTransition("goldAni"),this._jadeAni=this.getTransition("jadeAni"),this._resImg=[];for(var e=1;1e3>=e;e++){var i=this.getChild("resource"+e);if(!i)break;this._resImg.push(i.asLoader)}this._originY=this.y},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,n=this;return __generator(this,function(o){return t.prototype.open.apply(this,e),i=e[0],i==ResType.T_GOLD?(this._resImg.forEach(function(t){t.url="common_goldIcon_png"}),this._goldAni.play(function(){Core.ViewManager.inst.closeView(n)},this)):i==ResType.T_JADE?(this._resImg.forEach(function(t){t.url="common_jadeIcon_png"}),this._jadeAni.play(function(){Core.ViewManager.inst.closeView(n)},this)):Core.ViewManager.inst.closeView(this),r=e[1],r&&(this.y=this._originY+r),[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e}(Core.BaseView);t.GetResAniWnd=e,__reflect(e.prototype,"Shop.GetResAniWnd")}(Shop||(Shop={}));var Shop;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){var i=this;t.prototype.constructFromXML.call(this,e),this._treasureNameText=this.getChild("treasureName").asTextField,this._priceText=this.getChild("price").asTextField,this._bg1=this.getChild("bg1").asLoader,this._bg2=this.getChild("bg2").asLoader,this._resIcon=this.getChild("resIcon").asLoader,this._list=this.getChild("list").asList,this._bg1.addClickListener(this._onBox,this),this._bg2.addClickListener(this._onBox,this),this.getChild("buy").asLoader.addClickListener(this._onBox,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){i.getTransition("t0").play()},this),LanguageMgr.inst.isChineseLocale()||(this._treasureNameText.fontSize=14)},e.prototype.setProduct=function(t){var e=this;if(this._treasureNameText.text=t.desc,this._bg1.url="shop_"+t.bgImage1+"_png",t.bgImage2?this._bg2.url="shop_"+t.bgImage2+"_png":this._bg2.url="",t.isNotMoneyPay()?(this._priceText.text=""+t.price,t.hasEnoughResToBuy()?this._priceText.color=16777215:this._priceText.color=16711680):this._priceText.text=""+t.localizedPrice,this._resIcon.url=t.resIcon,t.icon){var i=(t.treasureType,fairygui.UIPackage.createObject(PkgName.shop,"giftCnt").asCom),r=new Pvp.SeasonTreasureInfo(Data.treasure_config.get(t.treasureType));i.getChild("treasureIcon").asLoader.url="treasure_box"+r.rare+"_png",i.getChild("treasureName").asTextField.text=r.title,i.addClickListener(function(){Core.ViewManager.inst.open(ViewName.shopTreasureInfoWnd,t,function(){e._product.isNotMoneyPay()?e._onJadePay():e._onPay()})},this),this._list.addChild(i)}if(t.general.length>0){var i=fairygui.UIPackage.createObject(PkgName.shop,"cardCnt").asCom,n=CardPool.CardPoolMgr.inst.getCardData(parseInt(t.general[0]),1),o=parseInt(t.general[1]);i.setCardInfo(n.__id__,o),this._list.addChild(i)}if(t.glod){var i=fairygui.UIPackage.createObject(PkgName.shop,"goldCnt").asCom;t.glod;i.setGoldInfo(t.glod),this._list.addChild(i)}if(t.jade){var i=fairygui.UIPackage.createObject(PkgName.shop,"jadeCnt").asCom,s=t.jade;i.setJadeInfo(s),this._list.addChild(i)}if(t.skin){var i=fairygui.UIPackage.createObject(PkgName.shop,"skinCnt").asCom,a=i.getChild("card").asCom;Utils.setImageUrlPicture(a.getChild("cardImg").asImage,"skin_m_"+t.skin+"_png"),a.getChild("nameText").asTextField.text=CardPool.CardSkinMgr.inst.getSkinConf(t.skin).name,i.getChild("title").asTextField.text="x1",this._list.addChild(i);var u=CardPool.CardPoolMgr.inst.getCollectCard(CardPool.CardSkinMgr.inst.getSkinConf(t.skin).general);Core.ViewManager.inst.open(ViewName.skinView,u,t.skin)}this._product=t},e.prototype._onBox=function(){var t=this;Data.treasure_config.get(this._product.id);Core.ViewManager.inst.open(ViewName.shopTreasureInfoWnd,this._product,function(){t._product.isNotMoneyPay()?t._onJadePay():t._onPay()})},e.prototype._onJadePay=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t=Pvp.Config.inst.getPvpTeam(Pvp.PvpMgr.inst.getPvpLevel()),t<this._product.payTeamLv?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70127)),[2]):(this._onBuy(),[2])})})},e.prototype._onBuy=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return t={GiftID:this._product.treasureType},[4,Net.rpcCall(pb.MessageID.C2S_BUY_LIMIT_GITF_BY_JADE,pb.BuyLimitGiftByJadeArg.encode(t))];case 1:return e=o.sent(),0==e.errcode?(i=pb.BuyLimitGiftReply.decode(e.payload),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60095)),r=new Treasure.TreasureReward,r.gold=i.GiftReward.GoldAmount,r.jade=i.GiftReward.Jade,i.GiftReward.CardIDs.forEach(function(t){r.addCardId(t)}),i.GiftReward.CardSkins.forEach(function(t){r.addSkinId(t)}),i.GiftReward.EmojiTeams.forEach(function(t){r.addEmojiTeamId(t)}),i.GiftReward.Headframes.forEach(function(t){r.addHeadFrame(t)}),r.shareId=i.GiftReward.ShareHid,Core.ViewManager.inst.open(ViewName.treasureRewardInfo,r,new Treasure.TreasureItem(-1,this._product.treasureType)),Core.EventCenter.inst.dispatchEventWith(GameEvent.LimitGiftSoldOutEv),n=Core.ViewManager.inst.getView(ViewName.shopView),n.onBuyGift()):Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60081)),[2]}})})},e.prototype._onPay=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n,o,s;return __generator(this,function(a){switch(a.label){case 0:return[4,Payment.PayMgr.inst.payProduct(this._product.id,1)];case 1:return t=a.sent(),t.success?(e=null,Payment.PayMgr.inst.needSendBuyRpc()?[3,2]:(i=t.param,e=i.LimitGift,[3,4])):[3,5];case 2:return r={GiftID:this._product.treasureType,Receipt:t.result},[4,Net.rpcCall(pb.MessageID.C2S_BUY_LIMIT_GITF,pb.BuyLimitGiftArg.encode(r))];case 3:n=a.sent(),0==n.errcode&&(e=pb.BuyLimitGiftReply.decode(n.payload)),a.label=4;case 4:return e?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60073)),o=new Treasure.TreasureReward,o.gold=e.GiftReward.GoldAmount,o.jade=e.GiftReward.Jade,e.GiftReward.CardIDs.forEach(function(t){o.addCardId(t)}),o.shareId=e.GiftReward.ShareHid,Core.ViewManager.inst.open(ViewName.treasureRewardInfo,o,new Treasure.TreasureItem(-1,this._product.treasureType)),Core.EventCenter.inst.dispatchEventWith(GameEvent.LimitGiftSoldOutEv),s=Core.ViewManager.inst.getView(ViewName.shopView),s.onBuyGift()):Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60116)),[3,6];case 5:Core.TipsUtils.showTipsFromCenter(t.result),a.label=6;case 6:return[2]}})})},Object.defineProperty(e.prototype,"treasure",{get:function(){return this._treasure},enumerable:!0,configurable:!0}),e}(fairygui.GComponent);t.GiftItemCom=e,__reflect(e.prototype,"Shop.GiftItemCom")}(Shop||(Shop={}));var Shop;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._list=this.getChild("list").asList},e.prototype.setGiftProducts=function(t){var e=this;this._list.removeChildren(),t.forEach(function(t){if(t.isVipCard()){var i=fairygui.UIPackage.createObject(PkgName.shop,"advipItem").asCom;i.setProduct(t),e._list.addChild(i)}else if(t.isMiniVipCard()){var i=fairygui.UIPackage.createObject(PkgName.shop,"minivipItem").asCom;i.setProduct(t),e._list.addChild(i)}else{var i=fairygui.UIPackage.createObject(PkgName.shop,"purchaseItem").asCom;i.setProduct(t),e._list.addChild(i)}})},e.prototype.playTrans=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){t.getTransition("t0").play(function(){e()})})];case 1:return e.sent(),[2]}})})},e}(fairygui.GComponent);t.GiftSellCom=e,__reflect(e.prototype,"Shop.GiftSellCom")}(Shop||(Shop={}));var Shop;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.modal=!0,this.center(),this._privCom=this.contentPane.getChild("priv").asCom,this._privCom.setPriv(Social.PrivType.vip),this._buyBtn=this.contentPane.getChild("btnBuy").asButton,this._payBtn=this.contentPane.getChild("btnPay").asButton,this.adjust(this.contentPane.getChild("closeBg")),this.contentPane.getChild("closeBg").addClickListener(function(){Core.ViewManager.inst.closeView(e)},this),this._buyBtn.addClickListener(this._onBuy,this),this._payBtn.addClickListener(this._onPay,this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){switch(n.label){case 0:return[4,t.prototype.open.apply(this,e)];case 1:return n.sent(),i=e[0],this._callback=e[1],r=i.treasureType,this._product=i,i.isNotMoneyPay()?(this._buyBtn.visible=!0,this._payBtn.visible=!1,this._buyBtn.title=""+i.jadePrice,Player.inst.getResource(ResType.T_JADE)<i.jadePrice?this._buyBtn.getChild("title").asTextField.color=16711680:this._buyBtn.getChild("title").asTextField.color=16777215):(this._buyBtn.visible=!1,this._payBtn.visible=!0,this._payBtn.title=""+i.localizedPrice),[2]}})})},e.prototype._onPay=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._callback&&this._callback(),Core.ViewManager.inst.closeView(this),[2]})})},e.prototype._onBuy=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return Player.inst.hasEnoughJade(this._product.jadePrice)?[4,Net.rpcCall(pb.MessageID.C2S_BUY_VIP_CARD,null)]:(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60085)),[2]);case 1:return t=o.sent(),0==t.errcode?(e=pb.BuyVipCardReply.decode(t.payload),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60095)),i=new Pvp.GetRewardData,i.addHeadFrame(e.HeadFrame),r=Payment.PayMgr.inst.getProducts().getValue("advip"),i.addOther(r.name,"shop_"+r.icon+"_png"),Core.ViewManager.inst.open(ViewName.getRewardWnd,i),Core.EventCenter.inst.dispatchEventWith(GameEvent.LimitGiftSoldOutEv),Player.inst.vipTime=e.RemainTime,n=Core.ViewManager.inst.getView(ViewName.shopView),n.onBuyGift(),Core.ViewManager.inst.closeView(this)):Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60081)),[2]}})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,t.prototype.close.apply(this,e)];case 1:return i.sent(),this._product=null,this._callback=null,[2]}})})},e}(Core.BaseWindow);t.GiftVipInfoWnd=e,__reflect(e.prototype,"Shop.GiftVipInfoWnd");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.modal=!0,this.center(),this._buyBtn=this.contentPane.getChild("btnBuy").asButton,this._privCom=this.contentPane.getChild("priv").asCom,this._privCom.setPriv(Social.PrivType.miniVip),this.adjust(this.contentPane.getChild("closeBg")),this.contentPane.getChild("closeBg").addClickListener(function(){Core.ViewManager.inst.closeView(e)},this),this._buyBtn.addClickListener(this._onBuy,this)},e.prototype._onBuy=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n,o=this;return __generator(this,function(s){switch(s.label){case 0:return Player.inst.hasEnoughJade(this._product.jadePrice)?(t={GiftID:this._product.treasureType},[4,Net.rpcCall(pb.MessageID.C2S_BUY_LIMIT_GITF_BY_JADE,pb.BuyLimitGiftByJadeArg.encode(t))]):(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60085)),[2]);case 1:return e=s.sent(),0==e.errcode?(Core.ViewManager.inst.closeView(this),i=pb.BuyLimitGiftReply.decode(e.payload),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60095)),r=new Treasure.TreasureReward,r.gold=i.GiftReward.GoldAmount,r.jade=i.GiftReward.Jade,i.GiftReward.CardIDs.forEach(function(t){r.addCardId(t)}),i.GiftReward.CardSkins.forEach(function(t){r.addSkinId(t)}),i.GiftReward.EmojiTeams.forEach(function(t){r.addEmojiTeamId(t)}),i.GiftReward.Headframes.forEach(function(t){r.addHeadFrame(t)}),r.shareId=i.GiftReward.ShareHid,n=new Pvp.GetRewardData,n.addOther(this._product.name,"shop_"+this._product.icon+"_png",this._product.desc),Core.ViewManager.inst.open(ViewName.getRewardWnd,n,function(){Core.ViewManager.inst.open(ViewName.treasureRewardInfo,r,new Treasure.TreasureItem(-1,o._product.treasureType)),Core.EventCenter.inst.dispatchEventWith(GameEvent.LimitGiftSoldOutEv);var t=Core.ViewManager.inst.getView(ViewName.shopView);t.onBuyGift()})):Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60081)),[2]}})})},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){switch(n.label){case 0:return[4,t.prototype.open.apply(this,e)];case 1:return n.sent(),i=e[0],this._callback=e[1],r=i.treasureType,this._product=i,this._buyBtn.visible=!0,this._buyBtn.title=""+i.jadePrice,Player.inst.hasEnoughJade(i.jadePrice)?this._buyBtn.getChild("title").asTextField.color=16777215:this._buyBtn.getChild("title").asTextField.color=16711680,[2]}})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,t.prototype.close.apply(this,e)];case 1:return i.sent(),[2]}})})},e}(Core.BaseWindow);t.GiftMiniVipInfoWnd=i,__reflect(i.prototype,"Shop.GiftMiniVipInfoWnd");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){var i=this;t.prototype.constructFromXML.call(this,e),this._priceText=this.getChild("price").asTextField,this._dayText=this.getChild("day").asTextField,this._remainDayText=this.getChild("time").asTextField,this.addClickListener(this._onJadePay,this),this.getChild("buy").asLoader.addClickListener(function(){i._product.isNotMoneyPay()?i._onJadePay():i._product.isVipCard()?Core.ViewManager.inst.open(ViewName.advipInfo,i._product,function(){i._onPay()}):Core.ViewManager.inst.open(ViewName.advipInfo,i._product,function(){i._onPay()})},this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){i.getTransition("t0").play()},this)},e.prototype.setProduct=function(t){t.isNotMoneyPay()?(this._priceText.text=""+t.jadePrice,Player.inst.hasEnoughJade(t.jadePrice)?this._priceText.color=16777215:this._priceText.color=16711680):this._priceText.text=""+t.localizedPrice,t.isVipCard()?"lzd_handjoy"==window.gameGlobal.channel?this._dayText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60032),30):this._dayText.text="":this._dayText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60032),7),this._product=t,this._setVipRemainTime(),this._startCountDown()},e.prototype._startCountDown=function(){fairygui.GTimers.inst.remove(this._setVipRemainTime,this),fairygui.GTimers.inst.add(1e3,-1,this._setVipRemainTime,this)},e.prototype._setVipRemainTime=function(){this._product.isVipCard()?Player.inst.isVip?this._remainDayText.text=Core.StringUtils.secToString(Player.inst.vipTime,"dhm"):this._remainDayText.text="":this._product.isMiniVipCard()&&Player.inst.isMiniVip?this._remainDayText.text=Core.StringUtils.secToString(Player.inst.miniVipTime,"dhm"):this._remainDayText.text=""},e.prototype._onJadePay=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._product.isVipCard()?Core.ViewManager.inst.open(ViewName.advipInfo,this._product):Core.ViewManager.inst.open(ViewName.minivipInfo,this._product),[2]})})},e.prototype._onPay=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return[4,Payment.PayMgr.inst.payProduct(this._product.id,1)];case 1:return t=o.sent(),t.success?(e=null,Payment.PayMgr.inst.needSendBuyRpc()?[3,2]:(i=t.param,e=i.LimitGift,[3,4])):[3,5];case 2:return[4,Net.rpcCall(pb.MessageID.C2S_BUY_VIP_CARD,null)];case 3:r=o.sent(),0==r.errcode&&(e=pb.BuyLimitGiftReply.decode(r.payload)),o.label=4;case 4:return e?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60095)),Core.EventCenter.inst.dispatchEventWith(GameEvent.LimitGiftSoldOutEv),Player.inst.vipTime=-1,n=Core.ViewManager.inst.getView(ViewName.shopView),n.onBuyGift()):Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60116)),[3,6];case 5:Core.TipsUtils.showTipsFromCenter(t.result),o.label=6;case 6:return[2]}})})},e}(fairygui.GComponent);t.GiftVipCom=r,__reflect(r.prototype,"Shop.GiftVipCom")}(Shop||(Shop={}));var Shop;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._cardImg=this.getChild("cardImg").asLoader,this._titleText=this.getChild("title").asTextField,this.touchable=!1},e.prototype.setGoldInfo=function(t){this._titleText.text="x"+t},e}(fairygui.GComponent);t.GoldCntCom=e,__reflect(e.prototype,"Shop.GoldCntCom")}(Shop||(Shop={}));var Shop;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.center(),this.modal=!0,this._nameText=this.contentPane.getChild("name").asTextField,this._goldCntText=this.contentPane.getChild("goldCnt").asTextField,this._cardImg=this.contentPane.getChild("icon").asLoader,this._btnBuy=this.contentPane.getChild("btnBuy").asButton,this._btnBuy.addClickListener(function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this._product.askSubRes(!0)];case 1:return t.sent()?(this._buyCallback&&this._buyCallback(),Core.ViewManager.inst.closeView(this),[2]):[2]}})})},this),this.contentPane.getChild("closeBtn").addClickListener(function(){Core.ViewManager.inst.closeView(e)},this),this.adjust(this.contentPane.getChild("closeBg")),this.contentPane.getChild("closeBg").addClickListener(function(){Core.ViewManager.inst.closeView(e)},this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){return t.prototype.open.apply(this,e),i=e[0],r=e[1],LanguageMgr.inst.isChineseLocale()?this._nameText.text=Core.StringUtils.TEXT(60034)+(i.desc+"?"):this._nameText.text=Core.StringUtils.TEXT(60034)+(" "+i.desc+"?"),this._goldCntText.text="x"+i.soldGold,""!=i.icon&&(this._cardImg.url=i.icon),this._btnBuy.title=""+i.price,i.hasEnoughResToBuy()?this._btnBuy.getChild("title").asTextField.color=16777215:this._btnBuy.getChild("title").asTextField.color=16711680,this._btnBuy.icon=i.resIcon,this._product=i,this._buyCallback=r,[2]})})},e.prototype._onClose=function(t){var e=t.stageX/fairygui.GRoot.contentScaleFactor,i=t.stageY/fairygui.GRoot.contentScaleFactor;e>=this.x&&e<=this.x+this.width&&i>=this.y&&i<=this.y+this.height||Core.ViewManager.inst.closeView(this)},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),this._product=null,this._buyCallback=null,this.root.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onClose,this),[2]})})},e}(Core.BaseWindow);t.GoldInfoWnd=e,__reflect(e.prototype,"Shop.GoldInfoWnd")}(Shop||(Shop={}));var Shop;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){var i=this;t.prototype.constructFromXML.call(this,e),this._nameText=this.getChild("name").asTextField,this._priceText=this.getChild("price").asTextField,this._goldCntText=this.getChild("goldCnt").asTextField,this._cardImg=this.getChild("icon").asLoader,this._resIcon=this.getChild("resIcon").asLoader,this.addClickListener(this._onBuy,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){i.getTransition("t0").play()},this),LanguageMgr.inst.isChineseLocale()||(this._nameText.fontSize=14)},e.prototype.setGoldProduct=function(t){this._nameText.text=t.desc,this._priceText.text=""+t.price,this._goldCntText.text="x"+t.soldGold,this._resIcon.url=t.resIcon,""!=t.icon&&(this._cardImg.url=t.icon),this._product=t},e.prototype._onBuy=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return Core.ViewManager.inst.open(ViewName.shopGoldInfoWnd,this._product,function(){return __awaiter(t,void 0,void 0,function(){var t,e,i,r;return __generator(this,function(n){switch(n.label){case 0:return t={GoodsID:this._product.id},[4,Net.rpcCall(pb.MessageID.C2S_BUY_GOLD,pb.BuyGoldArg.encode(t))];case 1:return e=n.sent(),0==e.errcode?(i=pb.BuyGoldReply.decode(e.payload),r=Core.ViewManager.inst.getView(ViewName.shopView),Core.EventCenter.inst.dispatchEventWith(GameEvent.RefreshSoldGoldEv,!1,i.NextRemainTime),r.onBuyGold(i.Gold)):Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60081)),[2]}})})}),[2]})})},e}(fairygui.GComponent);t.GoldItemCom=e,__reflect(e.prototype,"Shop.GoldItemCom")}(Shop||(Shop={}));var Shop;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){var i=this;t.prototype.constructFromXML.call(this,e),this._tipTimeBg=this.getChild("tipBg").asGraph,this._tipTimeText=this.getChild("tipTime").asTextField,this._list=this.getChild("list").asList,this.setCanBuyMode(!0),Core.EventCenter.inst.addEventListener(GameEvent.RefreshSoldGoldEv,function(t){i.setCanBuyMode(!1,t.data)},this)},e.prototype.setGoldProducts=function(t){var e=this;this._list.removeChildren(),t.forEach(function(t){var i=fairygui.UIPackage.createObject(PkgName.shop,"goldItem").asCom;i.setGoldProduct(t),e._list.addChild(i)})},e.prototype.setCanBuyMode=function(t,e){if(this._tipTimeBg.visible=!t,this._tipTimeText.visible=!t,this._tipTimeBg.touchable=!t,e){var i=e,r=Math.round((i-1800)/3600),n=Math.round((i-30)/60)%60;r>0?this._tipTimeText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60153),r):n>0?this._tipTimeText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60150),n):this._tipTimeText.text=Core.StringUtils.TEXT(60141)}},e.prototype.playTrans=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){t.getTransition("t0").play(function(){e()})})];case 1:return e.sent(),[2]}})})},e}(fairygui.GComponent);t.GoldSellCom=e,__reflect(e.prototype,"Shop.GoldSellCom")}(Shop||(Shop={}));var Shop;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._cardImg=this.getChild("cardImg").asLoader,this._titleText=this.getChild("title").asTextField,this.touchable=!1},e.prototype.setJadeInfo=function(t){this._titleText.text="x"+t},e}(fairygui.GComponent);t.JadeCntCom=e,__reflect(e.prototype,"Shop.JadeCntCom")}(Shop||(Shop={}));var Shop;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){var i=this;t.prototype.constructFromXML.call(this,e),this._nameText=this.getChild("name").asTextField,this._priceText=this.getChild("price").asTextField,this._jadeCntText=this.getChild("jadeCnt").asTextField,this._cardImg=this.getChild("icon").asLoader,this.addClickListener(this._onPay,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){i.getTransition("t0").play()},this),LanguageMgr.inst.isChineseLocale()||(this._nameText.fontSize=14)},e.prototype.setProduct=function(t){this._nameText.text=t.desc,this._priceText.text=t.localizedPrice,this._jadeCntText.text="x"+t.jade,this._cardImg.url=t.icon,this._product=t},e.prototype._onPay=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n,o,r,n;return __generator(this,function(s){switch(s.label){case 0:return[4,Payment.PayMgr.inst.payProduct(this._product.id,1)];case 1:return t=s.sent(),e=0,t.success?Payment.PayMgr.inst.needSendBuyRpc()?[3,2]:(i=t.param,r=i.Jade,e=r.Jade+r.RewardJade,[3,4]):[3,5];case 2:return n={GoodsID:this._product.id,Receipt:t.result},[4,Net.rpcCall(pb.MessageID.C2S_BUY_JADE,pb.BuyJadeArg.encode(n))];case 3:o=s.sent(),0==o.errcode?(r=pb.BuyJadeReply.decode(o.payload),e=r.Jade+r.RewardJade):Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60116)),s.label=4;case 4:return[3,6];case 5:Core.TipsUtils.showTipsFromCenter(t.result),s.label=6;case 6:return e>0&&(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60073)),n=new Pvp.GetRewardData,n.jade=e,Core.ViewManager.inst.open(ViewName.getRewardWnd,n)),[2]}})})},e}(fairygui.GComponent);t.JadeItemCom=e,__reflect(e.prototype,"Shop.JadeItemCom")}(Shop||(Shop={}));var Shop;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._list=this.getChild("list").asList},e.prototype.setJadeProducts=function(t){var e=this;if(this._list.removeChildren(),t.forEach(function(t){var i=fairygui.UIPackage.createObject(PkgName.shop,"jadeItem").asCom;i.setProduct(t),e._list.addChild(i)}),t.length>3){var i=t.length-3;this._list.height+=220*Math.ceil(i/3),this.height+=220*Math.ceil(i/3)}},e.prototype.playTrans=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){t.getTransition("t0").play(function(){e()})})];case 1:return e.sent(),[2]}})})},e}(fairygui.GComponent);t.JadeSellCom=e,__reflect(e.prototype,"Shop.JadeSellCom")}(Shop||(Shop={}));var Shop;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var t=this;e.prototype.initUI.call(this),this.adjust(this.getChild("bg"),Core.AdjustType.EXCEPT_MARGIN),this.y+=window.support.topMargin,this._shopList=this.getChild("shopList").asList,this._goldText=this.getChild("goldText").asTextField,this._jadeText=this.getChild("jadeText").asTextField,this._bowlderText=this.getChild("bowlderText").asTextField,this._closeBtn=this.getChild("closeBtn").asButton,this._giftSellCom=null,this._jadeSellCom=null,this._treasureSellCom=null,this._goldSellCom=null,this._refreshing=!1,this._closeBtn.addClickListener(function(){Core.ViewManager.inst.closeView(t)},this),Player.inst.addEventListener(Player.ResUpdateEvt,this._onResUpdate,this),Core.EventCenter.inst.addEventListener(GameEvent.LimitGiftSoldOutEv,function(){t._refresh()},this),Core.EventCenter.inst.addEventListener(GameEvent.RefreshSoldTreasureEv,function(e){t._refresh()},this),Core.EventCenter.inst.addEventListener(GameEvent.RefreshLimitGiftEv,function(e){t._refresh()},this),this.getChild("bowlderText").visible=Home.hasBowlderRes(),this.getChild("bowlderIcon").visible=Home.hasBowlderRes()},i.prototype.updateFreeItemCanGetState=function(t,e){this._freeSellCom&&(console.log("updateFreeItemCanGetState",t,e),this._freeSellCom.updateFreeItemCanGetState(t,e))},i.prototype._refresh=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o,s,a,u,h,l,c,c,d,p,c,_,g,c,f,c;return __generator(this,function(m){switch(m.label){case 0:return this._refreshing?[2]:(this._refreshing=!0,this._shopList.removeChildren(),this._giftSellCom=null,this._jadeSellCom=null,this._treasureSellCom=null,this._goldSellCom=null,this._onResUpdate(),[4,Net.rpcCall(pb.MessageID.C2S_FETCH_SHOP_DATA,null)]);case 1:return e=m.sent(),0!=e.errcode?(this._refreshing=!1,[2]):(i=!0,Core.DeviceUtils.isWXGame()&&"android"!=WXGame.WXGameMgr.inst.platform&&!WXGame.WXGameMgr.inst.isInHuoshuWhiteList&&Player.inst.cumulativePay<=0&&(i=!1),r=pb.ShopData.decode(e.payload),n=new Array,o=null,s=null,r.VipCard&&Home.FunctionMgr.inst.isVipCardOpen()&&(o=new pb.LimitGift,o.GiftID=r.VipCard.GoodsID,o.Price=r.VipCard.JadePrice),(o||r.Gift.length>0)&&Home.FunctionMgr.inst.isShopGiftOpen()?(a=new Array,u=Pvp.PvpMgr.inst.getPvpLevel(),h=Pvp.Config.inst.getPvpTeam(u),o&&(l=t.ShopMgr.inst.getGiftProduct(o.GiftID),l&&(l.remainTime=o.RemainTime,a.push(l))),r.Gift.forEach(function(e){var i=t.ShopMgr.inst.getGiftProduct(e.GiftID);i&&i.isVisible()&&h>=i.showTeamLv&&(h<=i.hideTeamLv||0==i.hideTeamLv)&&(i.remainTime=e.RemainTime,i.isMiniVipCard()?s=i:a.push(i))}),s&&(a=[s].concat(a)),a.length>0?(c=fairygui.UIPackage.createObject(PkgName.shop,"purchase",t.GiftSellCom).asCom,c.setGiftProducts(a),this._shopList.addChild(c),this._giftSellCom=c,[4,c.playTrans()]):[3,3]):[3,3]);case 2:m.sent(),fairygui.GTimers.inst.remove(this._nextGift,this),a.length>1&&(this._giftList=c.getChild("list").asList,this._curListIndex=0,fairygui.GTimers.inst.add(3e3,this._curListIndex,this._nextGift,this)),m.label=3;case 3:return r.Adses.length>0?(c=fairygui.UIPackage.createObject(PkgName.shop,"free",t.FreeSellCom).asCom,c.setFreeSellData(r.Adses),this._shopList.addChild(c),this._freeSellCom=c,[4,c.playTrans()]):[3,5];
case 4:m.sent(),m.label=5;case 5:return r.SoldTreasures.length>0?(d=[],p=[],r.SoldTreasures.forEach(function(e){var i=e.TreasureModelID,r=t.ShopMgr.inst.getTreasureProduct(i);r&&p.push(r)}),p.length>0?(c=fairygui.UIPackage.createObject(PkgName.shop,"treasure",t.TreasureSellCom).asCom,c.setTreasureProducts(p),r.SoldTreasureRemainTime>0&&c.setCanBuyMode(!1,r.SoldTreasureRemainTime),this._shopList.addChild(c),this._treasureSellCom=c,[4,c.playTrans()]):[3,7]):[3,7];case 6:m.sent(),m.label=7;case 7:return _=!0,r.JadeGoodsList.length>0&&_&&Home.FunctionMgr.inst.isInAppPurchaseOpen()?(g=[],r.JadeGoodsList.forEach(function(e){var i=t.ShopMgr.inst.getJadeProduct(e.GoodsID);i&&("advip"==i.id&&!Player.inst.isVip||"advip"!=i.id)&&(i.price=e.Price,i.jade=e.Jade,g.push(i))}),g.length>0?(c=fairygui.UIPackage.createObject(PkgName.shop,"jade",t.JadeSellCom).asCom,c.setJadeProducts(g),this._shopList.addChild(c),this._jadeSellCom=c,[4,c.playTrans()]):[3,9]):[3,9];case 8:m.sent(),m.label=9;case 9:return r.GoldGoodsList.length>0?(f=[],r.GoldGoodsList.forEach(function(e){var i=t.ShopMgr.inst.getGoldProduct(e.GoodsID);i?f.push(i):console.error("can't find gold product "+e.GoodsID)}),f.length>0?(c=fairygui.UIPackage.createObject(PkgName.shop,"gold",t.GoldSellCom).asCom,c.setGoldProducts(f),r.BuyGoldRemainTime>0&&c.setCanBuyMode(!1,r.BuyGoldRemainTime),this._shopList.addChild(c),this._goldSellCom=c,[4,c.playTrans()]):[3,11]):[3,11];case 10:m.sent(),m.label=11;case 11:return this._refreshing=!1,[2]}})})},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,e.prototype.open.apply(this,t)];case 1:return i.sent(),this._refresh(),[2]}})})},i.prototype._onResUpdate=function(){this._goldText.text=""+Player.inst.getResource(ResType.T_GOLD),this._jadeText.text=""+Player.inst.getResource(ResType.T_JADE),this._bowlderText.text=""+Player.inst.getResource(ResType.T_BOWLDER)},i.prototype.onBuyGold=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=new Pvp.GetRewardData,e.gold=t,Core.ViewManager.inst.open(ViewName.getRewardWnd,e),[2]})})},i.prototype.onBuyJade=function(t){var e=new Pvp.GetRewardData;e.jade=t,Core.ViewManager.inst.open(ViewName.getRewardWnd,e)},i.prototype.onBuyTreasure=function(){this._onResUpdate()},i.prototype.onBuyGift=function(){this._onResUpdate()},i.prototype._nextGift=function(){var t=this._giftList.scrollPane.percX,e=t*(this._giftList.numItems-1),i=Math.round(e);this._curListIndex!=i?this._curListIndex=i:(this._curListIndex+=1,this._curListIndex>=this._giftList.numItems&&(this._curListIndex=0),this._giftList.scrollToView(this._curListIndex,!0))},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),this._shopList.removeChildren(),this._giftSellCom=null,this._jadeSellCom=null,this._treasureSellCom=null,this._goldSellCom=null,this._refreshing=!1,fairygui.GTimers.inst.remove(this._nextGift,this),this._giftList=null,[2]})})},i}(Core.BaseView);t.ShopView=e,__reflect(e.prototype,"Shop.ShopView")}(Shop||(Shop={}));var Shop;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.center(),this.modal=!0,this._rareCardNumText=this.contentPane.getChild("txt1").asTextField,this._nameText=this.contentPane.getChild("treasureName").asTextField,this._buyBtn=this.contentPane.getChild("btnBuy").asButton,this._effBox0=this.contentPane.getChild("box0").asLoader,this._effBox1=this.contentPane.getChild("box1").asLoader,this._openTrans0=this.contentPane.getTransition("t0"),this._rewardList=this.contentPane.getChild("rewardList").asList,this._buyBtn.addClickListener(function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this._product.askSubRes(!0)];case 1:return t.sent()?(this._buyCallback&&this._buyCallback(),Core.ViewManager.inst.closeView(this),[2]):[2]}})})},this),this.contentPane.getChild("closeBtn").addClickListener(function(){Core.ViewManager.inst.closeView(e)},this),this.adjust(this.contentPane.getChild("closeBg")),this.contentPane.getChild("closeBg").addClickListener(function(){Core.ViewManager.inst.closeView(e)},this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a,u=this;return __generator(this,function(h){return t.prototype.open.apply(this,e),i=e[0],r=null,i.type==Payment.ProductType.T_GIFT?r=i.conf.reward:i.type==Payment.ProductType.T_TREASURE&&(r=i.id),this._buyCallback=e[1],n=new Treasure.TreasureItem(-1,r),o=Treasure.TreasureReward.genRewardItemComsByTreasure(n),o.forEach(function(t){u._rewardList.addChild(t)}),this._rewardList.height=50*Math.ceil(o.length/2),this._nameText.text=""+n.getName(),s=n.getRareCardNum(),0>=s?this._rareCardNumText.visible=!1:(this._rareCardNumText.visible=!0,this._rareCardNumText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60130),s)),a=n.getRareType(),this._effBox0.url="treasure_"+a+"0_png",this._effBox1.url="treasure_"+a+"1_png",this._buyBtn.title=""+i.price,i.hasEnoughResToBuy()?this._buyBtn.getChild("title").asTextField.color=16777215:this._buyBtn.getChild("title").asTextField.color=16711680,this._buyBtn.icon=i.resIcon,this._product=i,[2]})})},e.prototype._onClose=function(t){var e=t.stageX/fairygui.GRoot.contentScaleFactor,i=t.stageY/fairygui.GRoot.contentScaleFactor;e>=this.x&&e<=this.x+this.width&&i>=this.y&&i<=this.y+this.height||Core.ViewManager.inst.closeView(this)},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),this._buyCallback=null,this.root.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onClose,this),this._rewardList.removeChildren(0,-1,!0),[2]})})},e}(Core.BaseWindow);t.TreasureInfoWnd=e,__reflect(e.prototype,"Shop.TreasureInfoWnd")}(Shop||(Shop={}));var Shop;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){var i=this;t.prototype.constructFromXML.call(this,e),this._nameText=this.getChild("name").asTextField,this._priceText=this.getChild("price").asTextField,this._cardImg=this.getChild("box").asLoader,this._boxLight=this.getChild("canOpenBg").asLoader,this._resIcon=this.getChild("resIcon").asLoader,this.addClickListener(this._onBuy,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){i.getTransition("t0").play()},this)},e.prototype.setTreasureProduct=function(t){var e=t.id,i=new Treasure.TreasureItem(-1,e);this._cardImg.url=i.image,this._nameText.text=""+i.getName(),this._boxLight.url="treasure_box"+i.getRareType()+"CanOpen_png",this._priceText.text=""+t.price,this._resIcon.url=t.resIcon,this._product=t},e.prototype._onBuy=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return Core.ViewManager.inst.open(ViewName.shopTreasureInfoWnd,this._product,function(){return __awaiter(t,void 0,void 0,function(){var t,e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return t={TreasureModelID:this._product.id},[4,Net.rpcCall(pb.MessageID.C2S_BUY_SOLDTREASURE,pb.BuySoldTreasureArg.encode(t))];case 1:return e=o.sent(),0==e.errcode?(i=pb.BuySoldTreasureReply.decode(e.payload),r=new Treasure.TreasureReward,r.gold=i.TreasureReward.GoldAmount,r.jade=i.TreasureReward.Jade,i.TreasureReward.CardIDs.forEach(function(t){r.addCardId(t)}),r.shareId=i.TreasureReward.ShareHid,Core.ViewManager.inst.open(ViewName.treasureRewardInfo,r,new Treasure.TreasureItem(-1,this._product.id)),Core.EventCenter.inst.dispatchEventWith(GameEvent.RefreshSoldTreasureEv,!1,i.NextRemainTime),n=Core.ViewManager.inst.getView(ViewName.shopView),n.onBuyTreasure()):Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60081)),[2]}})})}),[2]})})},e}(fairygui.GComponent);t.TreasureItemCom=e,__reflect(e.prototype,"Shop.TreasureItemCom")}(Shop||(Shop={}));var Shop;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._tipTimeBg=this.getChild("tipBg").asGraph,this._tipTimeText=this.getChild("tipTime").asTextField,this._list=this.getChild("list").asList,this.setCanBuyMode(!0)},i.prototype.setTreasureProducts=function(e){var i=this;this._list.removeChildren(),e.forEach(function(e){var r=fairygui.UIPackage.createObject(PkgName.shop,"treasureItem",t.TreasureItemCom).asCom;r.setTreasureProduct(e),i._list.addChild(r)})},i.prototype.setCanBuyMode=function(t,e){if(this._tipTimeBg.visible=!t,this._tipTimeText.visible=!t,this._tipTimeBg.touchable=!t,e){var i=e,r=Math.round((i-1800)/3600),n=Math.round((i-30)/60)%60;r>0?this._tipTimeText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60153),r):n>0?this._tipTimeText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60150),n):this._tipTimeText.text=Core.StringUtils.TEXT(60141)}},i.prototype.playTrans=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){t.getTransition("t0").play(function(){e()})})];case 1:return e.sent(),[2]}})})},i}(fairygui.GComponent);t.TreasureSellCom=e,__reflect(e.prototype,"Shop.TreasureSellCom")}(Shop||(Shop={}));var Social;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._headIconImg=this.getChild("headIcon").asImage,this._newHintImg=this.getChild("newHint").asLoader},e.prototype.setCard=function(t,e){var i=t.cardId;""==e?this._url="avatar_"+i+"_png":this._url="avatar_"+CardPool.CardSkinMgr.inst.getSkinConf(e).head+"_png",this._cardId=i,Utils.setImageUrlPicture(this._headIconImg,this._url),this._newHintImg.visible=CardPool.CardPoolMgr.inst.isAvatarNew(i)},Object.defineProperty(e.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cardId",{get:function(){return this._cardId},enumerable:!0,configurable:!0}),e.prototype.setCheck=function(t){t?this.getController("button").setSelectedPage("down"):this.getController("button").setSelectedPage("up")},e}(fairygui.GComponent);t.AvatarItemCom=e,__reflect(e.prototype,"Social.AvatarItemCom");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._headFrameImg=this.getChild("headFrame").asImage,this._newHintImg=this.getChild("newHint").asLoader},e.prototype.setFrame=function(t){this._skinID=t,this._url="headframe_"+this._skinID+"_png",Utils.setImageUrlPicture(this._headFrameImg,this._url),this._newHintImg.visible=!1},Object.defineProperty(e.prototype,"SkinID",{get:function(){return this._skinID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),e.prototype.setCheck=function(t){t?this.getController("button").setSelectedPage("down"):this.getController("button").setSelectedPage("up")},e}(fairygui.GComponent);t.FrameItemCom=i,__reflect(i.prototype,"Social.FrameItemCom");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.center(),this.modal=!0,this._confirmBtn=this.contentPane.getChild("confirmBtn").asButton,this._headCom=this.contentPane.getChild("head").asCom,this._nameText=this.contentPane.getChild("name").asTextField,this._nameText.textParser=Core.StringUtils.parseColorText,this._headList=this.contentPane.getChild("headList").asList,this._headFrameList=this.contentPane.getChild("headFrameList").asList,this.contentPane.getChild("headChk").visible=!1,this.contentPane.getChild("headFrameChk").visible=!1,this._confirmBtn.addClickListener(function(){e._curItem&&Player.inst.saveAvatarUrl(e._curItem.url),e._curFrame&&Player.inst.saveFrameUrl(e._curFrame.SkinID),CardPool.CardPoolMgr.inst.clearAvatarHintNum(),Core.ViewManager.inst.closeView(e)},this),this._headList.addEventListener(fairygui.ItemEvent.CLICK,this._onItemClick,this),this._headFrameList.addEventListener(fairygui.ItemEvent.CLICK,this._onFrameClick,this),this._curItem=null},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){switch(o.label){case 0:return this.battleChangeLayer(),t.prototype.open.apply(this,e),this._onceCards=new Array,this._headCom.setAll(Player.inst.avatarUrl,Player.inst.frameUrl),this._nameText.text=Player.inst.name,[4,Net.rpcCall(pb.MessageID.C2S_FETCH_HEAD,null)];case 1:return i=o.sent(),0==i.errcode&&(this._onceCards=pb.HeadData.decode(i.payload).OnceCards),[4,Net.rpcCall(pb.MessageID.C2S_FETCH_HEAD_FRAME,null)];case 2:return r=o.sent(),0==r.errcode&&(n=pb.FetchHeadFrameReply.decode(r.payload),this._updateFrame(n)),Core.DeviceUtils.isWXGame()?(this.contentPane.getChild("headChk").visible=!1,this.contentPane.getChild("headFrameChk").visible=!1,this.contentPane.getController("switch").selectedIndex=1):(this.contentPane.getChild("headChk").visible=!0,this.contentPane.getChild("headFrameChk").visible=!0,this.contentPane.getController("switch").selectedIndex=0,this._updateHead()),[2]}})})},e.prototype._updateHead=function(){var t=this;this._headList.removeChildren();var e=[];[Camp.WEI,Camp.SHU,Camp.WU,Camp.HEROS].forEach(function(t){var i=CardPool.CardPoolMgr.inst.getCollectCardsByCamp(t,!1);e=e.concat(i)}),e.forEach(function(e){if(e.amount>0||e.level>1||-1!=t._onceCards.indexOf(e.cardId)){var i=e.hasSkins;i.forEach(function(i){var r=fairygui.UIPackage.createObject(PkgName.social,"headItemCom").asCom;r.setCard(e,i),t._headList.addChild(r),r.url==Player.inst.avatarUrl&&(t._curItem=r,t._curItem.setCheck(!0))})}})},e.prototype._updateFrame=function(t){var e=this;this._headFrameList.removeChildrenToPool();var i=t.HeadFrames;i.sort(),i.forEach(function(t){var i=e._headFrameList.addItemFromPool().asCom;t&&""!=t||(t="1"),i.setFrame(t),t==Player.inst.frameID&&(e._curFrame=i,e._curFrame.setCheck(!0))})},e.prototype._onItemClick=function(t){var e=t.itemObject;this._curItem!=e&&(this._curItem&&this._curItem.setCheck(!1),this._curItem=e,this._curItem&&(this._curItem.setCheck(!0),this._headCom.setHead(this._curItem.url)))},e.prototype._onFrameClick=function(t){var e=t.itemObject;this._curFrame!=e&&(this._curFrame&&this._curFrame.setCheck(!1),this._curFrame=e,this._curFrame&&(this._curFrame.setCheck(!0),this._headCom.setFrame(this._curFrame.url)))},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e}(Core.BaseWindow);t.AvatarWnd=r,__reflect(r.prototype,"Social.AvatarWnd")}(Social||(Social={}));var Social;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._headCom=this.getChild("head").asCom,this._nameText=this.getChild("name").asTextField,this._messageText=this.getChild("messageTxt").asTextField},i.prototype.setChatlet=function(e){this._headCom.setAll(e.headUrl,"headframe_"+e.frameUrl+"_png"),this._nameText.text=e.name,this._nameText.textParser=Core.StringUtils.parseColorText,this._messageText.text=e.msg,this._messageText.funcParser=Core.StringUtils.parseFuncText,0!=e.pvpLevel?(e.uid==Player.inst.uid&&e.pvpLevel<2?this.getChild("rankTitleText").asTextField.text=Pvp.Config.inst.getPvpTitle(Pvp.PvpMgr.inst.getPvpLevel()):this.getChild("rankTitleText").asTextField.text=Pvp.Config.inst.getPvpTitle(e.pvpLevel),this.getChild("rankTitleText").visible=!0):this.getChild("rankTitleText").visible=!1;var i=(this.getChild("contentGrp").height,e.msg.length,this._messageText.textWidth),r=(this._messageText.height,this._messageText.displayObject.numLines);if(350>=i&&1>=r?this.getChild("bottom").asLoader.width=i+20:this._messageText.align=fairygui.AlignType.Left,this._headCom.addClickListener(this._onDetail,this),window.gameGlobal.isMultiLan){var n=this.getChild("countryFlagImg").asImage;n.visible=!0,LanguageMgr.inst.setCountryFlagImg(n,t.UserLocalCache.inst.getUserCountry(e.uid))}this._headCom.addClickListener(this._onDetail,this),this._chatlet=e},i.prototype.showTimeText=function(e){this.getChild("time").visible=e;this.getChild("contentGrp").height;if(e){var i=this._chatlet.timeStamp;this.getChild("time").asTextField.text=t.ChatMgr.secToChatDate(i)}else this.height=this.height-30,this.getChild("time").asTextField.height=10},i.prototype._onDetail=function(){return __awaiter(this,void 0,void 0,function(){var e,e;return __generator(this,function(i){switch(i.label){case 0:return this._chatlet.isMyselfChat()?[4,t.FriendMgr.inst.fetchPlayerInfo(Player.inst.uid)]:[3,2];case 1:return e=i.sent(),e&&Core.ViewManager.inst.open(ViewName.selfInfo,Player.inst.uid,e),[3,4];case 2:return[4,t.FriendMgr.inst.fetchPlayerInfo(this._chatlet.uid)];case 3:e=i.sent(),e&&Core.ViewManager.inst.open(ViewName.friendInfo,this._chatlet.uid,e),i.label=4;case 4:return[2]}})})},i}(fairygui.GComponent);t.ChatletCom=e,__reflect(e.prototype,"Social.ChatletCom")}(Social||(Social={}));var Social;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._headCom=this.getChild("head").asCom,this._nameText=this.getChild("nameText").asTextField,this._nameText.textParser=Core.StringUtils.parseColorText,this._rankImg=this.getChild("rankImg").asLoader,this._rankTitleText=this.getChild("rankTitleText").asTextField,this._agreeBtn=this.getChild("agreeBtn").asButton,this._refuseBtn=this.getChild("refuseBtn").asButton,this._bg=this.getChild("bg").asLoader,this._agreeBtn.addClickListener(this._onAgree,this),this._refuseBtn.addClickListener(this._onRefuse,this),this._bg.addClickListener(this._onDetail,this),window.gameGlobal.isMultiLan&&(this._rankTitleText.fontSize=12)},i.prototype.setApplyInfo=function(t,e){this._info=t,this._host=e,t.HeadFrame||""!=t.HeadFrame||(t.HeadFrame="1"),this._headCom.setAll(t.HeadImgUrl,"headframe_"+t.HeadFrame+"_png"),this._nameText.text=t.Name;var i=t.PvpScore,r=Pvp.PvpMgr.inst.getPvpLevel(i);this._rankTitleText.text=Pvp.Config.inst.getPvpTitle(r);var n=Pvp.Config.inst.getPvpTeam(r);this._rankImg.url="common_rank"+n+"_png"},i.prototype._onAgree=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return[4,t.FriendMgr.inst.replyAddFriendApply(this._info.Uid,!0)];case 1:return r.sent()?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60137)),Core.EventCenter.inst.dispatchEventWith(GameEvent.AddFriend,!1,""),e=Core.StringUtils.TEXT(60197),[4,t.ChatMgr.inst.sendPrivateChat(this._info.Uid,this._info.Name,this._info.HeadImgUrl,e)]):[3,3];case 2:return i=r.sent(),[3,3];case 3:return this._host.delApplyItem(this),[2]}})})},i.prototype._onRefuse=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,t.FriendMgr.inst.replyAddFriendApply(this._info.Uid,!1)];case 1:return e.sent()&&Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60138)),this._host.delApplyItem(this),[2]}})})},i.prototype._onDetail=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,t.FriendMgr.inst.fetchPlayerInfo(this._info.Uid)];case 1:return e=i.sent(),e&&Core.ViewManager.inst.open(ViewName.friendInfo,this._info.Uid,e),[2]}})})},i}(fairygui.GComponent);__reflect(e.prototype,"ApplyItemCom");var i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.initUI=function(){i.prototype.initUI.call(this),this.center(),this.modal=!0,this._applyList=this.contentPane.getChild("applyList").asList,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._closeBtn.addClickListener(this._onClose,this)},r.prototype.open=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return __awaiter(this,void 0,void 0,function(){var n,o=this;return __generator(this,function(s){switch(s.label){case 0:return i.prototype.open.apply(this,r),[4,t.FriendMgr.inst.fetchAddFriendApplies()];case 1:return n=s.sent(),n&&n.FriendApplys&&n.FriendApplys.length>0?(this.contentPane.getChild("emptyHintText").visible=!1,n.FriendApplys.forEach(function(t){var i=fairygui.UIPackage.createObject(PkgName.social,"friendApplyItem",e).asCom;i.setApplyInfo(t,o),o._applyList.addChild(i)})):this.contentPane.getChild("emptyHintText").visible=!0,[2]}})})},r.prototype.delApplyItem=function(e){this._applyList.removeChild(e);var i=t.FriendMgr.inst.applyNum;t.FriendMgr.inst.applyNum=Math.max(0,i-1)},r.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return i.prototype.close.apply(this,t),this._applyList.removeChildren(),[2]})})},r.prototype._onClose=function(){Core.ViewManager.inst.closeView(this)},r}(Core.BaseWindow);t.FriendApplyWnd=i,__reflect(i.prototype,"Social.FriendApplyWnd")}(Social||(Social={}));var Social;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.center(),this.modal=!0,this._favoriteCardList=this.contentPane.getChild("commonlyCard").asList,this._fightCardList=this.contentPane.getChild("cardList").asList,this._addFriendBtn=this.contentPane.getChild("addBtn").asButton,this._delFriendBtn=this.contentPane.getChild("deleteBtn").asButton,this._fightBtn=this.contentPane.getChild("fightBtn").asButton,this._chatBtn=this.contentPane.getChild("chatBtn").asButton,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._relateCtrl=this.contentPane.getController("relationship"),this._warCtrl=this.contentPane.getController("war"),this._nameText=this.contentPane.getChild("name").asTextField,this._nameText.textParser=Core.StringUtils.parseColorText,this._countryNameText=this.contentPane.getChild("country").asTextField,this._countryNameText.textParser=Core.StringUtils.parseColorText,this._countryJobText=this.contentPane.getChild("countryJob").asTextField,this._countryJobText.funcParser=Core.StringUtils.parseFuncText,this._cityNameText=this.contentPane.getChild("city").asTextField,this._cityJobText=this.contentPane.getChild("cityJob").asTextField,this._cityJobText.funcParser=Core.StringUtils.parseFuncText,this._headCom=this.contentPane.getChild("head").asCom,this._addFriendBtn.addClickListener(this._onAddFriend,this),this._delFriendBtn.addClickListener(this._onDelFriend,this),this._fightBtn.addClickListener(this._onFight,this),this._chatBtn.addClickListener(this._onChat,this),this._closeBtn.addClickListener(this._onClose,this),this._favoriteCardList.addEventListener(fairygui.ItemEvent.CLICK,this._onClickCardList,this),this._fightCardList.addEventListener(fairygui.ItemEvent.CLICK,this._onClickCardList,this),LanguageMgr.inst.isChineseLocale()||(this.contentPane.getChild("totalCntTitle").asTextField.fontSize=14,this.contentPane.getChild("winCntTitle").asTextField.fontSize=14,this.contentPane.getChild("offensiveRateTitle").asTextField.fontSize=14,this.contentPane.getChild("defensiveRateTitle").asTextField.fontSize=14),Home.FunctionMgr.inst.isWorldWarOpen()?this._warCtrl.setSelectedIndex(0):this._warCtrl.setSelectedIndex(1)},i.prototype._onAddFriend=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this._playerInfo.IsFriend?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60147)),[2]):this._uid==Player.inst.uid?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60103)),[2]):[4,t.FriendMgr.inst.applyAddFriend(this._uid)];case 1:return e.sent()?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60136)),this._addFriendBtn.enabled=!1):Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60082)),[2]}})})},i.prototype._onDelFriend=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._playerInfo.IsFriend?(Core.TipsUtils.confirm(Core.StringUtils.TEXT(60113),function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,t.FriendMgr.inst.delFriend(this._uid)];case 1:return e.sent()?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60094)),Core.EventCenter.inst.dispatchEventWith(GameEvent.DelFriend,!1,this._uid),this._relateCtrl.setSelectedIndex(0),this._playerInfo.IsFriend=!1):Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60080)),[2]}})})},function(){},this,Core.StringUtils.TEXT(60047)),[2]):(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60126)),[2])})})},i.prototype._onFight=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,t.FriendMgr.inst.inviteBattle(this._uid)];case 1:return e.sent()?[4,Core.ViewManager.inst.open(ViewName.inviteWaiting)]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},i.prototype._onChat=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return this.visible=!1,Core.ViewManager.inst.open(ViewName.privateChatWnd,this._uid,function(){t.visible=!0}),[2]})})},i.prototype._onClose=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.closeView(this),[2]})})},i.prototype._onClickCardList=function(t){var e=t.itemObject;Core.ViewManager.inst.open(ViewName.cardInfoOther,e.cardObj)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a,u=this;return __generator(this,function(h){return this.battleChangeLayer(),e.prototype.open.apply(this,t),i=t[1],r=t[0],this._playerInfo=i,this._uid=r,this.displayObject.cacheAsBitmap=!1,(null==i.HeadImgUrl||""==i.HeadImgUrl)&&(i.HeadImgUrl="society_headicon1_png"),i.HeadFrame&&""!=i.HeadFrame||(i.HeadFrame="1"),this._headCom.setAll(i.HeadImgUrl,"headframe_"+i.HeadFrame+"_png"),this._nameText.text=i.Name,this.contentPane.getChild("id").asTextField.text="ID:"+r,this.contentPane.getChild("totalCnt").asTextField.text=""+i.BattleAmount,this.contentPane.getChild("winCnt").asTextField.text=""+i.BattleWinAmount,this.contentPane.getChild("offensiveRate").asTextField.text=i.FirstHandWinRate+"%",this.contentPane.getChild("defensiveRate").asTextField.text=i.BackHandWinRate+"%",this.contentPane.getChild("rankingValue").asTextField.text=Core.StringUtils.format(Core.StringUtils.TEXT(60061),i.RankScore),n=i.PvpScore,o=Pvp.PvpMgr.inst.getPvpLevel(n),this.contentPane.getChild("rankLevel").asTextField.text=Pvp.Config.inst.getPvpTitle(o),s=Pvp.Config.inst.getPvpTeam(o),this.contentPane.getChild("rankIcon").asLoader.url="common_rank"+s+"_png",this._updateWarInfo(i),i.FavoriteCards.forEach(function(t){var e=Data.pool.get(t.GCardID),i=new CardPool.Card(e),r=fairygui.UIPackage.createObject(PkgName.cards,"smallCard",UI.CardCom);r.cardObj=i,r.cardObj.equip=t.Equip,r.setDeskFront(),r.setDeskBackground(),r.setCardImg(),r.setEquip(),r.setNumText(),r.setNumOffsetText(),r.setName(),u._favoriteCardList.addChild(r)}),i.FightCards.forEach(function(t){var e=Data.pool.get(t.GCardID),i=new CardPool.Card(e),r=fairygui.UIPackage.createObject(PkgName.cards,"smallCard",UI.CardCom);r.cardObj=i,r.cardObj.equip=t.Equip,r.cardObj.skin=t.Skin,r.setDeskFront(),r.setDeskBackground(),r.setCardImg(),r.setEquip(),r.setNumText(),r.setNumOffsetText(),r.setName(),u._fightCardList.addChild(r)}),i.IsFriend?this._relateCtrl.setSelectedIndex(1):this._relateCtrl.setSelectedIndex(0),this._addFriendBtn.enabled=!0,i.CanInviteBattle&&!Core.ViewManager.inst.isShow(ViewName.battle)?this._fightBtn.enabled=!0:this._fightBtn.enabled=!1,this._addFriendBtn.enabled=this._uid!=Player.inst.uid,window.gameGlobal.isMultiLan&&(a=this.contentPane.getChild("countryFlagImg").asImage,a.visible=!0,LanguageMgr.inst.setCountryFlagImg(a,i.Country)),this.displayObject.cacheAsBitmap=!0,[2]})})},i.prototype._updateWarInfo=function(t){if(""!=t.CampaignCountry?this._countryNameText.text=t.CampaignCountry:this._countryNameText.text=Core.StringUtils.TEXT(70112),t.CountryJob&&t.CountryJob!=Job.UnknowJob?this._countryJobText.text=Utils.job2TextDesc(t.CountryJob,!0):this._countryJobText.text=Core.StringUtils.TEXT(70112),0!=t.CityID){var e=Data.city.get(t.CityID);this._cityNameText.text=e.name}else this._cityNameText.text=Core.StringUtils.TEXT(70112);t.CityJob&&t.CityJob!=Job.UnknowJob?this._cityJobText.text=Utils.job2TextDesc(t.CityJob,!0):this._cityJobText.text=Core.StringUtils.TEXT(70112)},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),this.displayObject.cacheAsBitmap=!1,this._favoriteCardList.removeChildren(0,-1,!0),this._fightCardList.removeChildren(0,-1,!0),[2]})})},i}(Core.BaseWindow);t.FriendInfoWnd=e,__reflect(e.prototype,"Social.FriendInfoWnd")}(Social||(Social={}));var Social;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.modal=!0,this.center(),this._friendList=this.contentPane.getChild("friendList").asList,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._closeBtn.addClickListener(this._onClose,this),this._optCallback=null,this._friendList.addEventListener(fairygui.ItemEvent.CLICK,this._onClickItem,this),this._friendList.itemClass=t.FriendItemCom,this._friendList.itemRenderer=this._renderFriendList,this._friendList.callbackThisObj=this,this._friendList.setVirtual(),this._friends=[]},i.prototype._onClickItem=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=t.itemObject,this._optCallback&&(this._optCallback(e.friend),this._optCallback=null),Core.ViewManager.inst.closeView(this),[2]})})},i.prototype._renderFriendList=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){return i=this._friends[t],r=e,r.setFriendInfo(i),[2]})})},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return[4,e.prototype.open.apply(this,i)];case 1:return n.sent(),this._optCallback=i[0],[4,t.FriendMgr.inst.fetchFriendList()];case 2:return r=n.sent(),this._friendList.numItems=0,r&&null!=r.friends&&(this._friends=r.friends,this._friendList.numItems=this._friends.length),[2]}})})},i.prototype._onClose=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._optCallback&&this._optCallback(),Core.ViewManager.inst.closeView(this),[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];
return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),this._optCallback=null,[2]})})},i}(Core.BaseWindow);t.FriendListOptionWnd=e,__reflect(e.prototype,"Social.FriendListOptionWnd")}(Social||(Social={}));var Social;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this._viewBtn=this.contentPane.getChild("viewBtn").asButton,this._fightBtn=this.contentPane.getChild("fightBtn").asButton,this._chatBtn=this.contentPane.getChild("chatBtn").asButton,this._viewBtn.addClickListener(this._onDetail,this),this._fightBtn.addClickListener(this._onFight,this),this._chatBtn.addClickListener(this._onChat,this),LanguageMgr.inst.isChineseLocale()||(this._viewBtn.getChild("title").asTextField.fontSize=12,this._fightBtn.getChild("title").asTextField.fontSize=12,this._chatBtn.getChild("title").asTextField.fontSize=12)},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return e.prototype.open.apply(this,i),this._friend=i[0],this._uid=this._friend.uid,this.x=i[1],this.y=i[2],[4,t.FriendMgr.inst.fetchPlayerInfo(this._uid)];case 1:return r=n.sent(),r&&r.CanInviteBattle?this.contentPane.getChild("fightBtn").enabled=!0:this.contentPane.getChild("fightBtn").enabled=!1,[2]}})})},i.prototype._onDetail=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,t.FriendMgr.inst.fetchPlayerInfo(this._uid)];case 1:return e=i.sent(),e&&(Core.ViewManager.inst.open(ViewName.friendInfo,this._uid,e),Core.ViewManager.inst.closeView(this)),[2]}})})},i.prototype._onFight=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,t.FriendMgr.inst.inviteBattle(this._uid)];case 1:return e.sent()?[4,Core.ViewManager.inst.open(ViewName.inviteWaiting,function(){t.FriendMgr.inst.cancelInviteBattle()})]:[3,3];case 2:e.sent(),Core.ViewManager.inst.closeView(this),e.label=3;case 3:return[2]}})})},i.prototype._onChat=function(){var t=this;this.visible=!1,Core.ViewManager.inst.open(ViewName.privateChatWnd,this._uid,function(){t.visible=!0},this._friend.name,this._friend.headImgUrl)},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i.prototype._onClose=function(t){var e=t.stageX/fairygui.GRoot.contentScaleFactor,i=t.stageY/fairygui.GRoot.contentScaleFactor;e>=this.x&&e<=this.x+this.width&&i>=this.y&&i<=this.y+this.height||Core.ViewManager.inst.closeView(this)},i}(Core.BaseWindow);t.FriendOptionWnd=e,__reflect(e.prototype,"Social.FriendOptionWnd");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._headCom=this.getChild("head").asCom,this._nameText=this.getChild("nameText").asTextField,this._nameText.textParser=Core.StringUtils.parseColorText,this._rankTitleText=this.getChild("rankTitleText").asTextField,this._rankImg=this.getChild("rankImg").asLoader,this._scoreText=this.getChild("scoreText").asTextField,this.getChild("wechatFlag")?this._wechatFlag=this.getChild("wechatFlag").asLoader:this._wechatFlag=null,this._onlineCtrl=this.getController("online")},e.prototype.setFriendInfo=function(t){this._headCom.setAll(t.headImgUrl,"headframe_"+t.frameUrl+"_png"),this._nameText.text=t.name;var e=t.score,i=Pvp.PvpMgr.inst.getPvpLevel(e);this._rankTitleText.text=Pvp.Config.inst.getPvpTitle(i);var r=Pvp.Config.inst.getPvpTeam(i);this._rankImg.url="common_rank"+r+"_png";var n=Pvp.PvpMgr.inst.getPvpStarCnt(e);this._scoreText.text=""+n,t.isOnline?this._onlineCtrl.setSelectedIndex(1):this._onlineCtrl.setSelectedIndex(0),this._wechatFlag&&(t.isWeChatFriend?this._wechatFlag.visible=!0:this._wechatFlag.visible=!1),this._friend=t},Object.defineProperty(e.prototype,"friend",{get:function(){return this._friend},enumerable:!0,configurable:!0}),e}(fairygui.GComponent);t.FriendItemBase=i,__reflect(i.prototype,"Social.FriendItemBase");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e)},e}(i);__reflect(r.prototype,"LastOppItemCom");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._offlineTimeText=this.getChild("offlineTime").asTextField},e.prototype.setFriendInfo=function(e){t.prototype.setFriendInfo.call(this,e);var i=e.lastOnlineTime;i&&i>0&&(console.debug(""+Date.now()/1e3,""+i),this._offlineTimeText.text=""+Core.StringUtils.secToString(Date.now()/1e3-i,"dhm"))},e}(i);t.FriendItemCom=n,__reflect(n.prototype,"Social.FriendItemCom");var o=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._friendList=this.getChild("friendList").asList,this._searchBtn=this.getChild("searchBtn").asButton,this._applyListBtn=this.getChild("applyBtn").asButton,this._inviteBtn=this.getChild("inviteBtn").asButton,this._wechatInviteBtn=this.getChild("wechatBtn").asButton,this._friendsIndex=0,this._friendsArray=new Array,this._friendList._scrollPane.addEventListener(fairygui.ScrollPane.PULL_UP_RELEASE,this._pullList,this),Core.DeviceUtils.isWXGame()?(this._inviteBtn.visible=!0,this._wechatInviteBtn.visible=!0):(this._inviteBtn.visible=!1,this._wechatInviteBtn.visible=!1),this._friendList.addEventListener(fairygui.ItemEvent.CLICK,this._onClickCardItem,this),this._applyListBtn.addClickListener(function(){Core.ViewManager.inst.open(ViewName.applyInfo)},this),this._searchBtn.addClickListener(function(){Core.ViewManager.inst.open(ViewName.friendSearch)},this),this._wechatInviteBtn.addClickListener(this._onWechatFight,this),this._inviteBtn.addClickListener(this._onWechatInvite,this),this._uid2FriendItem=new Collection.Dictionary,Core.EventCenter.inst.addEventListener(GameEvent.DeletedByFriend,this._onBeDeleted,this),Core.EventCenter.inst.addEventListener(GameEvent.DelFriend,this._onDelFriend,this),this.getChild("applyFriendNewHint").asCom.observerFriendApplyNum()},i.prototype.refresh=function(){return __awaiter(this,void 0,void 0,function(){var e,i,n;return __generator(this,function(o){switch(o.label){case 0:return[4,t.FriendMgr.inst.fetchFriendList()];case 1:return e=o.sent(),this._friendList.removeChildren(0,-1,!0),this._uid2FriendItem.clear(),e&&(i=e.lastOpp,i&&(n=fairygui.UIPackage.createObject(PkgName.social,"lastOpponent",r).asCom,n.setFriendInfo(i),this._friendList.addChild(n))),null!=e.friends&&(this._friendsIndex=0,this._friendsArray=e.friends,this._pullList(),e.friends.length>0?this.getChild("emptyHintText").visible=!1:this.getChild("emptyHintText").visible=!0),[2]}})})},i.prototype._addFriends=function(t){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(i){return t.forEach(function(t){var i=fairygui.UIPackage.createObject(PkgName.social,"friendItem",n).asCom;i.setFriendInfo(t),i.displayObject.cacheAsBitmap=!0,e._friendList.addChild(i),e._uid2FriendItem.setValue(t.uid,i)}),[2]})})},i.prototype._pullList=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){return t=30,this._friendsArray.length<=this._friendsIndex?[2]:(this._friendsArray.length<=this._friendsIndex+t&&(t=this._friendsArray.length-this._friendsIndex),e=this._friendsArray.slice(this._friendsIndex,this._friendsIndex+t),this._friendsIndex+=t,this._addFriends(e),[2])})})},i.prototype.onChosen=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,!0]})})},i.prototype._onClickCardItem=function(e){return __awaiter(this,void 0,void 0,function(){var i,n,o,s,a;return __generator(this,function(u){switch(u.label){case 0:return i=e.itemObject,n=i.friend,i instanceof r?[4,t.FriendMgr.inst.fetchPlayerInfo(n.uid)]:[3,2];case 1:return o=u.sent(),o&&Core.ViewManager.inst.open(ViewName.friendInfo,n.uid,o),[3,4];case 2:return s=260,a=e.stageY/fairygui.GRoot.contentScaleFactor-30,[4,Core.ViewManager.inst.openPopup(ViewName.friendOption,n,s,a)];case 3:u.sent(),u.label=4;case 4:return[2]}})})},i.prototype._onBeDeleted=function(t){var e=t.data;if(this._uid2FriendItem.containsKey(e)){var i=this._uid2FriendItem.getValue(e);this._friendList.removeChild(i),this._uid2FriendItem.remove(e)}},i.prototype._onDelFriend=function(t){var e=t.data,i=this._uid2FriendItem.getValue(e);this._friendList.removeChild(i),this._uid2FriendItem.remove(e)},i.prototype._onWechatFight=function(){WXGame.WXShareMgr.inst.wechatFight()},i.prototype._onWechatInvite=function(){WXGame.WXShareMgr.inst.wechatInvite()},i}(fairygui.GComponent);t.FriendListWndCom=o,__reflect(o.prototype,"Social.FriendListWndCom",["Social.ISocialCom"])}(Social||(Social={}));var Social;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var t=this;e.prototype.initUI.call(this),this.center(),this.modal=!0,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._confirmBtn=this.contentPane.getChild("confirmBtn").asButton,this._searchInput=this.contentPane.getChild("searchInput").asTextInput,this._warningText=this.contentPane.getChild("warning").asTextField,this._closeBtn.addClickListener(function(){Core.ViewManager.inst.closeView(t)},this),this._confirmBtn.addClickListener(this._onSearch,this),this._searchInput.addEventListener(egret.Event.FOCUS_IN,function(){t._warningText.text=""},this)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.open.apply(this,t),this._warningText.text="",[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),this._searchInput.text="",[2]})})},i.prototype._onSearch=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return e=Core.StringUtils.stringToLong(this._searchInput.text),e?e==Player.inst.uid?(this._warningText.text=Core.StringUtils.TEXT(60103),[2]):[4,t.FriendMgr.inst.fetchPlayerInfo(e)]:(this._warningText.text=Core.StringUtils.TEXT(60157),[2]);case 1:return i=r.sent(),i?(this._warningText.text="",Core.ViewManager.inst.open(ViewName.friendInfo,e,i)):this._warningText.text=Core.StringUtils.TEXT(60135),[2]}})})},i}(Core.BaseWindow);t.FriendSearchWnd=e,__reflect(e.prototype,"Social.FriendSearchWnd")}(Social||(Social={}));var Social;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._bg=this.getChild("n0").asLoader,this._icon=this.getChild("headIcon").asImage,this._frame=this.getChild("headFrame").asLoader},e.prototype.setAll=function(t,e){this.setHead(t),this.setFrame(e)},e.prototype.setHead=function(t){""==t.trim()?this._icon.visible=!1:(this._icon.visible=!0,Utils.setImageUrlPicture(this._icon,t))},e.prototype.setFrame=function(t){this.visible=!0;var e=parseInt(t);isNaN(e)||(t="headframe_"+e+"_png"),this._frame.url=t},e}(fairygui.GComponent);t.HeadCom=e,__reflect(e.prototype,"Social.HeadCom")}(Social||(Social={}));var Social;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this.getChild("yesBtn").asButton.addClickListener(this._onYes,this),this.getChild("noBtn").asButton.addClickListener(this._onNo,this),this._tran0=this.getTransition("t0")},e.prototype.setInfo=function(t,e){this._uid=t,this._fromName=e,this.getChild("txt").asTextField.textParser=Core.StringUtils.parseColorText,this.getChild("txt").asTextField.text=""+e+Core.StringUtils.TEXT(60111),this._tran0.play()},e.prototype._onYes=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this._replyInvite(!0)];case 1:return t.sent(),[2]}})})},e.prototype._onNo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this._replyInvite(!1)];case 1:return t.sent(),[2]}})})},e.prototype._replyInvite=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return e={Uid:this._uid,IsAgree:t},[4,Net.rpcCall(pb.MessageID.C2S_REPLY_INVITE_BATTLE,pb.ReplyInviteBattleArg.encode(e))];case 1:return i=r.sent(),0==i.errcode?t?Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60149)):Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60054)):Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60124)),this.visible=!1,[2]}})})},e}(fairygui.GComponent);t.InviteBattleHintCom=e,__reflect(e.prototype,"Social.InviteBattleHintCom")}(Social||(Social={}));var Social;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.center(),this.modal=!0,this._memberList=this.getChild("memberList").asList,this._rewardList=this.getChild("rewardList").asList,this._memberList.scrollPane.addEventListener(fairygui.ScrollPane.PULL_UP_RELEASE,this._memberUpdate,this),this._memberList.itemRenderer=this._memberItemUpdate,this.getChild("closeBtn").asButton.addClickListener(function(){Core.ViewManager.inst.closeView(e)},this),this.getChild("inviteBtn").asButton.addClickListener(function(){WXGame.WXShareMgr.inst.wechatInvite()},this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r=this;return __generator(this,function(o){return t.prototype.open.apply(this,e),this._memberNum=0,this._memberList.numItems=0,this._rewardDataList=new Collection.Dictionary,n.init.memberDataInit(),this._memberList.removeChildrenToPool(),this._rewardList.removeChildrenToPool(),i=e[0],i.Friends.forEach(function(t){n.init.addMember(t)}),n.init.memberSort(),i.Rewards.forEach(function(t){r._rewardDataList.setValue(t.ID,t)}),this._memberNum=20,this._memberList.numItems=20,this._updateRewards(),[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e.prototype._memberItemUpdate=function(t,e){var i=n.init.num,r=e;i>t?r.setMember(n.init.getMember(t)):r.setMember()},e.prototype._memberUpdate=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t=n.init.num,this._memberNum>=t?[2]:(t-this._memberNum>20?this._memberNum+=20:this._memberNum=t,this._memberList.numItems=this._memberNum,[2])})})},e.prototype._updateRewards=function(){var t=this,e=Data.invite_reward.keys;e.forEach(function(e){var i=t._rewardList.addItemFromPool();t._rewardDataList.containsKey(e)?i.setReward(e,t._rewardDataList.getValue(e)):i.setReward(e)})},e}(Core.BaseWindow);t.InviteRewardWnd=e,__reflect(e.prototype,"Social.InviteRewardWnd");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e)},e.prototype.setMember=function(t){t?(this.getChild("n13").text=Pvp.Config.inst.getPvpTitle(t.PvpLevel),this.getChild("headIcon").visible=!0,Utils.setImageUrlPicture(this.getChild("headIcon").asImage,t.HeadImgUrl)):(this.getChild("n13").text="",this.getChild("headIcon").visible=!1)},e}(fairygui.GComponent);t.InviteMemberItem=i,__reflect(i.prototype,"Social.InviteMemberItem");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e)},e.prototype.setReward=function(t,e){this._rewardID=t;var i=Data.invite_reward.get(t),r=1;2>=r&&i.goldReward>0&&(this.getChild("rewardIcon"+r).asLoader.url="common_goldIcon_png",this.getChild("cnt"+r).text="x"+i.goldReward,r+=1),2>=r&&i.jadeReward>0&&(this.getChild("rewardIcon"+r).asLoader.url="common_jadeIcon_png",this.getChild("cnt"+r).text="x"+i.jadeReward,r+=1),this.getChild("conditionTxt").text=Core.StringUtils.format(Core.StringUtils.TEXT(60048),Pvp.Config.inst.getPvpTitle(i.pvpLevel));var o=0,s=0;e&&(o=e.CurCnt,s=e.RewardCnt),s<i.cnt?(this.getChild("processTxt").text="("+o+"/"+i.cnt+")",s>=o?this.getController("c1").selectedIndex=0:(this.getController("c1").selectedIndex=1,n.init.rewardNum+=1,this.getChild("btnReceive").asButton.title=Core.StringUtils.format(Core.StringUtils.TEXT(70116),o-s),this.getChild("btnReceive").asButton.addClickListener(this._onReward,this))):(this.getChild("processTxt").text="("+o+"/"+i.cnt+")",this.getController("c1").selectedIndex=2)},e.prototype._onReward=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,o,s;return __generator(this,function(a){switch(a.label){case 0:return t={ID:this._rewardID},[4,Net.rpcCall(pb.MessageID.C2S_GET_WX_INVITE_REWARD,pb.GetWxInviteRewardArg.encode(t))];case 1:if(e=a.sent(),0==e.errcode){if(i=pb.GetWxInviteRewardReply.decode(e.payload),r=new Pvp.GetRewardData,r.gold=i.Gold,r.jade=i.Jade,i.Cards&&(o=Data.invite_reward.get(this._rewardID).cardReward,o.length>0))for(s=0;s<o.length;s++)r.addCards(o[s],i.Cards[s]);Core.ViewManager.inst.open(ViewName.getRewardWnd,r),this.getController("c1").selectedIndex=2,n.init.rewardNum-=1,n.init.rewardNum<=0&&Core.EventCenter.inst.dispatchEventWith(n.UpdateInviteHit,!1,!1)}return[2]}})})},e}(fairygui.GComponent);t.InviteRewardItem=r,__reflect(r.prototype,"Social.InviteRewardItem");var n=function(){function t(){}return Object.defineProperty(t,"init",{get:function(){return t._init||(t._init=new t),t._init},enumerable:!0,configurable:!0}),t.prototype.memberDataInit=function(){this._memberDataList=new Array,this._rewardNum=0},t.prototype.addMember=function(t){this._memberDataList.push(t)},t.prototype.memberSort=function(){this._memberDataList.sort(function(t,e){return t.PvpLevel>e.PvpLevel?-1:t.PvpLevel<e.PvpLevel?1:0})},Object.defineProperty(t.prototype,"num",{get:function(){return this._memberDataList.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rewardNum",{get:function(){return this._rewardNum},set:function(t){this._rewardNum=t},enumerable:!0,configurable:!0}),t.prototype.getMember=function(t){return t>=0&&this._memberDataList.length>t?this._memberDataList[t]:void 0},t.UpdateInviteHit="UpdateInviteHit",t}();t.InviteDataMgr=n,__reflect(n.prototype,"Social.InviteDataMgr")}(Social||(Social={}));var Social;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){this._myParent=Core.LayerManager.inst.maskLayer,t.prototype.initUI.call(this),this.adjust(this.getChild("background")),this.center(),this._cancelMatchBtn=this.getChild("cancelMatchBtn").asButton,this._cancelMatchBtn.addClickListener(this._onCancel,this),this.getChild("time").asTextField.text=""},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(r){switch(r.label){case 0:return SoundMgr.inst.playBgMusic("matching_mp3"),t.prototype.open.apply(this,e),this._cancelMatchBtn.visible=!0,[4,fairygui.GTimers.inst.waitTime(1)];case 1:return r.sent(),this.getTransition("shake").play(null,null,null,-1),this._countdown=60,this._countdownHdr=function(){i._countdown--,i.getChild("time").asTextField.text=Core.StringUtils.secToString(i._countdown,"hm")},fairygui.GTimers.inst.add(1e3,this._countdown,this._countdownHdr,this),this._onCancelCallback=e[0],[2]}})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(r){switch(r.label){case 0:return this._countdownHdr&&(fairygui.GTimers.inst.remove(this._countdownHdr,this),this._countdownHdr=null,this.getChild("time").asTextField.text=""),[4,new Promise(function(t){egret.Tween.get(i).to({scaleX:0,scaleY:0},300,egret.Ease.backIn).call(function(){t()},i)})];case 1:return r.sent(),[4,t.prototype.close.apply(this,e)];case 2:return r.sent(),this.getTransition("shake").stop(),[2]}})})},e.prototype._onCancel=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._onCancelCallback&&this._onCancelCallback(),SoundMgr.inst.playBgMusic("bg_mp3"),[4,Core.ViewManager.inst.closeView(this)];case 1:return t.sent(),[2]}})})},e.prototype.readyFight=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._cancelMatchBtn.visible=!1,this._countdownHdr&&(fairygui.GTimers.inst.remove(this._countdownHdr,this),this._countdownHdr=null,this.getChild("time").asTextField.text=""),[4,fairygui.GTimers.inst.waitTime(2e3)];case 1:return t.sent(),this.getTransition("shake").stop(),this.getTransition("open").play(this._openAnimationDone,this),[4,fairygui.GTimers.inst.waitTime(1e3)];case 2:return t.sent(),[2]}})})},e.prototype._openAnimationDone=function(){Core.ViewManager.inst.closeView(this)},e.prototype.cancelFight=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return SoundMgr.inst.playBgMusic("bg_mp3"),[4,Core.ViewManager.inst.closeView(this)];case 1:return t.sent(),[2]}})})},e}(Core.BaseView);t.InviteWaitingWnd=e,__reflect(e.prototype,"Social.InviteWaitingWnd")}(Social||(Social={}));var Social;!function(t){var e;!function(t){t[t.vip=1]="vip",t[t.priv=2]="priv",t[t.miniVip=99]="miniVip"}(e=t.PrivType||(t.PrivType={}));var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.constructFromXML=function(t){this._privIcon=this.getChild("icon").asLoader,this._privName=this.getChild("name").asTextField;var e=this.getChild("desc");e&&(this._privDesc=e.asTextField);var i=this.getChild("time");i&&(this._privTime=i.asTextField)},i.prototype.setPriv=function(t,i){return __awaiter(this,void 0,void 0,function(){var r,n,o;return __generator(this,function(s){switch(s.label){case 0:return t!=e.vip&&t!=e.miniVip?[3,3]:(r=Payment.PayMgr.inst.getProducts(),t==e.vip?this._privData=r.getValue("advip"):this._privData=r.getValue("minivip"),this._privName.text=this._privData.name,this._privIcon.url="shop_"+this._privData.icon+"_png",this._privDesc&&(this._privDesc.text=this._privData.desc),this._privTime?(n="",[4,Player.inst.getVipTime()]):[3,2]);case 1:o=s.sent(),o>0&&(n=Core.StringUtils.secToString(o,"dhm")),this._privTime.text=n,s.label=2;case 2:return[3,4];case 3:t==e.priv&&(this._privData=Data.priv_config.get(i),this._privIcon.url="reborn_"+this._privData.icon+"_png",this._privName.text=this._privData.name,this._privDesc&&(this._privDesc.text=this._privData.desc)),s.label=4;case 4:return[2]}})})},i}(fairygui.GComponent);t.PrivCom=i,__reflect(i.prototype,"Social.PrivCom");var r=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.center(),this.modal=!0,this._privList=this.contentPane.getChild("headList").asList,this._closeBtn=this.contentPane.getChild("confirmBtn").asButton,this._privList.addEventListener(fairygui.ItemEvent.CLICK,this._onPriv,this),this._closeBtn.addClickListener(function(){Core.ViewManager.inst.closeView(e)},this)},i.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.open.apply(this,e),this._refresh(),[2]})})},i.prototype._refresh=function(){var t=this;this._privList.removeChildrenToPool();var i=this._privList.addItemFromPool();i.setPriv(e.vip),i.grayed=!Player.inst.isVip;var r=Data.priv_config.keys;r.forEach(function(i){var r=t._privList.addItemFromPool();r.setPriv(e.priv,i),r.grayed=!Player.inst.hasPrivilege(i)})},i.prototype._onPriv=function(t){var e=this._privList.getChildIndex(t.itemObject);Core.ViewManager.inst.open(ViewName.privView,e)},i.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},i}(Core.BaseWindow);t.PrivPanelWnd=r,__reflect(r.prototype,"Social.PrivPanelWnd");var n=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.center(),this.modal=!0,this._privList=this.contentPane.getChild("list").asList,this.adjust(this.contentPane.getChild("closeBg")),this.contentPane.getChild("closeBg").addClickListener(function(){Core.ViewManager.inst.closeView(e)},this)},i.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){return t.prototype.open.apply(this,e),i=e[0],this._refresh(),this._privList.numItems>i&&this._privList.scrollToView(i),[2]})})},i.prototype._refresh=function(){var t=this;this._privList.removeChildrenToPool();var i=this._privList.addItemFromPool();i.setPriv(e.vip),i.getChild("icon").grayed=!Player.inst.isVip,i.getChild("light").visible=Player.inst.isVip;var r=Data.priv_config.keys;r.forEach(function(i){var r=t._privList.addItemFromPool();r.setPriv(e.priv,i),r.getChild("icon").grayed=!Player.inst.hasPrivilege(i),r.getChild("light").visible=Player.inst.hasPrivilege(i)})},i.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},i}(Core.BaseWindow);t.PrivViewWnd=n,__reflect(n.prototype,"Social.PrivViewWnd")}(Social||(Social={}));var Social;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var t=this;e.prototype.initUI.call(this),this.center(),this.modal=!0,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._chatletList=this.contentPane.getChild("chatletList").asList,this._inputText=this.contentPane.getChild("inputText").asTextInput,this._sendBtn=this.contentPane.getChild("sendBtn").asButton,this._nameText=this.contentPane.getChild("name").asTextField,this._nameText.textParser=Core.StringUtils.parseColorText,this._emojiBtn=this.contentPane.getChild("emojiBtn").asButton,this._chatletList.scrollPane.addEventListener(fairygui.ScrollPane.PULL_DOWN_RELEASE,this._renderList,this),this._closeBtn.addClickListener(function(){Core.ViewManager.inst.closeView(t)},this),this._sendBtn.addClickListener(this._onSend,this),this._emojiBtn.addClickListener(this._onEmoji,this),this._emojiBtn.visible=Home.FunctionMgr.inst.isEmojiToChatOpen()},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,n,o;return __generator(this,function(s){switch(s.label){case 0:return e.prototype.open.apply(this,i),r=i[0],this._closeCallback=i[1],this._toName=i[2],this._toHeadUrl=i[3],this._toName&&this._toHeadUrl?[3,2]:[4,t.FriendMgr.inst.fetchPlayerInfo(r)];case 1:n=s.sent(),n&&(this._toName=n.Name),s.label=2;case 2:return this._nameText.text=this._toName,[4,t.ChatMgr.inst.getPrivateChatlets(r)];case 3:return o=s.sent(),t.ChatMgr.inst.cleanPrivateHintsNum(r),this._lastTime=0,this._lastItem=null,this._arrayChat=new Array,this._loadIndex=0,o&&(o.sort(function(t,e){return t.timeStamp-e.timeStamp}),this._arrayChat=o,this._loadIndex=this._arrayChat.length,this._loadChatlets()),this._uid=r,t.ChatMgr.inst.currentChatUid=r,Core.EventCenter.inst.addEventListener(GameEvent.PrivateChat,this._onPrivateChat,this),[2]}})})},i.prototype._addChatlets=function(t,e){var i=this;if(e){for(var r=t.length-1,n=t.length-1;n>=0;n--){var o=this._addChatlet(t[n]);o.showTimeText(!0),this._chatletList.addChildAt(o,0)}this._chatletList.scrollToView(r,!1)}else t.forEach(function(t){var e=i._addChatlet(t);i._chatletList.addChild(e),t.timeStamp-i._lastTime>60?e.showTimeText(!0):e.showTimeText(!1),i._lastTime=t.timeStamp});this._chatletList.cacheContent(!1)},i.prototype._addChatlet=function(e){var i=null;return i=e.isMyselfChat()?fairygui.UIPackage.createObject(PkgName.social,"messageItemSelf",t.ChatletCom).asCom:fairygui.UIPackage.createObject(PkgName.social,"messageItem",t.ChatletCom).asCom,i.setChatlet(e),i},i.prototype.addChatlets=function(t,e){void 0===e&&(e=!0),this._addChatlets(t),this._chatletList.isBottomMost()&&this._chatletList.scrollToView(this._chatletList.numItems-1,e)},i.prototype._loadChatlets=function(){var t=new Array;this._loadIndex>10?(t=this._arrayChat.slice(this._loadIndex-10,this._loadIndex),this._loadIndex-=10):(t=this._arrayChat.slice(0,this._loadIndex),this._loadIndex=0),this._chatletList.cacheContent(!0),this._addChatlets(t,!0)},i.prototype._renderList=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._loadIndex<=0?[2]:(this._loadChatlets(),[2])})})},i.prototype._onSend=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return e=this._inputText.text,e&&""!=e?""==e.trim()?[2]:[4,t.FriendMgr.inst.fetchPlayerInfo(this._uid)]:[2];case 1:return i=n.sent(),i&&i.IsFriend?[4,t.ChatMgr.inst.sendPrivateChat(this._uid,this._toName,this._toHeadUrl,e.trim())]:(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60205)),[2]);case 2:return r=n.sent(),r&&(this.addChatlets(r),this._inputText.text=""),[2]}})})},i.prototype._onEmoji=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(i){return Core.ViewManager.inst.openPopup(ViewName.emojiChoiceWnd,function(i){return __awaiter(e,void 0,void 0,function(){var e,r,n;return __generator(this,function(o){switch(o.label){case 0:return e="#fimg,ui://common/emoji"+i+"(98,98)#e",[4,t.FriendMgr.inst.fetchPlayerInfo(this._uid)];case 1:return r=o.sent(),r&&r.IsFriend?[4,t.ChatMgr.inst.sendPrivateChat(this._uid,this._toName,this._toHeadUrl,e)]:(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60205)),[2]);case 2:return n=o.sent(),n&&(this.addChatlets(n),this._inputText.text=""),[2]}})})}),[2]})})},i.prototype._onPrivateChat=function(t){var e=t.data;e.length>0&&e[0].uid==this._uid&&this.addChatlets(e)},i.prototype.close=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return e.prototype.close.apply(this,i),this._closeCallback&&(this._closeCallback(),this._closeCallback=null),this._chatletList.removeChildren(),t.ChatMgr.inst.currentChatUid=null,Core.EventCenter.inst.removeEventListener(GameEvent.PrivateChat,this._onPrivateChat,this),[2]})})},i}(Core.BaseWindow);t.PrivateChatWnd=e,__reflect(e.prototype,"Social.PrivateChatWnd")
}(Social||(Social={}));var Social;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._newHintCom=this.getChild("newHint").asCom,this._headCom=this.getChild("head").asCom,this._nameText=this.getChild("name").asTextField,this._nameText.textParser=Core.StringUtils.parseColorText,this.addClickListener(this._onClick,this)},i.prototype.setUid=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return this._uid=e,this._chatlet=t,[4,this.refresh()];case 1:return[2,i.sent()]}})})},i.prototype.refresh=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){return e=this._chatlet,e?(this._headCom.setAll(e.fromHeadUrl,"headframe_"+e.frameUrl+"_png"),this._nameText.text=e.fromName,i=e.msg,i.indexOf("#fimg")>=0&&(i=Core.StringUtils.TEXT(70188)),this.getChild("lastMessageTxt").asTextField.text=i,this.getChild("lastMessageTxt").asTextField.funcParser=Core.StringUtils.parseFuncText,this.getChild("lastMessageTxt").asTextField.touchable=!1,this.getChild("lastMessageTime").asTextField.text=t.ChatMgr.secToChatDate(e.timeStamp),this._newHintCom.observePrivateChatNum(this._uid),this._time=e.timeStamp,this._lastChatlet=e,[2,!0]):[2,!1]})})},Object.defineProperty(i.prototype,"time",{get:function(){return this._time},enumerable:!0,configurable:!0}),i.prototype._onClick=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(i){return this._uid&&Core.ViewManager.inst.open(ViewName.privateChatWnd,this._uid,function(){return __awaiter(e,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return e=this,[4,t.ChatMgr.inst.getLatestPrivateChatlet(this._uid)];case 1:return e._chatlet=i.sent(),[4,this.refresh()];case 2:return i.sent(),[2]}})})},this._lastChatlet.fromName,this._lastChatlet.fromHeadUrl),[2]})})},i}(fairygui.GComponent);t.PrivateChatItemCom=e,__reflect(e.prototype,"Social.PrivateChatItemCom");var i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.constructFromXML=function(t){i.prototype.constructFromXML.call(this,t),this._entryList=this.getChild("chatEntryList").asList,this._uidToItem=new Collection.Dictionary,this._entryList._scrollPane.addEventListener(fairygui.ScrollPane.PULL_UP_RELEASE,this._pullChatList,this)},r.prototype.refresh=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o,s,a=this;return __generator(this,function(u){switch(u.label){case 0:return this._chatlets=new Collection.Dictionary,this._uidlist=new Array,[4,t.FriendMgr.inst.fetchFriendList()];case 1:return u.sent(),this._entryList.numItems>0&&this._entryList.scrollToView(0),this._entryList.removeChildren(),[4,t.ChatMgr.inst.getPrivateUidKeys()];case 2:e=u.sent(),i=[],r=0,u.label=3;case 3:return r<e.length?(n=e[r],o=Core.StringUtils.stringToLong(n),[4,t.ChatMgr.inst.getLatestPrivateChatlet(o)]):[3,6];case 4:s=u.sent(),s&&(this._chatlets.setValue(o,s),this._uidlist.push(o)),u.label=5;case 5:return++r,[3,3];case 6:return this._uidlist.sort(function(t,e){return a._chatlets.getValue(t).timeStamp<a._chatlets.getValue(e).timeStamp?1:-1}),this._uidlist.length>0?(this.getChild("emptyHintText").visible=!1,this._pullChatList()):this.getChild("emptyHintText").visible=!0,[2]}})})},r.prototype._pullChatList=function(){return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s;return __generator(this,function(a){for(i=0,i=this._uidlist.length>10?10:this._uidlist.length,r=t.FriendMgr.inst.friends,n=function(t){var i=o._uidlist.splice(0,1)[0],n=o._chatlets.getValue(i);r&&r.forEach(function(t){t.uid==i&&(n.fromHeadUrl=t.headImgUrl,n.fromName=t.name,n.frameUrl=t.frameUrl)});var s=fairygui.UIPackage.createObject(PkgName.social,"privateChatItem",e).asCom;s.setUid(n,i),o._uidToItem.setValue(""+i,s),o._entryList.addChild(s)},o=this,s=0;i>s;s++)n(s);return[2]})})},r.prototype.onChosen=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t?Core.EventCenter.inst.addEventListener(GameEvent.PrivateChat,this._onPrivateChat,this):Core.EventCenter.inst.removeEventListener(GameEvent.PrivateChat,this._onPrivateChat,this),[2,!0]})})},r.prototype._onPrivateChat=function(t){return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s;return __generator(this,function(a){switch(a.label){case 0:return i=t.data,i.length>0?(r=""+i[0].uid,(n=this._uidToItem.getValue(r))?(this._entryList.removeChild(n),this._entryList.addChildAt(n,0),[4,n.refresh()]):[3,2]):[3,3];case 1:return a.sent(),[3,3];case 2:for(o=0;o<this._uidlist.length;o++)if(this._uidlist[o]==i[0].uid){this._uidlist.splice(o,1);break}s=fairygui.UIPackage.createObject(PkgName.social,"privateChatItem",e).asCom,s.setUid(i[0],i[0].uid),this._uidToItem.setValue(""+i[0].uid,s),this._entryList.addChild(s),a.label=3;case 3:return[2]}})})},r}(fairygui.GComponent);t.PrivateChatWndCom=i,__reflect(i.prototype,"Social.PrivateChatWndCom",["Social.ISocialCom"])}(Social||(Social={}));var Social;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.center(),this.modal=!0,this._favoriteCardList=this.contentPane.getChild("commonlyCard").asList,this._fightCardList=this.contentPane.getChild("cardList").asList,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._privBtn=this.contentPane.getChild("privBtn").asButton,this._changeHeadBtn=this.contentPane.getChild("changeHeadBtn").asButton,this._modifyNameBtn=this.contentPane.getChild("modifyNameBtn").asButton,this._headCom=this.contentPane.getChild("head").asCom,this._nameText=this.contentPane.getChild("name").asTextField,this._nameText.textParser=Core.StringUtils.parseColorText,this._warCtrl=this.contentPane.getController("war"),this._countryNameText=this.contentPane.getChild("country").asTextField,this._countryNameText.textParser=Core.StringUtils.parseColorText,this._countryJobText=this.contentPane.getChild("countryJob").asTextField,this._countryJobText.funcParser=Core.StringUtils.parseFuncText,this._cityNameText=this.contentPane.getChild("city").asTextField,this._cityJobText=this.contentPane.getChild("cityJob").asTextField,this._cityJobText.funcParser=Core.StringUtils.parseFuncText,Core.DeviceUtils.isWXGame()?this.contentPane.getChild("avatarNumHint").asCom.visible=!1:(this.contentPane.getChild("avatarNumHint").asCom.visible=!0,this.contentPane.getChild("avatarNumHint").asCom.observerAvatarNum()),this._changeHeadBtn.visible=!0,this._modifyNameBtn.visible=!0,this._modifyNameBtn.addClickListener(function(){Core.ViewManager.inst.open(ViewName.modifyName)},this),this._changeHeadBtn.addClickListener(function(){Core.ViewManager.inst.open(ViewName.avatarChangeWnd)},this),this._privBtn.addClickListener(function(){Core.ViewManager.inst.open(ViewName.privPanelWnd)},this),this._closeBtn.addClickListener(this._onClose,this),this._favoriteCardList.addEventListener(fairygui.ItemEvent.CLICK,this._onClickCardList,this),this._fightCardList.addEventListener(fairygui.ItemEvent.CLICK,this._onClickCardList,this),Core.EventCenter.inst.addEventListener(GameEvent.ModifyAvatarEv,function(){e._headCom.setHead(Player.inst.avatarUrl)},this),Core.EventCenter.inst.addEventListener(GameEvent.ModifyFrameEv,function(){e._headCom.setFrame(Player.inst.frameUrl)},this),Core.EventCenter.inst.addEventListener(GameEvent.ModifyNameEv,function(t){Core.ViewManager.inst.isShow(ViewName.selfInfo)&&(e.contentPane.getChild("name").text=t.data)},this),this._privBtn.visible=Home.FunctionMgr.inst.isFeatOpen(),LanguageMgr.inst.isChineseLocale()||(this.contentPane.getChild("totalCntTitle").asTextField.fontSize=14,this.contentPane.getChild("winCntTitle").asTextField.fontSize=14,this.contentPane.getChild("offensiveRateTitle").asTextField.fontSize=14,this.contentPane.getChild("defensiveRateTitle").asTextField.fontSize=14),Home.FunctionMgr.inst.isWorldWarOpen()?this._warCtrl.setSelectedIndex(0):this._warCtrl.setSelectedIndex(1)},e.prototype._onClose=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.closeView(this),[2]})})},e.prototype._onClickCardList=function(t){var e=t.itemObject;Core.ViewManager.inst.open(ViewName.cardInfoOther,e.cardObj)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a,u=this;return __generator(this,function(h){return this.battleChangeLayer(),t.prototype.open.apply(this,e),i=e[1],r=e[0],this._playerInfo=i,this._uid=r,this.displayObject.cacheAsBitmap=!1,this._headCom.setAll(i.HeadImgUrl,Player.inst.frameUrl),this._nameText.text=i.Name,this.contentPane.getChild("id").asTextField.text="ID:"+r,this.contentPane.getChild("totalCnt").asTextField.text=""+i.BattleAmount,this.contentPane.getChild("winCnt").asTextField.text=""+i.BattleWinAmount,this.contentPane.getChild("offensiveRate").asTextField.text=i.FirstHandWinRate+"%",this.contentPane.getChild("defensiveRate").asTextField.text=i.BackHandWinRate+"%",this.contentPane.getChild("rankingValue").asTextField.text=Core.StringUtils.format(Core.StringUtils.TEXT(60061),i.RankScore),n=i.PvpScore,o=Pvp.PvpMgr.inst.getPvpLevel(n),this.contentPane.getChild("rankLevel").asTextField.text=Pvp.Config.inst.getPvpTitle(o),s=Pvp.Config.inst.getPvpTeam(o),this.contentPane.getChild("rankIcon").asLoader.url="common_rank"+s+"_png",this._updateWarInfo(i),i.FavoriteCards.forEach(function(t){var e=Data.pool.get(t.GCardID),i=CardPool.CardPoolMgr.inst.getCollectCard(e.cardId);i.skin=t.Skin;var r=fairygui.UIPackage.createObject(PkgName.cards,"smallCard",UI.CardCom);r.cardObj=i,r.setDeskFront(),r.setDeskBackground(),r.setCardImg(),r.setEquip(),r.setNumText(),r.setNumOffsetText(),r.setName(),u._favoriteCardList.addChild(r)}),i.FightCards.forEach(function(t){var e=Data.pool.get(t.GCardID),i=CardPool.CardPoolMgr.inst.getCollectCard(e.cardId);i.skin=t.Skin;var r=fairygui.UIPackage.createObject(PkgName.cards,"smallCard",UI.CardCom);r.cardObj=i,r.setDeskFront(),r.setDeskBackground(),r.setCardImg(),r.setEquip(),r.setNumText(),r.setNumOffsetText(),r.setName(),u._fightCardList.addChild(r)}),!Core.DeviceUtils.isWXGame()&&Core.ViewManager.inst.isShow(ViewName.battle)&&(this.displayObject.cacheAsBitmap=!0,o>=2&&(this._modifyNameBtn.visible=!0)),window.gameGlobal.isMultiLan&&(a=this.contentPane.getChild("countryFlagImg").asImage,a.visible=!0,LanguageMgr.inst.setCountryFlagImg(a)),[2]})})},e.prototype._updateWarInfo=function(t){if(console.log("---- ",t.CountryJob),""!=t.CampaignCountry?this._countryNameText.text=t.CampaignCountry:this._countryNameText.text=Core.StringUtils.TEXT(70112),t.CountryJob&&t.CountryJob!=Job.UnknowJob?this._countryJobText.text=Utils.job2TextDesc(t.CountryJob,!0):this._countryJobText.text=Core.StringUtils.TEXT(70112),0!=t.CityID){var e=Data.city.get(t.CityID);this._cityNameText.text=e.name}else this._cityNameText.text=Core.StringUtils.TEXT(70112);t.CityJob&&t.CityJob!=Job.UnknowJob?this._cityJobText.text=Utils.job2TextDesc(t.CityJob,!0):this._cityJobText.text=Core.StringUtils.TEXT(70112)},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),this.displayObject.cacheAsBitmap=!1,this._favoriteCardList.removeChildren(),this._fightCardList.removeChildren(),[2]})})},e}(Core.BaseWindow);t.SelfInfoWnd=e,__reflect(e.prototype,"Social.SelfInfoWnd")}(Social||(Social={}));var Social;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.center(),this.modal=!0,this._shareBtn=this.getChild("shareFacebookBtn").asButton,this._closeBtn=this.getChild("closeBtn").asButton,this._rewardNum=this.getChild("cnt1").asTextField,this._rewardNum.text="20",this._gotten=this.getChild("gotten").asLoader,this._gotten.visible=!1,this._closeBtn.addClickListener(function(){Core.ViewManager.inst.closeView(e)},this),this._shareBtn.addClickListener(this._onShare,this),Core.EventCenter.inst.addEventListener(GameEvent.ShareIOSOK,this._showGotten,this)},e.prototype._shareComplete=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return Player.inst.isIOSShared||!t?[3,2]:(this._gotten.visible=!0,[4,Net.rpcCall(pb.MessageID.C2S_IOS_SHARE,null)]);case 1:e=n.sent(),0==e.errcode&&(i=pb.IosShareReply.decode(e.payload),r=new Pvp.GetRewardData,r.jade=i.Jade,r.bowlder=i.Bowlder,Core.ViewManager.inst.open(ViewName.getRewardWnd,r),Core.EventCenter.inst.dispatchEventWith(GameEvent.ShareIOSOK,!1,!0),Player.inst.isIOSShared=!0),n.label=2;case 2:return[2]}})})},e.prototype._onShare=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return t=window.sharePlatform.getShareLink(),""==t?[3,2]:[4,window.sharePlatform.shareAppMsg(Core.StringUtils.TEXT(60254),t,"")];case 1:e=i.sent(),this._shareComplete(e),i.label=2;case 2:return[2]}})})},e.prototype._showGotten=function(t){this._gotten.visible=t.data},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.open.apply(this,e),this._gotten.visible=Player.inst.isIOSShared,[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e}(Core.BaseWindow);t.ShareFacebookRewardWnd=e,__reflect(e.prototype,"Social.ShareFacebookRewardWnd")}(Social||(Social={}));var Social;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.center(),this.modal=!0,this._shareBtn=this.getChild("shareBtn").asButton,this._pyqBtn=this.getChild("pyqBtn").asButton,this._closeBtn=this.getChild("closeBtn").asButton,this._rewardNum=this.getChild("cnt1").asTextField,this._rewardNum.text="10",this._gotten=this.getChild("gotten").asLoader,this._gotten.visible=!1,this._closeBtn.addClickListener(function(){Core.ViewManager.inst.closeView(e)},this),this._shareBtn.addClickListener(this._onShare,this),this._pyqBtn.addClickListener(this._onPyq,this),Core.NativeMsgCenter.inst.addListener(Core.NativeMessage.SHARE_APP2WECHAT,this._shareOK,this),Core.EventCenter.inst.addEventListener(GameEvent.ShareIOSOK,this._showGotten,this)},e.prototype._onShare=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.SHARE_APP2WECHAT,{title:Core.StringUtils.TEXT(60059),description:Core.StringUtils.TEXT(60247),url:"https://itunes.apple.com/cn/app/id1371944201?mt=8",scene:0}),[2]})})},e.prototype._onPyq=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.SHARE_APP2WECHAT,{title:Core.StringUtils.TEXT(60059),description:Core.StringUtils.TEXT(60247),url:"https://itunes.apple.com/cn/app/id1371944201?mt=8",scene:1}),[2]})})},e.prototype._shareOK=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return Player.inst.isIOSShared||1!=t.scene?[3,2]:(this._gotten.visible=!0,[4,Net.rpcCall(pb.MessageID.C2S_IOS_SHARE,null)]);case 1:e=n.sent(),0==e.errcode&&(i=pb.IosShareReply.decode(e.payload),r=new Pvp.GetRewardData,r.jade=i.Jade,Core.ViewManager.inst.open(ViewName.getRewardWnd,r),Core.EventCenter.inst.dispatchEventWith(GameEvent.ShareIOSOK,!1,!0),Player.inst.isIOSShared=!0),n.label=2;case 2:return[2]}})})},e.prototype._showGotten=function(t){this._gotten.visible=t.data},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.open.apply(this,e),this._gotten.visible=Player.inst.isIOSShared,[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e}(Core.BaseWindow);t.ShareRewardWnd=e,__reflect(e.prototype,"Social.ShareRewardWnd")}(Social||(Social={}));var Social;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._numText=this.getChild("textNum").asTextField,this._observee=null},i.prototype.observePrivateChatNum=function(t){this._observee=t,this._updateHintNum(),Core.EventCenter.inst.addEventListener(GameEvent.PrivateChatHintEv,this._onPrivateChatHintNumChange,this)},i.prototype._onPrivateChatHintNumChange=function(t){var e=t.data;this._observee&&e!=this._observee||this._updateHintNum()},i.prototype._updateHintNum=function(){var e=t.ChatMgr.inst.getPrivateHintsNum(this._observee);0>=e?this.visible=!1:e>99?(this.visible=!0,this._numText.text="99+"):(this.visible=!0,this._numText.text=""+e)},i}(fairygui.GComponent);t.PrivateChatHintCom=e,__reflect(e.prototype,"Social.PrivateChatHintCom");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._numText=this.getChild("textNum").asTextField},i.prototype.observerFriendApplyNum=function(){this._updateHintNum(),Core.EventCenter.inst.addEventListener(GameEvent.ApplyFriendHintEv,this._updateHintNum,this)},i.prototype._updateHintNum=function(){var e=t.FriendMgr.inst.applyNum;0>=e?this.visible=!1:e>99?(this.visible=!0,this._numText.text="99+"):(this.visible=!0,this._numText.text=""+e)},i}(fairygui.GComponent);t.ApplyFriendHintCom=i,__reflect(i.prototype,"Social.ApplyFriendHintCom");var r=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._numText=this.getChild("textNum").asTextField},i.prototype.observerSocialHintNum=function(){this._updateHintNum(),Core.EventCenter.inst.addEventListener(GameEvent.PrivateChatHintEv,this._updateHintNum,this),Core.EventCenter.inst.addEventListener(GameEvent.ApplyFriendHintEv,this._updateHintNum,this)},i.prototype._updateHintNum=function(){var e=t.ChatMgr.inst.getPrivateHintsNum();e+=t.FriendMgr.inst.applyNum,0>=e?this.visible=!1:e>99?(this.visible=!0,this._numText.text="99+"):(this.visible=!0,this._numText.text=""+e)},i}(fairygui.GComponent);t.SocialHintCom=r,__reflect(r.prototype,"Social.SocialHintCom")}(Social||(Social={}));var Social;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.height+=Utils.getResolutionDistance(),this.y=0,this._worldChatCom=this.getChild("worldChatCom").asCom,this._privateChatCom=this.getChild("privateChatCom").asCom,this._friendListCom=this.getChild("friendCom").asCom,this.getChild("privateChatNewHint").asCom.observePrivateChatNum(),this.getChild("applyFriendNewHint").asCom.observerFriendApplyNum(),this._switchCtrl=this.getController("switch"),this._switchCtrl.addEventListener(fairygui.StateChangeEvent.CHANGED,this._onSwitch,this),Core.EventCenter.inst.addEventListener(Core.Event.HomeListChangedEvt,this._onHomeListChanged,this),Core.EventCenter.inst.addEventListener(GameEvent.AddFriend,this._onAddFriend,this),Core.EventCenter.inst.addEventListener(GameEvent.ChannelChatEv,this._onChannelChat,this),LanguageMgr.inst.isChineseLocale()||(this.getChild("worldChk").asButton.getChild("title").asTextField.fontSize=15,this.getChild("privateChk").asButton.getChild("title").asTextField.fontSize=15,this.getChild("friendChk").asButton.getChild("title").asTextField.fontSize=15)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,e.prototype.open.apply(this,t)];case 1:return i.sent(),[2]}})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,e.prototype.close.apply(this,t)];case 1:return i.sent(),[2]}})})},i.prototype._onHomeListChanged=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n=this;return __generator(this,function(o){switch(o.label){case 0:return i=e?e.data:ViewName.social,i!=ViewName.social?[3,6]:(t.ChatMgr.inst.getPrivateHintsNum()>0?(this._switchCtrl.setSelectedPage("private"),this._curViewCom=this._privateChatCom):t.FriendMgr.inst.applyNum>0?(this._switchCtrl.setSelectedPage("friend"),this._curViewCom=this._friendListCom):(this._switchCtrl.setSelectedPage("world"),this._curViewCom=this._worldChatCom),this._curViewCom?[3,4]:(this._switchCtrl.setSelectedPage("world"),this._curViewCom=this._worldChatCom,[4,this._curViewCom.onChosen(!0)]));case 1:return r=o.sent(),r?[4,this._curViewCom.refresh()]:[3,3];case 2:o.sent(),o.label=3;case 3:return[3,5];case 4:this._loadTimeoutHdr||(this._loadTimeoutHdr=function(){return __awaiter(n,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this._loadTimeoutHdr=null,[4,this._curViewCom.onChosen(!0)];case 1:return t=e.sent(),t?[4,this._curViewCom.refresh()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},fairygui.GTimers.inst.add(1e3,1,this._loadTimeoutHdr,this)),o.label=5;case 5:return[3,7];case 6:this._loadTimeoutHdr&&(fairygui.GTimers.inst.remove(this._loadTimeoutHdr,this),this._loadTimeoutHdr=null),this._friendListCom.onChosen(!1),this._worldChatCom.onChosen(!1),this._privateChatCom.onChosen(!1),o.label=7;case 7:return[2]}})})},i.prototype._onAddFriend=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=t.data,"friend"==this._switchCtrl.selectedPage&&this._refreshCurView(),[2]})})},i.prototype._onChannelChat=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return t.data.channel==pb.ChatChannel.World&&(e=t.data.chatlet,this._worldChatCom.addChatlet(e)),[2]})})},i.prototype._onSwitch=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(r){switch(r.label){case 0:return t=this._switchCtrl.selectedPage,e=null,e="world"==t?this._worldChatCom:"private"==t?this._privateChatCom:this._friendListCom,e==this._curViewCom?[3,5]:(this._loadTimeoutHdr&&(fairygui.GTimers.inst.remove(this._loadTimeoutHdr,this),this._loadTimeoutHdr=null),this._curViewCom?[4,this._curViewCom.onChosen(!1)]:[3,2]);case 1:r.sent(),r.label=2;case 2:return this._curViewCom=e,[4,this._curViewCom.onChosen(!0)];case 3:return i=r.sent(),i?[4,this._curViewCom.refresh()]:[3,5];case 4:r.sent(),r.label=5;case 5:return[2]}})})},i.prototype.refresh=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this._onHomeListChanged()];case 1:return t.sent(),[4,this._onSwitch()];case 2:return t.sent(),[2]}})})},i.prototype._refreshCurView=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._loadTimeoutHdr&&(fairygui.GTimers.inst.remove(this._loadTimeoutHdr,this),this._loadTimeoutHdr=null),[4,this._curViewCom.refresh()];case 1:return t.sent(),[2]}})})},i}(Core.BaseView);t.SocialView=e,__reflect(e.prototype,"Social.SocialView")}(Social||(Social={}));var Social;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(i){var r=this;e.prototype.constructFromXML.call(this,i),this._chatletList=this.getChild("chatletList").asList,this._inputText=this.getChild("inputText").asTextInput,this._sendBtn=this.getChild("sendBtn").asButton,this._emojiBtn=this.getChild("emojiBtn").asButton;var n=this.getChild("emptyHintText");n&&(this._emptyHintText=n.asTextField),this._sendBtn.addClickListener(this._onSend,this),this._emojiBtn.addClickListener(this._onEmoji,this),this._emojiBtn.visible=Home.FunctionMgr.inst.isEmojiToChatOpen(),this._lastTime=0,this._chatNum=0,this._MAX_CHAT_NUM=30,this._initialized=!1,this._channel=t.ChatChannel.WORLD,Player.inst.addEventListener(Player.LoginEvt,function(){r._initialized=!1,r._removeChatlets()},this),Core.EventCenter.inst.addEventListener(GameEvent.UnSubscribeChatEv,function(t){t.data==r._channel&&(r._initialized=!1)},this)},i.prototype._removeChatlets=function(){this._chatNum=0,this._chatletList.removeChildren(0,-1,!0),this._lastTime=0},i.prototype.setChannel=function(t){this._channel=t},i.prototype.refresh=function(){return __awaiter(this,void 0,void 0,function(){var e,i=this;return __generator(this,function(r){return this._initialized||(e=t.ChatMgr.inst.drainWorldChatlets(this._channel),this._lastTime=0,this._lastItem=null,this._chatletList.removeChildren(0,-1,!0),e.forEach(function(t){i._addChatlet(t)}),this._lastItem&&this._chatletList.scrollToView(this._chatletList.getChildIndex(this._lastItem),!1),this._initialized=!0),[2]})})},i.prototype._addChatlet=function(e){var i=null;if(e.type==t.ChatType.Normal)i=e.isMyselfChat()?fairygui.UIPackage.createObject(PkgName.social,"messageItemSelf",t.ChatletCom).asCom:fairygui.UIPackage.createObject(PkgName.social,"messageItem",t.ChatletCom).asCom,i.setChatlet(e),e.timeStamp-this._lastTime>60?i.showTimeText(!0):i.showTimeText(!1);else if(e.type==t.ChatType.CampaignNotice){var r=e.getNoticeRawData();r.Type!=pb.CampaignNoticeType.AutocephalyVoteNt&&(i=fairygui.UIPackage.createObject(PkgName.war,"noticeFunctionItem").asCom,i.setNotice(r))}i&&(this._chatletList.addChild(i),this._lastTime=e.timeStamp,this._lastItem=i,this._chatNum+=1)},i.prototype.addChatlet=function(t){this._initialized&&(this._addChatlet(t),this._chatletList.isBottomMost()&&this._chatletList.scrollToView(this._chatletList.getChildIndex(this._lastItem),!0))},i.prototype.onChosen=function(e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return e?this._initialized?[3,2]:[4,t.ChatMgr.inst.subscribeChat(this._channel)]:[3,3];case 1:return i=r.sent(),this._removeChatlets(),this._emptyHintText&&(this._emptyHintText.visible=!i),[2,i];case 2:return[3,4];case 3:return this._chatNum>this._MAX_CHAT_NUM&&(this._chatletList.removeChildren(0,this._chatNum-this._MAX_CHAT_NUM-1),this._chatNum=this._MAX_CHAT_NUM,this._chatletList.scrollToView(this._chatletList.getChildIndex(this._lastItem))),[2,!0];case 4:return[2]}})})},i.prototype._onSend=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return e=this._inputText.text,e&&""!=e?""==e.trim()?[2]:[4,t.ChatMgr.inst.sendChat(this._channel,e.trim())]:[2];case 1:return i=r.sent(),i&&(this._inputText.text=""),[2]}})})},i.prototype._onEmoji=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(i){return Core.ViewManager.inst.openPopup(ViewName.emojiChoiceWnd,function(i){var r="#fimg,ui://common/emoji"+i+"(98,98)#e";t.ChatMgr.inst.sendChat(e._channel,r)}),[2]})})},i}(fairygui.GComponent);t.WorldChatWndCom=e,__reflect(e.prototype,"Social.WorldChatWndCom",["Social.ISocialCom"])}(Social||(Social={}));var Treasure;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.center(),this.modal=!0,this._advertBtn=this.contentPane.getChild("advertBtn").asButton,this._jadeSkipBtn=this.contentPane.getChild("jadeSkipBtn").asButton,this._shareBtn=this.contentPane.getChild("shareBtn").asButton,this._shareBtn.x=270,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._hintText=this.contentPane.getChild("txt2").asTextField,this._hintText2=this.contentPane.getChild("txt3").asTextField,this._hintText2.visible=!0,this._closeBtn.addClickListener(this._onClose,this),this._shareBtn.addClickListener(this._onShare,this),this._advertBtn.addClickListener(this._onAdvert,this),this._jadeSkipBtn.addClickListener(this._onSkipAdvert,this),this._jadeSkipBtn.visible=!0,Core.DeviceUtils.isWXGame()?(this._advertBtn.visible=!1,this._shareBtn.visible=!0):adsPlatform.isAdsOpen()?(this._advertBtn.visible=!0,this._shareBtn.visible=!1):(this._advertBtn.visible=!1,this._shareBtn.visible=!1,this._jadeSkipBtn.x=150),this._jadeSkipBtn.icon=Player.inst.getSkipAdvertResIcon()},e.prototype._onClose=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return this._shareBtn.visible?(Core.TipsUtils.confirm(Core.StringUtils.TEXT(60217),function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._callback?[4,this._callback(!1,!1,0)]:[3,2];case 1:t.sent(),this._callback=null,t.label=2;case 2:return Core.ViewManager.inst.closeView(this),[2]}})})},null,this,Core.StringUtils.TEXT(60041),Core.StringUtils.TEXT(60040)),[3,4]):[3,1];case 1:return this._callback?[4,this._callback(!1,!1,0)]:[3,3];case 2:e.sent(),this._callback=null,e.label=3;case 3:Core.ViewManager.inst.closeView(this),e.label=4;case 4:return[2]}})})},e.prototype._onAdvert=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return Player.inst.canSkipAdvertForTreasure()?(this._onSkipAdvert(),[2]):[4,adsPlatform.isAdsReady()];case 1:return t=i.sent(),t.success?[4,adsPlatform.showRewardAds()]:(Core.TipsUtils.showTipsFromCenter(t.reason),[2]);case 2:return e=i.sent(),e?this._callback?[4,this._callback(!0,!1,0)]:[3,4]:[3,5];case 3:i.sent(),i.label=4;case 4:return Core.ViewManager.inst.closeView(this),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60230)),[3,6];case 5:Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60172)),i.label=6;case 6:return[2]}})})},e.prototype._onSkipAdvert=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,Player.inst.askSubSkipAdvertRes(!0)];case 1:return t.sent()||Player.inst.canSkipAdvertForTreasure()?this._callback?[4,this._callback(!0,!0,0)]:[3,3]:[2];case 2:t.sent(),t.label=3;case 3:return Core.ViewManager.inst.closeView(this),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60191)),[2]}})})},e.prototype._onShare=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return Player.inst.canSkipAdvertForTreasure()?(this._onSkipAdvert(),[2]):(Core.DeviceUtils.isWXGame()&&(WXGame.WXShareMgr.inst.wechatShareAddTreasureCard(this._treasureId),WXGame.WXGameMgr.inst.isExamineVersion||WXGame.WXGameMgr.inst.registerOnShowCallback(function(){setTimeout(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._callback?[4,this._callback(!0,!1,0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return Core.ViewManager.inst.closeView(this),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60239)),[2]}})})},WXGame.WXShareMgr.inst.shareDelayOpTime)
})),[2])})})},e.prototype._onShareAddCard=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return e=t.data,this._callback?[4,this._callback(!1,!1,e.AddCardAmount)]:[3,2];case 1:i.sent(),this._callback=null,i.label=2;case 2:return Core.ViewManager.inst.closeView(this),[2]}})})},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.open.apply(this,e),this._treasureId=e[0],this._callback=e[1],Player.inst.hasEnoughResToSkipAdvert()||Player.inst.canSkipAdvertForTreasure()?(this._jadeSkipBtn.titleColor=16776960,Player.inst.canSkipAdvertForTreasure()?this._jadeSkipBtn.text=Core.StringUtils.TEXT(70114):this._jadeSkipBtn.text="3"):this._jadeSkipBtn.titleColor=16711680,this._shareBtn.visible&&Core.EventCenter.inst.addEventListener(GameEvent.AddTreasureCardEv,this._onShareAddCard,this),[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),this._callback=null,Core.EventCenter.inst.removeEventListener(GameEvent.AddTreasureCardEv,this._onShareAddCard,this),[2]})})},e}(Core.BaseWindow);t.AdvertAddTreasureCardWnd=e,__reflect(e.prototype,"Treasure.AdvertAddTreasureCardWnd")}(Treasure||(Treasure={}));var Treasure;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._countText=this.getChild("title").asTextField,this._card=this.getChild("card").asCom,this._newHintImg=this.getChild("newHintIcon").asLoader,this._newHintImg.visible=!1,this._bg=this.getChild("bg").asLoader},Object.defineProperty(e.prototype,"count",{get:function(){return this._count},set:function(t){this._count=t,this._countText.text="x"+this._count},enumerable:!0,configurable:!0}),e.prototype.setCardObj=function(t){this._cardObj=t,this._card.cardObj=t,this._card.setDeskFront(),this._card.setDeskBackground(),this._card.setCardImg(),this._card.setEquip(),this._card.setNumText(),this._card.setNumOffsetText(),this._card.setName(),this._card.setQualityMode(!0),this._count==t.amount&&1==t.level?this._newHintImg.visible=!0:this._newHintImg.visible=!1,this._cardObj.rare>=3?this._bg.url="cards_bg4_png":this._bg.url=""},e.prototype.cardObj=function(){return this._card.cardObj},e.prototype.hideNewHint=function(){this._newHintImg.visible=!1},e.prototype.playTrans=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){t.getTransition("t0").play(function(){e()})})];case 1:return e.sent(),[2]}})})},e.prototype.enableClick=function(t){t?this.addClickListener(this._onClick,this):this.removeClickListener(this._onClick,this)},e.prototype._onClick=function(){var t=this._cardObj.cardId,e=CardPool.CardPoolMgr.inst.getCollectCard(t);Core.ViewManager.inst.open(ViewName.cardInfo,e)},e}(fairygui.GComponent);t.CardRewardCom=e,__reflect(e.prototype,"Treasure.CardRewardCom")}(Treasure||(Treasure={}));var Treasure;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.center(),this.modal=!0,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._openBtn=this.contentPane.getChild("openBtn").asButton,this._openBtn.x=150,this._shareBtn=this.contentPane.getChild("shareBtn").asButton,this._advertBtn=this.contentPane.getChild("advertBtn").asButton,this._jadeSkipBtn=this.contentPane.getChild("jadeSkipBtn").asButton,this._cardDoubleHint=this.contentPane.getChild("cardDoubleHint").asLoader,this._goldText=this.contentPane.getChild("goldCntNew").asTextField,this._cardText=this.contentPane.getChild("cardCntNew").asTextField,this._boxName=this.contentPane.getChild("boxName").asTextField,this._closeBtn.addClickListener(this._onOpenConfirm,this),this._openBtn.addClickListener(this._onOpenConfirm,this),this._shareBtn.addClickListener(function(){return Player.inst.canSkipAdvertForTreasure()?void e._onSkipAdvert():(WXGame.WXShareMgr.inst.wechatShareDailyTreasure(e._treasure.id),void(WXGame.WXGameMgr.inst.isExamineVersion||WXGame.WXGameMgr.inst.registerOnShowCallback(function(){setTimeout(function(){return __awaiter(e,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return t={IsConsumeJade:!1},[4,Net.rpcCall(pb.MessageID.C2S_DAILY_TREASURE_READ_ADS,pb.DailyTreasureReadAdsArg.encode(t))];case 1:return e=i.sent(),0==e.errcode&&(this._treasure.isDouble=!0,this.refresh(this._treasure),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60238)),Core.ViewManager.inst.closeView(this)),[2]}})})},WXGame.WXShareMgr.inst.shareDelayOpTime)})))},this),this._advertBtn.addClickListener(function(){return __awaiter(e,void 0,void 0,function(){var t,e,i,r;return __generator(this,function(n){switch(n.label){case 0:return Player.inst.canSkipAdvertForTreasure()?(this._onSkipAdvert(),[2]):adsPlatform.isAdsOpen()?[4,adsPlatform.isAdsReady()]:[3,4];case 1:return t=n.sent(),t.success?[4,adsPlatform.showRewardAds()]:(Core.TipsUtils.showTipsFromCenter(t.reason),[2]);case 2:return(e=n.sent())?(i={IsConsumeJade:!1},[4,Net.rpcCall(pb.MessageID.C2S_DAILY_TREASURE_READ_ADS,pb.DailyTreasureReadAdsArg.encode(i))]):[3,4];case 3:r=n.sent(),0==r.errcode&&(this._treasure.isDouble=!0,this.refresh(this._treasure),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60223))),n.label=4;case 4:return[2]}})})},this),this._jadeSkipBtn.addClickListener(this._onSkipAdvert,this),this._shareBtn.visible=!1,this._advertBtn.visible=!1,this._jadeSkipBtn.icon=Player.inst.getSkipAdvertResIcon()},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.open.apply(this,e),this.refresh(e[0]),this._closeCallback=e[1],[2]})})},e.prototype._onSkipAdvert=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,Player.inst.askSubSkipAdvertRes(!0)];case 1:return i.sent()||Player.inst.canSkipAdvertForTreasure()?(t={IsConsumeJade:!0},[4,Net.rpcCall(pb.MessageID.C2S_DAILY_TREASURE_READ_ADS,pb.DailyTreasureReadAdsArg.encode(t))]):[2];case 2:return e=i.sent(),0==e.errcode&&(this._treasure.isDouble=!0,this.refresh(this._treasure),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60179))),[2]}})})},e.prototype.refresh=function(t){t||egret.log("daily treasure is null"),this._treasure=t,this._cardDoubleHint.visible=this._treasure.isDouble,this._shareBtn.touchable=!this._treasure.isDouble,this._advertBtn.touchable=!this._treasure.isDouble,this._goldText.text="x"+t.getMinGoldCnt()+" ~ "+t.getMaxGoldCnt();var e=0;Player.inst.hasPrivilege(Priv.DAILY_ADD_CARD)&&(e+=20),this._cardText.text="x"+(t.getCardNum()+e),this._boxName.text=""+t.getName(),t.isDouble?(this._openBtn.visible=!0,this._openBtn.icon="common_btnGreen_png",this._openBtn.title=Core.StringUtils.TEXT(60045),this._shareBtn.visible=!1,this._advertBtn.visible=!1,this._jadeSkipBtn.visible=!1,this.contentPane.getChild("txt2").asTextField.text=Core.StringUtils.TEXT(60109)):(this._jadeSkipBtn.visible=!0,this._openBtn.visible=!1,Player.inst.hasEnoughResToSkipAdvert()||Player.inst.canSkipAdvertForTreasure()?(this._jadeSkipBtn.titleColor=16776960,Player.inst.canSkipAdvertForTreasure()?this._jadeSkipBtn.text=Core.StringUtils.TEXT(70114):this._jadeSkipBtn.text="3"):this._jadeSkipBtn.titleColor=16711680,Core.DeviceUtils.isWXGame()?(this._advertBtn.visible=!1,this._shareBtn.visible=!0,this.contentPane.getChild("txt2").asTextField.text=Core.StringUtils.TEXT(60237),this._shareBtn.icon="common_btnGreen_png"):adsPlatform.isAdsOpen()?(this._advertBtn.visible=!0,this._shareBtn.visible=!1,this.contentPane.getChild("txt2").asTextField.text=Core.StringUtils.TEXT(60237)):(this._advertBtn.visible=!1,this._shareBtn.visible=!1,this._jadeSkipBtn.x=150),this._openBtn.icon="common_btnGrey_png",this._openBtn.title=Core.StringUtils.TEXT(60045))},e.prototype._onOpenConfirm=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t=this._treasure,t.isDouble?(this._closeCallback&&this._closeCallback(),Core.ViewManager.inst.closeView(this)):Core.TipsUtils.confirm(Core.StringUtils.TEXT(60227),function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._closeCallback&&this._closeCallback(),Core.ViewManager.inst.closeView(this),[2]})})},function(){},this,Core.StringUtils.TEXT(60039),Core.StringUtils.TEXT(60057)),[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),this._closeCallback=null,[2]})})},e}(Core.BaseWindow);t.DailyTreasureDoubleWnd=e,__reflect(e.prototype,"Treasure.DailyTreasureDoubleWnd")}(Treasure||(Treasure={}));var Treasure;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this._goldText=this.contentPane.getChild("goldCnt").asTextField,this._cardText=this.contentPane.getChild("cardCnt").asTextField,this._rareCardNumText=this.contentPane.getChild("txt1").asTextField,this._boxName=this.contentPane.getChild("txt2").asTextField,this._effBox0=this.contentPane.getChild("box0").asLoader,this._effBox1=this.contentPane.getChild("box1").asLoader,this._text=this.contentPane.getChild("txt3").asTextField,this.center(),this.modal=!0,this.adjust(this.contentPane.getChild("closeBg")),this.contentPane.getChild("closeBtn").addClickListener(this._onClose,this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,n,o;return __generator(this,function(s){return t.prototype.open.apply(this,e),this._treasureCom=e[0],this.addRelation(this._treasureCom,fairygui.RelationType.Top_Bottom),this.addRelation(this._treasureCom,fairygui.RelationType.Right_Center),i=this._treasureCom.treasure,i.getMinGoldCnt()==i.getMaxGoldCnt()?this._goldText.text="x"+i.getMinGoldCnt():this._goldText.text="x"+i.getMinGoldCnt()+" ~ "+i.getMaxGoldCnt(),r=0,(8==i.getRareType()||9==i.getRareType())&&Player.inst.hasPrivilege(Priv.DAILY_ADD_CARD)&&(r+=20),this._cardText.text="x"+(i.getCardNum()+r),this._boxName.text=""+i.getName(),i.totalStarCount?this._text.text=Core.StringUtils.format(Core.StringUtils.TEXT(60195),i.totalStarCount):this._text.text="",n=i.getRareCardNum(),0>=n?this._rareCardNumText.visible=!1:(this._rareCardNumText.visible=!0,this._rareCardNumText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60130),n)),o=i.getRareType(),this._effBox0.url="treasure_"+o+"0_png",this._effBox1.url="treasure_"+o+"1_png",[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e.prototype._onClose=function(t){Core.ViewManager.inst.closeView(this)},e}(Core.BaseWindow);t.DailyTreasureInfoWnd=e,__reflect(e.prototype,"Treasure.DailyTreasureInfoWnd")}(Treasure||(Treasure={}));var Treasure;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._starProgressBar=this.getChild("starProgress"),this._starProgressBar.setProgress(0,0),this._treasureImg=this.getChild("treasureIcon").asLoader,this._nextTimeText=this.getChild("nextTxt").asTextField,this._starImg=this.getChild("starIcon").asLoader,this._starImg2=this.getChild("starIcon2").asLoader,this._boxWnd=this.getChild("boxWnd").asLoader,this._tran0=this.getTransition("t0"),this._clickTrans=this.getTransition("t1"),this._nextTimeText.text="",this.addClickListener(this._onClick,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onTouchBegin,this)},i.prototype.refresh=function(t){if(this._treasure=t,this._treasure.isOpen){var e=this._treasure.getRareType();this._starProgressBar.visible=!1,this._treasureImg.url="treasure_box0_png",this._nextTimeText.visible=!0,this._starImg.visible=!1,this._starImg2.visible=!1,this._boxWnd.url="pvp_functionBottom_png",fairygui.GTimers.inst.add(1e3,this._treasure.nextTime,this._execCountDown,this),this._tran0.stop()}else if(this._treasure.canOpen()){fairygui.GTimers.inst.remove(this._execCountDown,this);var e=this._treasure.getRareType();this._starProgressBar.visible=!1,this._treasureImg.url="treasure_box"+e+"_png",this._treasureImg.grayed=!1,this._nextTimeText.visible=!0,this._nextTimeText.text=Core.StringUtils.TEXT(60052),this._starImg.visible=!1,this._starImg2.visible=!1,this._boxWnd.url="pvp_functionBottom2_png",this._setProgress(),this._tran0.play(null,null,null,-1)}else{fairygui.GTimers.inst.remove(this._execCountDown,this);var e=this._treasure.getRareType();this._starProgressBar.visible=!0,this._treasureImg.url="treasure_box"+e+"_png",this._treasureImg.grayed=!1,this._nextTimeText.visible=!1,this._starImg.visible=!0,this._starImg2.visible=!0,this._boxWnd.url="pvp_functionBottom_png",this._setProgress(),this._tran0.stop()}},i.prototype._setProgress=function(){var t=this._treasure.totalStarCount,e=this._treasure.openStarCount,i=t-e;this._starProgressBar.getChild("text").asTextField.text=i+"/"+t,this._starProgressBar.setProgress(i,t)},i.prototype._execCountDown=function(){var t=this._treasure.nextTime;t>0&&(this._treasure.nextTime=t-1,this._nextTimeText.text=""+Core.StringUtils.secToString(t,"hm"))},i.prototype._onClick=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r=this;return __generator(this,function(n){return this._treasure&&!this._treasure.isOpen?this._treasure.canOpen()?(e=function(){return __awaiter(r,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,t.TreasureMgr.inst().openTreasure(this._treasure.id)];case 1:return(e=i.sent())?(console.debug("TreasureItemCom _onClick get reward done"),t.TreasureMgr.inst().popTreasure(this._treasure.id),Core.ViewManager.inst.open(ViewName.treasureRewardInfo,e,this._treasure),[2]):(console.debug("openTreasure fail, id="+this._treasure.id+", t="+this._treasure.type),[2])}})})},Core.ViewManager.inst.open(ViewName.dailyTreasureDouble,this._treasure,e)):Core.ViewManager.inst.open(ViewName.dailyTreasureInfo,this):(i=Core.StringUtils.format(Core.StringUtils.TEXT(60160),Core.StringUtils.secToString(this._treasure.nextTime,"hm")),SoundMgr.inst.playSoundAsync("click_mp3")),[2]})})},i.prototype._onTouchBegin=function(){this._boxWnd&&this._clickTrans.play()},Object.defineProperty(i.prototype,"treasure",{get:function(){return this._treasure},enumerable:!0,configurable:!0}),i}(fairygui.GComponent);t.DailyTreasureItemCom=e,__reflect(e.prototype,"Treasure.DailyTreasureItemCom")}(Treasure||(Treasure={}));var Treasure;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._countText=this.getChild("title").asTextField},Object.defineProperty(e.prototype,"count",{get:function(){return this._count},set:function(t){this._count=t,this._countText.text="x"+this._count},enumerable:!0,configurable:!0}),e.prototype.setNoGoldHint=function(t){this._countText.text=t,this._countText.color=16777215,this._countText.fontSize=24},e.prototype.playTrans=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){t.getTransition("t0").play(function(){e()})})];case 1:return e.sent(),[2]}})})},e}(fairygui.GComponent);t.GoldRewardCom=e,__reflect(e.prototype,"Treasure.GoldRewardCom")}(Treasure||(Treasure={}));var Treasure;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._countText=this.getChild("title").asTextField},Object.defineProperty(e.prototype,"count",{get:function(){return this._count},set:function(t){this._count=t,this._countText.text="x"+this._count},enumerable:!0,configurable:!0}),e.prototype.setNoGoldHint=function(t){this._countText.text=t},e.prototype.playTrans=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){t.getTransition("t0").play(function(){e()})})];case 1:return e.sent(),[2]}})})},e}(fairygui.GComponent);t.JadeRewardCom=e,__reflect(e.prototype,"Treasure.JadeRewardCom")}(Treasure||(Treasure={}));var Treasure;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this._openTimeText=this.contentPane.getChild("treasureTime").asTextField,this._rareCardNumText=this.contentPane.getChild("txt1").asTextField,this._anotherOpenText=this.contentPane.getChild("txt2").asTextField,this._nameText=this.contentPane.getChild("treasureName").asTextField,this._skipHintText=this.contentPane.getChild("skipText").asTextField,this._openBtn=this.contentPane.getChild("btnOpen").asButton,this._effBox0=this.contentPane.getChild("box0").asLoader,this._effBox1=this.contentPane.getChild("box1").asLoader,this._openTrans0=this.contentPane.getTransition("t0"),this._openTrans1=this.contentPane.getTransition("t1"),this._openTrans2=this.contentPane.getTransition("t2"),this._openTrans3=this.contentPane.getTransition("t3"),this._rewardList=this.contentPane.getChild("rewardList").asList,this._shareBtn=this.contentPane.getChild("shareBtn").asButton,this._shareBtn.visible=!1,this._advertBtn=this.contentPane.getChild("advertBtn").asButton,this._advertBtn.addClickListener(this._onAdvert,this),this._advertBtn.visible=!1,this._jadeBtn=this.contentPane.getChild("jadeBtn").asButton,this._jadeBtn.addClickListener(this._onJade,this),this._jadeBtn.visible=!1,this._naviBtn=this.contentPane.getChild("naviBtn").asButton,this._naviBtn.addClickListener(this._onNaviToCurTreasure,this),this._naviBtn.visible=!1,this._jadeSkipBtn=this.contentPane.getChild("jadeSkipBtn").asButton,this._jadeSkipBtn.addClickListener(this._onJadeSkipAdvert,this),this._jadeSkipBtn.visible=!1,this.modal=!0,this.center(),this._isClickOpening=!1,this.adjust(this.contentPane.getChild("closeBg")),this.contentPane.getChild("closeBtn").addClickListener(this._onClose,this)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,n=this;return __generator(this,function(o){switch(o.label){case 0:return e.prototype.open.apply(this,t),this._treasureCom=t[0],i=this._treasureCom.pos,this._openTimeText.text="",this._jadeBtn.icon=this._treasureCom.treasure.getAccResIcon(),this._refresh(),r=null,r=0==i?this._openTrans0:1==i?this._openTrans1:2==i?this._openTrans2:this._openTrans3,[4,new Promise(function(t){r.play(function(){t()},n)})];case 1:return o.sent(),this._openBtn.addClickListener(this._onClickOpen,this),adsPlatform.isAdsOpen()&&Player.inst.addEventListener(Player.ResUpdateEvt,this._refreshAdvertCnt,this),Core.EventCenter.inst.addEventListener(Core.Event.UpdateTreasureEvt,this._onUpdateTreasureItem,this),this.contentPane.getChild("closeBg").addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onClose,this),[2]}})})},i.prototype._onWatchAdsFinish=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o;return __generator(this,function(s){switch(s.label){case 0:return e=this._treasureCom.treasure,i={TreasureID:e.id,IsConsumeJade:!1},[4,Net.rpcCall(pb.MessageID.C2S_TREASURE_READ_ADS,pb.TargetTreasure.encode(i))];case 1:return r=s.sent(),0!=r.errcode?[3,4]:(n=pb.TreasureReadAdsReply.decode(r.payload),e.openTime=n.RemainTime,e.openTime<=0?[4,t.TreasureMgr.inst().openTreasure(e.id)]:[3,3]);case 2:return(o=s.sent())?(t.TreasureMgr.inst().onTreasureCountDownDone(e),t.TreasureMgr.inst().popTreasure(e.id),Core.ViewManager.inst.open(ViewName.treasureRewardInfo,o,e,function(){Core.ViewManager.inst.close(ViewName.treasureInfo)}),Core.ViewManager.inst.closeView(this),[3,4]):[2];case 3:this._refresh(),this._refreshAdvertCnt(),e.fireUpdateEvent(),s.label=4;case 4:return[2]}})})},i.prototype._onShare=function(){var t=this;return Player.inst.isVip?void this._onJadeSkipAdvert():void(Core.DeviceUtils.isWXGame()&&(WXGame.WXShareMgr.inst.wechatShareTreasure(this._treasureCom.treasure.id),WXGame.WXGameMgr.inst.registerOnShowCallback(function(){setTimeout(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60242)),[4,this._onWatchAdsFinish()];case 1:return t.sent(),[2]}})})},WXGame.WXShareMgr.inst.shareDelayOpTime)})))},i.prototype._refreshAdvertCnt=function(){this._advertBtn.getChild("title1").asTextField.text=Core.StringUtils.TEXT(60023)+(""+Player.inst.getAdvertCnt())+Core.StringUtils.TEXT(60011)},i.prototype._onAdvert=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i=this;return __generator(this,function(r){switch(r.label){case 0:return Player.inst.isVip?(this._onJadeSkipAdvert(),[2]):adsPlatform.isAdsOpen()?Player.inst.getAccTreasureCnt()<=0?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60235)),[2]):[4,adsPlatform.isAdsReady()]:[3,4];case 1:return t=r.sent(),!t.success||Player.inst.getAdvertCnt()<=0?(Core.DeviceUtils.isWXGame()?(Core.TipsUtils.showTipsFromCenter(t.reason),Core.DeviceUtils.isWXGame()&&Core.TipsUtils.confirm(Core.StringUtils.TEXT(60246),function(){i._onShare()},null,this,Core.StringUtils.TEXT(60072),Core.StringUtils.TEXT(60020))):Core.TipsUtils.showTipsFromCenter(t.reason),[2]):[4,adsPlatform.showRewardAds()];case 2:return(e=r.sent())?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60224)),[4,this._onWatchAdsFinish()]):[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}})})},i.prototype._onJadeSkipAdvert=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o;return __generator(this,function(s){switch(s.label){case 0:return Player.inst.getAccTreasureCnt()<=0?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60215)),[2]):Player.inst.hasEnoughResToSkipAdvert()||Player.inst.isVip?(e=this._treasureCom.treasure,i={TreasureID:e.id,IsConsumeJade:!0},[4,Net.rpcCall(pb.MessageID.C2S_TREASURE_READ_ADS,pb.TreasureReadAdsArg.encode(i))]):(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60085)),[2]);case 1:return r=s.sent(),0!=r.errcode?[3,4]:(n=pb.TreasureReadAdsReply.decode(r.payload),e.openTime=n.RemainTime,e.openTime<=0?[4,t.TreasureMgr.inst().openTreasure(e.id)]:[3,3]);case 2:return(o=s.sent())?(t.TreasureMgr.inst().onTreasureCountDownDone(e),t.TreasureMgr.inst().popTreasure(e.id),Core.ViewManager.inst.open(ViewName.treasureRewardInfo,o,e,function(){Core.ViewManager.inst.close(ViewName.treasureInfo)}),Core.ViewManager.inst.closeView(this),[3,4]):[2];case 3:this._refresh(),this._refreshAdvertCnt(),e.fireUpdateEvent(),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60178)),s.label=4;case 4:return[2]}})})},i.prototype._onJade=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o;return __generator(this,function(s){switch(s.label){case 0:return e=this._treasureCom.treasure,[4,e.askSubAccRes(e.getAccResCnt(),!0)];case 1:return s.sent()?(i=e.id,r={TreasureID:i},[4,Net.rpcCall(pb.MessageID.C2S_JADE_ACC_TREASURE,pb.TargetTreasure.encode(r))]):[2];case 2:return n=s.sent(),0!=n.errcode?[3,5]:(e.openTime=0,[4,t.TreasureMgr.inst().openTreasure(i)]);case 3:return(o=s.sent())?(t.TreasureMgr.inst().onTreasureCountDownDone(e),t.TreasureMgr.inst().popTreasure(i),[4,Core.ViewManager.inst.open(ViewName.treasureRewardInfo,o,e,function(){Core.ViewManager.inst.close(ViewName.treasureInfo)})]):[2];case 4:s.sent(),Core.ViewManager.inst.closeView(this),s.label=5;case 5:return[2]}})})},i.prototype._onNaviToCurTreasure=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return this._treasureCom.treasure.isActivating()?[2]:(e=t.TreasureMgr.inst().curActivatingTreasure)?(i=e.pos,r=Core.ViewManager.inst.getView(ViewName.match),n=r.getTreasureCom(i),[4,Core.ViewManager.inst.closeView(this)]):[3,3];case 1:return o.sent(),[4,Core.ViewManager.inst.open(ViewName.treasureInfo,n)];case 2:o.sent(),o.label=3;case 3:return[2]}})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,e.prototype.close.apply(this,t)];case 1:return i.sent(),this._openTrans0.stop(),this._openTrans1.stop(),this._openTrans2.stop(),this._openTrans3.stop(),this._openTimeText.text="",this.root.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onClose,this),this._openBtn.removeClickListener(this._onClickOpen,this),adsPlatform.isAdsOpen()&&Player.inst.removeEventListener(Player.ResUpdateEvt,this._refreshAdvertCnt,this),Core.EventCenter.inst.removeEventListener(Core.Event.UpdateTreasureEvt,this._onUpdateTreasureItem,this),[2]}})})},i.prototype._onUpdateTreasureItem=function(t){t.treasureItem==this._treasureCom.treasure&&this._refresh()},i.prototype._onClose=function(t){Core.ViewManager.inst.closeView(this)},i.prototype._onClickOpen=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return this._isClickOpening?[2]:(this._isClickOpening=!0,e=this._treasureCom.treasure.getOpenNeedTime(),5>=e?[4,Core.ViewManager.inst.closeView(this)]:[3,2]);case 1:i.sent(),i.label=2;case 2:return this._treasureCom.playActivateAnimation(),[4,t.TreasureMgr.inst().activateTreasure(this._treasureCom.treasure.id)];case 3:return i.sent(),this._treasureCom.treasure.fireUpdateEvent(),e>5&&this._refresh(),this._isClickOpening=!1,[2]}})})},i.prototype._refresh=function(){var e=this;if(!this._treasureCom.treasure)return void console.debug("=== can't get treasure item");this._rewardList.removeChildren(0,-1,!0);var i=t.TreasureReward.genRewardItemComsByTreasure(this._treasureCom.treasure);i.forEach(function(t){e._rewardList.addChild(t)}),this._rewardList.height=50*Math.ceil(i.length/2),this._nameText.text=""+this._treasureCom.treasure.getName();var r=this._treasureCom.treasure.getRareCardNum();0>=r?this._rareCardNumText.visible=!1:(this._rareCardNumText.visible=!0,this._rareCardNumText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60130),r)),t.TreasureMgr.inst().curActivatingTreasure?(this._treasureCom.treasure.isActivating()?(this._anotherOpenText.visible=!1,this._naviBtn.visible=!1):(this._anotherOpenText.visible=!0,this._naviBtn.visible=!0),this._openBtn.enabled=!1):(this._anotherOpenText.visible=!1,this._naviBtn.visible=!1,this._openBtn.enabled=!0),this._openBtn.visible=!0,this._advertBtn.visible=!1,this._jadeBtn.visible=!1,this._jadeSkipBtn.visible=!1,this._skipHintText.visible=!1;var n=this._treasureCom.treasure;if(n.isActivating()){this._startCountDown(),this._openBtn.visible=!1;var o=(Player.inst.getAdvertCnt(),Player.inst.getAccTreasureCnt());if(o>0){this._jadeBtn.visible=!1,this._jadeSkipBtn.visible=!0,Player.inst.hasEnoughResToSkipAdvert()||Player.inst.isVip?(this._jadeSkipBtn.titleColor=16776960,Player.inst.isVip?this._jadeSkipBtn.text=Core.StringUtils.TEXT(70114):this._jadeSkipBtn.text="3"):this._jadeSkipBtn.titleColor=16711680,this._skipHintText.visible=!0;var s=20;Player.inst.hasPrivilege(Priv.TREASURE_ADD_ACC_CNT)&&(s+=2),this._skipHintText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60159),o,s),Core.DeviceUtils.isWXGame()?(this._advertBtn.visible=!0,this._jadeSkipBtn.x=30):adsPlatform.isAdsOpen()?this._advertBtn.visible=!0:(this._advertBtn.visible=!1,this._jadeSkipBtn.x=125)}else this._advertBtn.visible=!1,this._jadeSkipBtn.visible=!1,this._jadeBtn.visible=!0,this._skipHintText.visible=!1}else if(n.canOpen())console.debug("--- treasure can open!"),Core.ViewManager.inst.closeView(this);else{fairygui.GTimers.inst.remove(this._execCountDown,this);var a=n.getOpenNeedTime(),u=1;Player.inst.hasPrivilege(Priv.TREASURE_SUB_TIME)&&(u-=.1),this._openTimeText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60107),Core.StringUtils.secToString(a*u,"hm"))}var h=n.getRareType();this._effBox0.url="treasure_"+h+"0_png",this._effBox1.url="treasure_"+h+"1_png"},i.prototype._execCountDown=function(){this._openTimeText.visible=!0,this._countdown-=1,this._countdown<=0?(fairygui.GTimers.inst.remove(this._execCountDown,this),this._refresh()):this._setCountDownTime(this._countdown)},i.prototype._startCountDown=function(){fairygui.GTimers.inst.remove(this._execCountDown,this),this._countdown=this._treasureCom.treasure.openTime,this._setCountDownTime(this._countdown),this._countdown>0&&fairygui.GTimers.inst.add(1e3,this._countdown,this._execCountDown,this)},i.prototype._setCountDownTime=function(t){if(this._treasureCom&&this._treasureCom.treasure){this._openTimeText.text=Core.StringUtils.secToString(t,"hm");var e=this._treasureCom.treasure.getAccResCnt(t);this._jadeBtn.title=""+e,this._treasureCom.treasure.hasEnoughResToAcc(e)?this._jadeBtn.getChild("title").asTextField.color=16777215:this._jadeBtn.getChild("title").asTextField.color=16711680}},i}(Core.BaseWindow);t.TreasureInfoWnd=e,__reflect(e.prototype,"Treasure.TreasureInfoWnd")}(Treasure||(Treasure={}));var Treasure;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._readyOpenBg=this.getChild("readyOpenBg").asLoader,this._canOpenBg=this.getChild("canOpenBg").asLoader,this._treasureImg=this.getChild("teasureImg").asLoader,this._nameText=this.getChild("nameText").asTextField,this._openBtn=this.getChild("openBtn").asButton,this._openTimeText=this.getChild("openTimeText").asTextField,this._boxWnd=this.getChild("boxWnd").asLoader,this._jadeIcon=this.getChild("jadeIcon").asLoader,this._jadeText=this.getChild("jadeText").asTextField,this._jadeCnt=this.getChild("jadeCnt").asTextField,this._jadeBg=this.getChild("jadeBg").asLoader,LanguageMgr.inst.isChineseLocale()||(this._openTimeText.fontSize=12),this._clickTrans=this.getTransition("t3"),this._activateTrans=this.getTransition("t4"),this.addClickListener(this._onClick,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onTouchBegin,this),Core.EventCenter.inst.addEventListener(Core.Event.ReLoginEv,this._onRelogin,this),this._treasure=null},i.prototype._onRelogin=function(){fairygui.GTimers.inst.remove(this._execCountDown,this)},Object.defineProperty(i.prototype,"pos",{get:function(){return this._pos},set:function(t){this._pos=t},enumerable:!0,configurable:!0}),i.prototype.hideContent=function(){this._readyOpenBg.visible=!1,this._canOpenBg.visible=!1,this._treasureImg.visible=!1,this._nameText.visible=!1,this._openBtn.visible=!1,this._openTimeText.visible=!1},Object.defineProperty(i.prototype,"treasure",{get:function(){return this._treasure},enumerable:!0,configurable:!0}),i.prototype.refresh=function(t){if(this._treasure=t,this._resetUI(),this._jadeCnt.visible=!1,this._jadeIcon.visible=!1,this._jadeText.visible=!1,this._jadeBg.visible=!1,t){this._nameText.text=this._treasure.getName(),this._nameText.visible=!0,t.isActivating()?(this._jadeCnt.visible=!0,this._jadeIcon.visible=!0,this._jadeText.visible=!0,this._jadeIcon.url=t.getAccResIcon(),Player.inst.getAccTreasureCnt()>0?this._jadeText.text=Core.StringUtils.TEXT(60025):this._jadeText.text=Core.StringUtils.TEXT(60062),this._jadeBg.visible=!0,this._startCountDown()):t.canOpen()?(Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.REMOVE_NOTIFY),fairygui.GTimers.inst.remove(this._execCountDown,this),this._canOpenMode()):this._canActivateMode();
var e=this._treasure.getRareType();this._treasureImg.visible=!0,this._treasureImg.url="treasure_box"+e+"_png",this._canOpenBg.url="treasure_box"+e+"CanOpen_png"}else this._nameText.visible=!1,fairygui.GTimers.inst.remove(this._execCountDown,this)},i.prototype._resetUI=function(){this._readyOpenBg.visible=!1,this._canOpenBg.visible=!1,this._treasureImg.url="treasure_box0_png",this._openBtn.visible=!1,this._openTimeText.visible=!1,this._boxWnd.url="treasure_boxFrame_png"},i.prototype._canOpenMode=function(){this._boxWnd.url="treasure_boxFrame2_png",this._openBtn.visible=!0},i.prototype._canActivateMode=function(){this._canOpenBg.visible=!0,this._openTimeText.visible=!0,t.TreasureMgr.inst().curActivatingTreasure?this._openTimeText.text=Core.StringUtils.TEXT(60063):this._openTimeText.text=Core.StringUtils.TEXT(60064)},i.prototype._execCountDown=function(){this._openTimeText.visible=!0;var e=this._treasure.openTime;e-=1,0>=e?(fairygui.GTimers.inst.remove(this._execCountDown,this),this._treasure.openTime=0,this.refresh(this._treasure),this._treasure.fireUpdateEvent(),t.TreasureMgr.inst().onTreasureCountDownDone(this._treasure)):(this._treasure.openTime=e,this._setCountDownTime(e))},i.prototype._setCountDownTime=function(t){if(this._treasure){this._openTimeText.text=Core.StringUtils.secToString(t,"hm");var e=0;Player.inst.getAccTreasureCnt()>0?Player.inst.isVip?(this._jadeCnt.text=Core.StringUtils.TEXT(70114),this._jadeCnt.color=16777215):(e=3,this._jadeCnt.text=""+e,Player.inst.hasEnoughResToSkipAdvert()?this._jadeCnt.color=16777215:this._jadeCnt.color=16711680):(e=this._treasure.getAccResCnt(),this._jadeCnt.text=""+e,this._treasure.hasEnoughResToAcc(e)?this._jadeCnt.color=16777215:this._jadeCnt.color=16711680)}},i.prototype._startCountDown=function(){Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.REMOVE_NOTIFY),fairygui.GTimers.inst.remove(this._execCountDown,this),this._execCountDown(),this._treasure.lastUpdateTime=Math.floor((new Date).getTime()/1e3),fairygui.GTimers.inst.add(1e3,this._treasure.openTime,this._execCountDown,this),Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.CREATE_NOTIFY,{time:this._treasure.openTime,message:Core.StringUtils.TEXT(60176)})},i.prototype._onClick=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return this._treasure?(e=this._treasure,e.canOpen()?(console.debug("TreasureItemCom _onClick open"),[4,t.TreasureMgr.inst().openTreasure(e.id)]):[3,2]):[3,3];case 1:return(i=r.sent())?(console.debug("TreasureItemCom _onClick get reward done"),Core.ViewManager.inst.open(ViewName.treasureRewardInfo,i,e,function(){t.TreasureMgr.inst().popTreasure(e.id)}),[3,3]):(console.debug("openTreasure fail, id="+e.id+", t="+e.type),[2]);case 2:console.debug("TreasureItemCom _onClick info"),Core.ViewManager.inst.open(ViewName.treasureInfo,this),r.label=3;case 3:return[2]}})})},i.prototype._onTouchBegin=function(){this._treasure&&this._clickTrans.play()},i.prototype.playActivateAnimation=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){t._activateTrans.play(function(){e()},t)})];case 1:return e.sent(),[2]}})})},i}(fairygui.GComponent);t.TreasureItemCom=e,__reflect(e.prototype,"Treasure.TreasureItemCom")}(Treasure||(Treasure={}));var Treasure;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e)},e.prototype.setRewardInfo=function(t,e,i){var r=Reward.RewardMgr.inst.getRewardIcon(t);this.getChild("rewardIcon").asLoader.url=r,i&&i>0&&e!=i?this.getChild("cnt").asTextField.text="x"+e+"~"+i:this.getChild("cnt").asTextField.text="x"+e},e}(fairygui.GComponent);t.TreasureRewardItemCom=e,__reflect(e.prototype,"Treasure.TreasureRewardItemCom")}(Treasure||(Treasure={}));var Treasure;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){var t=this;e.prototype.initUI.call(this),this.adjust(this.getChild("bg")),this._resultList=this.getChild("resultList").asList,this._confirmBtn=this.getChild("btnOk").asButton,this._shareBtn=this.getChild("shareBtn").asButton,this._boxEff0=this.getChild("box0").asLoader,this._boxEff4=this.getChild("box4").asLoader,this._confirmBtn.addClickListener(this._onClickClose,this),Core.DeviceUtils.isWXGame()&&this._shareBtn.addClickListener(function(){WXGame.WXShareMgr.inst.wechatShowOffTreasure(t._niceCardName)},this),this._finishCallback=null},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,n,o,s,a,u,h,l,c,d,p,_,g,f,m,y,C,v,T,w,b,P,I,S,x,E,M,B,L,k,N;return __generator(this,function(D){switch(D.label){case 0:return e.prototype.open.apply(this,i),this._reward=i[0],this._treasure=i[1],this._finishCallback=i[2],r=this._treasure.getRareType(),this._boxEff0.url="treasure_"+r+"0_png",this._boxEff4.url="treasure_"+r+"4_png",[4,fairygui.GTimers.inst.waitTime(500)];case 1:return D.sent(),n=0,o=this._reward.gold,o>0?(s=fairygui.UIPackage.createObject(PkgName.treasure,"goldCnt",t.GoldRewardCom).asCom,s.count=o,this._resultList.addChild(s),[4,s.playTrans()]):[3,3];case 2:D.sent(),D.label=3;case 3:return a=this._reward.jade,a>0?(u=fairygui.UIPackage.createObject(PkgName.treasure,"jadeCnt",t.JadeRewardCom).asCom,u.count=a,this._resultList.addChild(u),[4,u.playTrans()]):[3,5];case 4:D.sent(),D.label=5;case 5:h=this._reward.cardIds.keys(),l=!1,c=0,d=h,D.label=6;case 6:return c<d.length?(p=d[c],_=this._reward.cardIds.getValue(p),g=CardPool.CardPoolMgr.inst.getCollectCard(p),g||(g=new CardPool.Card(CardPool.CardPoolMgr.inst.getCardData(p,1)),g.amount=_),f=fairygui.UIPackage.createObject(PkgName.treasure,"cardCnt",t.CardRewardCom).asCom,f.count=_,f.setCardObj(g),f.enableClick(!0),this._resultList.addChild(f),this._resultList.scrollToView(this._resultList.getChildIndex(f),!0),[4,f.playTrans()]):[3,9];case 7:D.sent(),g.rare>=CardQuality.NORMAL&&(l=!0,m=CardPool.CardPoolMgr.inst.getCardData(p,1),this._niceCardName=m.name),D.label=8;case 8:return c++,[3,6];case 9:for(y=this._reward.skinIds.keys(),C=function(t){var e=fairygui.UIPackage.createObject(PkgName.treasure,"skinCnt").asCom,i=e.getChild("card").asCom;Utils.setImageUrlPicture(i.getChild("cardImg").asImage,"skin_m_"+t+"_png"),i.getChild("nameText").asTextField.text=CardPool.CardSkinMgr.inst.getSkinConf(t).name,e.getChild("title").asTextField.text="x"+v._reward.skinIds.getValue(t),e.addClickListener(function(){var e=CardPool.CardPoolMgr.inst.getCollectCard(CardPool.CardSkinMgr.inst.getSkinConf(t).general);Core.ViewManager.inst.open(ViewName.skinView,e,t)},v),v._resultList.addChild(e)},v=this,T=0,w=y;T<w.length;T++)b=w[T],C(b);for(P=this._reward.emojiIds.keys(),I=0,S=P;I<S.length;I++)x=S[I],E=fairygui.UIPackage.createObject(PkgName.treasure,"emojiCnt").asCom,E.getChild("emoji").asCom.getChild("headFrame").asLoader.url=Reward.RewardMgr.inst.getRewardIcon(Reward.RewardType.T_EMOJI,null,x),E.getChild("title").asTextField.text="x"+this._reward.emojiIds.getValue(x),this._resultList.addChild(E);for(M=this._reward.headFrames.keys(),B=0,L=M;B<L.length;B++)k=L[B],N=fairygui.UIPackage.createObject(PkgName.treasure,"headFrameCnt").asCom,N.getChild("headFrame").asLoader.url=Reward.RewardMgr.inst.getRewardIcon(Reward.RewardType.T_HEAD_FRAME,null,k),N.getChild("title").asTextField.text="x"+this._reward.headFrames.getValue(k),this._resultList.addChild(N);return l&&Core.DeviceUtils.isWXGame()?(this._shareBtn.visible=!0,this._confirmBtn.setXY(255,705),this._confirmBtn.visible=!0):(this._shareBtn.visible=!1,this._confirmBtn.setXY(165,705),this._confirmBtn.visible=!0),console.log("reward result: ",this._reward),this._reward.shareId>0&&Core.DeviceUtils.isWXGame()&&Core.ViewManager.inst.open(ViewName.shareRewardTreasure,this._reward.shareId),[2]}})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){if(e.prototype.close.apply(this,t),this._resultList.removeChildren(),this._finishCallback){try{this._finishCallback()}catch(r){egret.log(r)}this._finishCallback=null}return[2]})})},i.prototype._onClickClose=function(){Core.ViewManager.inst.closeView(this);var t=Pvp.PvpMgr.inst.getPvpLevel();t>=5&&"true"!=egret.localStorage.getItem("showReview")&&(egret.localStorage.setItem("showReview","true"),console.log("OPEN_APP_COMMENT"),Core.NativeMsgCenter.inst.callNative(Core.NativeMessage.OPEN_APP_COMMENT))},i}(Core.BaseView);t.TreasureRewardResultView=e,__reflect(e.prototype,"Treasure.TreasureRewardResultView")}(Treasure||(Treasure={}));var Treasure;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.adjust(this.getChild("bg")),this._card=this.getChild("card").asCom,this._skin=this.getChild("skin").asCom,this._emoji=this.getChild("emoji").asCom,this._headFrame=this.getChild("headFrame").asCom,this._countText=this.getChild("cardCnt").asTextField,this._goldText=this.getChild("goldCnt").asTextField,this._levelText=this.getChild("level").asTextField,this._levelUpTips=this.getChild("levelTip").asTextField,this._expProgressBar=this.getChild("expProgressBar").asCom,this._expProgressText=this.getChild("progressCnt").asTextField,this._cardRemainText=this.getChild("cardRemaining").asTextField,this._boxEff0=this.getChild("box0").asLoader,this._boxEff1=this.getChild("box1").asLoader,this._boxEff2=this.getChild("box2").asLoader,this._boxEff3=this.getChild("box3").asLoader,this._boxEff4=this.getChild("box4").asLoader,this._rareLight=this.getChild("rareLight").asLoader,this._tranGold=this.getTransition("gold"),this._tranCard=this.getTransition("card"),this._tranNewCard=this.getTransition("newCard"),this._tranJade=this.getTransition("jade"),this._tranSkin=this.getTransition("skin"),this._tranEmoji=this.getTransition("emoji"),this._tranHeadFrame=this.getTransition("headFrame"),this._transPlaying=!1,this._expProgressBar.getChild("text").asTextField.text="",this._expProgressBar.getChild("head").asLoader.visible=!1,this._reward=null,this._finishCallback=null,this.addClickListener(this._playTransition,this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,t.prototype.open.apply(this,e)];case 1:return i.sent(),this._reward=e[0],this._treasure=e[1],this._finishCallback=e[2],this._refreshContent(),this._playTransition(),[2]}})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,t.prototype.close.apply(this,e)];case 1:return i.sent(),this._transPlaying=!1,this._finishCallback=null,[2]}})})},e.prototype._refreshContent=function(){this._cardIds=this._reward.cardIds.keys(),this._cardIds||(this._cardIds=[]),this._skinIds=this._reward.skinIds.keys(),this._skinIds||(this._skinIds=[]),this._emojiTeamIds=this._reward.emojiIds.keys(),this._emojiTeamIds||(this._emojiTeamIds=[]),this._headFrameIds=this._reward.headFrames.keys(),this._headFrameIds&&(this._headFrameIds=[]),this._gold=this._reward.gold,this._jade=this._reward.jade,this._cardRemainText.text=""+this._cardIds.length;var t=this._treasure.getRareType();this._boxEff0.url="treasure_"+t+"0_png",this._boxEff1.url="treasure_"+t+"1_png",this._boxEff2.url="treasure_"+t+"2_png",this._boxEff3.url="treasure_"+t+"3_png",this._boxEff4.url="treasure_"+t+"4_png"},e.prototype._setEmojiRewardInfo=function(){var t=this._emojiTeamIds[0],e=Reward.RewardMgr.inst.getRewardIcon(Reward.RewardType.T_EMOJI,null,t);this._emoji.visible=!0,this._emoji.getChild("headFrame").asLoader.url=e,this._emoji.alpha=1,this._countText.text="x"+this._reward.emojiIds.getValue(t),this._countText.color=16777215,this._levelUpTips.visible=!1,this._rareLight.visible=!1},e.prototype._setHeadFrameRewardInfo=function(){var t=this._headFrameIds[0],e=Reward.RewardMgr.inst.getRewardIcon(Reward.RewardType.T_HEAD_FRAME,null,t);this._headFrame.visible=!0,this._headFrame.getChild("headFrame").asLoader.url=e,this._headFrame.alpha=1,this._countText.text="x"+this._reward.headFrames.getValue(t),this._countText.color=16777215,this._levelUpTips.visible=!1,this._rareLight.visible=!1},e.prototype._setSkinRewardInfo=function(){var t=this._skinIds[0];this._reward.skinIds.getValue(t);this._skin.visible=!0,Utils.setImageUrlPicture(this._skin.getChild("cardImg").asImage,"skin_m_"+t+"_png"),this._skin.getChild("nameText").asTextField.text=CardPool.CardSkinMgr.inst.getSkinConf(t).name,this._skin.alpha=1,this._countText.text="x"+this._reward.skinIds.getValue(t),this._countText.color=16777215,this._levelUpTips.visible=!1,this._rareLight.visible=!1},e.prototype._setCardRewardInfo=function(){var t=this._cardIds[0];this._curCardId=t;var e=this._reward.cardIds.getValue(t),i=CardPool.CardPoolMgr.inst.getCollectCard(t);i||(i=new CardPool.Card(CardPool.CardPoolMgr.inst.getCardData(t,1)),i.amount=e),this.getChild("card").asCom.alpha=1,this.getChild("gold").asCom.alpha=0,this._card.cardObj=i,this._card.setDeskFront(),this._card.setDeskBackground(),this._card.setCardImg(),this._card.setEquip(),this._card.setNumText(),this._card.setNumOffsetText(),this._card.setName(),this._card.setQualityMode(!0),this._countText.text="x"+e,this._countText.color=16777215,this._goldText.visible=!1,this._levelText.visible=!0,this._levelText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60029),Core.StringUtils.getZhNumber(i.level)),this._curAmount=i.amount-e,this._toAmount=i.amount,this._curMaxAmount=i.maxAmount,this._levelUpTips.visible=!1,this._expProgressBar.visible=!0,this._expProgressText.visible=!0,this._curMaxAmount<=0?(this._expProgressText.text=this._curAmount+"/"+Core.StringUtils.TEXT(60030),this._expProgressBar.setProgress(100,100)):(this._expProgressText.text=this._curAmount+"/"+this._curMaxAmount,this._expProgressBar.setProgress(this._curAmount,this._curMaxAmount)),(i.amount==e&&1==i.level||this._curAmount>=this._curMaxAmount)&&(this._levelUpTips.visible=!0)},e.prototype._setGoldRewardInfo=function(){this._levelUpTips.visible=!1,this._levelText.visible=!1,this.getChild("card").asCom.alpha=0,this.getChild("jade").asCom.alpha=0,this.getChild("gold").asCom.alpha=1,this._curGold=Player.inst.getResource(ResType.T_GOLD)-this._gold,this._goldText.text=""+this._curGold,this._countText.text="x"+this._gold,this._countText.color=16776960,this._goldText.visible=!0,this._goldText.color=16776960,this._expProgressText.visible=!1,this._expProgressBar.setProgress(0,100),this._expProgressBar.visible=!1},e.prototype._setJadeRewardInfo=function(){this._levelUpTips.visible=!1,this._levelText.visible=!1,this.getChild("card").asCom.alpha=0,this.getChild("gold").asCom.alpha=0,this.getChild("jade").asCom.alpha=1,this._curJade=Player.inst.getResource(ResType.T_JADE)-this._jade,this._goldText.text=""+this._curJade,this._countText.text="x"+this._jade,this._countText.color=6750105,this._goldText.visible=!0,this._goldText.color=6750105,this._expProgressText.visible=!1,this._expProgressBar.setProgress(0,100),this._expProgressBar.visible=!1},e.prototype._onPlaySkinAniDone=function(){this.getChild("skin").asCom.visible=!0,this._transPlaying=!1},e.prototype._onPlayEmojiAniDone=function(){this._emoji.visible=!0,this._transPlaying=!1},e.prototype._onPlayHeadFrameAniDone=function(){this._headFrame.visible=!0,this._transPlaying=!1},e.prototype._onPlayCardAniDone=function(){this._curMaxAmount<=0?(this._expProgressText.text=this._toAmount+"/"+Core.StringUtils.TEXT(60030),this._expProgressBar.setProgress(100,100)):(this._expProgressText.text=this._toAmount+"/"+this._curMaxAmount,this._expProgressBar.setProgress(this._toAmount,this._curMaxAmount),this._toAmount>=this._curMaxAmount&&(this._levelUpTips.visible=!0)),this.getChild("card").asCom.visible=!0,this._transPlaying=!1,this._curCardId=null},e.prototype._onPlayGoldAniDone=function(){this._goldText.text=""+Player.inst.getResource(ResType.T_GOLD),this._goldText.color=16776960,this.getChild("gold").asCom.visible=!0,this._transPlaying=!1,this._gold=0},e.prototype._onPlayJadeAniDone=function(){this._goldText.text=""+Player.inst.getResource(ResType.T_JADE),this._goldText.color=6750105,this.getChild("jade").asCom.visible=!0,this._transPlaying=!1,this._jade=0},e.prototype._onPlayTransitionCompleted=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n=this;return __generator(this,function(o){switch(o.label){case 0:return this._gold>0?[4,new Promise(function(t){n._aniResolve=t;var e=n._gold,i=60,r=e/i;1>r&&(i=e,r=1),n._timeoutHdr=function(){n._curGold+=r,n._curGold>=Player.inst.getResource(ResType.T_GOLD)&&(n._curGold=Player.inst.getResource(ResType.T_GOLD),e=r),n._goldText.text=""+Math.ceil(n._curGold),e-=r,0>=e&&(n._aniResolve=null,n._timeoutHdr=null,n._onPlayGoldAniDone(),t())},fairygui.GTimers.inst.add(1,i,n._timeoutHdr,n)})]:[3,2];case 1:return o.sent(),[3,11];case 2:return this._jade>0?[4,new Promise(function(t){n._aniResolve=t;var e=n._jade,i=60,r=e/i;1>r&&(i=e,r=1),n._timeoutHdr=function(){n._curJade+=r,n._curJade>=Player.inst.getResource(ResType.T_GOLD)&&(n._curJade=Player.inst.getResource(ResType.T_GOLD),e=r),n._goldText.text=""+Math.ceil(n._curJade),e-=r,0>=e&&(n._aniResolve=null,n._timeoutHdr=null,n._onPlayJadeAniDone(),t())},fairygui.GTimers.inst.add(1,i,n._timeoutHdr,n)})]:[3,4];case 3:return o.sent(),[3,11];case 4:return this._curCardId?(t=this._curAmount,this._curAmount<this._curMaxAmount?(e=!1,[4,this._expProgressBar.doProgressAnimation(this._curAmount,this._toAmount,this._curMaxAmount,function(i){n._curMaxAmount<=0?n._expProgressText.text=Math.round(i)+"/"+Core.StringUtils.TEXT(60030):n._expProgressText.text=Math.round(i)+"/"+n._curMaxAmount,t=Math.round(i),t>=n._curMaxAmount&&(n._levelUpTips.visible=!0),t>=n._toAmount&&!e&&(e=!0,n._onPlayCardAniDone())})]):[3,6]):[3,9];case 5:o.sent(),o.label=6;case 6:return t<this._toAmount?(i=t,r=this._toAmount-i,[4,new Promise(function(t){n._aniResolve=t,n._timeoutHdr=function(){i+=1,r-=1,n._curMaxAmount<=0?n._expProgressText.text=i+"/"+Core.StringUtils.TEXT(60030):n._expProgressText.text=i+"/"+n._curMaxAmount,i>=n._curMaxAmount&&(n._levelUpTips.visible=!0),0>=r&&(n._aniResolve=null,n._onPlayCardAniDone(),t())},fairygui.GTimers.inst.add(1,r,n._timeoutHdr,n)})]):[3,8];case 7:o.sent(),o.label=8;case 8:return[3,11];case 9:return[4,new Promise(function(t){n._aniResolve=t;var e=1,i=60,r=e/i;1>r&&(i=e,r=1),n._timeoutHdr=function(){e-=r,0>=e&&(n._aniResolve=null,n._timeoutHdr=null,Function.apply(n._transPlayDone,n),t())},fairygui.GTimers.inst.add(1,i,n._timeoutHdr,n)})];case 10:o.sent(),o.label=11;case 11:return[2]}})})},e.prototype._playTransition=function(){if(this._transPlaying)return this._expProgressBar.stopProgressAnimation(),this._aniResolve&&(this._aniResolve(),this._aniResolve=null),this._tranGold.playing&&this._tranGold.stop(!0),this._tranCard.playing&&this._tranCard.stop(!0),this._tranNewCard.playing&&this._tranNewCard.stop(!0),this._tranJade.playing&&this._tranJade.stop(!0),this._tranSkin.playing&&this._tranSkin.stop(!0),this._tranEmoji.playing&&this._tranEmoji.stop(!0),this._tranHeadFrame.playing&&this._tranHeadFrame.stop(!0),this._timeoutHdr&&(fairygui.GTimers.inst.remove(this._timeoutHdr,this),this._timeoutHdr=null),void(this._gold>0?this._onPlayGoldAniDone():this._jade>0?this._onPlayJadeAniDone():this._curCardId?this._onPlayCardAniDone():this._onPlaySkinAniDone());if(this._transPlaying=!0,this._gold>0)this._setGoldRewardInfo(),this._tranGold.play(this._onPlayTransitionCompleted,this);else if(this._jade>0)this._setJadeRewardInfo(),this._tranJade.play(this._onPlayTransitionCompleted,this);else if(this._cardIds.length>0){this._setCardRewardInfo(),this._cardRemainText.text=""+(this._cardIds.length-1);var t=CardPool.CardPoolMgr.inst.getCollectCard(this._cardIds[0]),e=this._reward.cardIds.getValue(this._cardIds[0]);t.amount==e&&1==t.level?(this._levelUpTips.text=Core.StringUtils.TEXT(60065),this._tranNewCard.play(this._onPlayTransitionCompleted,this)):(this._levelUpTips.text=Core.StringUtils.TEXT(60056),this._tranCard.play(this._onPlayTransitionCompleted,this)),t.rare>=3?this._rareLight.visible=!0:this._rareLight.visible=!1,this._cardIds.splice(0,1)}else if(this._skinIds.length>0)this._setSkinRewardInfo(),this._transPlayDone=this._onPlaySkinAniDone,this._tranSkin.play(this._onPlayTransitionCompleted,this),this._skinIds.splice(0,1);else if(this._emojiTeamIds.length>0)this._setEmojiRewardInfo(),this._transPlayDone=this._onPlayEmojiAniDone,this._tranEmoji.play(this._onPlayTransitionCompleted,this),this._emojiTeamIds.splice(0,1);else{if(this._headFrameIds.length<=0)return Core.ViewManager.inst.open(ViewName.treasureRewardResult,this._reward,this._treasure,this._finishCallback),void Core.ViewManager.inst.closeView(this);this._setHeadFrameRewardInfo(),this._transPlayDone=this._onPlayHeadFrameAniDone,this._tranHeadFrame.play(this._onPlayTransitionCompleted,this),this._headFrameIds.splice(0,1)}},e}(Core.BaseView);t.TreasureRewardView=e,__reflect(e.prototype,"Treasure.TreasureRewardView")}(Treasure||(Treasure={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._nameText=this.getChild("nameText").asTextField,this._nameText.textParser=Core.StringUtils.parseColorText,this._headCom=this.getChild("lordHead").asCom,this._timeText=this.getChild("time").asTextField,this._goldCntText=this.getChild("goldCnt").asTextField,this._jobText=this.getChild("job").asRichTextField,this._jobText.textParser=Core.StringUtils.parseColorText,this._jobText.funcParser=Core.StringUtils.parseFuncText,this._headCom.addClickListener(this._onClick,this)},i.prototype.setInfo=function(e){this._player=new t.CampaignPlayer(e.Player),this._nameText.text=this._player.name,this._headCom.setAll(this._player.headImg,this._player.headFrame),this._goldCntText.text=e.Gold.toString(),this._timeText.text=Core.StringUtils.secToString(Math.floor(Date.now()/1e3)-e.Time,"dhm"),this._jobText.text=this._player.employee.doubleJobName(!0)},i.prototype._onClick=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,Social.FriendMgr.inst.fetchPlayerInfo(this._player.uID)];case 1:return t=e.sent(),t&&Core.ViewManager.inst.open(ViewName.friendInfo,this._player.uID,t),[2]}})})},i}(fairygui.GComponent);t.AddGoldRecordItem=e,__reflect(e.prototype,"War.AddGoldRecordItem");var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.initUI=function(){t.prototype.initUI.call(this),this.center(),this.modal=!0,this._emptyHintText=this.contentPane.getChild("emptyHintText").asTextField,this._playerList=this.contentPane.getChild("playerList").asList,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._playerList.itemClass=e,this._playerList._scrollPane.addEventListener(fairygui.ScrollPane.PULL_UP_RELEASE,this._getMorePlayer,this),this._closeBtn.addClickListener(this._onClose,this)},i.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){return t.prototype.open.call(this),this._cityID=e[0],i=e[1],this._emptyHintText.visible=0==i.Records.length,this._page=0,this._playerList.removeChildrenToPool(),this._refreshList(i.Records),[2]})})},i.prototype._refreshList=function(t){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(i){return t.length<=0?this._page=-1:this._page+=1,t.forEach(function(t){var i=e._playerList.addItemFromPool().asCom;i.setInfo(t)}),[2]})})},i.prototype._getMorePlayer=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(r){switch(r.label){case 0:return this._page<0?[2]:(t={CityID:this._cityID,Page:this._page},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_CITY_CAPITAL_INJECTION_HISTORY,pb.FetchCityCapitalInjectionArg.encode(t))]);case 1:return e=r.sent(),0==e.errcode&&(i=pb.CityCapitalInjectionHistory.decode(e.payload),this._refreshList(i.Records)),[2]}})})},i.prototype._onClose=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.closeView(this),[2]})})},i.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t.prototype.close.call(this),[2]})})},i}(Core.BaseWindow);t.AddGoldRecordPanel=i,__reflect(i.prototype,"War.AddGoldRecordPanel")}(War||(War={}));var War;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.center(),this.modal=!0,this._goldCom=this.contentPane.getChild("jinbi").asCom,this._goldInput=this.contentPane.getChild("goldInput").asTextField,this._goldMaxText=this.contentPane.getChild("goldMaxCnt").asTextField,this._confirmBtn=this.contentPane.getChild("confirmBtn").asButton,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._recordBtn=this.contentPane.getChild("recordBtn").asButton,this._goldCnt=this.contentPane.getChild("goldCnt").asSlider,this._goldCnt.getChild("title").visible=!1,this._closeBtn.addClickListener(this._onCloseBtn,this),this._confirmBtn.addClickListener(this._onConfirm,this),this._recordBtn.addClickListener(this._onRecordBtn,this),this._goldCnt.addEventListener(fairygui.StateChangeEvent.CHANGED,this._goldInputChange,this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.open.apply(this,e),this._city=e[0],this._refreshView(),[2]})})},e.prototype._refreshView=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._goldCom.setInfo(WarResType.Gold,this._city.gold),this._goldMaxText.text=""+Player.inst.getResource(ResType.T_GOLD),this._goldInput.text="",this._goldCnt.value=0,0==Player.inst.getResource(ResType.T_GOLD)?(this._goldCnt.grayed=!0,this._goldCnt.touchable=!1):(this._goldCnt.grayed=!1,this._goldCnt.touchable=!0,this._goldCnt.max=Player.inst.getResource(ResType.T_GOLD)),this._setConfirmBtn(!1),this._goldInputChange(),[2]})})},e.prototype._goldInputChange=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._goldInput.text=""+this._goldCnt.value,this._goldCom.setInfo(WarResType.Gold,this._city.gold+this._goldCnt.value),this._goldMaxText.text=""+(Player.inst.getResource(ResType.T_GOLD)-this._goldCnt.value),0==this._goldCnt.value?this._setConfirmBtn(!1):this._setConfirmBtn(!0),[2]})})},e.prototype._setConfirmBtn=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._confirmBtn.touchable=t,this._confirmBtn.grayed=!t,[2]})})},e.prototype._onConfirm=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t=this._goldInput.text,Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70218),t),this._onConfirmBtn,null,this),[2]})})},e.prototype._onConfirmBtn=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(r){switch(r.label){case 0:return t={CityID:this._city.cityID,Gold:parseInt(this._goldInput.text)},[4,Net.rpcCall(pb.MessageID.C2S_CITY_CAPITAL_INJECTION,pb.CityCapitalInjectionArg.encode(t))];case 1:return e=r.sent(),0==e.errcode&&(i=pb.CityCapitalInjectionReply.decode(e.payload),this._city.gold=i.CurGold,Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70219),this._goldInput.text)),this._refreshView()),[2]}})})},e.prototype._onRecordBtn=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(r){switch(r.label){case 0:return t={CityID:this._city.cityID,Page:0},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_CITY_CAPITAL_INJECTION_HISTORY,pb.FetchCityCapitalInjectionArg.encode(t))];case 1:return e=r.sent(),0==e.errcode&&(i=pb.CityCapitalInjectionHistory.decode(e.payload),Core.ViewManager.inst.open(ViewName.addGoldRecordPanel,this._city.cityID,i)),[2]}})})},e.prototype._onCloseBtn=function(){Core.ViewManager.inst.closeView(this)},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e}(Core.BaseWindow);t.AddGoldWnd=e,__reflect(e.prototype,"War.AddGoldWnd")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(i){var r=this;e.prototype.constructFromXML.call(this,i),this._countryIcon=this.getChild("flag").asLoader,this._campNameText=this.getChild("campName").asTextField,this._cityNameText=this.getChild("cityName").asTextField,this._cityGloryText=this.getChild("honor").asTextField,this._cityPlayerNumText=this.getChild("playerCnt").asTextField,this._goldCntText=this.getChild("goldCnt").asTextField,this._bounsCntText=this.getChild("bounsCnt").asTextField,this._cityNoticeBtn=this.getChild("noticeBtn").asButton,this._showComCtr=this.getController("showCom"),this._cityNoticeBtn.addClickListener(this._onNotice,this),this._cityGloryIcon=this.getChild("honorIcon").asLoader,this._cityPlayerNumIcon=this.getChild("playerCntIcon").asLoader,this.getChild("bg").asLoader.addClickListener(this._onCity,this),this._cityGloryIcon.addClickListener(function(){Core.ViewManager.inst.openPopup(ViewName.descTipsWnd,Utils.warResType2desc(WarResType.Glory))},this),this._cityPlayerNumIcon.addClickListener(function(){return __awaiter(r,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,t.WarMgr.inst.fetchInCityMember(this._cityID,0)];case 1:return e=i.sent(),e&&Core.ViewManager.inst.open(ViewName.allMemberPanel,this._cityID,e),[2]}})})},this)},i.prototype.setInfo=function(t,e){this._cityNameText.text=t.cityName,this._campNameText.text=e.countryName,this._cityPlayerNumText.text=t.playerNum.toString(),this._cityGloryText.text=(t.glory/10).toString()},i.prototype.setReplyData=function(e,i){this._cityID=e.CityID,this._cityNameText.text=t.CityMgr.inst.getCity(e.CityID).cityName,this._cityPlayerNumText.text=e.PlayerAmount.toString(),this._cityGloryText.text=(e.Glory/10).toString();var r=t.CityMgr.inst.getCity(this._cityID);if(0==r.countryID?e.MaxApplyCountryGold<=0?this._showComCtr.selectedPage="null":(this._showComCtr.selectedPage="apply",this._goldCntText.text=e.MaxApplyCountryGold.toString()):"bouns"==i&&e.AvgMissionReward>0?(this._showComCtr.selectedPage="reward",this._bounsCntText.text=e.AvgMissionReward.toString()):this._showComCtr.selectedPage="notice",r.countryID&&0!=r.countryID){var n=t.CountryMgr.inst.getCountry(r.countryID);this._campNameText.text=n.countryName,this._countryIcon.url=n.countryFlag}else this._countryIcon.url="war_flag0_png",this._campNameText.text=""},i.prototype._onNotice=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return e={CityID:this._cityID},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_CITY_NOTICE,pb.TargetCity.encode(e))];case 1:return i=o.sent(),0==i.errcode&&(r=pb.CityNotice.decode(i.payload).Notice,n=this._cityID==t.MyWarPlayer.inst.cityID&&t.MyWarPlayer.inst.employee.canNotice(),Core.ViewManager.inst.open(ViewName.cityNoticeWnd,r,n)),[2]
}})})},i.prototype._onCity=function(){t.WarMgr.inst.openCityInfo(this._cityID)},i}(fairygui.GComponent);t.AllCityItem=e,__reflect(e.prototype,"War.AllCityItem");var i=function(i){function r(){var t=null!==i&&i.apply(this,arguments)||this;return t._curFilterCond="",t}return __extends(r,i),r.prototype.initUI=function(){i.prototype.initUI.call(this),this.center(),this.modal=!0,this._cityList=this.contentPane.getChild("playerList").asList,this._cityList.itemClass=e,this._cityList.itemRenderer=this._renderCities,this._cityList.callbackThisObj=this,this._cityList.setVirtual(),this._filterCtrl=this.contentPane.getController("filter"),this._orderCityData=[],this._curFilterCond=this._filterCtrl.selectedPage,this.contentPane.getChild("countryChk").asButton.addClickListener(this._refresh,this),this.contentPane.getChild("honorChk").asButton.addClickListener(this._refresh,this),this.contentPane.getChild("memberChk").asButton.addClickListener(this._refresh,this),this.contentPane.getChild("bounsBtn").asButton.addClickListener(this._refresh,this),this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._closeBtn.addClickListener(this._onCloseBtn,this)},r.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(r){return i.prototype.open.apply(this,t),this._allCityData=t[0],this._allCityData.PlayerAmounts.forEach(function(t){e._orderCityData.push(t)}),this._sortCityData(),this._cityList.numItems=this._orderCityData.length,[2]})})},r.prototype._refresh=function(){this._curFilterCond!=this._filterCtrl.selectedPage&&(this._curFilterCond=this._filterCtrl.selectedPage,this._sortCityData(),this._cityList.numItems=0,this._cityList.numItems=this._orderCityData.length)},r.prototype._sortCityData=function(){var e=this;this._orderCityData=this._orderCityData.sort(function(i,r){var n=0,o=0,s=i.CityID,a=r.CityID,u=t.CityMgr.inst.getCity(s),h=t.CityMgr.inst.getCity(a);if("shili"==e._curFilterCond){if(n=u.countryID,o=h.countryID,0==o)return-1;if(0==n)return 1;var l=t.CountryMgr.inst.getCountry(n),c=t.CountryMgr.inst.getCountry(o);if(!c)return-1;if(!l)return 1;var d=l.cityList.size(),p=c.cityList.size();return d>p?-1:p>d?1:n!=o?n-o:r.PlayerAmount-i.PlayerAmount}return"rongyu"==e._curFilterCond?(n=i.Glory,o=r.Glory):"chengyuan"==e._curFilterCond?(n=i.PlayerAmount,o=r.PlayerAmount):"bouns"==e._curFilterCond&&(n=i.AvgMissionReward,o=r.AvgMissionReward),n>o?-1:o>n?1:s>a?-1:1})},r.prototype._renderCities=function(t,e){var i=this._orderCityData[t],r=e;r.setReplyData(i,this._curFilterCond)},r.prototype._onCloseBtn=function(){Core.ViewManager.inst.closeView(this)},r.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._cityList.numItems=0,this._orderCityData=[],i.prototype.close.apply(this,t),[2]})})},r}(Core.BaseWindow);t.AllCityPanel=i,__reflect(i.prototype,"War.AllCityPanel")}(War||(War={}));var War;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._headCom=this.getChild("lordHead").asCom,this._nameText=this.getChild("nameText").asTextField,this._nameText.textParser=Core.StringUtils.parseColorText,this._jobText=this.getChild("job").asRichTextField,this._jobText.textParser=Core.StringUtils.parseColorText,this._jobText.funcParser=Core.StringUtils.parseFuncText,this._delBtn=this.getChild("deleteBtn").asButton,this._isKickOutText=this.getChild("banTime").asTextField,this._rankText=this.getChild("rankTitleText").asTextField,this._rankIcon=this.getChild("rankImg").asLoader,this._battlePoint=this.getChild("battlePoint").asTextField,this._headCom.addClickListener(this._onDetail,this),this._delBtn.addClickListener(this._onDelBtn,this)},e.prototype.setInfo=function(t){this._info=t,this._nameText.text=t.name,this._headCom.setAll(t.headImg,t.headFrame),this._rankText.text=this._info.pvpLvTitle,this._rankIcon.url=this._info.pvpTeamIcon,t.employee.hasOfficialTitle()?this._jobText.text=t.employee.doubleJobName(!0):this._jobText.text=t.employee.doubleJobName(!0),this._info.kickOutTime>0?this._kickTime=this._info.kickOutTime-Date.now()/1e3:this._kickTime=0,this._battlePoint.text=this._info.contribution.toString(),this.refresh()},e.prototype.setDelBtn=function(t){this._delBtn.visible=t,this._kickTime>0&&(this._delBtn.visible=!1)},e.prototype.refresh=function(){this._kickTime>0?(this._isKickOutText.visible=!0,this._isKickOutText.text=Core.StringUtils.format(Core.StringUtils.TEXT(70220),Core.StringUtils.secToString(this._kickTime,"dhm")),this._delBtn.visible=!1):this._isKickOutText.visible=!1},e.prototype._onDetail=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,Social.FriendMgr.inst.fetchPlayerInfo(this._info.uID)];case 1:return t=e.sent(),t&&Core.ViewManager.inst.open(ViewName.friendInfo,this._info.uID,t),[2]}})})},e.prototype._onDelBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70221),this._info.name),this._onDel,null,this),[2]})})},e.prototype._onDel=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return t={Uid:this._info.uID},[4,Net.rpcCall(pb.MessageID.C2S_KICK_OUT_CITY_PLAYER,pb.CampaignTargetPlayer.encode(t))];case 1:return e=i.sent(),0==e.errcode&&(this._kickTime=86400,this.refresh()),[2]}})})},e}(fairygui.GComponent);t.MemberItem=e,__reflect(e.prototype,"War.MemberItem");var i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.initUI=function(){i.prototype.initUI.call(this),this.center(),this.modal=!0,this._hitText=this.contentPane.getChild("emptyHintText").asTextField,this._hitText2=this.contentPane.getChild("emptyHintText2").asTextField,this._hitText3=this.contentPane.getChild("emptyHintText3").asTextField,this._pageCtr=this.contentPane.getController("c1"),this._playerList=this.contentPane.getChild("playerList").asList,this._playerList.itemClass=e,this._playerList._scrollPane.addEventListener(fairygui.ScrollPane.PULL_UP_RELEASE,this._updatePlayers,this),this._helpList=this.contentPane.getChild("helpList").asList,this._helpList.itemClass=e,this._helpList._scrollPane.addEventListener(fairygui.ScrollPane.PULL_UP_RELEASE,this._updateHelps,this),this._captiveList=this.contentPane.getChild("captiveList").asList,this._captiveList.itemClass=e,this._captiveList._scrollPane.addEventListener(fairygui.ScrollPane.PULL_UP_RELEASE,this._updateCaptives,this),this._bounsBtn=this.contentPane.getChild("bounsBtn").asButton,this._countryChk=this.contentPane.getChild("countryChk").asButton,this._honorChk=this.contentPane.getChild("honorChk").asButton,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._closeBtn.addClickListener(this._onCloseBtn,this),this._bounsBtn.addClickListener(this._onHelpBtn,this),this._countryChk.addClickListener(this._onPlayerBtn,this),this._honorChk.addClickListener(this._onCaptiveBtn,this)},r.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(r){return i.prototype.open.apply(this,t),this._nowPage=0,this._helpPage=0,this._captivePage=0,this._pageCtr.selectedIndex=0,this._city=t[0],e=t[1],this._playerList.numItems>0&&this._playerList.scrollToView(0),this._hitText2.visible=!1,this._hitText3.visible=!1,this._playerList.removeChildrenToPool(),this._helpList.removeChildrenToPool(),this._captiveList.removeChildrenToPool(),e.Players.length<=0?this._hitText.visible=!0:(this._hitText.visible=!1,this._addPlayer(e)),[2]})})},r.prototype._addPlayer=function(e){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(r){return e.Players.length<=0?(0==this._nowPage&&(this._hitText.visible=!0),this._nowPage=-1,[2]):(this._nowPage+=1,e.Players.forEach(function(e){var r=i._playerList.addItemFromPool().asCom,n=new t.CampaignPlayer(e);r.setInfo(n),t.MyWarPlayer.inst.employee.canKickMember()&&0==e.CountryJob&&0==e.CityJob&&i._city.cityID==t.MyWarPlayer.inst.cityID?r.setDelBtn(!0):r.setDelBtn(!1)}),[2])})})},r.prototype._updatePlayers=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return this._nowPage<0?[2]:[4,t.WarMgr.inst.fetchCityMember(this._city.cityID,this._nowPage)];case 1:return e=i.sent(),e&&this._addPlayer(e),[2]}})})},r.prototype._onPlayerBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return 0!=this._nowPage?[2]:(this._updatePlayers(),[2])})})},r.prototype._onHelpBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return 0!=this._helpPage?[2]:(this._updateHelps(),[2])})})},r.prototype._updateHelps=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return this._helpPage<0?[2]:[4,t.WarMgr.inst.fetchInCityMember(this._city.cityID,this._helpPage)];case 1:return e=i.sent(),e&&this._addHelps(e),[2]}})})},r.prototype._addHelps=function(e){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(r){return e.Players.length<=0?(0==this._helpPage&&(this._hitText2.visible=!0),this._helpPage=-1,[2]):(this._helpPage+=1,e.Players.forEach(function(e){var r=i._helpList.addItemFromPool().asCom,n=new t.CampaignPlayer(e);r.setInfo(n),r.setDelBtn(!1)}),[2])})})},r.prototype._onCaptiveBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return 0!=this._captivePage?[2]:(this._updateCaptives(),[2])})})},r.prototype._updateCaptives=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return this._captivePage<0?[2]:[4,t.WarMgr.inst.fetchCityCaptives(this._city.cityID,this._captivePage)];case 1:return e=i.sent(),e&&this._addCaptives(e),[2]}})})},r.prototype._addCaptives=function(e){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(r){return e.Players.length<=0?(0==this._captivePage&&(this._hitText3.visible=!0),this._captivePage=-1,[2]):(this._captivePage+=1,e.Players.forEach(function(e){var r=i._captiveList.addItemFromPool().asCom,n=new t.CampaignPlayer(e);r.setInfo(n),r.setDelBtn(!1)}),[2])})})},r.prototype._onCloseBtn=function(){Core.ViewManager.inst.closeView(this)},r.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return i.prototype.close.apply(this,t),[2]})})},r}(Core.BaseWindow);t.AllMemberPanel=i,__reflect(i.prototype,"War.AllMemberPanel")}(War||(War={}));var War;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(t){this._typeCtr=this.getController("comType"),this._buttonCtr=this.getController("button"),this._headCom=this.getChild("lordHead").asCom,this._nameText=this.getChild("nameText").asTextField,this._nameText.textParser=Core.StringUtils.parseColorText,this._jobText=this.getChild("job").asRichTextField,this._jobText.textParser=Core.StringUtils.parseColorText,this._jobText.funcParser=Core.StringUtils.parseFuncText,this._rankTitleText=this.getChild("rankTitleText").asTextField,this._rankImg=this.getChild("rankImg").asLoader},e.prototype.setInfo=function(t){this._buttonCtr.selectedIndex=0,t?(this._playerInfo=t,this._typeCtr.selectedIndex=1,this._headCom.setAll(t.headImg,t.headFrame),this._nameText.text=t.name,this._jobText.text=t.employee.doubleJobName(!0),this._rankTitleText.text=t.pvpLvTitle,this._rankImg.url=t.pvpTeamIcon):(this._playerInfo=null,this._typeCtr.selectedIndex=0,this._headCom.setAll("",""),this._nameText.text="",this._jobText.text="")},Object.defineProperty(e.prototype,"player",{get:function(){return this._playerInfo},enumerable:!0,configurable:!0}),e}(fairygui.GButton);t.PlayerChooseItem=e,__reflect(e.prototype,"War.PlayerChooseItem");var i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.initUI=function(){i.prototype.initUI.call(this),this.center(),this.modal=!0,this._jobDesc=this.contentPane.getChild("jobText").asTextField,this._nowHeadCom=this.contentPane.getChild("nowPlayer").asCom,this._nowNameText=this.contentPane.getChild("nowPlayerName").asTextField,this._nowNameText.textParser=Core.StringUtils.parseColorText,this._newHeadCom=this.contentPane.getChild("newPlayer").asCom,this._newNameText=this.contentPane.getChild("newPlayerName").asTextField,this._newNameText.textParser=Core.StringUtils.parseColorText,this._confirmBtn=this.contentPane.getChild("confirmBtn").asButton,this._hintText=this.contentPane.getChild("emptyHintText").asTextField,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._playerList=this.contentPane.getChild("playerList").asList,this._playerList.itemClass=e,this._playerList.addEventListener(fairygui.ItemEvent.CLICK,this._onClickItem,this),this._playerList._scrollPane.addEventListener(fairygui.ScrollPane.PULL_UP_RELEASE,this._fetchMember,this),this._closeBtn.addClickListener(this._onCloseBtn,this),this._confirmBtn.addClickListener(this._onConfirmBtn,this)},r.prototype._onCloseBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._isKingDie=!1,Core.ViewManager.inst.closeView(this),[2]})})},r.prototype._onClickItem=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return this._setConfirmBtn(!0),e=t.itemObject.asCom,this._newPlayer=e.player,this._newPlayer?(this._newHeadCom.setAll(this._newPlayer.headImg,this._newPlayer.headFrame),this._newNameText.text=this._newPlayer.name,this._nowPlayer&&this._newPlayer.uID==this._nowPlayer.uID?this._setConfirmBtn(!1):this._setConfirmBtn(this._newPlayer.employee.canAppointToJob(this._job))):(this._newHeadCom.setAll("",""),this._newNameText.text=""),[2]})})},r.prototype._onConfirmBtn=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,r,r,r;return __generator(this,function(n){switch(n.label){case 0:return e=Utils.job2Type(this._job),this._isKingDie?(this._isKingDie=!1,Core.EventCenter.inst.dispatchEventWith(t.WarMgr.KingDie,!1,this._newPlayer.uID),Core.ViewManager.inst.closeView(this),[2]):this._newPlayer?(i=null,i=this._nowPlayer?this._nowPlayer.uID:0,e!=JobType.CityJob?[3,4]:[4,t.WarMgr.inst.appointJob(this._newPlayer.uID,this._job,i)]):[3,8];case 1:return r=n.sent(),r?[4,this._newPlayer.employee.setCityJob(this._job)]:[3,3];case 2:n.sent(),this._city.updatePlayer(this._newPlayer,i),Core.EventCenter.inst.dispatchEventWith(t.WarMgr.RefreshAppoint),this._onCloseBtn(),n.label=3;case 3:return[3,7];case 4:return e!=JobType.CountryJob?[3,7]:this._newPlayer.employee.hasSameJob(Job.YourMajesty)?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70222)),[2]):[4,t.WarMgr.inst.appointJob(this._newPlayer.uID,this._job,i)];case 5:return r=n.sent(),r?[4,this._newPlayer.employee.setCountryJob(this._job)]:[3,7];case 6:n.sent(),this._country.updatePlayer(this._newPlayer,i),Core.EventCenter.inst.dispatchEventWith(t.WarMgr.RefreshAppoint),this._onCloseBtn(),n.label=7;case 7:return[3,12];case 8:return e!=JobType.CityJob?[3,10]:[4,t.WarMgr.inst.recallJob(this._nowPlayer.uID,this._job)];case 9:return r=n.sent(),r&&(this._city.removePlayer(this._nowPlayer.uID),Core.EventCenter.inst.dispatchEventWith(t.WarMgr.RefreshAppoint),this._onCloseBtn()),[3,12];case 10:return e!=JobType.CountryJob?[3,12]:this._nowPlayer.employee.hasSameJob(Job.YourMajesty)?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70222)),[2]):[4,t.WarMgr.inst.recallJob(this._nowPlayer.uID,this._job)];case 11:r=n.sent(),r&&(this._country.removePlayer(this._nowPlayer.uID),Core.EventCenter.inst.dispatchEventWith(t.WarMgr.RefreshAppoint),this._onCloseBtn()),n.label=12;case 12:return[2]}})})},r.prototype._setConfirmBtn=function(t){this._confirmBtn.touchable=t,this._confirmBtn.grayed=!t},r.prototype.open=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return i.prototype.open.apply(this,e),this._job=e[1],this._jobType=Utils.job2Type(this._job),this._jobDesc.text=Utils.job2descText(this._job),this._jobType==JobType.CityJob?(this._city=t.CityMgr.inst.getCity(e[0]),this._country=t.CountryMgr.inst.getCountryForCityID(e[0])):this._jobType==JobType.CountryJob&&(this._country=t.CountryMgr.inst.getCountry(e[0])),this._nowPlayer=e[3],this._newHeadCom.setAll("",""),this._newNameText.text="",this._page=0,this._playerList.removeChildrenToPool(),this._hintText.visible=!0,this._setConfirmBtn(!1),this._refresh(),this._addPlayers(e[2]),[2]})})},r.prototype.setKingDie=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._isKingDie=t,[2]})})},r.prototype._refresh=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return this._nowPlayer?(this._nowHeadCom.setAll(this._nowPlayer.headImg,this._nowPlayer.headFrame),this._nowNameText.text=this._nowPlayer.name,this._job!=Job.YourMajesty&&(t=this._playerList.addItemFromPool().asButton,t.setInfo())):(this._nowHeadCom.setAll("",""),this._nowNameText.text=""),[2]})})},r.prototype._addPlayers=function(e){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(r){return e.Players.length<=0?(this._page=-1,[2]):(this._page+=1,this._hintText.visible=!1,e.Players.forEach(function(e){var r=new t.CampaignPlayer(e),n=i._playerList.addItemFromPool().asButton;n.setInfo(r)}),[2])})})},r.prototype._fetchMember=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return this._page<0?[2]:(e=null,this._jobType!=JobType.CityJob?[3,2]:[4,t.WarMgr.inst.fetchCityMember(this._city.cityID,this._page)]);case 1:return e=i.sent(),[3,4];case 2:return this._jobType!=JobType.CountryJob?[3,4]:[4,t.WarMgr.inst.fetchCountryMember(this._country.countryID,this._page)];case 3:e=i.sent(),i.label=4;case 4:return e&&this._addPlayers(e),[2]}})})},r.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return i.prototype.close.apply(this,t),[2]})})},r}(Core.BaseWindow);t.AppointChooseWnd=i,__reflect(i.prototype,"War.AppointChooseWnd")}(War||(War={}));var Core;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"inst",{get:function(){return e._inst||(e._inst=new e),e._inst},enumerable:!0,configurable:!0}),e}(egret.EventDispatcher);t.EventCenter=e,__reflect(e.prototype,"Core.EventCenter");var i=function(){function t(){}return t.CloseViewEvt="CloseViewEvt",t.OpenViewEvt="OpenViewEvt",t.ReLoginEv="ReLoginEv",t.AddTreasureEvt="AddTreasureEv",t.DelTreasureEvt="DelTreasureEv",t.UpdateTreasureEvt="UpdateTreasureEvt",t.UpdateDailyTreasureEvt="UpdateDailyTreasureEvt",t.HomeListChangedEvt="HomeListChangeEvt",t.CardHintNumChangeEv="CardHintNumChangeEv",t.LevelHintNumChangeEv="LevelHintNumChangeEv",t.AvatarHintNumChangeEv="AvatarHintNumChangeEv",t.ReConnectEv="ReConnectEv",t}();t.Event=i,__reflect(i.prototype,"Core.Event")}(Core||(Core={}));var War;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.campFlag2Url=function(t){return t&&""!=t?"":"war_flag1_png"},e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._createCtr=this.getController("create"),this._campName=this.getChild("campName").asTextField,this._campFlag=this.getChild("campFlag").asLoader,this._createCtr.selectedIndex=1},e.prototype.setCamp=function(t){t?(this._campName.text=t.countryName,""==t.countryFlag?this._campFlag.url="war_flag0_png":this._campFlag.url=t.countryFlag):(this._campName.text="",this._campFlag.url="war_flag0_png")},e.prototype.setCampName=function(t){this._campName.text=t},e.prototype.setCampFlag=function(t){this._campFlag.url=t},e.prototype.setChoose=function(t){t?this._createCtr.selectedIndex=1:this._createCtr.selectedIndex=0},e}(fairygui.GComponent);t.CampIconCom=e,__reflect(e.prototype,"War.CampIconCom")}(War||(War={}));var War;!function(t){var e=function(){function t(){}return t.getAllType=function(){return[t.T_CALVERY,t.T_BOAT,t.T_TROOPS]},t.T_CALVERY=0,t.T_BOAT=1,t.T_TROOPS=2,t}();t.CharType=e,__reflect(e.prototype,"War.CharType");var i=function(){function t(){}return t.getAllDirs=function(){return[t.UP,t.RIGHT_UP,t.RIGHT,t.RIGHT_DOWN,t.DOWN,t.LEFT_DOWN,t.LEFT,t.LEFT_UP]},t.getResSupportDirs=function(){return[t.UP,t.RIGHT_UP,t.RIGHT,t.RIGHT_DOWN,t.DOWN]},t.UP=0,t.RIGHT_UP=1,t.RIGHT=2,t.RIGHT_DOWN=3,t.DOWN=4,t.LEFT_DOWN=5,t.LEFT=6,t.LEFT_UP=7,t.MAX_DIR_NUM=8,t}();t.CharDir=i,__reflect(i.prototype,"War.CharDir");var r=function(){function r(t,e){this._parent=t,this._designedPath=new Array,this._x=0,this._y=0,this._speed=50,this._dir=i.RIGHT,this._isMoving=!1,this._dirty=!1,this._charType=-1,this._countryFlagCom=null,this._fightAni=null,this._dir=-1,this._curECEff=null,this._effId2ECEffect=new Collection.Dictionary,this._shootEff=Core.MCFactory.inst.getMovieClip("shoot","shoot"),this._shootEff.scaleX=.6,this._shootEff.scaleY=.6,this._shootEff.setPivot(0,this._shootEff.height/2,!0),this.updateCharType(e)}return r.prototype.updateAmount=function(t){this._amountText&&(t>0?this._amountText.text="x"+t:this._amountText.text="")},r.prototype.updateCharType=function(t){this._charType!=t&&(this._charType=t,this._charCom&&(this._destroyCharCom(),this._shootEff.parent&&this._shootEff.parent.removeChild(this._shootEff)),this._charCom=fairygui.UIPackage.createObject(PkgName.war,"troops").asCom,this._charCom.touchable=!1,this._dirCtrl=this._charCom.getController("dir"),this._attCtrl=this._charCom.getController("attacking"),this._countryFlagCom=this._charCom.getChild("flag").asCom,this._countryFlagCom.getChild("campName").y=this._countryFlagCom.getChild("campName").y-5,this._fightAni=this._charCom.getTransition("t0"),this._amountText=this._charCom.getChild("amount").asTextField,this._headCom=this._charCom.getChild("head").asCom,this._parent.addChild(this._charCom),this._charCom.addChild(this._shootEff),this._shootEff.x=this._charCom.width/2,this._shootEff.y=this._charCom.height/2,this._shootEff.visible=!1,this._shootEff.stop(),this._charType=t,this._dir>0&&(this._dirty=!0,this._curEff=null,this._curECEff=null,this._onDirChange()),console.log("char.updateCharType ",t))},r.prototype.updateCountry=function(t){this._countryFlagCom&&(this._countryFlagCom.setCamp(t),this._countryFlagCom.getChild("campName").asTextField.fontSize=12)},r.prototype.showMyHead=function(t){this._headCom.visible=t,t&&(this._headCom.setHead(Player.inst.avatarUrl),this._headCom.setFrame(Player.inst.frameUrl))},r.prototype._runTo=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r,n=this;return __generator(this,function(o){switch(o.label){case 0:return i=Math.sqrt(Math.pow(this._x-t,2)+Math.pow(this._y-e,2)),r=Math.ceil(i/this._speed),this.dir=this.calcDir({x:this._x,y:this._y},{x:t,y:e}),console.debug("runTo distance="+i+", time="+r),[4,new Promise(function(i){egret.Tween.get(n).to({x:t,y:e},r).call(function(){i()},n)})];case 1:return o.sent(),[2]}})})},r.prototype.calcDir=function(t,e){var r=t.x,n=t.y,o=e.x,s=e.y,a=Math.PI,u=(Math.atan2(s-n,o-r)+2*a)%(2*a);return u>=0&&a/8>u?i.RIGHT:u>=a/8&&3*a/8>u?i.RIGHT_DOWN:u>=3*a/8&&5*a/8>u?i.DOWN:u>=5*a/8&&7*a/8>u?i.LEFT_DOWN:u>=7*a/8&&9*a/8>u?i.LEFT:u>=9*a/8&&11*a/8>u?i.LEFT_UP:u>=11*a/8&&13*a/8>u?i.UP:u>=13*a/8&&15*a/8>u?i.RIGHT_UP:i.RIGHT},r.prototype.moveAlongPath=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this._designedPath.push(t),this._isMoving||(this._isMoving=!0),[4,this._doMoveAlongPath()];case 1:return e.sent(),[2]}})})},r.prototype._doMoveAlongPath=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r;return __generator(this,function(n){switch(n.label){case 0:if(t=this._designedPath[0],!t)return[3,6];this._designedPath.splice(0,1),e=0,i=t,n.label=1;case 1:return e<i.length?(r=i[e],[4,this._runTo(r.x,r.y)]):[3,4];case 2:n.sent(),n.label=3;case 3:return e++,[3,1];case 4:return[4,this._doMoveAlongPath()];case 5:n.sent(),n.label=6;case 6:return[2]}})})},Object.defineProperty(r.prototype,"isMoving",{get:function(){return this._isMoving},enumerable:!0,configurable:!0}),r.prototype.pause=function(){egret.Tween.pauseTweens(this)},r.prototype.resume=function(){egret.Tween.resumeTweens(this)},r.prototype.addToParent=function(t){this._parent&&this._charCom&&this._parent.removeChild(this._charCom),this._parent=t,this._parent&&this._charCom&&this._parent.addChild(this._charCom)},r.prototype.removeFromParent=function(){this._parent&&this._charCom&&this._parent.removeChild(this._charCom),this._parent=null},Object.defineProperty(r.prototype,"charCom",{get:function(){return this._charCom},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"speed",{set:function(t){this._speed=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._charCom&&(this._charCom.x=this._x)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._charCom&&(this._charCom.y=this._y)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"dir",{get:function(){return this._dir},set:function(t){this._isMoving?(fairygui.GTimers.inst.remove(this._doSetDir,this),fairygui.GTimers.inst.add(100,1,this._doSetDir,this,t)):this._doSetDir(t)},enumerable:!0,configurable:!0}),r.prototype._doSetDir=function(t){t!=this._dir&&(this._dirty=!0),this._dir=t,this._onDirChange()},r.prototype._getEffectIdPrefix=function(){return this._charType==e.T_BOAT?"boat":"troop"},r.prototype._onDirChange=function(){var t=this._dir;t>i.DOWN&&(t=i.MAX_DIR_NUM-t);var e=""+this._getEffectIdPrefix()+t;this._dirty&&(this._curECEff&&(this._curECEff.gotoAndStop(1),this._curECEff.visible=!1),this._effId2ECEffect.containsKey(e)?this._curECEff=this._effId2ECEffect.getValue(e):(this._curECEff=Core.MCFactory.inst.getMovieClip(e,e),this._effId2ECEffect.setValue(e,this._curECEff)),this._curECEff.touchable=!1,this._curECEff.visible=!0,this._curECEff?(this._curECEff.scaleX=.6,this._curECEff.scaleY=.6,this._curECEff.setPivot(this._curECEff.width/2,this._curECEff.height/2,!0),this._dir>i.DOWN?(this._curECEff.scaleX=-1*Math.abs(this._curECEff.scaleX),this._curECEff.x=this._curECEff.width*Math.abs(this._curECEff.scaleX)+this._charCom.width/2):(this._curECEff.scaleX=Math.abs(this._curECEff.scaleX),this._curECEff.x=this._charCom.width/2),this._curECEff.y=this._charCom.height/2,this._charCom.addChild(this._curECEff),this._curECEff.gotoAndPlay(1,-1)):console.log("can't find ec effect ",e),this._dirty=!1)},r.prototype._onDirChange2=function(){var t=this._dir;t>i.DOWN&&(t=i.MAX_DIR_NUM-t);var e=this._charCom.getChild(""+t).asMovieClip;(e!=this._curEff||this._dirty)&&(this._dirCtrl.setSelectedIndex(t),this._curEff=e,this._curEff&&(this._dir>i.DOWN?(this._curEff.scaleX=-1*Math.abs(this._curEff.scaleX),this._curEff.x=this._curEff.width*Math.abs(this._curEff.scaleX)):(this._curEff.scaleX=Math.abs(this._curEff.scaleX),this._curEff.x=0),this._curEff.y=0),this._dirty=!1)},r.prototype.setInAttCityMode=function(e,i){if(this._attCtrl)if(e){if(this._attCtrl.setSelectedIndex(1),i){var r=i.toCityID,n=t.CityMgr.inst.getCity(r);if(n&&this._shootEff){this._shootEff.visible=!0,this._shootEff.gotoAndPlay(1,-1);var o=n.cityPoint.x,s=n.cityPoint.y,a=this.x,u=this.y,h=(Math.atan2(s-u,o-a)+2*Math.PI)%(2*Math.PI);this._shootEff.rotation=h*(180/Math.PI)}}}else this._attCtrl.setSelectedIndex(0),this._shootEff.visible=!1,this._shootEff.gotoAndStop(1)},r.prototype.setInFightMode=function(t){this._attCtrl&&this._fightAni&&(t?(this._attCtrl.setSelectedIndex(2),this._fightAni.play(null,null,null,-1)):(this._attCtrl.setSelectedIndex(0),this._fightAni.stop()))},r.prototype._destroyCharCom=function(){this.removeFromParent(),this._charCom=null,this._curEff=null,this._curECEff&&(this._curECEff.stop(),this._curECEff=null),this._effId2ECEffect.forEach(function(t,e){e.stop(),Core.MCFactory.inst.revertMovieClip(e)}),this._effId2ECEffect.clear()},r.prototype.onDestroy=function(){fairygui.GTimers.inst.remove(this._doSetDir,this),egret.Tween.pauseTweens(this),this._destroyCharCom(),this._shootEff&&(Core.MCFactory.inst.revertMovieClip(this._shootEff),this._shootEff=null),this._designedPath=[]},r.roadType2CharType=function(i){return i==t.RoadType.LAND?e.T_TROOPS:e.T_BOAT},r}();t.Char=r,__reflect(r.prototype,"War.Char")}(War||(War={}));var War;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._cardObj=this.getChild("card").asCom,this._teamCtr=this.getController("team"),this._seletCtr=this.getController("select"),this._disableCtr=this.getController("disable")},e.prototype.setInfo=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._card=CardPool.CardPoolMgr.inst.getCollectCard(t),this._cardObj.displayObject.cacheAsBitmap=!1,this._cardObj.cardObj=this._card,this._cardObj.setNumText(),this._cardObj.setName(),this._cardObj.setSkill(),this._cardObj.setCardImg(),this._cardObj.setEquip(),this._cardObj.setNumText(),this._cardObj.setNumOffsetText(),this._cardObj.setOwnFront(),this._cardObj.setDeskBackground(),this._cardObj.touchable=!1,this._cardObj.displayObject.cacheAsBitmap=!0,[2]})})},e.prototype.setChoose=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t?this._seletCtr.selectedIndex=1:this._seletCtr.selectedIndex=0,[2]})})},e.prototype.setClick=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.touchable=t,t?this._disableCtr.selectedIndex=0:this._disableCtr.selectedIndex=1,[2]})})},e.prototype.setInTeam=function(t){t?this._teamCtr.selectedIndex=1:this._teamCtr.selectedIndex=0},e.prototype.watch=function(){this._cardObj.watch()},e.prototype.unwatch=function(){this._cardObj.unwatch()},Object.defineProperty(e.prototype,"cardID",{get:function(){return this._card.cardId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cardCamp",{get:function(){return this._card.camp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cardObj",{get:function(){return this._card},enumerable:!0,configurable:!0}),e}(fairygui.GComponent);t.WarChoiceFightCardItem=e,__reflect(e.prototype,"War.WarChoiceFightCardItem");var i="camp",r="cards",n=function(n){function o(){var t=null!==n&&n.apply(this,arguments)||this;return t._SAVE_KEY="warcards",t}return __extends(o,n),o.prototype.initUI=function(){n.prototype.initUI.call(this),this.modal=!0,this.center(),this.adjust(this.contentPane.getChild("bg"),Core.AdjustType.EXCEPT_MARGIN),this.contentPane.y+=window.support.topMargin,this._campCtr=this.contentPane.getController("country"),this._campLists=new Collection.Dictionary,this._weiList=this.contentPane.getChild("weiCardList").asList,this._weiList.itemClass=e,this._weiList.callbackThisObj=this,this._weiList.itemRenderer=this._renderCards,this._weiList.setVirtual(),this._weiList.addEventListener(fairygui.ItemEvent.CLICK,this._onClickCard,this),this._shuList=this.contentPane.getChild("shuCardList").asList,this._shuList.itemClass=e,this._shuList.callbackThisObj=this,this._shuList.itemRenderer=this._renderCards,this._shuList.setVirtual(),this._shuList.addEventListener(fairygui.ItemEvent.CLICK,this._onClickCard,this),this._wuList=this.contentPane.getChild("wuCardList").asList,this._wuList.itemClass=e,this._wuList.callbackThisObj=this,this._wuList.itemRenderer=this._renderCards,this._wuList.setVirtual(),this._wuList.addEventListener(fairygui.ItemEvent.CLICK,this._onClickCard,this),this._campLists.setValue(Camp.WEI,this._weiList),this._campLists.setValue(Camp.SHU,this._shuList),this._campLists.setValue(Camp.WU,this._wuList),this._weiTapBtn=this.contentPane.getChild("weiTapBtn").asButton,this._shuTapBtn=this.contentPane.getChild("shuTapBtn").asButton,this._wuTapBtn=this.contentPane.getChild("wuTapBtn").asButton,this._weiTapBtn.getChild("cardNumHint").visible=!1,this._shuTapBtn.getChild("cardNumHint").visible=!1,this._wuTapBtn.getChild("cardNumHint").visible=!1,this._confirmBtn=this.contentPane.getChild("confirmBtn").asButton,this._closeBtn=this.contentPane.getChild("backBtn").asButton,this._confirmBtn.addClickListener(this._onConfirmBtn,this),this._closeBtn.addClickListener(this._onCloseBtn,this),this._weiTapBtn.addClickListener(this._onSelectCamp,this),this._shuTapBtn.addClickListener(this._onSelectCamp,this),this._wuTapBtn.addClickListener(this._onSelectCamp,this)
},o.prototype._updateCardDic=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){return this._allCards=new Collection.Dictionary,t=CardPool.CardPoolMgr.inst.getHasCollectCardsByCamp(Camp.HEROS),e=CardPool.CardPoolMgr.inst.getHasCollectCardsByCamp(Camp.WEI),e=e.concat(t),this._allCards.setValue(Camp.WEI,e),e=CardPool.CardPoolMgr.inst.getHasCollectCardsByCamp(Camp.SHU),e=e.concat(t),this._allCards.setValue(Camp.SHU,e),e=CardPool.CardPoolMgr.inst.getHasCollectCardsByCamp(Camp.WU),e=e.concat(t),this._allCards.setValue(Camp.WU,e),this._allCards.forEach(function(t,e){e=e.sort(function(t,e){return!t.isInCampaignMission&&!e.isInCampaignMission||t.isInCampaignMission&&e.isInCampaignMission?t.camp<e.camp?-1:t.camp>e.camp?1:t.cardId<e.cardId?-1:1:t.isInCampaignMission?1:-1})}),[2]})})},o.prototype._renderCards=function(t,e){var i=this._allChooseCardDic.getValue(this._curCamp),r=this._allCards.getValue(this._curCamp),n=r[t],o=e;if(o.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onTouchItem,this),o.unwatch(),o.setInfo(n.cardId),o.watch(),n.isInCampaignMission){o.setInTeam(!0),o.setClick(!1),o.setChoose(!1);var s=i.indexOf(n.cardId);s>=0&&i.splice(s,1)}else o.setInTeam(!1),o.setClick(!0),-1!=i.indexOf(n.cardId)?o.setChoose(!0):o.setChoose(!1),5==i.length?-1!=i.indexOf(n.cardId)?(o.setChoose(!0),o.setClick(!0)):o.setChoose(!1):o.setClick(!0)},o.prototype._checkCards=function(){var t=this._allChooseCardDic.getValue(this._curCamp);if(t&&t.length>0){for(var e=t.length-1;e>=0;e--){var i=CardPool.CardPoolMgr.inst.getCollectCard(t[e]);i.isInCampaignMission?t.splice(e,1):i.amount<=0&&i.level<=1&&t.splice(e,1)}this._allChooseCardDic.setValue(this._curCamp,t)}},o.prototype._clearAllList=function(){this._campLists.forEach(function(t,e){e.numItems=0})},o.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){var e,o;return __generator(this,function(s){switch(s.label){case 0:return n.prototype.open.apply(this,t),this._weiChooseCards=new Array,this._shuChooseCards=new Array,this._wuChooseCards=new Array,this._allChooseCardDic=new Collection.Dictionary,this._allChooseCardDic.setValue(Camp.WEI,this._weiChooseCards),this._allChooseCardDic.setValue(Camp.SHU,this._shuChooseCards),this._allChooseCardDic.setValue(Camp.WU,this._wuChooseCards),this._clearAllList(),this._mission=t[0],[4,this._updateCardDic()];case 1:return s.sent(),e=""+Player.inst.uid,o=egret.localStorage.getItem(this._SAVE_KEY),o&&""!=o?(console.log(o),this._saveData=JSON.parse(o),this._saveData[e]?(this._curCamp=JSON.parse(this._saveData[e][i]),console.log(this._curCamp,JSON.parse(this._saveData[e][r])),this._allChooseCardDic.setValue(this._curCamp,JSON.parse(this._saveData[e][r])),this._campCtr.selectedIndex=this._curCamp-1,this._checkCards()):(this._saveData={},this._saveData[e]={},this._saveData[e][i]="",this._saveData[e][r]="",this._curCamp=Camp.WEI)):(this._saveData={},this._saveData[e]={},this._saveData[e][i]="",this._saveData[e][r]="",this._curCamp=Camp.WEI),this._onSelectCamp(),[2]}})})},o.prototype._onSelectCamp=function(){this._campLists.getValue(this._curCamp).numItems=0,"wei"==this._campCtr.selectedPage?this._curCamp=Camp.WEI:"shu"==this._campCtr.selectedPage?this._curCamp=Camp.SHU:"wu"==this._campCtr.selectedPage&&(this._curCamp=Camp.WU),this._campLists.getValue(this._curCamp).numItems=this._allCards.getValue(this._curCamp).length,this._campLists.getValue(this._curCamp).refreshVirtualList()},o.prototype._onTouchItem=function(t){var e=t.target;e.$touchBegin=!0;var i=fairygui.GRoot.mouseX,r=fairygui.GRoot.mouseY;fairygui.GTimers.inst.callDelay(600,function(){Math.abs(fairygui.GRoot.mouseX-i)>15||Math.abs(fairygui.GRoot.mouseY-r)>20||e.$touchBegin&&Core.ViewManager.inst.open(ViewName.cardInfo,e.cardObj.collectCard)},this)},o.prototype._onClickCard=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){if(e=this._allChooseCardDic.getValue(this._curCamp),i=t.itemObject,i.$touchBegin=null,Core.ViewManager.inst.getView(ViewName.cardInfo)&&Core.ViewManager.inst.getView(ViewName.cardInfo).isShow())return[2];if(r=e.indexOf(i.cardID),-1!=r)e.splice(r,1),i.setChoose(!1);else{if(5==e.length)return[2];e.push(i.cardID),i.setChoose(!0)}return this._campLists.getValue(this._curCamp).refreshVirtualList(),[2]})})},o.prototype._refreshCamp=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},o.prototype._onConfirmBtn=function(){return __awaiter(this,void 0,void 0,function(){var e,n,o,s;return __generator(this,function(a){switch(a.label){case 0:return e=this._allChooseCardDic.getValue(this._curCamp),e.length<5?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(60142)),[2]):[4,t.WarMgr.inst.acceptMilitaryOrder(this._mission.Type,e,this._mission.TargetCity)];case 1:return n=a.sent(),n&&(o=""+Player.inst.uid,this._saveData[o][i]=JSON.stringify(this._curCamp),this._saveData[o][r]=JSON.stringify(e),s=JSON.stringify(this._saveData),egret.localStorage.setItem(this._SAVE_KEY,s),Core.ViewManager.inst.close(ViewName.questFightPanel),Core.ViewManager.inst.closeView(this)),[2]}})})},o.prototype._onCloseBtn=function(){Core.ViewManager.inst.closeView(this)},o.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return n.prototype.close.apply(this,t),this._clearAllList(),this._allCards.clear(),[2]})})},o}(Core.BaseWindow);t.ChoiceFightCardWnd=n,__reflect(n.prototype,"War.ChoiceFightCardWnd")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(e){var i=this;this._comCtr=this.getController("c1"),this._emperorHeadCom=this.getChild("emperorHead").asCom,this._emperorNameText=this.getChild("emperorName").asTextField,this._emperorNameText.textParser=Core.StringUtils.parseColorText,this._offBtn=this.getChild("offBtn").asButton,this._tip=this.getChild("tip").asTextField,this._battlePointIcon=this.getChild("battlePointIcon").asLoader,this._goldIcon=this.getChild("goldIcon").asLoader,this.getChild("n3").asLoader.addClickListener(this._setJob,this),this._emperorHeadCom.addClickListener(this._setJob,this),this._offBtn.addClickListener(this._onOffBtn,this),this._battlePointIcon.addClickListener(function(){Core.ViewManager.inst.openPopup(ViewName.descTipsWnd,t.Const.job2BattleRwdDesc(i._job))},this),this._goldIcon.addClickListener(function(){Core.ViewManager.inst.openPopup(ViewName.descTipsWnd,t.Const.job2GoldRwdDesc(i._job))},this)},i.prototype.setCurJob=function(t){this._job=t,this._jobType=Utils.job2Type(t),this._job==Job.UnknowJob?(this._battlePointIcon.visible=!1,this._goldIcon.visible=!1):(this._battlePointIcon.visible=!0,this._goldIcon.visible=!0)},i.prototype.setPlayer=function(t){this._nowPlayer=t,this._comCtr.selectedIndex=1,this._emperorHeadCom.setAll(t.headImg,t.headFrame),this._emperorNameText.text=t.name,t.uID==Player.inst.uid&&this._job!=Job.YourMajesty?this._offBtn.visible=!0:this._offBtn.visible=!1},i.prototype.refreshCom=function(e){this._cityID=e,this._city=t.CityMgr.inst.getCity(e),this._nowPlayer=null,this._comCtr.selectedIndex=0,this._offBtn.visible=!1,this._emperorHeadCom.setAll("",""),this._emperorNameText.text="",this._job==Job.Prefect?t.MyWarPlayer.inst.employee.hasSameJob(Job.YourMajesty)?this._tip.text=Core.StringUtils.TEXT(70223):this._tip.text=Core.StringUtils.TEXT(70224):t.MyWarPlayer.inst.isMyCity(this._city.cityID)&&t.MyWarPlayer.inst.employee.hasSameJob(Job.Prefect)?this._tip.text=Core.StringUtils.TEXT(70223):this._tip.text=Core.StringUtils.TEXT(70225)},i.prototype.refeshCampCom=function(e){this._cityID=0,this._country=e,this._nowPlayer=null,this._comCtr.selectedIndex=0,this._offBtn.visible=!1,this._emperorHeadCom.setAll("",""),this._emperorNameText.text="",t.MyWarPlayer.inst.employee.hasSameJob(Job.YourMajesty)?this._tip.text=Core.StringUtils.TEXT(70223):this._tip.text=Core.StringUtils.TEXT(70224)},i.prototype.canSetPlayer=function(){return 0==this._comCtr.selectedIndex},i.prototype._setJob=function(){return __awaiter(this,void 0,void 0,function(){var e,i,e;return __generator(this,function(r){switch(r.label){case 0:return this._jobType==JobType.CountryJob&&t.MyWarPlayer.inst.employee.hasSameJob(Job.YourMajesty)?[4,t.WarMgr.inst.fetchCountryMember(t.MyWarPlayer.inst.countryID,0)]:[3,2];case 1:return e=r.sent(),e&&Core.ViewManager.inst.open(ViewName.appointChooseWnd,t.MyWarPlayer.inst.countryID,this._job,e,this._nowPlayer),[3,4];case 2:return this._jobType!=JobType.CityJob?[3,4]:(i=!1,this._job==Job.Prefect&&t.MyWarPlayer.inst.employee.canSetPrefect()?i=!0:this._job!=Job.Prefect&&t.MyWarPlayer.inst.employee.canSetOtherCityJob()&&t.MyWarPlayer.inst.isMyCity(this._city.cityID)&&(i=!0),i?[4,t.WarMgr.inst.fetchCityMember(this._cityID,0)]:[3,4]);case 3:e=r.sent(),e&&Core.ViewManager.inst.open(ViewName.appointChooseWnd,this._cityID,this._job,e,this._nowPlayer),r.label=4;case 4:return[2]}})})},i.prototype._onOffBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70226),Utils.job2Text(this._job,!0)),this._onOffJob,null,this),[2]})})},i.prototype._onOffJob=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return e=Utils.job2Type(this._job),[4,t.WarMgr.inst.recallJob(Player.inst.uid,this._job)];case 1:return i=r.sent(),i&&(e==JobType.CityJob?this._city.removePlayer(Player.inst.uid):e==JobType.CountryJob&&this._country.removePlayer(Player.inst.uid),Core.EventCenter.inst.dispatchEventWith(t.WarMgr.RefreshAppoint)),[2]}})})},i}(fairygui.GComponent);t.CityJobItem=e,__reflect(e.prototype,"War.CityJobItem");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._comList=new Array,this._adjutantList=new Array,this._captainList=new Array,this._lordCom=this.getChild("lord").asCom,this._lordCom.setCurJob(Job.Prefect),this._adjutantCom1=this.getChild("adjutant1").asCom,this._adjutantCom2=this.getChild("adjutant2").asCom,this._adjutantCom1.setCurJob(Job.DuWei),this._adjutantCom2.setCurJob(Job.DuWei),this._adjutantList.push(this._adjutantCom1,this._adjutantCom2),this._captainCom1=this.getChild("captain1").asCom,this._captainCom2=this.getChild("captain2").asCom,this._captainCom3=this.getChild("captain3").asCom,this._captainCom4=this.getChild("captain4").asCom,this._captainCom5=this.getChild("captain5").asCom,this._captainCom1.setCurJob(Job.FieldOfficer),this._captainCom2.setCurJob(Job.FieldOfficer),this._captainCom3.setCurJob(Job.FieldOfficer),this._captainCom4.setCurJob(Job.FieldOfficer),this._captainCom5.setCurJob(Job.FieldOfficer),this._captainList.push(this._captainCom1,this._captainCom2,this._captainCom3,this._captainCom4,this._captainCom5),this._comList.push(this._lordCom),this._comList=this._comList.concat(this._adjutantList,this._captainList)},i.prototype.refreshCityJob=function(e){return __awaiter(this,void 0,void 0,function(){var i,r=this;return __generator(this,function(n){return this._comList.forEach(function(t){t.refreshCom(e)}),this._city=t.CityMgr.inst.getCity(e),i=this._city.players,i.forEach(function(t){r._setCityPlayer(t)}),[2]})})},i.prototype._setCityPlayer=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,e,i;return __generator(this,function(r){if(t.employee.hasSameJob(Job.Prefect))this._lordCom.setPlayer(t);else if(t.employee.hasSameJob(Job.DuWei)){for(e=0;e<this._adjutantList.length;e++)if(i=this._adjutantList[e],i.canSetPlayer())return i.setPlayer(t),[2]}else if(t.employee.hasSameJob(Job.FieldOfficer))for(e=0;e<this._captainList.length;e++)if(i=this._captainList[e],i.canSetPlayer())return i.setPlayer(t),[2];return[2]})})},i}(fairygui.GComponent);t.CityAppointCom=i,__reflect(i.prototype,"War.CityAppointCom")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.center(),this.modal=!0,this._appointCom=this.contentPane.getChild("n1").asCom,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._surrenderBtn=this.contentPane.getChild("surrenderBtn").asButton,this._quitBtn=this.contentPane.getChild("quitBtn").asButton,this._indeBtn=this.contentPane.getChild("indeBtn").asButton,this._closeBtn.addClickListener(this._onClose,this),this._quitBtn.addClickListener(this._onQuit,this),this._surrenderBtn.addClickListener(this._onSurrenderBtn,this),this._indeBtn.addClickListener(this._onAutocephalyBtn,this)},i.prototype._onClose=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.closeView(this),[2]})})},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return e.prototype.open.apply(this,i),this._city=t.CityMgr.inst.getCity(i[0]),Core.EventCenter.inst.addEventListener(t.WarMgr.RefreshAppoint,this._refreshJob,this),this.refreshWnd(),this._refreshJob(),[2]})})},i.prototype._watch=function(){},i.prototype._updateIndeBtn=function(){t.MyWarPlayer.inst.isMyCity(this._city.cityID)&&t.MyWarPlayer.inst.employee.canAutocephaly()?(this._indeBtn.touchable=!0,this._indeBtn.grayed=!1):(this._indeBtn.touchable=!0,this._indeBtn.grayed=!0)},i.prototype._updateSurrenderBtn=function(){t.MyWarPlayer.inst.isMyCity(this._city.cityID)&&t.MyWarPlayer.inst.employee.canSurrender()?(this._surrenderBtn.touchable=!0,this._surrenderBtn.grayed=!1):(this._surrenderBtn.touchable=!0,this._surrenderBtn.grayed=!0)},i.prototype.refreshWnd=function(){this._city.cityID==t.MyWarPlayer.inst.cityID&&0!=this._city.countryID?this._quitBtn.visible=!0:this._quitBtn.visible=!1,this._updateSurrenderBtn(),this._updateIndeBtn()},i.prototype._refreshJob=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._appointCom.refreshCityJob(this._city.cityID),[2]})})},i.prototype.close=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return Core.EventCenter.inst.removeEventListener(t.WarMgr.SelectCity,this._selectCity,this),Core.EventCenter.inst.removeEventListener(t.WarMgr.RefreshAppoint,this._refreshJob,this),e.prototype.close.apply(this,i),[2]})})},i.prototype._onSurrenderBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t.MyWarPlayer.inst.isMyCity(this._city.cityID)&&t.MyWarPlayer.inst.employee.canSurrender()?t.WarMgr.inst.inStatus(t.BattleStatusName.ST_DURING)||t.WarMgr.inst.inStatus(t.BattleStatusName.ST_PREPARE)?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70254))),[2]):(t.WarMgr.inst.joinSelectCityMode(!0,t.MapState.SurrenderCity),Core.EventCenter.inst.addEventListener(t.WarMgr.SelectCity,this._selectCity,this),[2]):(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70227))),[2])})})},i.prototype._selectCity=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a=this;return __generator(this,function(u){if(i=e.data){if(r=t.CityMgr.inst.getCity(i),0==r.countryID)return Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70255))),[2];n=t.CountryMgr.inst.getCountry(r.countryID),o=.2,s=t.MyWarPlayer.inst.getOffContribution(o),Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70228),this._city.cityName,n.countryName,s),function(){a._onSurrender(r.countryID)},null,this)}else t.WarMgr.inst.joinSelectCityMode(!1,t.MapState.SurrenderCity),Core.EventCenter.inst.removeEventListener(t.WarMgr.SelectCity,this._selectCity,this);return[2]})})},i.prototype._onSurrender=function(e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return t.WarMgr.inst.joinSelectCityMode(!1,t.MapState.SurrenderCity),Core.EventCenter.inst.removeEventListener(t.WarMgr.SelectCity,this._selectCity,this),t.WarMgr.inst.inStatus(t.BattleStatusName.ST_DURING)||t.WarMgr.inst.inStatus(t.BattleStatusName.ST_PREPARE)?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70254))),[2]):[4,t.WarMgr.inst.surrenderCity(e)];case 1:return i=r.sent(),i&&Core.ViewManager.inst.closeView(this),[2]}})})},i.prototype._onAutocephalyBtn=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n=this;return __generator(this,function(o){return t.MyWarPlayer.inst.isMyCity(this._city.cityID)&&t.MyWarPlayer.inst.employee.canSurrender()?t.WarMgr.inst.inStatus(t.BattleStatusName.ST_DURING)||t.WarMgr.inst.inStatus(t.BattleStatusName.ST_PREPARE)?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70254))),[2]):(e=t.CountryMgr.inst.getCountry(this._city.countryID),e&&(i=.2,r=t.MyWarPlayer.inst.getOffContribution(i),Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70367),e.countryName,100*i,r),function(){n._onAutocephaly()},null,this)),[2]):(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70227))),[2])})})},i.prototype._onAutocephaly=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,t.WarMgr.inst.autocephaly()];case 1:return e=i.sent(),e&&Core.ViewManager.inst.closeView(this),[2]}})})},i.prototype._onQuit=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){return t.MyWarPlayer.inst.lastCountryID>0?Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70229)),this._quit,null,this):(e=.1,i=t.MyWarPlayer.inst.getOffContribution(e),Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70230),this._city.cityName,100*e,i),this._quit,null,this)),[2]})})},i.prototype._quit=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){switch(o.label){case 0:return t.WarMgr.inst.inStatus(t.BattleStatusName.ST_DURING)||t.WarMgr.inst.inStatus(t.BattleStatusName.ST_PREPARE)?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70372)),Core.EventCenter.inst.removeEventListener(t.WarMgr.KingDie,this._quit,this),[2]):(i=null,e?[4,t.WarMgr.inst.quitCountry(e.data)]:[3,2]);case 1:return i=o.sent(),Core.EventCenter.inst.removeEventListener(t.WarMgr.KingDie,this._quit,this),[3,9];case 2:return t.MyWarPlayer.inst.employee.hasSameJob(Job.YourMajesty)?[4,t.WarMgr.inst.fetchCountryMember(this._city.countryID,0)]:[3,7];case 3:return r=o.sent(),r&&r.Players.length>1?(Core.EventCenter.inst.hasEventListener(t.WarMgr.KingDie)&&Core.EventCenter.inst.removeEventListener(t.WarMgr.KingDie,this._quit,this),Core.EventCenter.inst.addEventListener(t.WarMgr.KingDie,this._quit,this),Core.ViewManager.inst.open(ViewName.appointChooseWnd,this._city.countryID,Job.YourMajesty,r),n=Core.ViewManager.inst.getView(ViewName.appointChooseWnd),n.setKingDie(!0),[3,6]):[3,4];case 4:return[4,t.WarMgr.inst.quitCountry(0)];case 5:i=o.sent(),o.label=6;case 6:return[3,9];case 7:return[4,t.WarMgr.inst.quitCountry(0)];case 8:i=o.sent(),o.label=9;case 9:return i&&(Core.ViewManager.inst.closeView(this),Core.ViewManager.inst.close(ViewName.cityInfoPanel),t.MyWarPlayer.inst.countryID=0,t.WarMgr.inst.warView.updateHomeTip(),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70231),this._city.cityName)),Core.EventCenter.inst.dispatchEventWith(t.WarMgr.RefreshCityInfo)),[2]}})})},i}(Core.BaseWindow);t.CityAppointWnd=e,__reflect(e.prototype,"War.CityAppointWnd")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){this._titleText=this.getChild("title").asTextField,this._stopBtn=this.getChild("stopBtn").asButton,this._newBtn=this.getChild("newBtn").asButton,this._cntText=this.getChild("Budget").asTextField,this._progressBar=this.getChild("progress").asCom,this._bg=this.getChild("bg").asLoader,this._textImg=this.getChild("textImg").asLoader,this._newBtn.addClickListener(this._onNewBtn,this),this._stopBtn.addClickListener(this._onStopBtn,this)},i.prototype.setCom=function(t,e){this._msType=t,this._city=e,this._clearCom()},i.prototype._clearCom=function(){this._titleText.text=Utils.warMsType2text(this._msType),this._progressBar.setIconUrl(Utils.warMsType2Url(this._msType)),this._bg.url=Utils.warMsBgType2Url(this._msType).toString(),this._textImg.url=Utils.warMsTextType2Url(this._msType).toString();var t=this._city.getMsRes(this._msType),e=this._city.getMsResMax(this._msType);this._progressBar.setProgress(t,e),this._progressBar.setProgress2(t,e),this._cntText.text="",this._newBtn.text="发布任务",this.getChild("n75").asTextField.visible=!1,this._stopBtn.visible=!1},i.prototype.setMission=function(e){if(this._mission=e,this._cntText.text=e.MaxAmount-e.Amount+"/"+e.MaxAmount,this.getChild("n75").asTextField.visible=!0,e.Type==pb.CampaignMsType.Transport)this._msType=WarMsType.Transport,this._bg.url=Utils.warMsBgType2Url(this._msType).toString(),this._titleText.text=Core.StringUtils.format(Core.StringUtils.TEXT(70232),Utils.warTranType2text(e.TransportType),t.CityMgr.inst.getCity(e.TransportTargetCity).cityName),this._textImg.visible=!1,this._newBtn.visible=!1,this._stopBtn.visible=!0,e.TransportType==pb.TransportTypeEnum.ForageTT?this._progressBar.setIconUrl(Utils.warResType2Url(WarResType.Forage)):e.TransportType==pb.TransportTypeEnum.GoldTT&&this._progressBar.setIconUrl(Utils.warResType2Url(WarResType.Gold)),this._progressBar.setProgress(e.MaxAmount-e.Amount,e.MaxAmount),this._progressBar.setProgress2(e.MaxAmount-e.Amount,e.MaxAmount);else if(e.Type==pb.CampaignMsType.Dispatch)this._msType=WarMsType.Transport,this._bg.url=Utils.warMsBgType2Url(this._msType).toString(),this._titleText.text=Core.StringUtils.format(Core.StringUtils.TEXT(70233),t.CityMgr.inst.getCity(e.TransportTargetCity).cityName),this._textImg.visible=!1,this._newBtn.visible=!1,this._stopBtn.visible=!0,this._progressBar.setProgress(e.MaxAmount-e.Amount,e.MaxAmount),this._progressBar.setProgress2(e.MaxAmount-e.Amount,e.MaxAmount);else{var i=this._city.getMsRes(this._msType),r=this._city.getMsResMax(this._msType);this._bg.url=Utils.warMsBgType2Url(this._msType).toString(),this._textImg.visible=!0,this._textImg.url=Utils.warMsTextType2Url(this._msType).toString(),this._progressBar.setProgress(i,r),this._progressBar.setProgress2(i+e.Amount*t.WarQuest.warMsType2reward(this._msType),r),this._newBtn.text=Core.StringUtils.TEXT(70234),this._newBtn.visible=!(i==r),e.Amount>0?this._stopBtn.visible=!0:this._stopBtn.visible=!1}},i.prototype._onNewBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.open(ViewName.questReleaseWnd,this._msType,this._city,this._mission),[2]})})},i.prototype._onStopBtn=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(r){switch(r.label){case 0:return t={Type:this._mission.Type,TransportTargetCity:this._mission.TransportTargetCity},[4,Net.rpcCall(pb.MessageID.C2S_CANCEL_PUBLISH_MISSION,pb.CancelPublishMissionArg.encode(t))];case 1:return e=r.sent(),0==e.errcode&&(i=pb.CancelPublishMissionReply.decode(e.payload),this._msType!=WarMsType.Transport?this._clearCom():this.visible=!1,this._city.gold=i.Gold,this._city.forage=i.Forage),[2]}})})},i}(fairygui.GComponent);t.CityBuildItem=e,__reflect(e.prototype,"War.CityBuildItem");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._buildList=this.getChild("buildList").asList,this._buildList.foldInvisibleItems=!0,this._transportComList=new Array,this._irrigationCom=this._buildList.getChild("Irrigation").asCom,this._tradeCom=this._buildList.getChild("Trade").asCom,this._buildCom=this._buildList.getChild("Build").asCom,this._transportMgrBtn=this._buildList.getChild("Transport").asButton,this._migrateBtn=this._buildList.getChild("migrate").asButton,this._migrateBtn.addClickListener(this._onMigrateBtn,this),this._transportMgrBtn.addClickListener(this._onTransportBtn,this)},i.prototype._resCom=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._irrigationCom.setCom(WarMsType.Irrigation,this._city),this._tradeCom.setCom(WarMsType.Trade,this._city),this._buildCom.setCom(WarMsType.Build,this._city),this._transportComList.forEach(function(t){t.visible=!1}),[2]})})},i.prototype.refreshMission=function(t,e){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(r){return e&&(this._city=e),this._resCom(),t.Missions.forEach(function(t){t.Type==pb.CampaignMsType.Irrigation?i._irrigationCom.setMission(t):t.Type==pb.CampaignMsType.Trade?i._tradeCom.setMission(t):t.Type==pb.CampaignMsType.Build?i._buildCom.setMission(t):t.Type==pb.CampaignMsType.Transport?i._setTransportMission(t):t.Type==pb.CampaignMsType.Dispatch&&i._setTransportMission(t)}),[2]})})},i.prototype._setTransportMission=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){for(e=0;e<this._transportComList.length;e++)if(i=this._transportComList[e],0==i.visible)return i.visible=!0,i.setCom(WarMsType.Transport,this._city),i.setMission(t),this._buildList.setChildIndex(i,this._buildList.numItems-3),[2];return r=fairygui.UIPackage.createObject(PkgName.war,"cityBuildItem").asCom,r.setCom(WarMsType.Transport,this._city),r.setMission(t),r.visible=!0,this._transportComList.push(r),this._buildList.addChild(r),this._buildList.setChildIndex(r,this._buildList.numItems-3),[2]})})},i.prototype._onTransportBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t.WarMgr.inst.joinSelectCityMode(!0,t.MapState.Transport),Core.EventCenter.inst.addEventListener(t.WarMgr.SelectCity,this._openSetTransport,this),[2]})})},i.prototype._openSetTransport=function(e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){return Core.EventCenter.inst.removeEventListener(t.WarMgr.SelectCity,this._openSetTransport,this),this._parent.visible?(t.WarMgr.inst.joinSelectCityMode(!1,t.MapState.Transport),i=e.data,i&&Core.ViewManager.inst.open(ViewName.questTransReleaseWnd,i),[2]):[2]})})},i.prototype._onMigrateBtn=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){if(e=t.CountryMgr.inst.getCountry(this._city.countryID)){if(i=e.cityList.keys(),r=i.indexOf(this._city.cityID),i.splice(r,1),i.length<=0)return Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70235))),[2];t.WarMgr.inst.joinSelectCityMode(!0,t.MapState.SelectMy,i),Core.EventCenter.inst.addEventListener(t.WarMgr.SelectCity,this._openMigrate,this)}return[2]})})},i.prototype._openMigrate=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){return i=e.data,i?(r=t.CountryMgr.inst.getCountry(this._city.countryID),r&&(n=r.cityList.keys(),n.indexOf(i)>=0&&(Core.EventCenter.inst.removeEventListener(t.WarMgr.SelectCity,this._openMigrate,this),t.WarMgr.inst.joinSelectCityMode(!1,t.MapState.Transport),Core.ViewManager.inst.open(ViewName.questMigrateReleaseWnd,i)))):(t.WarMgr.inst.joinSelectCityMode(!1,t.MapState.Transport),Core.EventCenter.inst.removeEventListener(t.WarMgr.SelectCity,this._openMigrate,this)),[2]})})},i}(fairygui.GComponent);t.CityBuildCom=i,__reflect(i.prototype,"War.CityBuildCom")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._flag=this.getChild("flag").asLoader,this._icon=this.getChild("icon").asLoader,this._cityName=this.getChild("title").asTextField,this._campName=this.getChild("campName").asTextField,this._defPlayerNumText=this.getChild("amount").asTextField,this._defenseBar=this.getChild("expProgressBar").asCom,this._chooseCtr=this.getController("choose"),this._fightCtr=this.getController("fight"),this._headCom=this.getChild("head").asCom,this._chooseCtr.selectedIndex=1,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this._touchEnd,this),this._watchCityProps=["defence"],this._watchCountryProps=["countryFlag","countryName"]},i.prototype._touchBegin=function(t){this._touchX=t.stageX,this._touchY=t.stageY},i.prototype._touchEnd=function(t){if(null!=this._touchX&&null!=this._touchY){var e=this._touchX-t.stageX,i=this._touchY-t.stageY;this._touchX=null,this._touchY=null,Math.abs(e)>10||Math.abs(i)>10||this._onCity()}},i.prototype._watch=function(){this._city&&(this._city.watchProp(t.City.PropDefence,this._updateCityDefence,this),this._city.watchProp(t.City.PropCountry,this._updateCountryProps,this),this._city.watchProp(t.City.PropDefPlayerNum,this._updateDefPlayerNum,this))},i.prototype._unwatch=function(){this._city&&(this._city.unwatchProp(t.City.PropDefence,this._updateCityDefence,this),this._city.unwatchProp(t.City.PropCountry,this._updateCountryProps,this),this._city.unwatchProp(t.City.PropDefPlayerNum,this._updateDefPlayerNum,this)),this._country&&this._unwatchCountry()},i.prototype._watchCountry=function(){var t=this;this._country&&this._watchCountryProps.forEach(function(e){t._country.watchProp(e,t._updateCountryProps,t)})},i.prototype._unwatchCountry=function(){var t=this;this._country&&this._watchCountryProps.forEach(function(e){t._country.unwatchProp(e,t._updateCountryProps,t)})},i.prototype.setCity=function(t){this._unwatch(),this._city=t,this._cityName.text=this._city.cityName,this.setXY(this._city.cityPoint.x,this._city.cityPoint.y),this._chooseCtr.selectedIndex=0,this.refresh(),this._watch()},i.prototype.refresh=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._updateCityDefence(),this._updateCountryProps(),this._updateDefPlayerNum(),[2]})})},i.prototype.setInFallenMode=function(t){t?this._fightCtr.setSelectedIndex(2):this._fightCtr.setSelectedIndex(0)},i.prototype._updateCityDefence=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t.WarMgr.inst.inStatus(t.BattleStatusName.ST_DURING)?this._city.defence<=0?this._defenseBar.visible=!1:(this._defenseBar.setProgress(this._city.defence,this._city.defenceMax),this._defenseBar.setProgress2(this._city.defence,this._city.defenceMax),this._defenseBar.getChild("text").asTextField.text=""+this._city.defence,this._defenseBar.visible=!0,this._fightCtr.setSelectedIndex(1)):this._defenseBar.visible=!1,[2]})})},i.prototype._updateDefPlayerNum=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t.WarMgr.inst.inStatus(t.BattleStatusName.ST_DURING)&&this._city.defPlayerNum>0?this._defPlayerNumText.text="x"+this._city.defPlayerNum.toString():this._defPlayerNumText.text="",[2]})})},i.prototype._updateCountryProps=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._unwatchCountry(),0!=this._city.countryID?(this._country=t.CountryMgr.inst.getCountry(this._city.countryID),this._country?(this._campName.text=this._country.countryName,this._flag.visible=!0,this._flag.url=this._country.countryFlag,this._watchCountry()):(this._country=null,this._campName.text="",this._flag.visible=!1)):(this._country=null,this._campName.text="",this._flag.visible=!1),this._country?this._headCom.x=55:this._headCom.x=10,[2]
})})},i.prototype.setHead=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._headCom.visible=t,t&&(this._headCom.setHead(Player.inst.avatarUrl),this._headCom.setFrame(Player.inst.frameUrl),this._country?this._headCom.x=55:this._headCom.x=10),[2]})})},i.prototype._onCity=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(t.WarMgr.inst.mapState!=t.MapState.Normal){if(t.WarMgr.inst.mapState!=t.MapState.SurrenderCamp&&t.WarMgr.inst.mapState!=t.MapState.SurrenderCity){if(t.WarMgr.inst.nowSelectCity.cityID==this._city.cityID)return Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70236))),[2]}else if(0!=this._city.countryID&&this._city.countryID==t.MyWarPlayer.inst.countryID)return Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70237))),[2];return Core.EventCenter.inst.dispatchEventWith(t.WarMgr.SelectCity,!1,this._city.cityID),[2]}return t.WarMgr.inst.openCityInfo(this._city.cityID),[2]})})},i.prototype.setCitySelectMode=function(t){t?this._chooseCtr.selectedIndex=1:this._chooseCtr.selectedIndex=0},i.prototype.setCityInWarMode=function(t){this._defPlayerNumText.visible=t,this._updateDefPlayerNum(),t?this._city.defence<=0?this._fightCtr.selectedIndex=1:this._fightCtr.selectedIndex=1:this._fightCtr.selectedIndex=0},i.prototype.setCityInAttackedMode=function(t){t?this.getTransition("attacking").play():this.getTransition("attacking").stop(),this.getChild("n11").asLoader.visible=t},i.prototype.onDestroy=function(){this._unwatch(),this.removeFromParent()},i}(fairygui.GComponent);t.CityCom=e,__reflect(e.prototype,"War.CityCom")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._myNameText=this.getChild("n61").asTextField,this._myNameText.textParser=Core.StringUtils.parseColorText,this._myJobText=this.getChild("n77").asTextField,this._myJobText.textParser=Core.StringUtils.parseColorText,this._myCountryText=this.getChild("n85").asTextField,this._myContributionCom=this.getChild("gongji").asCom,this._mySalaryCom=this.getChild("fenglu").asCom,this._cityNameText=this.getChild("n86").asTextField,this._defenceBar=this.getChild("chengfang").asCom,this._cityGoldCom=this.getChild("jinbi").asCom,this._cityForageCom=this.getChild("liangcao").asCom,this._addGoldBtn=this.getChild("addGoldBtn").asButton,this._setFoodPriceBtn=this.getChild("setFoodPrice").asButton,this._independeBtn=this.getChild("independeBtn").asButton,this._memberBtn=this.getChild("memberBtn").asButton,this._isAttackText=this.getChild("n54").asTextField,this._addGoldBtn.addClickListener(this._onAddGoldBtn,this),this._setFoodPriceBtn.addClickListener(this._onSetFoodPriceBtn,this),this._independeBtn.addClickListener(this._onIndependeBtn,this),this._memberBtn.addClickListener(this._onMemberBtn,this)},i.prototype.setInfo=function(e){this._city=e,this._myNameText.text=Player.inst.name,this._myJobText.text=Utils.job2Text(t.MyWarPlayer.inst.employee.cityJob.type,!0),this._myCountryText.text=0==t.MyWarPlayer.inst.countryID?"":t.CountryMgr.inst.getCountry(t.MyWarPlayer.inst.countryID).countryName,this._myContributionCom.setNum(t.MyWarPlayer.inst.contribution),this._mySalaryCom.setNum(t.MyWarPlayer.inst.salary),this._cityNameText.text=e.cityName,this._defenceBar.setProgress(e.defence,e.defenceMax),this._defenceBar.setProgress2(e.defence,e.defenceMax),this._defenceBar.setIconUrl(Utils.warResType2Url(WarResType.Defense)),this._cityGoldCom.setNum(e.gold),this._cityGoldCom.setIconUrl(WarResType.Gold),this._cityForageCom.setNum(e.forage),this._cityForageCom.setIconUrl(WarResType.Forage),this._isAttackText.visible=this._city.isBeAttack},i.prototype._onAddGoldBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.open(ViewName.addGoldWnd,this._city),[2]})})},i.prototype._onSetFoodPriceBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._city.cityID!=t.MyWarPlayer.inst.cityID?[2]:((t.MyWarPlayer.inst.employee.hasSameJob(Job.Prefect)||t.MyWarPlayer.inst.employee.hasSameJob(Job.DuWei))&&t.WarMgr.inst.openSetFoodPriceWnd(this._city),[2])})})},i.prototype._onIndependeBtn=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_FETCH_AUTOCEPHALY_INFO,null)];case 1:return t=i.sent(),0==t.errcode&&(e=pb.AutocephalyInfo.decode(t.payload),Core.ViewManager.inst.open(ViewName.independentWnd,e)),[2]}})})},i.prototype._onMemberBtn=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,t.WarMgr.inst.fetchCityMember(this._city.cityID,0)];case 1:return e=i.sent(),e&&Core.ViewManager.inst.open(ViewName.allMemberPanel,this._city.cityID,e),[2]}})})},i}(fairygui.GComponent);t.CityDetailCom=e,__reflect(e.prototype,"War.CityDetailCom")}(War||(War={}));var War;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._bar=this.getChild("pro").asCom,this._icon=this.getChild("icon").asLoader,this._numText=this.getChild("pro").asCom.getChild("text").asTextField,this._numText.textParser=Core.StringUtils.parseColorText},e.prototype.setProgress=function(t,e){this._bar.setProgress(t,e),this._numText.text=t+"/"+e},e.prototype.setProgress2=function(t,e){this._bar.setProgress2(t,e)},e.prototype.setText=function(t,e,i){i>0?this._numText.text=t+"#cg+"+i+"#n/"+e:this._numText.text=t+"/"+e},e.prototype.setTextAlign=function(t){this._numText.align=t},e.prototype.setIconUrl=function(t){this._icon.url=t},e.prototype.openClick=function(t){this._type=t,this.addClickListener(this._onResCom,this)},e.prototype._onResCom=function(){Core.ViewManager.inst.openPopup(ViewName.descTipsWnd,Utils.warResType2desc(this._type))},e}(fairygui.GComponent);t.CityInfoBar=e,__reflect(e.prototype,"War.CityInfoBar")}(War||(War={}));var War;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._numText=this.getChild("time").asTextField,this._icon=this.getChild("icon").asLoader},e.prototype.setNum=function(t){this._numText.text=t.toString()},e.prototype.setStr=function(t){this._numText.text=t},e.prototype.setIconUrl=function(t){this._type=t,this._icon.url=Utils.warResType2Url(t)},e.prototype.setInfo=function(t,e){this.setIconUrl(t),this.setNum(e)},e.prototype.setTextAlign=function(t){this._numText.align=t},e.prototype.openClick=function(){this._icon.addClickListener(this._onResCom,this)},e.prototype._onResCom=function(){Core.ViewManager.inst.openPopup(ViewName.descTipsWnd,Utils.warResType2desc(this._type))},e}(fairygui.GComponent);t.CityInfoCom=e,__reflect(e.prototype,"War.CityInfoCom")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this._applyTimeText=this.contentPane.getChild("time").asTextField,this._playerList=this.contentPane.getChild("playList").asList,this._playerList._scrollPane.addEventListener(fairygui.ScrollPane.PULL_UP_RELEASE,this._getApplyPLayers,this),this._applyBtn=this.contentPane.getChild("applyBtn").asButton,this._moreBtn=this.contentPane.getChild("moreBtn").asButton,this._enterBtn=this.contentPane.getChild("enterBtn").asButton,this._appointBtn=this.contentPane.getChild("appointBtn").asButton,this._moveBtn=this.contentPane.getChild("moveBtn").asButton,this._moreBtn.addClickListener(this._onMore,this),this._enterBtn.addClickListener(this._onEnter,this),this._applyBtn.addClickListener(this._onApplyBtn,this),this._moveBtn.addClickListener(this._onEnter,this),this._appointBtn.addClickListener(this._onAppointBtn,this)},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){return e.prototype.open.apply(this,i),r=t.CityMgr.inst.getCity(i[0]),this._city=r,this._setCityDetails(),this.watch(),Core.EventCenter.inst.addEventListener(t.WarMgr.RefreshCityInfo,this._setCityBaseInfo,this),[2]})})},i.prototype._setCityDetails=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return e.prototype.setCityBaseInfo.call(this),this._setCityBaseInfo(),this._updatePlayer(),[2]})})},i.prototype._updateEnterBtn=function(){t.WarMgr.inst.inStatus(t.BattleStatusName.ST_NORMAL)?(this._enterBtn.grayed=!1,this._enterBtn.visible=!1,this._city.cityID==t.MyWarPlayer.inst.cityID?this._enterBtn.visible=!1:0==t.MyWarPlayer.inst.cityID||0==t.MyWarPlayer.inst.countryID?this._enterBtn.visible=!0:this._enterBtn.visible=!1):0==t.MyWarPlayer.inst.countryID?(this._enterBtn.visible=!0,this._enterBtn.grayed=!0):this._enterBtn.visible=!1},i.prototype._updateMoveBtn=function(){this._moveBtn.visible=!1,t.WarMgr.inst.inStatus(t.BattleStatusName.ST_NORMAL)&&this._city.cityID!=t.MyWarPlayer.inst.cityID&&0!=t.MyWarPlayer.inst.countryID&&this._city.countryID==t.MyWarPlayer.inst.countryID&&(this._moveBtn.visible=!0)},i.prototype._updateMoreBtn=function(){this._moreBtn.visible=!1,this._moreBtn.grayed=!0,t.MyWarPlayer.inst.isMyCity(this._city.cityID)&&0!=this._city.countryID&&(this._moreBtn.visible=!0,t.MyWarPlayer.inst.employee.hasSameJob(Job.Prefect)&&(this._moreBtn.grayed=!1))},i.prototype._updateAppointBtn=function(){this._appointBtn.visible=!0,t.MyWarPlayer.inst.isMyCity(this._city.cityID)&&0!=this._city.countryID?(this._appointBtn.grayed=!1,this._appointBtn.touchable=!0):t.MyWarPlayer.inst.isMyCountryCity(this._city.cityID)&&t.MyWarPlayer.inst.employee.hasSameJob(Job.YourMajesty)?(this._appointBtn.grayed=!1,this._appointBtn.touchable=!0):t.MyWarPlayer.inst.isMyCountryCity(this._city.cityID)?(this._appointBtn.grayed=!0,this._appointBtn.touchable=!1):(this._appointBtn.visible=!1,this._appointBtn.grayed=!0)},i.prototype._updateFightBtn=function(){},i.prototype._updateAppFightBtn=function(){this._applyBtn.visible=!1,this._applyTimeText.visible=!1,this._createTimerStop(),t.MyWarPlayer.inst.isMyCity(this._city.cityID)&&0==this._city.countryID&&(this._applyBtn.visible=!0,this._applyTimeText.visible=!0,this._city.createTime>0&&this._createTimerStart())},i.prototype._setCityBaseInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t.MyWarPlayer.inst.inStatus(t.PlayerStatusName.ST_ARREST)?(this._moreBtn.visible=!1,this._enterBtn.visible=!1,this._applyBtn.visible=!1,this._appointBtn.visible=!1,this._moveBtn.visible=!1):(this._updateEnterBtn(),this._updateMoreBtn(),this._updateAppFightBtn(),this._updateFightBtn(),this._updateMoveBtn(),this._updateAppointBtn()),[2]})})},i.prototype._updatePlayer=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){for(t=[],e=this._playerList.numItems-1;e>=0;e--)this._playerList.removeChildAt(e);return 0==this._city.countryID?(t=this._city.applyPlayers,this.contentPane.getChild("emptyHint").visible=!0,t.length>0?(this.contentPane.getChild("emptyHint").visible=!1,this._page=0):this._page=-1,this._addPlayer(t,!0)):(this._page=-1,t=this._city.players,t.length>0?(this.contentPane.getChild("emptyHint").visible=!1,this._addPlayer(t,!1)):this.contentPane.getChild("emptyHint").visible=!0),[2]})})},i.prototype._addPlayer=function(t,e){if(e)for(var i=0;i<t.length;i++){var r=fairygui.UIPackage.createObject(PkgName.war,"emperorApplyItem");r.setInfo(t[i]),this._playerList.addChild(r)}else for(var i=0;i<t.length;i++){var r=fairygui.UIPackage.createObject(PkgName.war,"playerItem");r.setInfo(t[i]),this._playerList.addChild(r)}},i.prototype._getApplyPLayers=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(r){switch(r.label){case 0:return this._page<0?[2]:(t={CityID:this._city.cityID,Page:this._page},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_APPLY_CREATE_COUNTRY_PLAYERS,pb.FetchApplyCreateCountryPlayersArg.encode(t))]);case 1:return e=r.sent(),0==e.errcode&&(i=pb.ApplyCreateCountryPlayers.decode(e.payload),i.Players.length>0?(this._page+=1,this._addPlayer(i.Players,!0)):this._page=-1),[2]}})})},i.prototype._onApplyBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return 0==this._city.countryID&&t.MyWarPlayer.inst.isMyCity(this._city.cityID)&&t.WarMgr.inst.inStatus(t.BattleStatusName.ST_NORMAL)&&t.WarMgr.inst.openEmperorApply(this._city.cityID),[2]})})},i.prototype._onAppointBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.open(ViewName.cityAppointPanel,this._city.cityID),[2]})})},i.prototype._onMore=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._city.inStatus(t.CityStatusName.ST_FALLEN)?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format("此城刚陷落不久，不宜发布指令")),[2]):t.MyWarPlayer.inst.employee.hasSameJob(Job.Prefect)&&t.MyWarPlayer.inst.isMyCity(this._city.cityID)?(Core.ViewManager.inst.open(ViewName.cityManagePanel,this._city.cityID),[2]):(Core.TipsUtils.showTipsFromCenter("只有本城太守才能发布指令"),[2])})})},i.prototype._createTimerStart=function(){fairygui.GTimers.inst.add(1e3,-1,this._updateCreateTime,this)},i.prototype._updateCreateTime=function(){this._city.createTime-=1,this._city.createTime<=0?(this._createTimerStop(),this._setCityDetails()):this._applyTimeText.text=Core.StringUtils.format(Core.StringUtils.TEXT(70238),Core.StringUtils.secToString(this._city.createTime,"hms"))},i.prototype._createTimerStop=function(){fairygui.GTimers.inst.remove(this._updateCreateTime,this)},i.prototype._onEnter=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o=this;return __generator(this,function(s){return t.WarMgr.inst.inStatus(t.BattleStatusName.ST_DURING)||t.WarMgr.inst.inStatus(t.BattleStatusName.ST_PREPARE)?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70239))),[2]):(0==t.MyWarPlayer.inst.cityID?Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70240),this._city.cityName),function(){o._joinCity()},null,this):0==t.MyWarPlayer.inst.countryID?Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70241),this._city.cityName),function(){o._moveCity(0)},null,this):(e=t.CityMgr.inst.getCity(t.MyWarPlayer.inst.cityID),i=t.CityMgr.inst.getShortestPathBetweenCityForTransport(e,this._city),r=t.Road.countCityPathDistance(i),n=r*Data.parameter.get("transfer_cost").para_value[0],t.MyWarPlayer.inst.employee.hasCityOfficialTitle()?Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70242),n,this._city.cityName,Utils.job2Text(t.MyWarPlayer.inst.employee.cityJob.type,!0)),function(){o._moveCity(n)},null,this):Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70243),n,this._city.cityName),function(){o._moveCity(n)},null,this)),[2])})})},i.prototype._joinCity=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,t.WarMgr.inst.joinCity(this._city.cityID)];case 1:return e=i.sent(),e&&(t.MyWarPlayer.inst.countryID=this._city.countryID,t.MyWarPlayer.inst.cityID=this._city.cityID,this._setCityDetails(),t.WarMgr.inst.warView.updateHomeTip(),Core.EventCenter.inst.dispatchEventWith(t.WarMgr.RefreshCityInfo),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70244),this._city.cityName))),[2]}})})},i.prototype._moveCity=function(e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return e&&Player.inst.getResource(ResType.T_GOLD)<e?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70245))),[2]):[4,t.WarMgr.inst.moveCity(this._city.cityID,e)];case 1:return i=r.sent(),i&&(t.MyWarPlayer.inst.countryID=this._city.countryID,t.MyWarPlayer.inst.cityID=this._city.cityID,this._setCityDetails(),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70244),this._city.cityName))),[2]}})})},i.prototype.close=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return e.prototype.close.apply(this,i),this._createTimerStop(),this.unwatch(),Core.EventCenter.inst.removeEventListener(t.WarMgr.RefreshCityInfo,this._setCityBaseInfo,this),[2]})})},i.prototype.watch=function(){this.watchCityInfo(),this.watchCountryInfo(),this._city.watchProp(t.City.PropApplyPlayer,this._updatePlayer,this),this._city.watchProp(t.City.PropPlayers,this._updatePlayer,this),this._city.watchProp(t.City.PropCountry,this._setCityBaseInfo,this)},i.prototype.unwatch=function(){this.unwatchCityInfo(),this.unwatchCountryInfo(),this._city.unwatchProp(t.City.PropApplyPlayer,this._updatePlayer,this),this._city.unwatchProp(t.City.PropPlayers,this._updatePlayer,this),this._city.unwatchProp(t.City.PropCountry,this._setCityBaseInfo,this)},i}(t.BaseCityInfoWnd);t.CityInfoWnd=e,__reflect(e.prototype,"War.CityInfoWnd")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){this._bg=this.getChild("bg").asLoader,this._titleText=this.getChild("title").asTextField,this._budgetText=this.getChild("Budget").asTextField,this._stopBtn=this.getChild("stopBtn").asButton,this._stopBtn.addClickListener(this._onStopBtn,this)},i.prototype.setFightInfo=function(e){this._mission=e,this._budgetText.text=e.MaxAmount-e.Amount+"/"+e.MaxAmount,e.Type==pb.MilitaryOrderType.DefCityMT?(this._bg.url="war_defenseBg_png",this._titleText.text=Core.StringUtils.TEXT(70246)):e.Type==pb.MilitaryOrderType.ExpeditionMT?(this._bg.url="war_attackBg_png",this._titleText.text=Core.StringUtils.format(Core.StringUtils.TEXT(70247),t.CityMgr.inst.getCity(e.TargetCity).cityName)):e.Type==pb.MilitaryOrderType.SupportMT&&(this._bg.url="war_moveBg_png",this._titleText.text=Core.StringUtils.format(Core.StringUtils.TEXT(70248),t.CityMgr.inst.getCity(e.TargetCity).cityName))},i.prototype._onStopBtn=function(){var t=this;Core.TipsUtils.confirm(Core.StringUtils.TEXT(70249),function(){t._onStop()},null,this)},i.prototype._onStop=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return e={Type:this._mission.Type,TargetCity:this._mission.TargetCity},[4,Net.rpcCall(pb.MessageID.C2S_CANCEL_MILITARY_ORDER,pb.TargetMilitaryOrder.encode(e))];case 1:return i=o.sent(),0==i.errcode&&(r=pb.CancelMilitaryOrderReply.decode(i.payload),n=t.CityMgr.inst.getCity(t.MyWarPlayer.inst.cityID),n&&(n.forage=r.Forage),this.visible=!1),[2]}})})},i}(fairygui.GComponent);t.CityManageFightItem=e,__reflect(e.prototype,"War.CityManageFightItem");var i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.constructFromXML=function(t){i.prototype.constructFromXML.call(this,t),this._fightList=this.getChild("list").asList,this._fightList.itemClass=e,this._fightList.foldInvisibleItems=!0,this._fightBtn=this.getChild("attackBtn").asButton,this._defenceBtn=this.getChild("defenseBtn").asButton,this._expeditionBtn=this.getChild("moveBtn").asButton,this._emptyHint=this.getChild("emptyHint").asTextField,this._fightBtn.addClickListener(this._onFightBtn,this),this._defenceBtn.addClickListener(this._onDefenceBtn,this),this._expeditionBtn.addClickListener(this._onExpeditionBtn,this)},r.prototype.openFightWnd=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._city=t,this.refreshList(),[2]})})},r.prototype.watch=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._city.watchProp(t.City.PropMilitaryOrderInfo,this.refreshList,this),[2]})})},r.prototype.unWatch=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._city.unwatchProp(t.City.PropMilitaryOrderInfo,this.refreshList,this),[2]})})},r.prototype.refreshList=function(){var t=this;this._fightList.removeChildrenToPool();var e=this._city.militaryOrderInfo;this._emptyHint.visible=e.length<=0,e.forEach(function(e){if(e.Amount>=0){var i=t._fightList.addItemFromPool().asCom;i.visible=!0,i.setFightInfo(e)}})},r.prototype._onFightBtn=function(){Core.ViewManager.inst.open(ViewName.questAttackReleaseWnd,this._city)},r.prototype._onDefenceBtn=function(){Core.ViewManager.inst.open(ViewName.questDefenseReleaseWnd,this._city)},r.prototype._onExpeditionBtn=function(){Core.ViewManager.inst.open(ViewName.questMoveReleaseWnd,this._city)},r}(fairygui.GComponent);t.CityManageFightCom=i,__reflect(i.prototype,"War.CityManageFightCom")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.center(),this.modal=!0,this._viewCtr=this.contentPane.getController("page"),this._buildCom=this.contentPane.getChild("n21").asCom,this._fightCom=this.contentPane.getChild("n26").asCom,this._buildBtn=this.contentPane.getChild("buildChk").asButton,this._fightBtn=this.contentPane.getChild("fightChk").asButton,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._closeBtn.addClickListener(this._onClose,this),this._buildBtn.addClickListener(this._onBuildBtn,this),this._fightBtn.addClickListener(this._onFightBtn,this)},i.prototype._onClose=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.closeView(this),[2]})})},i.prototype._onBuildBtn=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return t.WarMgr.inst.inStatus(t.BattleStatusName.ST_DURING)||t.WarMgr.inst.inStatus(t.BattleStatusName.ST_PREPARE)?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70250))),this._buildBtn.getController("button").selectedIndex=0,[2]):(e={CityID:this._city.cityID},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_CAMPAIGN_MISSION_INFO,pb.TargetCity.encode(e))]);case 1:return i=n.sent(),0==i.errcode&&(r=pb.CampaignMissionInfo.decode(i.payload),this._viewCtr.selectedIndex=0,this._fightBtn.getController("button").selectedIndex=0,this.refreshMission(r)),[2]}})})},i.prototype._onFightBtn=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return t.WarMgr.inst.inStatus(t.BattleStatusName.ST_DURING)||t.WarMgr.inst.inStatus(t.BattleStatusName.ST_PREPARE)?(e=t.WarMgr.inst.fetchMilitaryOrders(this._city),e&&(this._buildBtn.getController("button").selectedIndex=0,this._viewCtr.selectedIndex=1),[2]):(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70250))),this._fightBtn.getController("button").selectedIndex=0,[2])})})},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return e.prototype.open.apply(this,i),this._city=t.CityMgr.inst.getCity(i[0]),this.refreshWnd(),this._fightCom.openFightWnd(this._city),this._fightCom.watch(),t.WarMgr.inst.inStatus(t.BattleStatusName.ST_DURING)||t.WarMgr.inst.inStatus(t.BattleStatusName.ST_PREPARE)?this._onFightBtn():this._onBuildBtn(),[2]})})},i.prototype.refreshWnd=function(){},i.prototype.refreshMission=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._buildCom.refreshMission(t,this._city),[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),this._fightCom.unWatch(),[2]})})},i}(Core.BaseWindow);t.CityManageWnd=e,__reflect(e.prototype,"War.CityManageWnd")}(War||(War={}));var War;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.center(),this.modal=!0,this._btnCtr=this.contentPane.getController("view"),this._noticeText=this.contentPane.getChild("notice").asTextField,this._noticeInput=this.contentPane.getChild("noticeInput").asTextInput,this._modifyBtn=this.contentPane.getChild("modifyBtn").asButton,this._confirmBtn=this.contentPane.getChild("confirmBtn").asButton,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._modifyBtn.addClickListener(this._onModifyBtn,this),this._confirmBtn.addClickListener(this._onConfirmBtn,this),this._closeBtn.addClickListener(this._onClose,this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.open.apply(this,e),this._btnCtr.selectedIndex=0,this._oldStr=e[0],this._oldStr&&0!=this._oldStr.length||(this._oldStr=Core.StringUtils.TEXT(70252)),this._can=e[1],this._refresh(),[2]})})},e.prototype._refresh=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._modifyBtn.visible=this._can,this._noticeText.text=this._oldStr,[2]})})},e.prototype._onModifyBtn=function(){this._noticeInput.text=this._oldStr},e.prototype._onConfirmBtn=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(r){switch(r.label){case 0:return t=this._noticeInput.text,t==this._oldStr?[2]:(e={Notice:t},[4,Net.rpcCall(pb.MessageID.C2S_UPDATE_CITY_NOTICE,pb.CityNotice.encode(e))]);case 1:return i=r.sent(),101==i.errcode?Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70251)):0==i.errcode&&(this._oldStr=t,this._btnCtr.selectedIndex=0,this._refresh()),[2]}})})},e.prototype._onClose=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.closeView(this),[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e}(Core.BaseWindow);t.CityNoticeWnd=e,__reflect(e.prototype,"War.CityNoticeWnd")}(War||(War={}));var War;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._comList=new Array,this._generalList=new Array,this._kingCom=this.getChild("king").asCom,this._kingCom.setCurJob(Job.YourMajesty),this._kingCom.getChild("bg2").asLoader.url="war_jobBg3_png",this._adviserCom=this.getChild("adviser").asCom,this._adviserCom.setCurJob(Job.Counsellor),this._adviserCom.getChild("bg2").asLoader.url="war_jobBg3_png",this._generalCom1=this.getChild("general1").asCom,this._generalCom1.getChild("bg2").asLoader.url="war_jobBg3_png",this._generalCom2=this.getChild("general2").asCom,this._generalCom2.getChild("bg2").asLoader.url="war_jobBg3_png",this._generalCom1.setCurJob(Job.General),this._generalCom2.setCurJob(Job.General),this._generalList.push(this._generalCom1,this._generalCom2),this._comList.push(this._kingCom,this._adviserCom),this._comList=this._comList.concat(this._generalList)},e.prototype.refreshJob=function(t){return __awaiter(this,void 0,void 0,function(){var e,i=this;return __generator(this,function(r){return this._country=t,this._comList.forEach(function(t){t.refeshCampCom(i._country)}),e=this._country.players,e.forEach(function(t){i._setCountryPlayer(t)}),[2]})})},e.prototype._setCountryPlayer=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){if(t.employee.hasSameJob(Job.YourMajesty))this._kingCom.setPlayer(t);else if(t.employee.hasSameJob(Job.Counsellor))this._adviserCom.setPlayer(t);else if(t.employee.hasSameJob(Job.General))for(e=0;e<this._generalList.length;e++)if(i=this._generalList[e],i.canSetPlayer())return i.setPlayer(t),[2];return[2]})})},e}(fairygui.GComponent);t.CountryAppointCom=e,__reflect(e.prototype,"War.CountryAppointCom")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.center(),this.modal=!0,this._campObjWatchers=[],this._campCom=this.contentPane.getChild("modifyFlag").asCom,this._appointCom=this.contentPane.getChild("n1").asCom,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._surrenderBtn=this.contentPane.getChild("surrenderBtn").asButton,this._surrenderBtn.visible=!1,this._txt=this.contentPane.getChild("txt").asTextField,this._closeBtn.addClickListener(this._onClose,this),this._campCom.addClickListener(this._onCamp,this),this._surrenderBtn.addClickListener(this._onSurrenderBtn,this)},i.prototype._onClose=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.closeView(this),[2]})})},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){return e.prototype.open.apply(this,i),r=i[0],this._country=r,this._updateSurrenderBtn(),Core.EventCenter.inst.addEventListener(t.WarMgr.RefreshAppoint,this._refreshJob,this),this.refreshWnd(),this._refreshJob(),this._watch(),[2]})})},i.prototype._updateSurrenderBtn=function(){this._surrenderBtn.visible=!0,this._surrenderBtn.grayed=!t.MyWarPlayer.inst.employee.hasSameJob(Job.YourMajesty)},i.prototype._watch=function(){this._country.watchProp(t.Country.PropCampName,this.refreshWnd,this),this._country.watchProp(t.Country.PropFlag,this.refreshWnd,this)},i.prototype._unwatch=function(){this._country.unwatchProp(t.Country.PropCampName,this.refreshWnd,this),this._country.unwatchProp(t.Country.PropFlag,this.refreshWnd,this)},i.prototype.refreshWnd=function(){this._campCom.setCamp(this._country),t.MyWarPlayer.inst.employee.hasSameJob(Job.YourMajesty)?this._txt.visible=!0:this._txt.visible=!1},i.prototype._onSurrenderBtn=function(){return t.MyWarPlayer.inst.employee.hasSameJob(Job.YourMajesty)?t.WarMgr.inst.inStatus(t.BattleStatusName.ST_DURING)||t.WarMgr.inst.inStatus(t.BattleStatusName.ST_PREPARE)?void Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70254))):(t.WarMgr.inst.joinSelectCityMode(!0,t.MapState.SurrenderCamp),void Core.EventCenter.inst.addEventListener(t.WarMgr.SelectCity,this._selectCity,this)):void Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70253)))},i.prototype._selectCity=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o,s,a=this;return __generator(this,function(u){if(i=e.data){if(r=t.CityMgr.inst.getCity(i),0==r.countryID)return Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70255))),[2];n=t.CountryMgr.inst.getCountry(r.countryID),o=.2,s=t.MyWarPlayer.inst.getOffContribution(o),Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70256),n.countryName,s),function(){a._onSurrender(r.countryID)},null,this)}else t.WarMgr.inst.joinSelectCityMode(!1,t.MapState.SurrenderCamp),Core.EventCenter.inst.removeEventListener(t.WarMgr.SelectCity,this._selectCity,this);
return[2]})})},i.prototype._onSurrender=function(e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return t.WarMgr.inst.joinSelectCityMode(!1,t.MapState.SurrenderCamp),Core.EventCenter.inst.removeEventListener(t.WarMgr.SelectCity,this._selectCity,this),t.WarMgr.inst.inStatus(t.BattleStatusName.ST_DURING)||t.WarMgr.inst.inStatus(t.BattleStatusName.ST_PREPARE)?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70254))),[2]):[4,t.WarMgr.inst.surrenderCity(e)];case 1:return i=r.sent(),i&&Core.ViewManager.inst.closeView(this),[2]}})})},i.prototype._onCamp=function(){t.MyWarPlayer.inst.employee.canSetCampFlag()&&Core.ViewManager.inst.open(ViewName.modifyCampFlagWnd,this._country)},i.prototype._refreshJob=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._appointCom.refreshJob(this._country),[2]})})},i.prototype.close=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return this._unwatch(),Core.EventCenter.inst.removeEventListener(t.WarMgr.SelectCity,this._selectCity,this),Core.EventCenter.inst.removeEventListener(t.WarMgr.RefreshAppoint,this._refreshJob,this),e.prototype.close.apply(this,i),[2]})})},i}(Core.BaseWindow);t.CountryAppointWnd=e,__reflect(e.prototype,"War.CountryAppointWnd")}(War||(War={}));var War;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._headCom=this.getChild("lordHead").asCom,this._nameText=this.getChild("nameText").asTextField,this._nameText.textParser=Core.StringUtils.parseColorText,this._goldText=this.getChild("goldInput").asTextField,this.addClickListener(this._onClick,this)},e.prototype.setInfo=function(t){this._uID=t.Player.Uid,this._headCom.setAll(t.Player.HeadImg,t.Player.HeadFrame),this._nameText.text=t.Player.Name,this._goldText.text=t.Gold.toString()},e.prototype._onClick=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,Social.FriendMgr.inst.fetchPlayerInfo(this._uID)];case 1:return t=e.sent(),t&&Core.ViewManager.inst.open(ViewName.friendInfo,this._uID,t),[2]}})})},e}(fairygui.GComponent);t.EmperorApplyItem=e,__reflect(e.prototype,"War.EmperorApplyItem");var i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.initUI=function(){i.prototype.initUI.call(this),this.center(),this.modal=!0,this._cityObjWatchers=[],this._timerText=this.contentPane.getChild("treasureTime").asTextField,this._playerList=this.contentPane.getChild("playerList").asList,this._goldInput=this.contentPane.getChild("goldInput").asTextField,this._confirmBtn=this.contentPane.getChild("confirmBtn").asButton,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._hintText=this.contentPane.getChild("emptyHintText").asTextField,this._goldMaxCnt=this.contentPane.getChild("goldMaxCnt").asTextField,this._goldCnt=this.contentPane.getChild("goldCnt").asSlider,this._goldCnt.getChild("title").visible=!1,this._playerList.itemClass=e,this._playerList._scrollPane.addEventListener(fairygui.ScrollPane.PULL_UP_RELEASE,this._getApplyPLayers,this),this._closeBtn.addClickListener(this._onCloseBtn,this),this._confirmBtn.addClickListener(this._onConfirmBtn,this),this._goldCnt.addEventListener(fairygui.StateChangeEvent.CHANGED,this._goldInputChange,this)},r.prototype.open=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(o){return i.prototype.open.apply(this,e),this._cityID=e[0],r=e[1],n=t.CityMgr.inst.getCity(this._cityID),this._city=n,this._city.applyPlayers=r.Players,this._refresh(r),this._cityObjWatchers.push(Core.Binding.bindHandler(n,[t.City.PropCountry],this._onCloseBtn,this)),[2]})})},r.prototype._refresh=function(t){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(i){return this._time=0,this._page=0,this._goldInput.text="0",this._goldCnt.value=0,0==Player.inst.getResource(ResType.T_GOLD)?(this._goldCnt.grayed=!0,this._goldCnt.touchable=!1):(this._goldCnt.grayed=!1,this._goldCnt.touchable=!0,this._goldCnt.max=Player.inst.getResource(ResType.T_GOLD)),0==this._goldCnt.value&&(this._confirmBtn.touchable=!1,this._confirmBtn.grayed=!0),this._goldMaxCnt.text=Core.StringUtils.format(Core.StringUtils.TEXT(70257),Player.inst.getResource(ResType.T_GOLD)),this._playerList.removeChildrenToPool(),this._time=t.RemainTime,this._timerStart(),t.Players.length>0?(this._hintText.visible=!1,this._page+=1,t.Players.forEach(function(t){e._addApplyPlayer(t)})):(this._page=-1,this._hintText.visible=!0),this._myGold=t.MyApplyMoney,this._myGold>0?this._confirmBtn.title=Core.StringUtils.TEXT(70258):this._confirmBtn.title=Core.StringUtils.TEXT(70259),[2]})})},r.prototype._addApplyPlayer=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=this._playerList.addItemFromPool().asCom,e.setInfo(t),[2]})})},r.prototype._getApplyPLayers=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r=this;return __generator(this,function(n){switch(n.label){case 0:return this._page<0?[2]:(t={CityID:this._cityID,Page:this._page},[4,Net.rpcCall(pb.MessageID.C2S_FETCH_APPLY_CREATE_COUNTRY_PLAYERS,pb.FetchApplyCreateCountryPlayersArg.encode(t))]);case 1:return e=n.sent(),0==e.errcode&&(i=pb.ApplyCreateCountryPlayers.decode(e.payload),i.Players.length>0?(this._page+=1,i.Players.forEach(function(t){r._addApplyPlayer(t)})):this._page=-1),[2]}})})},r.prototype._goldInputChange=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._goldInput.text=""+this._goldCnt.value,0==this._goldCnt.value?(this._confirmBtn.touchable=!1,this._confirmBtn.grayed=!0):(this._confirmBtn.touchable=!0,this._confirmBtn.grayed=!1),this._goldMaxCnt.text=Core.StringUtils.format(Core.StringUtils.TEXT(70257),Player.inst.getResource(ResType.T_GOLD)-this._goldCnt.value),[2]})})},r.prototype._hasApply=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._goldInput.visible=!t,this._confirmBtn.visible=!t,[2]})})},r.prototype._timerStart=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._timerStop(),fairygui.GTimers.inst.add(1e3,-1,this._remainTimer,this),[2]})})},r.prototype._remainTimer=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._timerText.text=Core.StringUtils.secToString(this._time,"hms"),this._time-=1,this._time<=0&&this._timerStop(),[2]})})},r.prototype._timerStop=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return fairygui.GTimers.inst.remove(this._remainTimer,this),[2]})})},r.prototype._onConfirmBtn=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r=this;return __generator(this,function(n){return t=this._goldInput.text,t=t.trim(),e=parseInt(t),isNaN(e)||t.length<=0||t.length!=e.toString().length?[2]:(i="",i=this._myGold>0?Core.StringUtils.format(Core.StringUtils.TEXT(70260),e):Core.StringUtils.format(Core.StringUtils.TEXT(70261),e),Core.TipsUtils.confirm(i,function(){r._onConfirm(e)},null,this),[2])})})},r.prototype._onConfirm=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return Player.inst.getResource(ResType.T_GOLD)<t?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70262)),[2]):(e={Gold:t},[4,Net.rpcCall(pb.MessageID.C2S_CREATE_COUNTRY,pb.CreateCountryArg.encode(e))]);case 1:return i=n.sent(),0==i.errcode&&(r=pb.ApplyCreateCountryData.decode(i.payload),this._city.applyPlayers=r.Players,this._page=0,this._refresh(r)),[2]}})})},r.prototype._onCloseBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.closeView(this),[2]})})},r.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._cityObjWatchers.forEach(function(t){t.unwatch()}),this._cityObjWatchers=[],i.prototype.close.apply(this,t),[2]})})},r}(Core.BaseWindow);t.EmperorApplyWnd=i,__reflect(i.prototype,"War.EmperorApplyWnd")}(War||(War={}));var War;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.center(),this.modal=!0,this._cityName=this.contentPane.getChild("cityName").asTextField,this._memberCnt=this.contentPane.getChild("memberCnt").asSlider,this._memberInput=this.contentPane.getChild("memberInput").asTextField,this._foodCnt=this.contentPane.getChild("foodCnt").asSlider,this._foodInput=this.contentPane.getChild("foodInput").asTextField,this._foodText=this.contentPane.getChild("foodTxt2").asTextField,this._foodCom=this.contentPane.getChild("food").asCom,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._confirmBtn=this.contentPane.getChild("confirmBtn").asButton,this._closeBtn.addClickListener(this.onCloseBtn,this),this._memberCnt.addEventListener(fairygui.StateChangeEvent.CHANGED,this._memberInputChange,this),this._foodCnt.addEventListener(fairygui.StateChangeEvent.CHANGED,this._foodInputChange,this)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.open.apply(this,e),this._city=e[0],this._memberCnt.getChild("title").asTextField.visible=!1,this._foodCnt.getChild("title").asTextField.visible=!1,this.refreshView(),[2]})})},e.prototype.refreshView=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return this._memberCnt.value=0,t=5*this._city.inCityPlayerNum,this._memberCnt.max=0==t?5:t,this._foodCnt.value=0,this._foodCnt.max=this._city.forage,this._memberInputChange(),this._foodInputChange(),[2]})})},e.prototype._memberInputChange=function(){var t=this._memberCnt.value,e=this._foodCnt.value;this._memberInput.text=""+t;var i=t;0==i&&(i=1);var r=Math.min(5,Math.floor(this._city.forage/i));e>r&&(this._foodInput.text=r.toString(),this._foodCnt.value=r),0>=r?(this._foodCnt.max=1,this._foodCnt.touchable=!1,this._foodCom.grayed=!0):(this._foodCnt.max=r,this._foodCnt.touchable=!0,this._foodCom.grayed=!1),this._countFold()},e.prototype._foodInputChange=function(){this._foodInput.text=""+this._foodCnt.value,this._countFold()},e.prototype._countFold=function(){var t=this._memberCnt.value,e=this._foodCnt.value,i=t*e;0==i?this._foodText.text="":this._foodText.text=Core.StringUtils.format(Core.StringUtils.TEXT(70263),i),""==this._cityName.text||i>this._city.forage||0>=t?(this._confirmBtn.touchable=!1,this._confirmBtn.grayed=!0):(this._confirmBtn.touchable=!0,this._confirmBtn.grayed=!1),this._foodCom.setInfo(WarResType.Forage,this._city.forage-i)},e.prototype.onCloseBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.closeView(this),[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e}(Core.BaseWindow);t.BaseFightReleaseWnd=e,__reflect(e.prototype,"War.BaseFightReleaseWnd");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this._selectCityBtn=this.contentPane.getChild("chooseCity").asLoader,this._selectCityBtn.addClickListener(this._onSelectCity,this),this._confirmBtn.addClickListener(this._onConfirmBtn,this)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.open.apply(this,t),this._cityPath=new Array,this._canMoveAttackCitys=this._city.getNeighborEnemyCity(),this._toCity=null,this._cityName.text="",[2]})})},i.prototype._refreshCity=function(e){this._toCity=t.CityMgr.inst.getCity(e),this._cityName.text=this._toCity.cityName,this._cityPath=t.CityMgr.inst.getShortestPathBetweenCityForAttack(this._city,this._toCity),""==this._cityName.text||this._memberCnt.value*this._foodCnt.value>this._city.forage||this._memberCnt.value<=0?(this._confirmBtn.touchable=!1,this._confirmBtn.grayed=!0):(this._confirmBtn.touchable=!0,this._confirmBtn.grayed=!1)},i.prototype._onSelectCity=function(){return this._canMoveAttackCitys.length<=0?void Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70264))):(t.WarMgr.inst.joinSelectCityMode(!0,t.MapState.SelectEnemy,this._canMoveAttackCitys),void Core.EventCenter.inst.addEventListener(t.WarMgr.SelectCity,this._reCity,this))},i.prototype._reCity=function(e){var i=e.data;if(i){if(this._canMoveAttackCitys.indexOf(i)<0)return void Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70265)));this._refreshCity(i)}t.WarMgr.inst.joinSelectCityMode(!1,t.MapState.SelectEnemy),Core.EventCenter.inst.removeEventListener(t.WarMgr.SelectCity,this._reCity,this)},i.prototype._onConfirmBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._cityPath.length<=0?[2]:(this._onConfirn(),[2])})})},i.prototype._onConfirn=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,t.WarMgr.inst.publishMilitaryOrders(this._city,pb.MilitaryOrderType.ExpeditionMT,this._foodCnt.value,this._memberCnt.value,this._cityPath)];case 1:return e=i.sent(),e&&Core.ViewManager.inst.closeView(this),[2]}})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(e);t.QuestAttackReleaseWnd=i,__reflect(i.prototype,"War.QuestAttackReleaseWnd");var r=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this._confirmBtn.addClickListener(this._onConfirmBtn,this)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.open.apply(this,t),this._cityName.text=this._city.cityName,[2]})})},i.prototype._onConfirmBtn=function(){this._onConfirn()},i.prototype._onConfirn=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,t.WarMgr.inst.publishMilitaryOrders(this._city,pb.MilitaryOrderType.DefCityMT,this._foodCnt.value,this._memberCnt.value)];case 1:return e=i.sent(),e&&Core.ViewManager.inst.closeView(this),[2]}})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(e);t.QuestDefenseReleaseWnd=r,__reflect(r.prototype,"War.QuestDefenseReleaseWnd");var n=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.center(),this.modal=!0,this._cityName=this.contentPane.getChild("cityName").asTextField,this._selectCityBtn=this.contentPane.getChild("n24").asLoader,this._memberCnt=this.contentPane.getChild("memberCnt").asSlider,this._memberInput=this.contentPane.getChild("memberInput").asTextField,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._confirmBtn=this.contentPane.getChild("confirmBtn").asButton,this._closeBtn.addClickListener(this._onCloseBtn,this),this._confirmBtn.addClickListener(this._onConfirmBtn,this),this._selectCityBtn.addClickListener(this._onSelectCity,this),this._memberCnt.addEventListener(fairygui.StateChangeEvent.CHANGED,this._memberChange,this)},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(o){return e.prototype.open.apply(this,i),this._canMoveCitys=[],this._cityPath=[],this._canMovePath=new Collection.Dictionary,this._city=i[0],r=t.CountryMgr.inst.getCountry(t.MyWarPlayer.inst.countryID).cityList.keys(),r.forEach(function(e){if(e!=n._city.cityID){var i=t.CityMgr.inst.getCity(e),r=t.CityMgr.inst.getShortestPathBetweenCityForSupportFight(n._city,i);r.length>=2&&(n._canMoveCitys.push(e),n._canMovePath.setValue(i.cityID,r))}}),this._toCity=null,this._setConfirmBtn(!1),this._cityName.text="",this._memberCnt.value=0,this._memberCnt.getChild("title").asTextField.visible=!1,this._memberInput.text="0",this._memberCnt.max=this._city.inCityPlayerNum<=0?1:this._city.inCityPlayerNum,[2]})})},i.prototype._memberChange=function(){this._memberInput.text=""+this._memberCnt.value,this._toCity&&this._memberCnt.value>0?this._setConfirmBtn(!0):this._setConfirmBtn(!1)},i.prototype._setConfirmBtn=function(t){this._confirmBtn.grayed=!t,this._confirmBtn.touchable=t},i.prototype._refreshCity=function(e){this._toCity=t.CityMgr.inst.getCity(e),this._cityPath=this._canMovePath.getValue(e),this._cityName.text=this._toCity.cityName},i.prototype._onSelectCity=function(){return this._canMoveCitys.length<=0?void Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70266))):(t.WarMgr.inst.joinSelectCityMode(!0,t.MapState.SelectMy,this._canMoveCitys),void Core.EventCenter.inst.addEventListener(t.WarMgr.SelectCity,this._reCity,this))},i.prototype._reCity=function(e){var i=e.data;if(i){if(this._canMoveCitys.indexOf(i)<0)return;this._refreshCity(i)}t.WarMgr.inst.joinSelectCityMode(!1,t.MapState.SelectMy),Core.EventCenter.inst.removeEventListener(t.WarMgr.SelectCity,this._reCity,this)},i.prototype._onConfirmBtn=function(){this._toCity&&this._onConfirm()},i.prototype._onConfirm=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,t.WarMgr.inst.publishMilitaryOrders(this._city,pb.MilitaryOrderType.SupportMT,0,this._memberCnt.value,this._cityPath)];case 1:return e=i.sent(),e&&Core.ViewManager.inst.closeView(this),[2]}})})},i.prototype._onCloseBtn=function(){Core.ViewManager.inst.closeView(this)},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseWindow);t.QuestMoveReleaseWnd=n,__reflect(n.prototype,"War.QuestMoveReleaseWnd")}(War||(War={}));var War;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(t){this._lordHeadCom=this.getChild("lordHeadCom").asCom,this._nameText=this.getChild("nameText").asTextField,this._resultCom=this.getChild("result").asCom},e.prototype.setInfo=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._lordHeadCom.setAll(t.HeadImg,t.HeadFrame),this._nameText.text=t.Name,this._resultCom.visible=!0,[2]})})},e}(fairygui.GComponent);t.IndependentPlayerItem=e,__reflect(e.prototype,"War.IndependentPlayerItem");var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.initUI=function(){t.prototype.initUI.call(this),this._timeText=this.contentPane.getChild("treasureTime").asTextField,this._playerList=this.contentPane.getChild("playerList").asList,this._campNameInput=this.contentPane.getChild("campNameInput").asTextInput,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._confirmBtn=this.contentPane.getChild("confirmBtn").asButton,this._hintText=this.contentPane.getChild("emptyHintText").asTextField,this._playerList.itemClass=e},i.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.open.apply(this,e),this._independentData=new pb.AutocephalyInfo,this._independentData=e[0],this._refresh(),[2]})})},i.prototype._refresh=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return this._playerList.removeChildrenToPool(),null==this._independentData.CountryName||""==this._independentData.CountryName?this._campNameInput.text="":this._campNameInput.text=this._independentData.CountryName,this._independentData.AgreePlayers.length<=0?this._hintText.visible=!0:(this._hintText.visible=!1,this._independentData.AgreePlayers.forEach(function(e){var i=t._playerList.addItemFromPool().asCom;i.setInfo(e)})),[2]})})},i.prototype._onConfirmBtn=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i=this;return __generator(this,function(r){return t=this._campNameInput.text,t.trim(),t.length>2||t.length<=0?[2]:(e="确定独立成立势力"+t+"吗？",Core.TipsUtils.confirm(e,function(){i._independent(t)},null,this),[2])})})},i.prototype._independent=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return e={CountryName:t},[4,Net.rpcCall(pb.MessageID.C2S_AUTOCEPHALY,pb.AutocephalyArg.encode(e))];case 1:return i=r.sent(),0==i.errcode&&(this._independentData.CountryName=t,this._refresh()),[2]}})})},i.prototype._onCloseBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.closeView(this),[2]})})},i.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},i}(Core.BaseWindow);t.IndependentWnd=i,__reflect(i.prototype,"War.IndependentWnd")}(War||(War={}));var War;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._dragDetector=null,t}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._baseWidth=this.width,this._baseHeight=this.height},i.prototype.refreshAllCity=function(){var t=this;this._cityComList.forEach(function(e){t.refreshCity(e)})},i.prototype.refreshCity=function(t){this._cityComList.getValue(t).refresh()},i.prototype.initSize=function(){this._calcBaseScale(),this._center()},i.prototype.beginDragDetect=function(){var t=this;this._dragDetector?this._dragDetector.unregisterTouch(this):this._dragDetector=new Core.DragDetector,this._dragDetector.registerTouch(this,Core.DragDetector.T_ZOOM,{minScale:this._baseSX,maxScale:1,checkBoundCb:function(e,i){return t._checkBound(e,i)},onDropCb:function(){t._checkObjOnScreen()}})},i.prototype._calcBaseScale=function(){var t=fairygui.GRoot.inst,e=t.getDesignStageWidth()/this.width,i=t.getDesignStageHeight()/this.height,r=e>i?e:i;this._baseSX=r,this._baseSY=r},i.prototype._center=function(){if(0==t.MyWarPlayer.inst.locationCityID){var e=this.parent.width/2-this.width*this.scaleX/2,i=this.parent.height/2-this.height*this.scaleY/2,r=this._checkBound(e,i);this.x=r.x,this.y=r.y}else{var n=t.CityMgr.inst.getCity(t.MyWarPlayer.inst.locationCityID);if(n){var o=fairygui.GRoot.inst,e=-n.cityPoint.x*this.scaleX+o.getDesignStageWidth()/2,i=-n.cityPoint.y*this.scaleY+o.getDesignStageHeight()/2,r=this._checkBound(e,i);this.x=r.x,this.y=r.y}}this._checkObjOnScreen()},i.prototype.moveCenter=function(e){if(e)this._moveMap(e);else if(0==t.MyWarPlayer.inst.cityID){var i=this.parent.width/2-this.width*this.scaleX/2,r=this.parent.height/2-this.height*this.scaleY/2,n=this._checkBound(i,r);egret.Tween.get(this,{onChange:this._checkObjOnScreen,onChangeObj:this}).to({x:n.x,y:n.y},300,egret.Ease.backOut)}else{var o=t.CityMgr.inst.getCity(t.MyWarPlayer.inst.cityID);this._moveMap(o)}},i.prototype._moveMap=function(t){var e=fairygui.GRoot.inst,i=(-t.cityPoint.x-50)*this.scaleX+e.getDesignStageWidth()/2,r=(-t.cityPoint.y-50)*this.scaleY+e.getDesignStageHeight()/2,n=this._checkBound(i,r);egret.Tween.get(this,{onChange:this._checkObjOnScreen,onChangeObj:this}).to({x:n.x,y:n.y},300,egret.Ease.sineIn)},i.prototype.destroyResMap=function(){for(var t=1;18>=t;t++)RES.destroyRes("war_map"+t+"_jpg")},i.prototype.loadResMap=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(r){switch(r.label){case 0:t=1,r.label=1;case 1:return 18>=t?(e=this.getChild("map"+t).asLoader,i=e,[4,this._getResMap(t)]):[3,4];case 2:i.texture=r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},i.prototype._getResMap=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,RES.getResAsync("war_map"+t+"_jpg")];case 1:return[2,e.sent()]}})})},i.prototype._checkBound=function(t,e){var i=fairygui.GRoot.inst,r=t;if(i.getDesignStageWidth()==this.width*this.scaleX)r=this.parent.width/2-this.width*this.scaleX/2;else{var n=(this.parent.width-i.getDesignStageWidth())/2;r=Math.min(n,r),r=Math.max(this.parent.width-this.width*this.scaleX-n,r)}var o=e;if(i.getDesignStageHeight()==this.height*this.scaleY)o=this.parent.height/2-this.height*this.scaleY/2;else{var s=(this.parent.height-i.getDesignStageHeight())/2;o=Math.min(s,o),o=Math.max(this.parent.height-this.height*this.scaleY-s,o)}return{x:r,y:o}},i.prototype._checkObjOnScreen=function(){var t=this,e=fairygui.GRoot.inst,i=e.getDesignStageWidth(),r=e.getDesignStageHeight();if(this._cityComList){var n=50;this._cityComList.forEach(function(t,e){var o=e.localToGlobal(0,0);o.x<-n||o.x>i+n||o.y<-n||o.y>r+n?e.visible=!1:e.visible=!0})}if(this._mapList){var o=100;this._mapList.forEach(function(e,n){var s=e.localToGlobal(0,0);e.width*t.scaleX,e.height*t.scaleY;s.x<-e.width-o||s.x>i+o||s.y<-e.height-o||s.y>r+o?e.visible=!1:e.visible=!0})}},i.prototype.initUI=function(){e.prototype.initUI.call(this)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.open.apply(this,t),[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseView);t.MainMap=e,__reflect(e.prototype,"War.MainMap")}(War||(War={}));var War;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.center(),this.modal=!0,this._flagList=this.contentPane.getChild("headList").asList,this._campName=this.contentPane.getChild("campName").asTextField,this._campFlag=this.contentPane.getChild("campFlag").asLoader,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._confirmBtn=this.contentPane.getChild("confirmBtn").asButton,this._flagList.addEventListener(fairygui.ItemEvent.CLICK,this._changeFlag,this),this._closeBtn.addClickListener(this._onClose,this),this._confirmBtn.addClickListener(this._onConfirmBtn,this)},e.prototype._changeFlag=function(t){var e=t.itemObject,i=this._flagList.getChildIndex(t.itemObject);this._curFlagUrl="war_flag"+i+"_png",this._campFlag.url=this._curFlagUrl,this._curFlagIndex=i,this._curFlagCom.setChoose(!1),e.setCampFlag(this._curFlagUrl),e.setCampName(this._curName),e.setChoose(!0),this._curFlagCom=e,this._checkChange()},e.prototype._changeName=function(){},e.prototype.autoAddEllipsis=function(t,e){var i=this.cutString(t,e),r=i;return r},e.prototype.cutString=function(t,e){for(var i,r=t.length,n=0,o=0;r>o;o++){var s=t.charCodeAt(o);if(n+=s>=1&&126>=s||s>=65376&&65439>=s?1:2,n>2)return i=t.substr(0,o);if(2==n)return i=t.substr(0,o+1)}return t},e.prototype._changeNameEnd=function(){},e.prototype._checkChange=function(){this._curName==this._country.countryName&&this._curFlagUrl==this._country.countryFlag?this._setConfirmBtn(!1):""==this._curName.trim()?this._setConfirmBtn(!1):this._setConfirmBtn(!0)},e.prototype._setConfirmBtn=function(t){this._confirmBtn.touchable=t,this._confirmBtn.grayed=!t},e.prototype._onClose=function(){Core.ViewManager.inst.closeView(this)},e.prototype._onConfirmBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.TipsUtils.confirm(Core.StringUtils.TEXT(70267),this._confirm,null,this),[2]})})},e.prototype._confirm=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return t={Flag:this._curFlagIndex.toString()},[4,Net.rpcCall(pb.MessageID.C2S_COUNTRY_MODIFY_FLAG,pb.CountryModifyFlagArg.encode(t))];case 1:return e=i.sent(),0==e.errcode&&Core.ViewManager.inst.closeView(this),[2]}})})},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r,n;return __generator(this,function(o){for(t.prototype.open.apply(this,e),this._country=e[0],this._curName=this._country.countryName,this._curFlagUrl=this._country.countryFlag,this._curFlagCom=null,this._campName.text=this._country.countryName,this._campFlag.url=this._country.countryFlag,this._flagList.removeChildrenToPool(),i=0;11>i;i++)r=this._flagList.addItemFromPool().asCom,n="war_flag"+i+"_png",r.setCampFlag(n),n==this._curFlagUrl?(r.setCampName(this._curName),r.setChoose(!0),this._curFlagCom=r,this._curFlagIndex=i):r.setChoose(!1);return[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e}(Core.BaseWindow);t.ModifyCampFlagWnd=e,__reflect(e.prototype,"War.ModifyCampFlagWnd")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.modal=!0,this.center(),this._timeText=this.contentPane.getChild("time").asTextField,this._power=this.contentPane.getChild("power").asTextField,this._cardList=this.contentPane.getChild("headList").asList,this._cardList.itemClass=t.WarCardHeadCom,this._cardList.callbackThisObj=this,this._cardList.itemRenderer=this._renderCards,this._cardList.setVirtual(),this._cardList.addEventListener(fairygui.ItemEvent.CLICK,this._onClickHead,this),this._confirmBtn=this.contentPane.getChild("confirmBtn").asButton,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._confirmBtn.addClickListener(this._onConfirmBtn,this),this._closeBtn.addClickListener(this._onCloseBtn,this)},i.prototype._updateHeadList=function(){},i.prototype._updateList=function(){var t=this;this._cardList.numItems=0,this._allCards=new Array;var e=CardPool.CardPoolMgr.inst.getHasCollectCardsByCamp(Camp.WEI);this._allCards=this._allCards.concat(e),e=CardPool.CardPoolMgr.inst.getHasCollectCardsByCamp(Camp.SHU),this._allCards=this._allCards.concat(e),e=CardPool.CardPoolMgr.inst.getHasCollectCardsByCamp(Camp.WU),this._allCards=this._allCards.concat(e),e=CardPool.CardPoolMgr.inst.getHasCollectCardsByCamp(Camp.HEROS),this._allCards=this._allCards.concat(e),this._allCards.sort(function(e,i){var r=e.getPower(t._type),n=i.getPower(t._type);
return n-r}),this._cardList.numItems=this._allCards.length},i.prototype._renderCards=function(t,e){var i=this._allCards[t],r=e;return r.setInfo(i.cardId,this._type),Pvp.PvpMgr.inst.isCardInSeason(i.cardId)?(r.setInTeam(2),r.setClick(!1),void r.setChoose(!1)):(Pvp.PvpMgr.inst.isCardInTeam(i.cardId)?r.setInTeam(1):r.setInTeam(0),-1!=this._chooseCards.indexOf(i.cardId)?r.setChoose(!0):r.setChoose(!1),void(5==this._chooseCards.length?-1!=this._chooseCards.indexOf(i.cardId)?(r.setChoose(!0),r.setClick(!0)):(r.setChoose(!1),r.setClick(!1)):this._curCamp!=Camp.HEROS&&(i.camp==this._curCamp||i.camp==Camp.HEROS?r.setClick(!0):r.setClick(!1))))},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){return e.prototype.open.apply(this,i),this._chooseCards=new Array,this._mission=i[0],this._curCamp=Camp.HEROS,this._maxPower=0,r=this._mission.Type,this._type=r,this._timeText.visible=!0,this._type==WarMsType.Transport?(this._maxTime=this._mission.TransportMaxTime,this._timeText.text=""+Core.StringUtils.secToString(this._mission.TransportMaxTime,"hm"),this._power.text=Core.StringUtils.TEXT(70269)):(this._maxTime=Utils.warMsType2time(this._type),this._timeText.text=Core.StringUtils.TEXT(70270),this._power.text=t.WarQuest.warMsPower2text(this._type).toString()),this._updateList(),this._updateHeadList(),[2]})})},i.prototype._onClickHead=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){if(e=t.itemObject,i=this._chooseCards.indexOf(e.cardID),-1!=i)this._chooseCards.splice(i,1),e.setChoose(!1),this._maxPower-=e.cardPower;else{if(5==this._chooseCards.length)return[2];this._chooseCards.push(e.cardID),this._maxPower+=e.cardPower,e.setChoose(!0)}return this._refreshTime(),this._refreshCamp(),[2]})})},i.prototype._refreshTime=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._chooseCards&&this._type!=WarMsType.Transport&&(0==this._maxPower?this._timeText.text=Core.StringUtils.TEXT(70270):this._timeText.text=""+Core.StringUtils.secToString(Math.ceil(Utils.warMsType2time(this._type)/this._maxPower),"hm")),[2]})})},i.prototype._refreshCamp=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return this._curCamp=Camp.HEROS,this._chooseCards.forEach(function(e){var i=CardPool.CardPoolMgr.inst.getCollectCard(e);i.camp!=Camp.HEROS&&(t._curCamp=i.camp)}),this._cardList.numItems=this._allCards.length,[2]})})},i.prototype._onConfirmBtn=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r;return __generator(this,function(n){switch(n.label){case 0:return this._chooseCards.length<5?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70268)),[2]):(t=null,t={Type:this._mission.Type,Cards:this._chooseCards,TransportTargetCity:this._mission.TransportTargetCity},[4,Net.rpcCall(pb.MessageID.C2S_ACCEPT_CAMPAIGN_MISSION,pb.AcceptCampaignMissionArg.encode(t))]);case 1:return e=n.sent(),0==e.errcode&&(i=pb.AcceptCampaignMissionReply.decode(e.payload),r=Core.ViewManager.inst.getView(ViewName.warQuestPanel),r.getNewMission(this._mission,i.RemainTime,this._chooseCards),r.refesh(i.Missions),Core.ViewManager.inst.closeView(this)),[2]}})})},i.prototype._onCloseBtn=function(){Core.ViewManager.inst.closeView(this)},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseWindow);t.QuestChooseCardWnd=e,__reflect(e.prototype,"War.QuestChooseCardWnd")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._bg=this.getChild("bg").asLoader,this._titleText=this.getChild("title").asTextField,this._text=this.getChild("text").asTextField,this._foodText=this.getChild("foodCnt").asTextField,this._confirmBtn=this.getChild("n20").asButton,this._backBtn=this.getChild("backBtn").asButton,this._isLocationCtr=this.getController("islocation"),this._confirmBtn.addClickListener(this._onConfirmBtn,this),this._backBtn.addClickListener(this._onBackBtn,this)},i.prototype.setLocation=function(){this._isLocationCtr.selectedIndex=1,this._confirmBtn.visible=!1;var e=t.CityMgr.inst.getCity(t.MyWarPlayer.inst.locationCityID),i=t.CityMgr.inst.getCity(t.MyWarPlayer.inst.cityID);this._titleText.text=Core.StringUtils.format(Core.StringUtils.TEXT(70271),i.cityName),this._text.text=Core.StringUtils.format(Core.StringUtils.TEXT(70272),e.cityName,i.cityName),this._backBtn.title=Core.StringUtils.format(Core.StringUtils.TEXT(70273))},i.prototype.setMission=function(e,i,r){this._isLocationCtr.selectedIndex=0,this._confirmBtn.visible=i,this._mission=e,this._city=r,this._foodText.text=this._mission.Forage.toString();var n=t.CityMgr.inst.getCity(this._mission.TargetCity);if(this._mission.Type==pb.MilitaryOrderType.DefCityMT){var o=t.CityMgr.inst.getCity(t.MyWarPlayer.inst.locationCityID);this._bg.url="war_defenseBg_png",this._titleText.text=Core.StringUtils.format(Core.StringUtils.TEXT(70274),o.cityName),this._text.text=Core.StringUtils.format(Core.StringUtils.TEXT(70275),o.cityName)}else this._mission.Type==pb.MilitaryOrderType.ExpeditionMT?(this._bg.url="war_attackBg_png",this._titleText.text=Core.StringUtils.format(Core.StringUtils.TEXT(70276),n.cityName),this._text.text=Core.StringUtils.format(Core.StringUtils.TEXT(70277),n.cityName)):this._mission.Type==pb.MilitaryOrderType.SupportMT&&(this._bg.url="war_moveBg_png",this._titleText.text=Core.StringUtils.format(Core.StringUtils.TEXT(70278),n.cityName),this._text.text=Core.StringUtils.format(Core.StringUtils.TEXT(70279),n.cityName),this._foodText.visible=!1,this.getChild("foodIcon").asLoader.visible=!1)},i.prototype._onBackBtn=function(){var t=this;Core.TipsUtils.confirm(Core.StringUtils.TEXT(70280),function(){t._onBack()},null,this)},i.prototype._onBack=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_CAMPAIGN_BACK_CITY,null)];case 1:return t=e.sent(),0==t.errcode&&(Core.ViewManager.inst.close(ViewName.questFightPanel),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70281)))),[2]}})})},i.prototype._onConfirmBtn=function(){var e=this;return this._mission.Type!=pb.MilitaryOrderType.SupportMT&&t.WarMgr.inst.inStatus(t.BattleStatusName.ST_PREPARE)?void Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70282))):this._mission.Type!=pb.MilitaryOrderType.DefCityMT&&this._city.inStatus(t.CityStatusName.ST_ATTACKED)?void Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70283))):void(t.MyWarPlayer.inst.cityID!=t.MyWarPlayer.inst.locationCityID?Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70284)),function(){e._onConfirm()},null,this):Core.ViewManager.inst.open(ViewName.choiceFightCardWnd,this._mission))},i.prototype._onConfirm=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return this._mission.Type!=pb.MilitaryOrderType.DefCityMT&&this._city.inStatus(t.CityStatusName.ST_ATTACKED)?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70283))),[2]):[4,t.WarMgr.inst.acceptMilitaryOrder(this._mission.Type,t.MyWarPlayer.inst.supportCards,this._mission.TargetCity)];case 1:return e=i.sent(),e&&Core.ViewManager.inst.close(ViewName.questFightPanel),[2]}})})},i}(fairygui.GComponent);t.QuestFightItem=e,__reflect(e.prototype,"War.QuestFightItem");var i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.initUI=function(){i.prototype.initUI.call(this),this.modal=!0,this.center(),this._questList=this.contentPane.getChild("questList").asList,this._questList.itemClass=e,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._closeBtn.addClickListener(this._onCloseBtn,this),this._emptyHint=this.contentPane.getChild("emptyHint").asTextField},r.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return i.prototype.open.apply(this,t),this._city=t[0],this._emptyHint.visible=this._city.militaryOrderInfo.length<=0,this._refreshList(),this._watch(),[2]})})},r.prototype._watch=function(){this._city.watchProp(t.City.PropMilitaryOrderInfo,this._refreshList,this)},r.prototype._unwatch=function(){this._city.unwatchProp(t.City.PropMilitaryOrderInfo,this._refreshList,this)},r.prototype._refreshList=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n=this;return __generator(this,function(o){return this._questList.removeChildrenToPool(),e=t.MyWarPlayer.inst.inStatus(t.PlayerStatusName.ST_NORMAL),t.MyWarPlayer.inst.cityID!=t.MyWarPlayer.inst.locationCityID&&e&&(i=this._questList.addItemFromPool().asCom,i.setLocation()),r=this._city.militaryOrderInfo,r.forEach(function(t){if(t.Amount>0){var i=n._questList.addItemFromPool().asCom;i.setMission(t,e,n._city)}}),[2]})})},r.prototype._onCloseBtn=function(){Core.ViewManager.inst.closeView(this)},r.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return i.prototype.close.apply(this,t),this._unwatch(),[2]})})},r}(Core.BaseWindow);t.QuestFightPanel=i,__reflect(i.prototype,"War.QuestFightPanel")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.center(),this.modal=!0,this._cityNameText=this.contentPane.getChild("cityName").asTextField,this._cityLoader=this.contentPane.getChild("n30").asLoader,this._memberInput=this.contentPane.getChild("memberInput").asTextField,this._memberCnt=this.contentPane.getChild("memberCnt").asSlider,this._memberCnt.getChild("title").visible=!1,this._goldInput=this.contentPane.getChild("goldInput").asTextField,this._goldCnt=this.contentPane.getChild("goldCnt").asSlider,this._goldCnt.getChild("title").visible=!1,this._text1=this.contentPane.getChild("txt1").asTextField,this._text2=this.contentPane.getChild("txt2").asTextField,this._totalGoldText=this.contentPane.getChild("totalGold").asTextField,this._resCom=this.contentPane.getChild("res").asCom,this._confirmBtn=this.contentPane.getChild("confirmBtn").asButton,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._cityLoader.addClickListener(this._reSelect,this),this._closeBtn.addClickListener(this._onCloseBtn,this),this._confirmBtn.addClickListener(this._onConfirmBtn,this),this._memberCnt.addEventListener(fairygui.StateChangeEvent.CHANGED,this._memberChange,this),this._goldCnt.addEventListener(fairygui.StateChangeEvent.CHANGED,this._goldChange,this)},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return e.prototype.open.apply(this,i),this._fromCity=t.WarMgr.inst.nowSelectCity,this._cityPath=new Array,this._resCom.setInfo(WarResType.Gold,this._fromCity.gold),this._refresh(i[0]),[2]})})},i.prototype._refresh=function(e){this._toCity=t.CityMgr.inst.getCity(e),this._cityPath=t.CityMgr.inst.getShortestPathBetweenCityForTransport(this._fromCity,this._toCity),this._cityNameText.text=this._toCity.cityName;var i=t.Road.countCityPathDistance(this._cityPath);if(this._money=i*Data.parameter.get("transfer_cost").para_value[0],this._memberInput.text="0",this._memberCnt.value=0,this._goldInput.text="0",this._goldCnt.value=0,this._fromCity.gold<this._money)this._memberCnt.max=1,this._memberCnt.touchable=!1,this._memberCnt.grayed=!0;else{var r=Math.floor(this._fromCity.gold/this._money);this._memberCnt.max=Math.min(r,this._fromCity.playerNum),this._memberCnt.touchable=!0,this._memberCnt.grayed=!1}this._memberChange(),this._goldChange()},i.prototype._reSelect=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){return e=t.CountryMgr.inst.getCountry(t.MyWarPlayer.inst.countryID),e&&(i=e.cityList.keys(),r=i.indexOf(this._fromCity.cityID),r>=0&&i.splice(r,1),t.WarMgr.inst.joinSelectCityMode(!0,t.MapState.SelectMy,i),Core.EventCenter.inst.addEventListener(t.WarMgr.SelectCity,this._reCity,this)),[2]})})},i.prototype._reCity=function(e){var i=e.data;if(i){var r=t.CountryMgr.inst.getCountry(t.MyWarPlayer.inst.countryID),n=r.cityList.keys();if(!(n.indexOf(i)>=0))return;this._refresh(i)}t.WarMgr.inst.joinSelectCityMode(!1,t.MapState.SelectMy),Core.EventCenter.inst.removeEventListener(t.WarMgr.SelectCity,this._reCity,this)},i.prototype._memberChange=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r;return __generator(this,function(n){return t=this._memberCnt.value,e=this._goldCnt.value,i=t,0==i&&(i=1),r=Math.min(1e4,Math.floor((this._fromCity.gold-i*this._money)/i)),e>r&&(this._goldInput.text=r.toString(),this._goldCnt.value=r),0>=r?(this._goldCnt.max=1,this._goldCnt.value=0,this._goldCnt.touchable=!1,this._goldCnt.grayed=!0):(this._goldCnt.max=r,this._goldCnt.touchable=!0,this._goldCnt.grayed=!1),this._countGold(),[2]})})},i.prototype._goldChange=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._goldInput.text=""+this._goldCnt.value,this._countGold(),[2]})})},i.prototype._countGold=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(r){return t=this._memberCnt.value,e=this._goldCnt.value,i=t*(this._money+e),this._memberInput.text=t.toString(),this._goldInput.text=e.toString(),this._text1.text=Core.StringUtils.format(Core.StringUtils.TEXT(70285),t*this._money),this._text2.text=Core.StringUtils.format(Core.StringUtils.TEXT(70286),t*e),this._totalGoldText.text=i.toString(),this._resCom.setNum(this._fromCity.gold-i),[2]})})},i.prototype._onConfirmBtn=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return e=parseInt(this._goldInput.text),i=parseInt(this._memberInput.text),parseInt(this._totalGoldText.text)>this._fromCity.gold&&Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70287))),0>=i?[2]:[4,t.WarMgr.inst.publishMission(pb.CampaignMsType.Dispatch,e,i,null,this._cityPath)];case 1:return r=n.sent(),r&&Core.ViewManager.inst.closeView(this),[2]}})})},i.prototype._onCloseBtn=function(){Core.ViewManager.inst.closeView(this)},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseWindow);t.QuestMigrateReleaseWnd=e,__reflect(e.prototype,"War.QuestMigrateReleaseWnd")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.center(),this.modal=!0,this._cityInfobar=this.contentPane.getChild("nongyeProgress").asCom,this._titleText=this.contentPane.getChild("n1").asTextField,this._memberInput=this.contentPane.getChild("memberInput").asTextField,this._goldInput=this.contentPane.getChild("goldInput").asTextField,this._goldIcon=this.contentPane.getChild("n11").asLoader,this._missionDesc=this.contentPane.getChild("txt1").asTextField,this._rewardDesc=this.contentPane.getChild("txt2").asTextField,this._resCom=this.contentPane.getChild("res").asCom,this._confirmBtn=this.contentPane.getChild("confirmBtn").asButton,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._memberCnt=this.contentPane.getChild("memberCnt").asSlider,this._memberCnt.getChild("title").visible=!1,this._goldCnt=this.contentPane.getChild("goldCnt").asSlider,this._goldCnt.getChild("title").visible=!1,this._totlaGold=this.contentPane.getChild("totalGold").asTextField,this._closeBtn.addClickListener(this._onCloseBtn,this),this._confirmBtn.addClickListener(this._onConfirmBtn,this),this._memberCnt.addEventListener(fairygui.StateChangeEvent.CHANGED,this._memberInputChange,this),this._goldCnt.addEventListener(fairygui.StateChangeEvent.CHANGED,this._goldInputChange,this)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.open.apply(this,t),this._type=t[0],this._city=t[1],this._mission=t[2],this._refresh(),[2]})})},i.prototype._refresh=function(){this._titleText.text=""+Utils.warMsType2text(this._type),this._cityInfobar.setProgress(this._city.getMsRes(this._type),this._city.getMsResMax(this._type)),this._cityInfobar.setProgress2(this._city.getMsRes(this._type),this._city.getMsResMax(this._type)),this._cityInfobar.setIconUrl(Utils.warMsType2Url(this._type));var e=Utils.warMsType2WarResType(this._type);e&&this._cityInfobar.openClick(e),this._resCom.setInfo(WarResType.Gold,this._city.gold),this._goldInput.text="0",this._memberInput.text="0",this._totlaGold.text="0",this._memberCnt.value=0,this._goldCnt.value=0,0==Math.ceil((this._city.getMsResMax(this._type)-this._city.getMsRes(this._type))/t.WarQuest.warMsType2reward(this._type))?(this._memberCnt.grayed=!0,this._memberCnt.touchable=!1):(this._memberCnt.grayed=!1,this._memberCnt.touchable=!0,this._memberCnt.max=Math.ceil((this._city.getMsResMax(this._type)-this._city.getMsRes(this._type))/t.WarQuest.warMsType2reward(this._type)));var i=0;i=Math.floor(this._city.gold/this._memberCnt.max),this._city.gold>0?(i>=1e4?this._goldCnt.max=1e4:this._goldCnt.max=this._city.gold,this._goldCnt.grayed=!1,this._goldCnt.touchable=!0):(this._goldCnt.max=1,this._goldCnt.grayed=!0,this._goldCnt.touchable=!1),this._confirmBtn.touchable=!1,this._confirmBtn.grayed=!0,this._goldCnt.value=0,this._cityInfobar.setProgress2(this._city.getMsRes(this._type)+this._memberCnt.max,this._city.getMsResMax(this._type)),this._goldInputChange(),this._memberInputChange()},i.prototype._memberInputChange=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){return e=this._memberCnt.value,i=this._goldCnt.value,this._memberInput.text=""+e,this._cityInfobar.setProgress2(this._city.getMsRes(this._type)+e*t.WarQuest.warMsType2reward(this._type),this._city.getMsResMax(this._type)),this._cityInfobar.setText(this._city.getMsRes(this._type),this._city.getMsResMax(this._type),e*t.WarQuest.warMsType2reward(this._type)),r=0,r=0==e?Math.min(1e4,this._city.gold):Math.min(1e4,Math.floor(this._city.gold/e)),i>r&&(this._goldInput.text=r.toString(),this._goldCnt.value=r),0>=r?(this._goldCnt.max=1,this._goldCnt.grayed=!0,this._goldCnt.touchable=!1):(this._goldCnt.max=r,this._goldCnt.grayed=!1,this._goldCnt.touchable=!0),this._countGold(),[2]})})},i.prototype._goldInputChange=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._goldInput.text=""+this._goldCnt.value,this._countGold(),[2]})})},i.prototype._countGold=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o;return __generator(this,function(s){return e=0,i=this._memberCnt.value,r=this._goldCnt.value,n=i*e,o=r*i,r?this._rewardDesc.text=Core.StringUtils.format(Core.StringUtils.TEXT(70288),r):this._rewardDesc.text="",i?this._missionDesc.text=Core.StringUtils.format(Core.StringUtils.TEXT(70289),i*t.WarQuest.warMsType2reward(this._type)):this._missionDesc.text="",this._resCom.setInfo(WarResType.Gold,this._city.gold-this._goldCnt.value*this._memberCnt.value),this._totlaGold.text=""+this._goldCnt.value*this._memberCnt.value,i>0&&o<=this._city.gold?(this._confirmBtn.touchable=!0,this._confirmBtn.grayed=!1):(this._confirmBtn.touchable=!1,this._confirmBtn.grayed=!0),[2]})})},i.prototype._onConfirmBtn=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return e=parseInt(this._goldInput.text),i=this._memberCnt.value,[4,t.WarMgr.inst.publishMission(this._type,e,i)];case 1:return r=n.sent(),r&&this._onCloseBtn(),[2]}})})},i.prototype._onCloseBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.closeView(this),[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseWindow);t.QuestReleaseWnd=e,__reflect(e.prototype,"War.QuestReleaseWnd")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.center(),this.modal=!0,this._cityNameText=this.contentPane.getChild("cityName").asTextField,this._cityLoader=this.contentPane.getChild("n24").asLoader,this._dayCntText=this.contentPane.getChild("dayCnt").asTextField,this._goldMemberInput=this.contentPane.getChild("goldMemberInput").asTextField,this._goldInput=this.contentPane.getChild("goldInput").asTextField,this._goldDesc=this.contentPane.getChild("goldTxt2").asTextField,this._goldCntDesc=this.contentPane.getChild("goldTxt1").asTextField,this._foodMemberInput=this.contentPane.getChild("foodMemberInput").asTextField,this._foodInput=this.contentPane.getChild("foodInput").asTextField,this._foodDesc=this.contentPane.getChild("foodTxt2").asTextField,this._foodCntDesc=this.contentPane.getChild("foodTxt1").asTextField,this._typeCtr=this.contentPane.getController("resource"),this._goldMemberCnt=this.contentPane.getChild("goldMemberCnt").asSlider,this._goldMemberCnt.getChild("title").visible=!1,this._goldCnt=this.contentPane.getChild("goldCnt").asSlider,this._goldCnt.getChild("title").visible=!1,this._foodMemberCnt=this.contentPane.getChild("foodMemberCnt").asSlider,this._foodMemberCnt.getChild("title").visible=!1,this._foodCnt=this.contentPane.getChild("foodCnt").asSlider,this._foodCnt.getChild("title").visible=!1,this._goldResCom1=this.contentPane.getChild("gold1").asCom,this._goldResCom2=this.contentPane.getChild("gold2").asCom,this._foodResCom=this.contentPane.getChild("food").asCom,this._goldConfirmBtn=this.contentPane.getChild("goldConfirmBtn").asButton,this._foodConfirmBtn=this.contentPane.getChild("foodConfirmBtn").asButton,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._goldBtn=this.contentPane.getChild("worldChk").asButton,this._foodBtn=this.contentPane.getChild("warChk").asButton,this._closeBtn.addClickListener(this._onClose,this),this._goldConfirmBtn.addClickListener(this._onGoldConfirm,this),this._foodConfirmBtn.addClickListener(this._onFoodConfirm,this),this._goldBtn.addClickListener(this._onGoldBtn,this),this._foodBtn.addClickListener(this._onFoodBtn,this),this._cityLoader.touchable=!0,this._cityLoader.addClickListener(this._reSelect,this),this._goldMemberCnt.addEventListener(fairygui.StateChangeEvent.CHANGED,this._goldMemberInputChange,this),this._goldCnt.addEventListener(fairygui.StateChangeEvent.CHANGED,this._goldInputChange,this),this._foodMemberCnt.addEventListener(fairygui.StateChangeEvent.CHANGED,this._foodMemberInputChange,this),this._foodCnt.addEventListener(fairygui.StateChangeEvent.CHANGED,this._foodInputChange,this)},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return e.prototype.open.apply(this,i),this._cityPath=new Array,this._fromCity=t.WarMgr.inst.nowSelectCity,this._foodResCom.setInfo(WarResType.Forage,this._fromCity.forage),this._goldResCom1.setInfo(WarResType.Gold,this._fromCity.gold),this._goldResCom2.setInfo(WarResType.Gold,this._fromCity.gold),this._typeCtr.selectedIndex=0,this._refresh(i[0]),[2]})})},i.prototype._refresh=function(e){return __awaiter(this,void 0,void 0,function(){var i,r,n,o;return __generator(this,function(s){return this._toCity=t.CityMgr.inst.getCity(e),i=Data.parameter.get("transport_time").para_value[0],this._cityPath=t.CityMgr.inst.getShortestPathBetweenCityForTransport(this._fromCity,this._toCity),this._cityNameText.text=this._toCity.cityName,r=i*t.Road.countCityPathDistance(this._cityPath),this._dayCntText.text=""+Core.StringUtils.secToString(r,"hm"),this._goldInput.text="0",this._goldMemberInput.text="0",this._goldMemberCnt.value=0,this._goldCnt.value=0,this._foodInput.text="0",this._foodMemberInput.text="0",this._foodMemberCnt.value=0,this._foodCnt.value=0,n=Data.parameter.get("task_target_transport").para_value[0],o=Data.parameter.get("task_target_transport").para_value[1],this._fromCity.forage<o?(this._foodMemberCnt.max=1,this._foodMemberCnt.touchable=!1,this._foodMemberCnt.grayed=!0):(this._foodMemberCnt.max=Math.floor(this._fromCity.forage/o),this._foodMemberCnt.touchable=!0,this._foodMemberCnt.grayed=!1),this._fromCity.gold<n?(this._goldMemberCnt.max=1,this._goldMemberCnt.touchable=!1,this._goldMemberCnt.grayed=!0):(this._goldMemberCnt.max=Math.floor(this._fromCity.gold/n),this._goldMemberCnt.touchable=!0,this._goldMemberCnt.grayed=!1),this._fromCity.gold>=0?(this._goldCnt.max=this._fromCity.gold,this._goldCnt.grayed=!1,this._goldCnt.touchable=!0):(this._goldCnt.max=1,this._goldCnt.grayed=!0,this._goldCnt.touchable=!1),this._foodConfirmBtn.touchable=!1,this._foodConfirmBtn.grayed=!0,this._goldConfirmBtn.touchable=!1,this._goldConfirmBtn.grayed=!0,this._goldInputChange(),this._foodInputChange(),this._goldMemberInputChange(),this._foodMemberInputChange(),[2]})})},i.prototype._goldMemberInputChange=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n;return __generator(this,function(o){return t=0,t=Data.parameter.get("task_target_transport").para_value[0],e=this._goldMemberCnt.value,i=this._goldCnt.value,this._goldMemberInput.text=""+e,r=e,0==r&&(r=1),n=Math.min(1e4,Math.floor((this._fromCity.gold-e*t)/r)),i>n&&(this._goldInput.text=n.toString(),this._goldCnt.value=n),0>=n?(this._goldCnt.max=1,this._goldCnt.touchable=!1,this._goldCnt.grayed=!0):(this._goldCnt.max=n,this._goldCnt.touchable=!0,this._goldCnt.grayed=!1),this._countGold(),[2]})})},i.prototype._goldInputChange=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._goldInput.text=""+this._goldCnt.value,this._countGold(),[2]})})},i.prototype._foodMemberInputChange=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){return t=0,t=Data.parameter.get("task_target_transport").para_value[1],e=this._foodMemberCnt.value,this._fromCity.forage<t&&(this._foodMemberCnt.value=0),this._foodMemberInput.text=""+this._foodMemberCnt.value,this._countFoodGold(),[2]})})},i.prototype._foodInputChange=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._foodInput.text=""+this._foodCnt.value,this._countFoodGold(),[2]})})},i.prototype._countGold=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n;return __generator(this,function(o){return t=0,t=Data.parameter.get("task_target_transport").para_value[0],e=this._goldMemberCnt.value,i=this._goldCnt.value,r=e*t,n=i*e,e?this._goldCntDesc.text=Core.StringUtils.format(Core.StringUtils.TEXT(70290),r):this._goldCntDesc.text="",r+n>this._fromCity.gold||0==r?(this._goldConfirmBtn.touchable=!1,this._goldConfirmBtn.grayed=!0):(this._goldConfirmBtn.touchable=!0,this._goldConfirmBtn.grayed=!1),i?this._goldDesc.text=Core.StringUtils.format(Core.StringUtils.TEXT(70289),i):this._goldDesc.text="",this._goldResCom1.setInfo(WarResType.Gold,this._fromCity.gold-(r+n)),[2]})})},i.prototype._countFoodGold=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r,n,o,s;return __generator(this,function(a){return t=0,t=Data.parameter.get("task_target_transport").para_value[1],e=this._foodMemberCnt.value,i=this._foodCnt.value,r=e*t,n=i*e,e?this._foodCntDesc.text=Core.StringUtils.format(Core.StringUtils.TEXT(70291),r):this._foodCntDesc.text="",r<=this._fromCity.forage&&n<=this._fromCity.gold&&(o=e,0==o&&(o=1),s=Math.min(1e4,Math.floor(this._fromCity.gold/o)),i>s&&(i=s,this._foodCnt.value=i),this._foodCnt.max=s),0==e?(this._foodConfirmBtn.touchable=!1,this._foodConfirmBtn.grayed=!0):(this._foodConfirmBtn.touchable=!0,this._foodConfirmBtn.grayed=!1),i?this._foodDesc.text=Core.StringUtils.format(Core.StringUtils.TEXT(70288),i):this._foodDesc.text="",this._goldResCom2.setInfo(WarResType.Gold,this._fromCity.gold-i*e),this._foodResCom.setInfo(WarResType.Forage,this._fromCity.forage-r),[2]})})},i.prototype._onClose=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.closeView(this),[2]})})},i.prototype._onGoldConfirm=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return e=parseInt(this._goldInput.text),i=parseInt(this._goldMemberInput.text),r=pb.TransportTypeEnum.GoldTT,0>=i?[2]:[4,t.WarMgr.inst.publishMission(pb.CampaignMsType.Transport,e,i,r,this._cityPath)];case 1:return n=o.sent(),n&&Core.ViewManager.inst.closeView(this),[2]}})})},i.prototype._onFoodConfirm=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n;return __generator(this,function(o){switch(o.label){case 0:return e=this._foodCnt.value,i=parseInt(this._foodMemberInput.text),r=pb.TransportTypeEnum.ForageTT,[4,t.WarMgr.inst.publishMission(pb.CampaignMsType.Transport,e,i,r,this._cityPath)];case 1:return n=o.sent(),n&&Core.ViewManager.inst.closeView(this),[2]}})})},i.prototype._reCity=function(e){var i=e.data;i&&this._refresh(i),t.WarMgr.inst.joinSelectCityMode(!1,t.MapState.Transport),Core.EventCenter.inst.removeEventListener(t.WarMgr.SelectCity,this._reCity,this)},i.prototype._onGoldBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._countGold(),[2]})})},i.prototype._onFoodBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._countFoodGold(),[2]})})},i.prototype._reSelect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t.WarMgr.inst.joinSelectCityMode(!0,t.MapState.Transport),Core.EventCenter.inst.addEventListener(t.WarMgr.SelectCity,this._reCity,this),[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseWindow);t.QuestTransReleaseWnd=e,__reflect(e.prototype,"War.QuestTransReleaseWnd")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.center(),this.modal=!0,this._forageCom=this.contentPane.getChild("liangcao").asCom,this._goldInput=this.contentPane.getChild("goldInput").asTextInput,this._nowPrice=this.contentPane.getChild("nowPrice").asTextField,this._confirmBtn=this.contentPane.getChild("confirmBtn").asButton,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._confirmBtn.addClickListener(this._onConfirmBtn,this),this._closeBtn.addClickListener(this._onCloseBtn,this),this._goldInput.addEventListener(fairygui.ItemEvent.FOCUS_OUT,this._goldInputChange,this)},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];
return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.open.apply(this,t),this._city=t[0],this._refresh(),[2]})})},i.prototype._refresh=function(){this._city=t.CityMgr.inst.getCity(t.MyWarPlayer.inst.cityID),this._forageCom.setInfo(WarResType.Forage,this._city.forage),this._goldInput.text="1",this._nowPrice.text="之前价格："+this._city.foragePrice.toString(),this._goldInputChange()},i.prototype._goldInputChange=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){return t=this._goldInput.text,e=Utils.str2num(t),(!e||0>=e)&&(this._goldInput.text="1"),[2]})})},i.prototype._onConfirmBtn=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){switch(r.label){case 0:return e=parseInt(this._goldInput.text),[4,t.WarMgr.inst.setForagePrice(e)];case 1:return i=r.sent(),i&&Core.ViewManager.inst.closeView(this),[2]}})})},i.prototype._onCloseBtn=function(){Core.ViewManager.inst.closeView(this)},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseWindow);t.SetFoodPriceWnd=e,__reflect(e.prototype,"War.SetFoodPriceWnd")}(War||(War={}));var War;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this._aniClose=this.getTransition("t0"),this._aniOpen=this.getTransition("t1"),this.adjust(this.getChild("bg")),this._parent=Core.LayerManager.inst.topLayer},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(r){switch(r.label){case 0:return this.visible=!0,[4,t.prototype.open.apply(this,e)];case 1:return r.sent(),[4,new Promise(function(t){i._aniClose.play(function(){t()},null,null,1)})];case 2:return r.sent(),[2]}})})},e.prototype.dismiss=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){t._aniOpen.play(function(){e()},null,null,1)})];case 1:return e.sent(),[2]}})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,t.prototype.close.apply(this,e)];case 1:return i.sent(),this.visible=!1,[2]}})})},e}(Core.BaseView);t.WarEnterAniView=e,__reflect(e.prototype,"War.WarEnterAniView")}(War||(War={}));var War;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._cardIcon=this.getChild("headIcon").asImage,this._cardPowerText=this.getChild("value").asTextField,this._cardName=this.getChild("name").asTextField,this._selectCtr=this.getController("select"),this._disableCtr=this.getController("disable"),this._teamCtr=this.getController("team"),this._nameBg=this.getChild("nameBg").asLoader,this._cardName.textParser=Core.StringUtils.parseColorText},e.prototype.setInfo=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(n){return i="",this._card=CardPool.CardPoolMgr.inst.getCollectCard(t),r=this._card.skin,i=""==r||void 0==r?"avatar_"+t+"_png":"avatar_"+Data.skin_config.get(r).head+"_png",99==this._card.rare?this._nameBg.url="pvp_name_limited_png":this._nameBg.url="pvp_name_normal_png",this.getChild("n13").visible=!1,Utils.setImageUrlPicture(this._cardIcon,i),this.setChoose(!1),this.setClick(!0),this.setPower(e),this._cardName.text=this._card.name.toString(),[2]})})},e.prototype.setChoose=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t?this._selectCtr.selectedIndex=1:this._selectCtr.selectedIndex=0,[2]})})},e.prototype.setClick=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.touchable=t,t?this._disableCtr.selectedIndex=0:this._disableCtr.selectedIndex=1,[2]})})},e.prototype.setInTeam=function(t){this._teamCtr.selectedIndex=t},e.prototype.setPower=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return t&&t!=WarMsType.Transport?(e=this._card.gcardId,this._cardPowerText.visible=!0,this._cardPowerText.text=""+this._card.getPower(t),this._power=this._card.getPower(t)):(this._power=0,this._cardPowerText.visible=!1),[2]})})},Object.defineProperty(e.prototype,"cardID",{get:function(){return this._card.cardId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cardCamp",{get:function(){return this._card.camp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cardPower",{get:function(){return this._power},enumerable:!0,configurable:!0}),e}(fairygui.GComponent);t.WarCardHeadCom=e,__reflect(e.prototype,"War.WarCardHeadCom")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this._banFightBtn=this.contentPane.getChild("banFightBtn").asButton,this._enterBtn=this.contentPane.getChild("enterBtn").asButton},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.open.apply(this,t),this._cityID=t[0],this._updateCanEnter(),this._updateCanAttack(),this._emptyHint.visible=this._city.playerNum<=0,this.refreshPlayers(),[2]})})},i.prototype._updateCanEnter=function(){t.MyWarPlayer.inst.isMyCountryCity(this._cityID)?this._enterBtn.visible=!(t.MyWarPlayer.inst.locationCityID==this._cityID):this._enterBtn.visible=!1},i.prototype._updateCanAttack=function(){},i.prototype.refreshPlayers=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._playerList.removeChildrenToPool(),[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i.prototype._onbanFightBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},i}(t.BaseCityInfoWnd);t.WarCityInfoWnd=e,__reflect(e.prototype,"War.WarCityInfoWnd")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.modal=!0,this.center(),this._gainResCom=this.getChild("liangcao").asCom,this._winCityText=this.getChild("getCity").asTextField,this._loseCityText=this.getChild("loseCity").asTextField,this._okBtn=this.getChild("confirmBtn").asButton,this._okBtn.addClickListener(this._onClose,this)},i.prototype._onClose=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,t.WarMgr.inst.changeStatus(t.BattleStatusName.ST_NORMAL,this._data.NextWarRemainTime)];case 1:return e.sent(),Core.ViewManager.inst.closeView(this),[2]}})})},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,n,o;return __generator(this,function(s){return e.prototype.open.apply(this,i),r=i[0],this._callback=i[1],this._gainResCom.setInfo(WarResType.Contribution,r.Contribution),this._gainResCom.setTextAlign(fairygui.AlignType.Center),n="",r.OccupyCitys.forEach(function(e){var i=t.CityMgr.inst.getCity(e);n+=" "+i.cityName}),this._winCityText.text=n,o="",r.LostCitys.forEach(function(e){var i=t.CityMgr.inst.getCity(e);o+=" "+i.cityName}),this._loseCityText.text=o,this._data=r,[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),this._callback&&this._callback(),[2]})})},i}(Core.BaseWindow);t.WarEndView=e,__reflect(e.prototype,"War.WarEndView")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._quitBtn=this.getChild("quitBtn").asButton,this._cancelBtn=this.getChild("cancelBtn").asButton,this._continueBtn=this.getChild("continueBtn").asButton,this._waitProgress=this.getChild("shangyeProgress").asCom,this._foodText=this.getChild("foodInput").asTextField,this._statusCtrl=this.getController("status"),this._quitBtn.addClickListener(this._onQuitBtn,this),this._continueBtn.addClickListener(this._onContinueBtn,this),this._cancelBtn.addClickListener(this._onCancelBtn,this)},i.prototype.watch=function(){t.MyWarPlayer.inst.watchProp(t.MyWarPlayer.PropForage,this._updateFood,this)},i.prototype._updateFood=function(){this._foodText.text=t.MyWarPlayer.inst.forage.toString()},i.prototype.unwatch=function(){t.MyWarPlayer.inst.unwatchProp(t.MyWarPlayer.PropForage,this._updateFood,this)},i.prototype.setTeamStatus=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i]},i.prototype.closePanel=function(){this.visible=!1},i.prototype.updateContinueStatus=function(){var e=t.WarTeamMgr.inst.myTeam;if(e){this.visible=!0,this._statusCtrl.selectedIndex=5,this._foodText.text=t.MyWarPlayer.inst.forage.toString();var i=this.getChild("attackPlayerContinueTxt1").asTextField;e.inStatus(t.TeamStatusName.ST_CAN_ATT_CITY)?i.text=Core.StringUtils.format(Core.StringUtils.TEXT(70292)):e.inStatus(t.TeamStatusName.ST_FIELD_BATTLE_END)?i.text=Core.StringUtils.format(Core.StringUtils.TEXT(70293)):e.inStatus(t.TeamStatusName.ST_DEF_BATTLE_END)&&(i.text=Core.StringUtils.format(Core.StringUtils.TEXT(70294)))}},i.prototype.updateRectifyStatus=function(e,i){this.visible=!0,this._statusCtrl.selectedIndex=4,this._foodText.text=t.MyWarPlayer.inst.forage.toString(),this._waitProgress.getChild("text").asTextField.text=Core.StringUtils.format(Core.StringUtils.TEXT(70295),i-e,i),this._waitProgress.setProgress(i-e,i)},i.prototype.updateExpeditionStatus=function(){if(t.WarTeamMgr.inst.myTeam)if(this.visible=!0,t.WarTeamMgr.inst.myTeam.isAttCity()){this._statusCtrl.selectedIndex=2,this._foodText.text=t.MyWarPlayer.inst.forage.toString();var e=t.CityMgr.inst.getCity(t.WarTeamMgr.inst.myTeam.toCityID),i=this.getChild("attackCityTxt2").asTextField;i.text=Core.StringUtils.format(Core.StringUtils.TEXT(70296),e.cityName)}else{this._statusCtrl.selectedIndex=1,this._foodText.text=t.MyWarPlayer.inst.forage.toString();var e=t.CityMgr.inst.getCity(t.WarTeamMgr.inst.myTeam.toCityID),i=this.getChild("attackPlayerTxt2").asTextField;i.text=Core.StringUtils.format(Core.StringUtils.TEXT(70296),e.cityName)}},i.prototype.updateAcctakCityStatus=function(){if(t.WarTeamMgr.inst.myTeam){this.visible=!0,this._statusCtrl.selectedIndex=2,this._foodText.text=t.MyWarPlayer.inst.forage.toString();var e=t.CityMgr.inst.getCity(t.WarTeamMgr.inst.myTeam.toCityID),i=this.getChild("attackCityTxt2").asTextField;i.text=Core.StringUtils.format(Core.StringUtils.TEXT(70296),e.cityName)}},i.prototype.updateSupportStatus=function(){if(t.WarTeamMgr.inst.myTeam){var e=t.CityMgr.inst.getCity(t.WarTeamMgr.inst.myTeam.toCityID);if(e){this.visible=!0,this._statusCtrl.selectedIndex=0,this._foodText.text=t.MyWarPlayer.inst.forage.toString();var i=this.getChild("movePlayerTxt2").asTextField;i.text=Core.StringUtils.format(Core.StringUtils.TEXT(70296),e.cityName)}}},i.prototype.updateDefendStatus=function(){var e=t.CityMgr.inst.getCity(t.MyWarPlayer.inst.locationCityID);if(e){this.visible=!0,this._statusCtrl.selectedIndex=3,this._foodText.text=t.MyWarPlayer.inst.forage.toString();var i=this.getChild("defenseCItyTxt2").asTextField;i.text=Core.StringUtils.format(Core.StringUtils.TEXT(70296),e.cityName)}},i.prototype._onContinueBtn=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return e=t.WarTeamMgr.inst.myTeam,e?e.inStatus(t.TeamStatusName.ST_CAN_ATT_CITY)?[4,Net.rpcCall(pb.MessageID.C2S_BEGIN_ATTACK_CITY,null)]:[3,2]:[3,6];case 1:return i.sent(),[3,6];case 2:return e.inStatus(t.TeamStatusName.ST_FIELD_BATTLE_END)?[4,Net.rpcCall(pb.MessageID.C2S_MY_TEAM_MARCH,null)]:[3,4];case 3:return i.sent(),[3,6];case 4:return e.inStatus(t.TeamStatusName.ST_DEF_BATTLE_END)?[4,Net.rpcCall(pb.MessageID.C2S_DEF_CITY,null)]:[3,6];case 5:i.sent(),i.label=6;case 6:return[2]}})})},i.prototype._onQuitBtn=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=t.WarTeamMgr.inst.myTeam,e&&(e.inStatus(t.TeamStatusName.ST_CAN_ATT_CITY)?this._onQuit():e.inStatus(t.TeamStatusName.ST_FIELD_BATTLE_END)?this._onQuit():e.inStatus(t.TeamStatusName.ST_DEF_BATTLE_END)&&this._onCanelDefCity()),[2]})})},i.prototype._onCancelBtn=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(i){return t.MyWarPlayer.inst.inStatus(t.PlayerStatusName.ST_DEFEND)?Core.TipsUtils.confirm(Core.StringUtils.TEXT(70297),function(){e._onCanelDefCity()},null,this):Core.TipsUtils.confirm(Core.StringUtils.TEXT(70298),function(){e._onQuit()},null,this),[2]})})},i.prototype._onCanelDefCity=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_CANCEL_DEF_CITY,null)];case 1:return e=i.sent(),0==e.errcode&&(t.WarTeamMgr.inst.myTeam&&t.WarTeamMgr.inst.myTeam.changeStatus(t.TeamStatusName.ST_DISAPPEAR),t.WarMgr.inst.warView.setCloseBtn(!0),t.MyWarPlayer.inst.changeStatus(t.PlayerStatusName.ST_NORMAL)),[2]}})})},i.prototype._onQuit=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o;return __generator(this,function(s){switch(s.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_MY_TEAM_RETREAT,null)];case 1:return e=s.sent(),0==e.errcode&&(i=pb.TeamRetreat.decode(e.payload),i.NewCity!=i.OldCity?(r=t.CityMgr.inst.getCity(i.OldCity),n=t.CityMgr.inst.getCity(i.NewCity),r&&n&&Core.TipsUtils.alert(Core.StringUtils.format(Core.StringUtils.TEXT(70299),r.cityName,n.cityName))):(o=t.CityMgr.inst.getCity(t.MyWarPlayer.inst.cityID),o&&Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70300),o.cityName))),t.WarTeamMgr.inst.myTeam&&t.WarTeamMgr.inst.myTeam.changeStatus(t.TeamStatusName.ST_DISAPPEAR),t.WarMgr.inst.warView.setCloseBtn(!0),t.MyWarPlayer.inst.changeStatus(t.PlayerStatusName.ST_NORMAL)),[2]}})})},i}(fairygui.GComponent);t.WarFightStatusPanel=e,__reflect(e.prototype,"War.WarFightStatusPanel")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){this._titleText=this.getChild("n1").asTextField,this._descText=this.getChild("txt2").asTextField,this._surrenderBtn=this.getChild("surrenderBtn").asButton,this._runAwayBtn=this.getChild("runAwayBtn").asButton,this._surrenderBtn.addClickListener(this._onSurrenderBtn,this),this._runAwayBtn.addClickListener(this._onRunAwayBtn,this)},i.prototype.showPanel=function(){this.visible=!0;var e=t.CityMgr.inst.getCity(t.MyWarPlayer.inst.locationCityID);if(0!=e.countryID){var i=t.CountryMgr.inst.getCountry(e.countryID);if(i)return void(this._titleText.text=Core.StringUtils.format(Core.StringUtils.TEXT(70301),e.cityName,i.countryName))}this._titleText.text=Core.StringUtils.format(Core.StringUtils.TEXT(70302),e.cityName)},i.prototype.closePanel=function(){this.visible=!1},i.prototype._onSurrenderBtn=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n,o=this;return __generator(this,function(s){return e=t.CityMgr.inst.getCity(t.MyWarPlayer.inst.locationCityID),0!=e.countryID&&(i=t.CountryMgr.inst.getCountry(e.countryID))?(r=.1,n=t.MyWarPlayer.inst.getOffContribution(r),Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70303),100*r,n,t.CountryMgr.inst.getCountry(e.countryID).countryName),function(){return __awaiter(o,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return[4,t.WarMgr.inst.surrender()];case 1:return r=n.sent(),r&&(t.MyWarPlayer.inst.countryID=i.countryID,t.MyWarPlayer.inst.cityID=e.cityID,Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70304),e.cityName)),t.WarMgr.inst.warView.map.moveCenter(e)),[2]}})})},null,this),[2]):(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70305))),[2])})})},i.prototype._onRunAwayBtn=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n=this;return __generator(this,function(o){return e=t.MyWarPlayer.inst.countryID,i=t.CountryMgr.inst.getCountry(e),r="",r=i?Core.StringUtils.format(Core.StringUtils.TEXT(70306)):Core.StringUtils.format(Core.StringUtils.TEXT(70307)),Core.TipsUtils.confirm(r,function(){return __awaiter(n,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,t.WarMgr.inst.runAway()];case 1:return e=i.sent(),[2]}})})},null,this),[2]})})},i}(fairygui.GComponent);t.WarGameOverPanel=e,__reflect(e.prototype,"War.WarGameOverPanel")}(War||(War={}));var War;!function(t){var e;!function(t){t[t.JoinCity=0]="JoinCity",t[t.ReadyWar=1]="ReadyWar",t[t.InWar=2]="InWar"}(e=t.WarTipType||(t.WarTipType={}));var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._titleText=this.getChild("n1").asTextField,this._descText=this.getChild("txt2").asTextField,this._title="",this._desc=""},i.prototype.showTipNormal=function(){this.visible=!0,0==t.MyWarPlayer.inst.cityID?(this._title=Core.StringUtils.TEXT(70308),this._desc=Core.StringUtils.TEXT(70309)):(this._title=Core.StringUtils.TEXT(70310),this._desc="{0}"),this._titleText.text=Core.StringUtils.format(this._title,Core.StringUtils.secToString(t.WarMgr.inst.getCurStatusRemainTime(),"hms")),this._descText.text=Core.StringUtils.format(this._desc,Core.StringUtils.secToString(t.WarMgr.inst.getCurStatusRemainTime(),"hms")),this._startTimer()},i.prototype.showTipPrePare=function(){this.visible=!0,0!=t.MyWarPlayer.inst.countryID?(this._title=Core.StringUtils.TEXT(70311),this._desc=Core.StringUtils.TEXT(70312),this._titleText.text=Core.StringUtils.format(this._title,Core.StringUtils.secToString(t.WarMgr.inst.getCurStatusRemainTime(),"hms")),this._descText.text=Core.StringUtils.format(this._desc)):(this._title=Core.StringUtils.TEXT(70311),this._desc=Core.StringUtils.TEXT(70314),this._titleText.text=""+Core.StringUtils.secToString(t.WarMgr.inst.getCurStatusRemainTime(),"hms"),this._descText.text=this._desc),this._startTimer()},i.prototype.showTipInWar=function(){this.visible=!0,0!=t.MyWarPlayer.inst.countryID?(this._title=Core.StringUtils.TEXT(70315),this._desc=Core.StringUtils.TEXT(70316),this._titleText.text=Core.StringUtils.format(this._title,Core.StringUtils.secToString(t.WarMgr.inst.getCurStatusRemainTime(),"hms")),this._descText.text=Core.StringUtils.format(this._desc)):(this._title=Core.StringUtils.TEXT(70315),this._desc=Core.StringUtils.TEXT(70314),this._titleText.text=""+Core.StringUtils.secToString(t.WarMgr.inst.getCurStatusRemainTime(),"hms"),this._descText.text=this._desc),this._startTimer()},i.prototype._startTimer=function(){fairygui.GTimers.inst.add(1e3,-1,this._updateTimer,this)},i.prototype._updateTimer=function(){this._time-=1,this._time<=0?this.closeTip():(this._titleText.text=Core.StringUtils.format(this._title,Core.StringUtils.secToString(t.WarMgr.inst.getCurStatusRemainTime(),"hms")),this._descText.text=Core.StringUtils.format(this._desc,Core.StringUtils.secToString(t.WarMgr.inst.getCurStatusRemainTime(),"hms")))},i.prototype.closeTip=function(){fairygui.GTimers.inst.remove(this._updateTimer,this),this.visible=!1},i}(fairygui.GComponent);t.WarHomeTipPanel=i,__reflect(i.prototype,"War.WarHomeTipPanel")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.adjust(this.getChild("bg")),this._mapParent=this.getChild("map").asCom,this._map=this._mapParent.getChild("map").asCom,this._mapBackBtn=this._mapParent.getChild("backBtn").asButton,this._mapBackBtn.visible=!1,this._mapBackBtn.addClickListener(function(){Core.EventCenter.inst.dispatchEventWith(t.WarMgr.SelectCity,!1)},this),this._selectCity=this._mapParent.getChild("selectCityPanel").asCom,this._selectCity.visible=!1,this._moreCtr=this.getController("more"),this._closeBtn=this.getChild("n2").asButton,this._cityBtn=this.getChild("cityBtn").asButton,this._questBtn=this.getChild("questBtn").asButton,this._fightBtn=this.getChild("fightBtn").asButton,this._warShopBtn=this.getChild("shopBtn").asButton,this._topTipPanel=this.getChild("selectCityPanel").asCom,this._gameOverPanel=this.getChild("n17").asCom,this._gameOverPanel.visible=!1,this._fightPanel=this.getChild("n14").asCom,this._fightPanel.visible=!1,this._functionList=this.getChild("commonFunction").asList,this._worldBtn=this._functionList.getChild("worldBtn").asButton,this._noticeBtn=this._functionList.getChild("noticeBtn").asButton,this._countryAppointBtn=this.getChild("countryAppointBtn").asButton,this._battlePointText=this.getChild("battlePoint").asTextField,this._battleIcon=this.getChild("battleIcon").asLoader,this._cityBtn.addClickListener(this._onMyCity,this),this._questBtn.addClickListener(this._onQuest,this),this._closeBtn.addClickListener(this._onCloseBtn,this),this._worldBtn.addClickListener(this._onWorldBtn,this),this._noticeBtn.addClickListener(this._onNoticeBtn,this),this._countryAppointBtn.addClickListener(this._onCountryAppointBtn,this),this._battleIcon.addClickListener(this._onBattleIcon,this),this._fightBtn.addClickListener(this._onFightBtn,this),this._warShopBtn.addClickListener(this._onWarShopBtn,this),this.getChild("battlePointBg").asLoader.y+=window.support.topMargin,this.getChild("selectCityPanel").asCom.y+=window.support.topMargin},Object.defineProperty(i.prototype,"fightStatusPanel",{get:function(){return this._fightPanel},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"arrestPanel",{get:function(){return this._gameOverPanel},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"warStatusPanel",{get:function(){return this._topTipPanel},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fightBtn",{get:function(){return this._fightBtn},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"questBtn",{get:function(){return this._questBtn},enumerable:!0,configurable:!0}),i.prototype._onMyCity=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._map.moveCenter(),t.MyWarPlayer.inst.cityID&&0!=t.MyWarPlayer.inst.cityID&&t.WarMgr.inst.openMyCityInfo(),[2]})})},i.prototype._onQuest=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t.MyWarPlayer.inst.inStatus(t.PlayerStatusName.ST_ARREST)?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70317)),[2]):t.WarMgr.inst.inStatus(t.BattleStatusName.ST_DURING)||t.WarMgr.inst.inStatus(t.BattleStatusName.ST_PREPARE)?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70318)),[2]):(this._questBtn.getChild("n7").visible=!1,t.WarMgr.inst.openMyQuestInfo(),[2])})})},i.prototype._onWorldBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t.WarMgr.inst.openCityListPanel(),[2]})})},i.prototype._onNoticeBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t.MyWarPlayer.inst.countryID&&0!=t.MyWarPlayer.inst.countryID?(Core.ViewManager.inst.open(ViewName.warNoticePanel),[2]):(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70374)),[2])})})},i.prototype._onCountryAppointBtn=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return t.MyWarPlayer.inst.inStatus(t.PlayerStatusName.ST_ARREST)?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70373)),[2]):(e=t.CountryMgr.inst.getCountry(t.MyWarPlayer.inst.countryID),[4,Net.rpcCall(pb.MessageID.C2S_FETCH_COUNTRY_JOB_PLAYERS,null)]);case 1:return i=n.sent(),0==i.errcode&&(r=pb.CampaignPlayerList.decode(i.payload),e.setCountryPlayers(r.Players)),Core.ViewManager.inst.open(ViewName.countryAppointPanel,e),[2]}})})},i.prototype._onBattleIcon=function(){var t=fairygui.UIPackage.createObject(PkgName.cards,ViewName.skillInfo).asCom;t.getChild("skillDescTxt").asRichTextField.text=Core.StringUtils.TEXT(70214),this._parent.addChild(t);var e;e=function(){t.parent.removeChild(t),egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_END,e,t)},egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_END,e,t),t.center(),t.y=this._battleIcon.y+this._battleIcon.height},i.prototype._onFightBtn=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return t.MyWarPlayer.inst.inStatus(t.PlayerStatusName.ST_ARREST)?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70319)),[2]):(e=t.MyWarPlayer.inst.locationCityID,e&&0!=e?t.WarMgr.inst.inStatus(t.BattleStatusName.ST_DURING)||t.WarMgr.inst.inStatus(t.BattleStatusName.ST_PREPARE)?(i=t.CityMgr.inst.getCity(e),[4,t.WarMgr.inst.fetchMilitaryOrders(i)]):[3,2]:(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70320)),[2]));case 1:return r=n.sent(),r&&(this._map.moveCenter(i),Core.ViewManager.inst.open(ViewName.questFightPanel,i)),[3,3];case 2:return Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70321)),[2];case 3:return[2]}})})},i.prototype._onWarShopBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.open(ViewName.warShopView),[2]})})},i.prototype._onCloseBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t.WarTeamMgr.inst.myTeam?[2]:(Core.ViewManager.inst.closeView(this),[2])})})},i.prototype.setCloseBtn=function(t){this._closeBtn.visible=t},Object.defineProperty(i.prototype,"mapView",{get:function(){return this._map},enumerable:!0,configurable:!0}),i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return e.prototype.open.apply(this,i),this._noticeBtn.getChild("n6").asCom.getChild("textNum").visible=!1,this._moreCtr.selectedIndex=0,this._map.loadResMap(),this._fightPanel.closePanel(),this.setCloseBtn(!0),Core.ViewManager.inst.getView(ViewName.newHome).setVisible(!1),Core.EventCenter.inst.addEventListener(t.WarMgr.ShowNotifyRedDot,this._showNotifyReDot,this),Core.EventCenter.inst.addEventListener(t.WarMgr.ShowMissionRedDot,this._showMissionReDot,this),this.watch(),[2]})})},i.prototype.initMap=function(){this._map.initSize(),this._map.beginDragDetect()},i.prototype.watch=function(){t.MyWarPlayer.inst.watchProp(t.MyWarPlayer.PropLocationCity,this._updateCityBtn,this),t.MyWarPlayer.inst.watchProp(t.MyWarPlayer.PropCity,this._updateQuestBtn,this),t.MyWarPlayer.inst.watchProp(t.MyWarPlayer.PropCountry,this.refreshHomeView,this),t.MyWarPlayer.inst.watchProp(t.MyWarPlayer.PropContribution,this._updateContribution,this),this._fightPanel.watch()},i.prototype.unwatch=function(){t.MyWarPlayer.inst.unwatchProp(t.MyWarPlayer.PropLocationCity,this._updateCityBtn,this),t.MyWarPlayer.inst.unwatchProp(t.MyWarPlayer.PropCity,this._updateQuestBtn,this),t.MyWarPlayer.inst.unwatchProp(t.MyWarPlayer.PropCountry,this.refreshHomeView,this),t.MyWarPlayer.inst.unwatchProp(t.MyWarPlayer.PropContribution,this._updateContribution,this),this._fightPanel.unwatch()},i.prototype._updateCityBtn=function(){var e=0!=t.MyWarPlayer.inst.locationCityID;this._cityBtn.touchable=e,this._cityBtn.grayed=!e,this._fightBtn.touchable=e,this._fightBtn.grayed=!e},i.prototype._updateQuestBtn=function(){var e=!1;if(0==t.MyWarPlayer.inst.cityID)e=!1;else{var i=t.CityMgr.inst.getCity(t.MyWarPlayer.inst.cityID);i&&0!=i.countryID&&(e=!0)}this._questBtn.touchable=e,this._questBtn.grayed=!e},i.prototype.updateFightAndQuest=function(){t.WarMgr.inst.inStatus(t.BattleStatusName.ST_DURING)||t.WarMgr.inst.inStatus(t.BattleStatusName.ST_PREPARE)?(this._fightBtn.visible=!0,this._questBtn.visible=!1):(this._fightBtn.visible=!1,this._questBtn.visible=!0)},i.prototype._updateCountryBtn=function(){this._countryAppointBtn.visible=0!=t.MyWarPlayer.inst.countryID},i.prototype._updateContribution=function(){this._battlePointText.text=""+t.MyWarPlayer.inst.contribution},i.prototype.updateFightTip=function(){t.MyWarPlayer.inst.inStatus(t.PlayerStatusName.ST_DEFEND)?this._fightPanel.updateDefendStatus():t.MyWarPlayer.inst.inStatus(t.PlayerStatusName.ST_EXPEDITION)?this._fightPanel.updateExpeditionStatus():t.MyWarPlayer.inst.inStatus(t.PlayerStatusName.ST_SUPPORT)&&this._fightPanel.updateSupportStatus()},i.prototype.updateHomeTip=function(){t.WarMgr.inst.inStatus(t.BattleStatusName.ST_NORMAL)?this._topTipPanel.showTipNormal():t.WarMgr.inst.inStatus(t.BattleStatusName.ST_PREPARE)?this._topTipPanel.showTipPrePare():t.WarMgr.inst.inStatus(t.BattleStatusName.ST_DURING)&&this._topTipPanel.showTipInWar()},i.prototype.joinSelectMode=function(e,i){this._mapBackBtn.visible=e,this._selectCity.visible=e;var r=null;fairygui.GRoot.inst;if(e){r=this.localToGlobal(this._mapParent.x,this._mapParent.y),Core.LayerManager.inst.mainLayer.addChild(this._mapParent);var n=Core.LayerManager.inst.mainLayer.globalToLocal(r.x,r.y);this._mapParent.x=n.x,this._mapParent.y=n.y,i==t.MapState.Transport?this._selectCity.getChild("txt2").text=Core.StringUtils.TEXT(70322):i==t.MapState.SelectMy?this._selectCity.getChild("txt2").text=Core.StringUtils.TEXT(70323):i==t.MapState.SelectEnemy?this._selectCity.getChild("txt2").text=Core.StringUtils.TEXT(70324):i==t.MapState.SurrenderCity?this._selectCity.getChild("txt2").text=Core.StringUtils.TEXT(70325):i==t.MapState.SurrenderCamp&&(this._selectCity.getChild("txt2").text=Core.StringUtils.TEXT(70326))}else{r=Core.LayerManager.inst.mainLayer.localToGlobal(this._mapParent.x,this._mapParent.y),this.addChild(this._mapParent),this.setChildIndex(this._mapParent,1);var n=this.globalToLocal(r.x,r.y);this._mapParent.x=n.x,this._mapParent.y=n.y}},i.prototype.refreshHomeView=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._topTipPanel.closeTip(),this._fightBtn.getChild("n7").visible=!1,this._fightBtn.getChild("time").visible=!1,t.MyWarPlayer.inst.inStatus(t.PlayerStatusName.ST_ARREST)?this._gameOverPanel.showPanel():(this._gameOverPanel.closePanel(),this.updateFightTip(),this.updateHomeTip()),this._questBtn.getChild("n7").visible=t.WarMgr.inst.hasCompleteMisson,this._noticeBtn.getChild("n6").visible=t.WarMgr.inst.hasNewNotice,this._questBtn.getChild("time").visible=!1,this.updateFightAndQuest(),this._updateCityBtn(),this._updateContribution(),this._updateCountryBtn(),this._updateQuestBtn(),[2]})})},i.prototype._refreshMapCity=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=t.data,this._map.refreshCity(e),[2]})})},i.prototype._showNotifyReDot=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._noticeBtn.getChild("n6").visible=!0,[2]
})})},i.prototype._showMissionReDot=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._questBtn.getChild("n7").visible=!0,[2]})})},i.prototype.close=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return e.prototype.close.apply(this,i),this.unwatch(),this._map.destroyResMap(),t.WarMgr.inst.onDestroy(),[4,Net.rpcPush(pb.MessageID.C2S_LEAVE_CAMPAIGN_SCENE,null)];case 1:return r.sent(),Core.ViewManager.inst.getView(ViewName.newHome).setVisible(!0),[2]}})})},Object.defineProperty(i.prototype,"map",{get:function(){return this._map},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"warTipPanel",{get:function(){return this._topTipPanel},enumerable:!0,configurable:!0}),i}(Core.BaseView);t.WarHomeView=e,__reflect(e.prototype,"War.WarHomeView")}(War||(War={}));var War;!function(t){var e=function(){function e(t){this._id=t.ID,this._type=t.Type,this._time=t.Time,this._mailDesc=Data.war_mail_config.get(this._type),this._mailData=t.Args}return Object.defineProperty(e.prototype,"title",{get:function(){return this._mailDesc.title},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"content",{get:function(){switch(this._type){case pb.CampaignNoticeType.NewCountryNt:var e=pb.NewCountryNtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,e.PlayerName,t.CityMgr.inst.getCity(e.CityID).cityName,e.CountryName);case pb.CampaignNoticeType.AppointJobNt:var e=pb.AppointJobNtArg.decode(this._mailData);if(e.Job>3){var i=t.CityMgr.inst.getCity(e.CityID);return Core.StringUtils.format(this._mailDesc.content,e.PlayerName,e.TargetPlayerName,i.cityName+Utils.job2Text(e.Job,!0))}return Core.StringUtils.format(this._mailDesc.content,e.PlayerName,e.TargetPlayerName,Utils.job2Text(e.Job,!0));case pb.CampaignNoticeType.RecallJobNt:var e=pb.RecallJobNtArg.decode(this._mailData);if(e.Job>3){var r=e.CityID,i=t.CityMgr.inst.getCity(r);return Core.StringUtils.format(this._mailDesc.content,i.cityName,Utils.job2Text(e.Job,!0))}return Core.StringUtils.format(this._mailDesc.content,"",Utils.job2Text(e.Job,!0));case pb.CampaignNoticeType.AutocephalyNt:var e=pb.AutocephalyNtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,Utils.job2Text(e.Job,!0),e.PlayerName,e.CountryName,e.NewCountryName);case pb.CampaignNoticeType.KickOutNt:var e=pb.KickOutNtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,Utils.job2Text(e.Job,!0),e.PlayerName,t.CityMgr.inst.getCity(e.CityID).cityName);case pb.CampaignNoticeType.YourMajestyChangeNt:var e=pb.YourMajestyChangeNtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,e.YourMajestyName,e.NewYourMajestyName);case pb.CampaignNoticeType.ResignNt:var e=pb.ResignNtArg.decode(this._mailData);if(e.Job>3){var r=e.CityID,i=t.CityMgr.inst.getCity(r);return Core.StringUtils.format(this._mailDesc.content,i.cityName,Utils.job2Text(e.Job,!0),e.PlayerName)}return Core.StringUtils.format(this._mailDesc.content,"",Utils.job2Text(e.Job,!0),e.PlayerName);case pb.CampaignNoticeType.ClearMissionNt:return Core.StringUtils.format(this._mailDesc.content);case pb.CampaignNoticeType.BeOccupyNt:var e=pb.BeOccupyNtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,e.CountryName,t.CityMgr.inst.getCity(e.BeOccupyCityID).cityName,e.CaptiveAmount);case pb.CampaignNoticeType.DestoryCountryNt:var e=pb.DestoryCountryNtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,e.BeDestoryCountryName,e.CountryName);case pb.CampaignNoticeType.UnifiedWordNt:var e=pb.UnifiedWordNtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,e.CountryName,e.YourMajestyName);case pb.CampaignNoticeType.AutocephalyVoteNt:var e=pb.AutocephalyVoteNtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,Utils.job2Text(e.Job,!0),e.PlayerName,e.CountryName,e.CountryName);case pb.CampaignNoticeType.CapitalInjectionNt:var e=pb.CapitalInjectionNtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,Utils.job2Text(e.Job,!0),e.PlayerName,e.Gold);case pb.CampaignNoticeType.ProductionNt:var e=pb.ProductionNtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,e.Forage,e.Gold);case pb.CampaignNoticeType.SalaryNt:var e=pb.SalaryNtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,e.Gold);case pb.CampaignNoticeType.TransportNt:var e=pb.TransportNtArg.decode(this._mailData);return console.log(this._mailDesc.content),Core.StringUtils.format(this._mailDesc.content,t.CityMgr.inst.getCity(e.FromCity).cityName,t.CityMgr.inst.getCity(e.TargetCity).cityName,e.Amount,Utils.warTranType2text(e.TransportType));case pb.CampaignNoticeType.OccupyNt:var e=pb.OccupyNtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,t.CityMgr.inst.getCity(e.OccupyCityID).cityName,e.CaptiveAmount);case pb.CampaignNoticeType.SurrenderNt:var e=pb.SurrenderNtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,e.PlayerName);case pb.CampaignNoticeType.BetrayNt:var e=pb.BetrayNtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,e.PlayerName);case pb.CampaignNoticeType.EscapedNt:var e=pb.EscapedNtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,e.PlayerName);case pb.CampaignNoticeType.EscapedReturnNt:var e=pb.EscapedReturnNtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,e.PlayerName);case pb.CampaignNoticeType.AutoDefOrderNt:var e=pb.TargetCity.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,t.CityMgr.inst.getCity(e.CityID).cityName);case pb.CampaignNoticeType.SurrenderCity1Nt:var e=pb.SurrenderCity1NtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,e.PlayerName,t.CityMgr.inst.getCity(e.CityID).cityName,e.TargetCountryName);case pb.CampaignNoticeType.SurrenderCity2Nt:var e=pb.SurrenderCity2NtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,e.PlayerName,t.CityMgr.inst.getCity(e.CityID).cityName);case pb.CampaignNoticeType.SurrenderCity3Nt:var e=pb.SurrenderCity1NtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,e.PlayerName,t.CityMgr.inst.getCity(e.CityID).cityName,e.TargetCountryName);case pb.CampaignNoticeType.SurrenderCountry1Nt:var e=pb.SurrenderCountry1NtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,e.PlayerName,e.TargetCountryName);case pb.CampaignNoticeType.SurrenderCountry2Nt:var e=pb.SurrenderCountry1NtArg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,e.PlayerName,e.TargetCountryName);case pb.CampaignNoticeType.AutocephalyNt2:var e=pb.AutocephalyNt2Arg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,t.CityMgr.inst.getCity(e.CityID).cityName,Utils.job2Text(e.Job,!0),e.PlayerName,e.OldCountryName,e.NewCountryName);case pb.CampaignNoticeType.AutocephalyNt3:var e=pb.AutocephalyNt3Arg.decode(this._mailData);return Core.StringUtils.format(this._mailDesc.content,e.PlayerName,t.CityMgr.inst.getCity(e.CityID).cityName,e.NewCountryName);default:return""}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return this._time},enumerable:!0,configurable:!0}),e}();t.NoticeData=e,__reflect(e.prototype,"War.NoticeData");var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._headCom=this.getChild("head").asCom,this._timeText=this.getChild("time").asTextField,this._nameText=this.getChild("name").asTextField,this._titleText=this.getChild("title").asTextField,this._titleText.textParser=Core.StringUtils.parseColorText},i.prototype.setNotice=function(t){this._notice=new e(t),this._nameText.text=this._notice.title,this._titleText.text=this._notice.content,this._timeText.text=Core.StringUtils.format(Core.StringUtils.TEXT(60051),Core.StringUtils.secToString(Math.floor(Date.now()/1e3-this._notice.time),"dhm"))},i}(fairygui.GComponent);t.BaseWarNoticeItem=i,__reflect(i.prototype,"War.BaseWarNoticeItem");var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._remainTimeText=null,e._agreeBtn=null,e._refuseBtn=null,e}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._remainTimeText=this.getChild("remainTime").asTextField,this._remainTimeText.visible=!1,this._agreeBtn=this.getChild("agreeBtn").asButton,this._agreeBtn.addClickListener(this._onAgreeBtn,this),this._refuseBtn=this.getChild("refuseBtn").asButton,this._refuseBtn.addClickListener(this._onRefuseBtn,this),this._headIcon=this.getChild("head").asCom.getChild("headIcon").asImage,Utils.setImageUrlPicture(this._headIcon,"society_headicon1_png")},e.prototype.setNotice=function(e){t.prototype.setNotice.call(this,e),this._remainTimeText.visible=!1,this._agreeBtn.visible=!1,this._refuseBtn.visible=!1,this.height=119},e.prototype._onAgreeBtn=function(){},e.prototype._onRefuseBtn=function(){},e}(i);t.WarNoticeItem=r,__reflect(r.prototype,"War.WarNoticeItem");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.center(),this.modal=!0,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._warChatCom=this.contentPane.getChild("chatCom").asCom,this._warChatCom.setChannel(Social.ChatChannel.CampaignCountry),this._closeBtn.addClickListener(function(){Core.ViewManager.inst.closeView(e)},this),Core.EventCenter.inst.addEventListener(GameEvent.ChannelChatEv,this._onChannelChat,this)},e.prototype._onChannelChat=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return t.data.channel==pb.ChatChannel.CampaignCountry&&(e=t.data.chatlet,this._warChatCom.addChatlet(e)),[2]})})},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return t.prototype.open.apply(this,e),[4,this._warChatCom.onChosen(!0)];case 1:return i=r.sent(),i?[4,this._warChatCom.refresh()]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e}(Core.BaseWindow);t.WarNoticePanel=n,__reflect(n.prototype,"War.WarNoticePanel");var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.center(),this.modal=!0,this._warNoticeItemList=new Array,this._noticeList=this.contentPane.getChild("chatletList").asList,this._noticeList.itemClass=r,this._noticeList.itemRenderer=this._renderNotices,this._noticeList.callbackThisObj=this,this._noticeList.setVirtual(),this._hintText=this.contentPane.getChild("emptyHintText").asTextField,this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._closeBtn.addClickListener(this._onCloseBtn,this),this._notices=[]},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,r=this;return __generator(this,function(n){return t.prototype.open.apply(this,e),i=e[0],this._clearList(),i.Notices.forEach(function(t){r._notices.push(t)}),this._noticeList.numItems=this._notices.length,this._hintText.visible=0==this._notices.length,[2]})})},e.prototype._renderNotices=function(t,e){var i=this._notices[this._notices.length-1-t],r=e;r.setNotice(i)},e.prototype._clearList=function(){this._noticeList.numItems=0,this._notices=[]},e.prototype._onCloseBtn=function(){Core.ViewManager.inst.closeView(this)},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),this._clearList(),[2]})})},e}(Core.BaseWindow);t.WarNoticePanel_deprecated=o,__reflect(o.prototype,"War.WarNoticePanel_deprecated")}(War||(War={}));var War;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.constructFromXML=function(t){this._nameText=this.getChild("nameText").asTextField,this._nameText.textParser=Core.StringUtils.parseColorText,this._headCom=this.getChild("lordHead").asCom,this._jobText=this.getChild("job").asRichTextField,this._jobText.textParser=Core.StringUtils.parseColorText,this._jobText.funcParser=Core.StringUtils.parseFuncText},e.prototype.setInfo=function(t){this._info=t,this._nameText.text=t.name,this._jobText.text=t.employee.doubleJobName(!0),this._headCom.setAll(t.headImg,t.headFrame),this._headCom.addClickListener(this._onDetail,this)},e.prototype._onDetail=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,Social.FriendMgr.inst.fetchPlayerInfo(this._info.uID)];case 1:return t=e.sent(),t&&Core.ViewManager.inst.open(ViewName.friendInfo,this._info.uID,t),[2]}})})},e}(fairygui.GComponent);t.WarPlayerItem=e,__reflect(e.prototype,"War.WarPlayerItem")}(War||(War={}));var War;!function(t){var e=function(){function t(){}return t.warMsType2reward=function(t){switch(t){case WarMsType.Irrigation:return Data.parameter.get("task_target_irrigation").para_value[0];case WarMsType.Trade:return Data.parameter.get("task_target_trade").para_value[0];case WarMsType.Build:return Data.parameter.get("task_target_build").para_value[0];default:return 0}},t.warMsPower2text=function(t){switch(t){case WarMsType.Irrigation:return Core.StringUtils.TEXT(70327);case WarMsType.Trade:return Core.StringUtils.TEXT(70328);case WarMsType.Build:return Core.StringUtils.TEXT(70329);default:return""}},t}();t.WarQuest=e,__reflect(e.prototype,"War.WarQuest");var i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.constructFromXML=function(t){this._titleText=this.getChild("title").asTextField,this._suggestText=this.getChild("suggest").asTextField,this._descText=this.getChild("text").asTextField,this._rewardCnt1Text=this.getChild("rewardCnt1").asTextField,this._rewardCnt2Text=this.getChild("rewardCnt2").asTextField,this._rewardIcon2=this.getChild("rewardIcon2").asLoader,this._bg=this.getChild("bg").asLoader,this._acceptBtn=this.getChild("n20").asButton,this._acceptBtn.addClickListener(this._onAcceptBtn,this)},r.prototype.setInfo=function(i,r){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(o){return this._mission=i,n=i.Type,this._type=n,this._suggestText.text=e.warMsPower2text(this._type),this._descText.text=""+Utils.warMsDesc2text(this._type),this._rewardIcon2.url=Utils.warMsType2Url(this._type).toString(),this._bg.url=Utils.warMsBgType2Url(this._type).toString(),this._type==WarMsType.Transport?(this._titleText.text=Core.StringUtils.format(Core.StringUtils.TEXT(70232),Utils.warTranType2text(i.TransportType),t.CityMgr.inst.getCity(i.TransportTargetCity).cityName),this._setReward2(!1)):this._type==WarMsType.Dispatch?(this._titleText.text=Core.StringUtils.format(Core.StringUtils.TEXT(70233),t.CityMgr.inst.getCity(i.TransportTargetCity).cityName),this._setReward2(!1)):(this._titleText.text=Utils.warMsType2text(this._type),this._rewardCnt2Text.text="+"+e.warMsType2reward(this._type),this._setReward2(!0)),this._rewardCnt1Text.text=i.GoldReward.toString(),this._acceptBtn.visible=!r,[2]})})},r.prototype._setReward2=function(t){this._rewardCnt2Text.visible=t,this._rewardIcon2.visible=t},r.prototype._onAcceptBtn=function(){return __awaiter(this,void 0,void 0,function(){var e,i=this;return __generator(this,function(r){return t.MyWarPlayer.inst.isKickOut?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70330)),[2]):(this._type==WarMsType.Dispatch?(e="",t.MyWarPlayer.inst.employee.hasCityOfficialTitle()&&(e=Core.StringUtils.format(Core.StringUtils.TEXT(70331),t.MyWarPlayer.inst.employee.cityJob.name)),Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70332),t.CityMgr.inst.getCity(t.MyWarPlayer.inst.cityID).cityName,t.CityMgr.inst.getCity(this._mission.TransportTargetCity).cityName,e),function(){i._onAcceptMove()},null,this)):Core.ViewManager.inst.open(ViewName.questChooseCardWnd,this._mission),[2])})})},r.prototype._onAcceptMove=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(n){switch(n.label){case 0:return e={Type:this._mission.Type,Cards:null,TransportTargetCity:this._mission.TransportTargetCity},[4,Net.rpcCall(pb.MessageID.C2S_ACCEPT_CAMPAIGN_MISSION,pb.AcceptCampaignMissionArg.encode(e))];case 1:return i=n.sent(),0==i.errcode&&(this._mission.GoldReward>0&&(r=new Pvp.GetRewardData,r.gold=this._mission.GoldReward,Core.ViewManager.inst.open(ViewName.getRewardWnd,r)),Core.TipsUtils.showTipsFromCenter(Core.StringUtils.format(Core.StringUtils.TEXT(70333),t.CityMgr.inst.getCity(this._mission.TransportTargetCity).cityName)),Core.ViewManager.inst.close(ViewName.warQuestPanel)),[2]}})})},r}(fairygui.GComponent);t.WarQuestItem=i,__reflect(i.prototype,"War.WarQuestItem");var r=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._statusCtr=this.getController("status"),this._timeBar=this.getChild("boxProgress").asCom,this._titleText=this.getChild("title").asTextField,this._timeText=this.getChild("time").asTextField,this._card1Com=this.getChild("card1").asCom,this._card2Com=this.getChild("card2").asCom,this._card3Com=this.getChild("card3").asCom,this._card4Com=this.getChild("card4").asCom,this._card5Com=this.getChild("card5").asCom,this._cardList=[this._card1Com,this._card2Com,this._card3Com,this._card4Com,this._card5Com],this._rewardCnt1Text=this.getChild("rewardCnt1").asTextField,this._rewardIcon1=this.getChild("rewardIcon1").asLoader,this._rewardCnt2Text=this.getChild("rewardCnt2").asTextField,this._rewardIcon2=this.getChild("rewardIcon2").asLoader,this._cancelBtn=this.getChild("cancelBtn").asButton,this._completeBtn=this.getChild("completeBtn").asButton,this._cancelBtn.addClickListener(this._onCancelBtn,this),this._completeBtn.addClickListener(this._onGetRewardBtn,this)},i.prototype.setInfo=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t?(this._statusCtr.selectedIndex=0,this.visible=!0,this._setType(t.Type),this._maxTime=t.MaxTime,this._remainTime=t.RemainTime,this._gold=t.GoldReward,this._rewardCnt1Text.text=t.GoldReward.toString(),this._rewardCnt2Text.text="+"+e.warMsType2reward(this._type),this._rewardIcon2.url=Utils.warMsType2Url(this._type).toString(),this._setCard(t.Cards),this._questTimerStart()):(this.visible=!1,this._statusCtr.selectedIndex=0),[2]})})},i.prototype.setCallBack=function(t){this._callBack=t},i.prototype._questComplete=function(t){this._completeBtn.visible=t,this._cancelBtn.visible=!t,t&&(this._timeText.text=Core.StringUtils.TEXT(70334),this._timeBar.setProgress(this._maxTime,this._maxTime))},i.prototype.getNewMission=function(t,i,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return this._statusCtr.selectedIndex=0,this.visible=!0,this._remainTime=i,this._maxTime=i,this._setType(t.Type),this._gold=t.GoldReward,this._rewardCnt1Text.text=t.GoldReward.toString(),this._rewardCnt2Text.text="+"+e.warMsType2reward(this._type),this._rewardIcon2.url=Utils.warMsType2Url(this._type).toString(),this._questTimerStart(),this._setCard(r),[2]})})},i.prototype._setType=function(t){this._type=t,this._type==WarMsType.Transport?(this._titleText.text=""+Utils.warMsType2text(this._type),this._setReward2(!1)):(this._titleText.text=Utils.warMsType2text(this._type),this._setReward2(!0))},i.prototype._setReward2=function(t){this._rewardCnt2Text.visible=t,this._rewardIcon2.visible=t},i.prototype._setCard=function(t){for(var e=0;e<this._cardList.length;e++)e<t.length?(this._cardList[e].visible=!0,this._cardList[e].setInfo(t[e])):this._cardList[e].visible=!1},i.prototype._onGetRewardBtn=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_GET_CAMPAIGN_MISSION_REWARD,null)];case 1:return t=i.sent(),0==t.errcode&&(this._statusCtr.selectedIndex=0,this.visible=!1,this._callBack&&this._callBack(),0!=this._gold&&(e=new Pvp.GetRewardData,e.gold=this._gold,Core.ViewManager.inst.open(ViewName.getRewardWnd,e))),[2]}})})},i.prototype._questTimerStart=function(){this._remainTime>0?(this._timeText.text=Core.StringUtils.secToString(this._remainTime,"hms"),this._timeBar.setProgress(this._maxTime-this._remainTime,this._maxTime),this.questTimerStop(),this._questComplete(!1),fairygui.GTimers.inst.add(1e3,-1,this._questTimer,this)):(this._questComplete(!0),this.questTimerStop())},i.prototype._questTimer=function(){this._remainTime<=0?(this.questTimerStop(),this._questComplete(!0)):(this._timeText.text=Core.StringUtils.secToString(this._remainTime,"hms"),this._timeBar.setProgress(this._maxTime-this._remainTime,this._maxTime)),this._remainTime-=1},i.prototype.questTimerStop=function(){fairygui.GTimers.inst.remove(this._questTimer,this)},i.prototype._onCancelBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.TipsUtils.confirm(Core.StringUtils.TEXT(70335),this._onCancel,null,this),[2]})})},i.prototype._onCancel=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(r){switch(r.label){case 0:return[4,Net.rpcCall(pb.MessageID.C2S_CANCEL_CAMPAIGN_MISSION,null)];case 1:return t=r.sent(),0==t.errcode&&(e=pb.CampaignMissionInfo.decode(t.payload),this._statusCtr.selectedIndex=0,this.visible=!1,this.questTimerStop(),this._callBack&&this._callBack(),i=Core.ViewManager.inst.getView(ViewName.warQuestPanel),i.refesh(e.Missions)),[2]}})})},i}(fairygui.GComponent);t.CurQuestCom=r,__reflect(r.prototype,"War.CurQuestCom");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){var e=this;t.prototype.initUI.call(this),this.center(),this.modal=!0,this._questList=this.contentPane.getChild("questList").asList,this._questList.foldInvisibleItems=!0,this._curQuestCom=fairygui.UIPackage.createObject(PkgName.war,"questStatus").asCom,this._curQuestCom.setCallBack(function(){e._cancelBtn()}),this._questList.addChild(this._curQuestCom),this._closeBtn=this.contentPane.getChild("closeBtn").asButton,this._emptyHint=this.contentPane.getChild("emptyHint").asTextField,this._closeBtn.addClickListener(this._onClose,this)},e.prototype._onClose=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._curQuestCom.questTimerStop(),Core.ViewManager.inst.closeView(this),[2]})})},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){return t.prototype.open.apply(this,e),this._cityID=e[0],i=e[1],this._curQuestCom.setInfo(i.ExecutingMission),i.ExecutingMission?this._hasquest=!0:this._hasquest=!1,this._missions=i.Missions,this._emptyHint.visible=this._missions.length<=0,this.refesh(),[2]})})},e.prototype.refesh=function(t){var e=this;if(t&&(this._missions=t),this._questList.numItems>1)for(var i=this._questList.numItems-1;i>0;i--)this._questList.removeChildAt(i);var r=[];this._missions.forEach(function(t){r.push(t)}),r=r.sort(function(t,e){return t.GoldReward>e.GoldReward?-1:t.GoldReward<e.GoldReward?1:t.Type>e.Type?-1:1}),r.forEach(function(t){var i=fairygui.UIPackage.createObject(PkgName.war,"questItem").asCom;i.setInfo(t,e._hasquest),e._questList.addChild(i)})},e.prototype.getNewMission=function(t,e,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return this._curQuestCom.getNewMission(t,e,i),this._hasquest=!0,[2]})})},e.prototype._cancelBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._hasquest=!1,this.refesh(),[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),this._curQuestCom.questTimerStop(),[2]})})},e}(Core.BaseWindow);t.WarQuestWnd=n,__reflect(n.prototype,"War.WarQuestWnd")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.modal=!0,this.center(),this._campCom=this.getChild("n27").asCom,this._majestyNameText=this.getChild("lordName").asTextField,this._confirmBtn=this.getChild("confirmBtn").asButton,this._confirmBtn.addClickListener(this._onClose,this)},i.prototype.open=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,n,o;return __generator(this,function(s){return e.prototype.open.apply(this,i),r=i[0],n=r.CountryID,o=t.CountryMgr.inst.getCountry(n),this._campCom.setCamp(o),this._majestyNameText.text=r.YourMajestyName,[2]})})},i.prototype._onClose=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.closeView(this),[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseWindow);t.WarUnifiedView=e,__reflect(e.prototype,"War.WarUnifiedView")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this._itemCtr=this.getController("c1"),this._maskCtr=this.getController("c2"),this._price=this.getChild("price").asTextField,this._cardCom=this.getChild("card").asCom,this._equipCom=this.getChild("equip").asCom,this._resCom=this.getChild("gold").asCom,this._skinCom=this.getChild("skin").asCom,this.addClickListener(this._onBox,this)},i.prototype.setType=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return this._warShopType=t,this._warItemData=e,this._itemCtr.selectedIndex=this._warShopType,this._refresh(),[2]})})},i.prototype._refresh=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r,n;return __generator(this,function(o){return this._price.text=this._warItemData.fightPrice.toString(),t.MyWarPlayer.inst.contribution>=this._warItemData.fightPrice?this._price.color=16777215:this._price.color=16711680,this._warShopType==t.WarShopType.card?(e=CardPool.CardPoolMgr.inst.getCardData(this._warItemData.cardId,1),i=new CardPool.Card(e),this._updateCard(i),CardPool.CardPoolMgr.inst.getCollectCard(this._warItemData.cardId).amount>0?this._maskCtr.selectedIndex=1:this._maskCtr.selectedIndex=0):this._warShopType==t.WarShopType.equip?(r=Equip.EquipMgr.inst.getEquipData(this._warItemData.equipId),this._equipCom.getChild("icon").asLoader.url=r.equipIcon,this._equipCom.getChild("equipName").asTextField.text=r.equipName,r.hasEquip?this._maskCtr.selectedIndex=1:this._maskCtr.selectedIndex=0):this._warShopType==t.WarShopType.skin?(n=CardPool.CardSkinMgr.inst.getSkinConf(this._warItemData.skinId),Utils.setImageUrlPicture(this._skinCom.getChild("cardImg").asImage,"skin_m_"+this._warItemData.skinId+"_png"),this._skinCom.getChild("nameText").asTextField.text=n.name,CardPool.CardSkinMgr.inst.hasSkin(n.general,this._warItemData.skinId)?this._maskCtr.selectedIndex=1:this._maskCtr.selectedIndex=0):this._warShopType==t.WarShopType.res&&(this._resCom.getChild("goldCnt").asTextField.text=this._warItemData.cnt.toString()),[2]})})},i.prototype._updateCard=function(t){this._cardCom.cardObj=t,this._cardCom.setName(),this._cardCom.setOwnBackground(),this._cardCom.setOwnFront(),this._cardCom.setCardImg(),this._cardCom.setEquip()},i.prototype._onBox=function(){this._warShopType==t.WarShopType.card?Core.ViewManager.inst.open(ViewName.featCardInfo,this._cardCom.cardObj,null,CardPool.BuyType.War,this._warItemData):this._warShopType==t.WarShopType.equip?Core.ViewManager.inst.open(ViewName.rebornEquipInfo,this._warItemData.equipId,CardPool.BuyType.War,this._warItemData):this._warShopType==t.WarShopType.res?Core.TipsUtils.confirm(Core.StringUtils.format(Core.StringUtils.TEXT(70371),this._warItemData.cnt),this._onBuy,null,this):this._warShopType==t.WarShopType.skin&&Core.ViewManager.inst.open(ViewName.buySkinInfo,this._warItemData.skinId,CardPool.BuyType.War,this._warItemData)},i.prototype._onBuy=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(r){return t.MyWarPlayer.inst.contribution<this._warItemData.fightPrice?(Core.TipsUtils.showTipsFromCenter(Core.StringUtils.TEXT(70370)),[2]):(e=t.WarMgr.inst.buyGoods(this._warItemData.type,this._warItemData.__id__),e&&(i=new Pvp.GetRewardData,i.gold=this._warItemData.cnt,Core.ViewManager.inst.open(ViewName.getRewardWnd,i)),[2])})})},i}(fairygui.GComponent);t.WarShopItem=e,__reflect(e.prototype,"War.WarShopItem")}(War||(War={}));var War;!function(t){var e;!function(t){t[t.card=0]="card",t[t.skin=1]="skin",t[t.equip=2]="equip",t[t.res=3]="res"}(e=t.WarShopType||(t.WarShopType={}));var i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.initUI=function(){i.prototype.initUI.call(this),this.adjust(this.getChild("bg"),Core.AdjustType.EXCEPT_MARGIN),this.y+=window.support.topMargin,this._fightCntText=this.getChild("fightCnt").asTextField,this._shopList=this.getChild("shopList").asList,this._shopList.foldInvisibleItems=!0,this._cardCom=this._shopList.getChild("cardCom").asCom,this._equipCom=this._shopList.getChild("equipCom").asCom,this._skinCom=this._shopList.getChild("skinCom").asCom,this._resCom=this._shopList.getChild("resCom").asCom,this._cardCom.setType(e.card),this._skinCom.setType(e.skin),this._equipCom.setType(e.equip),this._resCom.setType(e.res),this._closeBtn=this.getChild("closeBtn").asButton,this._closeBtn.addClickListener(this._onCloseBtn,this)},r.prototype.open=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return i.prototype.open.apply(this,e),this._updateContribution(),this._refresh(),Core.EventCenter.inst.addEventListener(t.WarMgr.RefreshShop,this._refresh,this),this._watch(),[2]})})},r.prototype._updateContribution=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._fightCntText.text=t.MyWarPlayer.inst.contribution.toString(),[2]})})},r.prototype._refresh=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._cardCom.refresh(),this._skinCom.refresh(),this._equipCom.refresh(),this._resCom.refresh(),[2]})})},r.prototype._watch=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t.MyWarPlayer.inst.watchProp(t.MyWarPlayer.PropContribution,this._updateContribution,this),[2]
})})},r.prototype._unwatch=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t.MyWarPlayer.inst.unwatchProp(t.MyWarPlayer.PropContribution,this._updateContribution,this),[2]})})},r.prototype.close=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return i.prototype.close.apply(this,e),Core.EventCenter.inst.removeEventListener(t.WarMgr.RefreshShop,this._refresh,this),this._unwatch(),[2]})})},r.prototype._onCloseBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Core.ViewManager.inst.closeView(this),[2]})})},r}(Core.BaseView);t.WarShopView=i,__reflect(i.prototype,"War.WarShopView")}(War||(War={}));var War;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.warShopType2Data=function(e){switch(e){case t.WarShopType.card:return Data.war_shop_card;case t.WarShopType.skin:return Data.war_shop_skin;case t.WarShopType.equip:return Data.war_shop_equip;case t.WarShopType.res:return Data.war_shop_res}},i.prototype.constructFromXML=function(i){e.prototype.constructFromXML.call(this,i),this._warShopType=null,this._warShopData=null,this._shopList=this.getChild("list").asList,this._shopList.itemClass=t.WarShopItem,this._shopList.callbackThisObj=this},i.prototype.setType=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._warShopType=t,this._warShopData=i.warShopType2Data(this._warShopType),[2]})})},i.prototype.refresh=function(){return __awaiter(this,void 0,void 0,function(){var t,e=this;return __generator(this,function(i){return this._shopList.removeChildrenToPool(),t=this._warShopData.keys,t.forEach(function(t){var i=e._warShopData.get(t),r=e._shopList.addItemFromPool().asCom;r.setType(e._warShopType,i)}),this.setShow(this._shopList.numItems>0),[2]})})},i.prototype.setShow=function(t){this.visible=t},i}(fairygui.GComponent);t.WarShopWindow=e,__reflect(e.prototype,"War.WarShopWindow")}(War||(War={}));var WXGame;!function(t){var e=function(){function t(){}return t.T_PREVIEW=1,t.T_NAV=2,t}();__reflect(e.prototype,"AdvertIconType");var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this._image=this.getChild("advert").asImage,this.addClickListener(this._onClick,this)},i.prototype._onClick=function(){if(this._type==e.T_PREVIEW){var t=this._data.wx_code_image;wx.previewImage({urls:[t]})}},i.prototype.setData=function(t){this._data=t,this._type=t.ad_type,this.alpha=1,Utils.setImageUrlPicture(this._image,t.icon)},i}(fairygui.GComponent);t.WXAdvertIconCom=i,__reflect(i.prototype,"WXGame.WXAdvertIconCom")}(WXGame||(WXGame={}));var WXGame;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){t.prototype.initUI.call(this),this._myParent=Core.LayerManager.inst.maskLayer,this.center(),this.modal=!0,console.log("fucka");try{this.contentPane.getChild("getBtn").asButton.addClickListener(this._onClickGet,this)}catch(i){console.log(i)}return console.log("fuckb"),[2]})})},e.prototype._onClickGet=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,r;return __generator(this,function(n){switch(n.label){case 0:return this._hid?(t={Hid:this._hid},[4,Net.rpcCall(pb.MessageID.C2S_GET_SHARE_TREASURE_REWARD,pb.GetShareTreasureArg.encode(t))]):[3,2];case 1:e=n.sent(),0==e.errcode?(i=pb.OpenTreasureReply.decode(e.payload),r=new Treasure.TreasureReward,r.gold=i.GoldAmount,i.CardIDs.forEach(function(t){r.addCardId(t)}),Core.ViewManager.inst.open(ViewName.treasureRewardInfo,r,new Treasure.TreasureItem(-1,"BX0303"))):Core.TipsUtils.showTipsFromCenter("你已经领取过该类的限定宝箱啦"),Core.ViewManager.inst.closeView(this),n.label=2;case 2:return[2]}})})},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){console.log("fuck1"),t.prototype.open.apply(this,e),console.log("fuck2"),this._hid=e[0],console.log("fuck3"),i=e[1],console.log("fuck4");try{this.contentPane.getChild("txt2").asTextField.text="<"+i+">\n赠送给你的限定宝箱！\n记得也要回赠给好友哦。"}catch(n){console.log(n)}return console.log("fuck5"),[2]})})},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.prototype.close.apply(this,e),[2]})})},e}(Core.BaseWindow);t.WXTreasureGetReward=e,__reflect(e.prototype,"WXGame.WXTreasureGetReward")}(WXGame||(WXGame={}));var WXGame;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initUI=function(){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(r){return e.prototype.initUI.call(this),this.center(),this.modal=!0,this.contentPane.getChild("closeBtn").asButton.addClickListener(function(){Core.ViewManager.inst.closeView(i)},this),this.contentPane.getChild("shareBtn").asButton.addClickListener(function(){t.WXShareMgr.inst.wechatShareReward(i._hid),Core.ViewManager.inst.closeView(i)},this),[2]})})},i.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.open.apply(this,t),this._hid=t[0],[2]})})},i.prototype.close=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return e.prototype.close.apply(this,t),[2]})})},i}(Core.BaseWindow);t.WXTreasureShareReward=e,__reflect(e.prototype,"WXGame.WXTreasureShareReward")}(WXGame||(WXGame={}));var BREAK_SINGAL={},CONTINUE_SINGAL={},RETURN_SINGAL={result:void 0},evaluate_map={Program:function(t,e){for(var i=0,r=t.body;i<r.length;i++){var n=r[i];evaluate(n,e)}},Identifier:function(t,e){if("undefined"!==t.name){var i=e.$find(t.name);if(i)return i.$get();throw"[Error] "+t.loc+", '"+t.name+"' 未定义"}},Literal:function(t,e){return t.value},BlockStatement:function(t,e){for(var i=e.invasived?e:new Scope("block",e),r=0,n=t.body;r<n.length;r++){var o=n[r],s=evaluate(o,i);if(s===BREAK_SINGAL||s===CONTINUE_SINGAL||s===RETURN_SINGAL)return s}},EmptyStatement:function(t,e){},DebuggerStatement:function(t,e){},ExpressionStatement:function(t,e){evaluate(t.expression,e)},ReturnStatement:function(t,e){return RETURN_SINGAL.result=t.argument?evaluate(t.argument,e):void 0,RETURN_SINGAL},LabeledStatement:function(t,e){t.type+" 未实现"},BreakStatement:function(t,e){return BREAK_SINGAL},ContinueStatement:function(t,e){return CONTINUE_SINGAL},IfStatement:function(t,e){return evaluate(t.test,e)?evaluate(t.consequent,e):t.alternate?evaluate(t.alternate,e):void 0},SwitchStatement:function(t,e){for(var i=evaluate(t.discriminant,e),r=new Scope("switch",e),n=!1,o=0,s=t.cases;o<s.length;o++){var a=s[o];if(n||a.test&&i!==evaluate(a.test,r)||(n=!0),n){var u=evaluate(a,r);if(u===BREAK_SINGAL)break;if(u===CONTINUE_SINGAL||u===RETURN_SINGAL)return u}}},SwitchCase:function(t,e){for(var i=0,r=t.consequent;i<r.length;i++){var n=r[i],o=evaluate(n,e);if(o===BREAK_SINGAL||o===CONTINUE_SINGAL||o===RETURN_SINGAL)return o}},WithStatement:function(t,e){throw"因为 with 很多问题，已经被基本弃用了，不实现"},ThrowStatement:function(t,e){throw evaluate(t.argument,e)},TryStatement:function(t,e){try{return evaluate(t.block,e)}catch(i){if(t.handler){var r=t.handler.param,n=new Scope("block",e);return n.invasived=!0,n.$const(r.name,i),evaluate(t.handler,n)}throw i}finally{if(t.finalizer)return evaluate(t.finalizer,e)}},CatchClause:function(t,e){return evaluate(t.body,e)},WhileStatement:function(t,e){for(;evaluate(t.test,e);){var i=new Scope("loop",e);i.invasived=!0;var r=evaluate(t.body,i);if(r===BREAK_SINGAL)break;if(r!==CONTINUE_SINGAL&&r===RETURN_SINGAL)return r}},DoWhileStatement:function(t,e){do{var i=new Scope("loop",e);i.invasived=!0;var r=evaluate(t.body,i);if(r===BREAK_SINGAL)break;if(r!==CONTINUE_SINGAL&&r===RETURN_SINGAL)return r}while(evaluate(t.test,e))},ForStatement:function(t,e){var i=new Scope("loop",e);for(t.init?evaluate(t.init,i):null;t.test?evaluate(t.test,i):!0;t.update?evaluate(t.update,i):void 0){var r=evaluate(t.body,i);if(r===BREAK_SINGAL)break;if(r!==CONTINUE_SINGAL&&r===RETURN_SINGAL)return r}},ForInStatement:function(t,e){var i=t.left.kind,r=t.left.declarations[0],n=r.id.name;for(var o in evaluate(t.right,e)){var s=new Scope("loop",e);s.invasived=!0,e.$declar(i,n,o);var a=evaluate(t.body,s);if(a===BREAK_SINGAL)break;if(a!==CONTINUE_SINGAL&&a===RETURN_SINGAL)return a}},FunctionDeclaration:function(t,e){var i=evaluate_map.FunctionExpression(t,e),r=t.id.name;if(!e.$const(r,i))throw"[Error] "+name+" 重复定义"},VariableDeclaration:function(t,e){for(var i=t.kind,r=0,n=t.declarations;r<n.length;r++){var o=n[r],s=o.id.name,a=o.init?evaluate(o.init,e):void 0;if(!e.$declar(i,s,a))throw"[Error] "+s+" 重复定义"}},VariableDeclarator:function(t,e){throw"执行这里就错了"},ThisExpression:function(t,e){var i=e.$find("this");return i?i.$get():null},ArrayExpression:function(t,e){return t.elements.map(function(t){return evaluate(t,e)})},ObjectExpression:function(t,e){for(var i={},r=0,n=t.properties;r<n.length;r++){var o=n[r],s=o.kind,a=void 0;if("Literal"===o.key.type)a=evaluate(o.key,e);else{if("Identifier"!==o.key.type)throw"这里绝对就错了";a=o.key.name}var u=evaluate(o.value,e);if("init"===s)i[a]=u;else if("set"===s)Object.defineProperty(i,a,{set:u});else{if("get"!==s)throw"这里绝对就错了";Object.defineProperty(i,a,{get:u})}}return i},FunctionExpression:function(t,e){return function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];var n=new Scope("function",e);n.invasived=!0;for(var o=0;o<t.params.length;o++){var s=t.params[o].name;n.$const(s,i[o])}n.$const("this",this),n.$const("arguments",arguments);var a=evaluate(t.body,n);return a===RETURN_SINGAL?a.result:void 0}},UnaryExpression:function(t,e){return{"-":function(){return-evaluate(t.argument,e)},"+":function(){return+evaluate(t.argument,e)},"!":function(){return!evaluate(t.argument,e)},"~":function(){return~evaluate(t.argument,e)},"void":function(){return void evaluate(t.argument,e)},"typeof":function(){if("Identifier"===t.argument.type){var i=e.$find(t.argument.name);return i?typeof i.$get():"undefined"}return typeof evaluate(t.argument,e)},"delete":function(){if("MemberExpression"===t.argument.type){var i=t.argument,r=i.object,n=i.property,o=i.computed;return o?delete evaluate(r,e)[evaluate(n,e)]:delete evaluate(r,e)[n.name]}if("Identifier"===t.argument.type){var s=e.$find("this");if(s)return s.$get()[t.argument.name]}}}[t.operator]()},UpdateExpression:function(t,e){var i,r=t.prefix;if("Identifier"===t.argument.type){var n=t.argument.name;if(i=e.$find(n),!i)throw n+" 未定义"}else if("MemberExpression"===t.argument.type){var o=t.argument,s=evaluate(o.object,e),a=o.computed?evaluate(o.property,e):o.property.name;i={$set:function(t){return s[a]=t,!0},$get:function(){return s[a]}}}return{"--":function(t){return i.$set(t-1),r?--t:t--},"++":function(t){return i.$set(t+1),r?++t:t++}}[t.operator](evaluate(t.argument,e))},BinaryExpression:function(t,e){return{"==":function(t,e){return t==e},"!=":function(t,e){return t!=e},"===":function(t,e){return t===e},"!==":function(t,e){return t!==e},"<":function(t,e){return e>t},"<=":function(t,e){return e>=t},">":function(t,e){return t>e},">=":function(t,e){return t>=e},"<<":function(t,e){return t<<e},">>":function(t,e){return t>>e},">>>":function(t,e){return t>>>e},"+":function(t,e){return t+e},"-":function(t,e){return t-e},"*":function(t,e){return t*e},"/":function(t,e){return t/e},"%":function(t,e){return t%e},"|":function(t,e){return t|e},"^":function(t,e){return t^e},"&":function(t,e){return t&e},"in":function(t,e){return t in e},"instanceof":function(t,e){return t instanceof e}}[t.operator](evaluate(t.left,e),evaluate(t.right,e))},AssignmentExpression:function(t,e){var i;if("Identifier"===t.left.type){var r=t.left.name,n=e.$find(r);if(!n)throw r+" 未定义";i=n}else{if("MemberExpression"!==t.left.type)throw"如果出现在这里，那就说明有问题了";var o=t.left,s=evaluate(o.object,e),a=o.computed?evaluate(o.property,e):o.property.name;i={$set:function(t){return s[a]=t,!0},$get:function(){return s[a]}}}return{"=":function(t){return i.$set(t),t},"+=":function(t){return i.$set(i.$get()+t),i.$get()},"-=":function(t){return i.$set(i.$get()-t),i.$get()},"*=":function(t){return i.$set(i.$get()*t),i.$get()},"/=":function(t){return i.$set(i.$get()/t),i.$get()},"%=":function(t){return i.$set(i.$get()%t),i.$get()},"<<=":function(t){return i.$set(i.$get()<<t),i.$get()},">>=":function(t){return i.$set(i.$get()>>t),i.$get()},">>>=":function(t){return i.$set(i.$get()>>>t),i.$get()},"|=":function(t){return i.$set(i.$get()|t),i.$get()},"^=":function(t){return i.$set(i.$get()^t),i.$get()},"&=":function(t){return i.$set(i.$get()&t),i.$get()}}[t.operator](evaluate(t.right,e))},LogicalExpression:function(t,e){return{"||":function(){return evaluate(t.left,e)||evaluate(t.right,e)},"&&":function(){return evaluate(t.left,e)&&evaluate(t.right,e)}}[t.operator]()},MemberExpression:function(t,e){var i=t.object,r=t.property,n=t.computed;return n?evaluate(i,e)[evaluate(r,e)]:evaluate(i,e)[r.name]},ConditionalExpression:function(t,e){return evaluate(t.test,e)?evaluate(t.consequent,e):evaluate(t.alternate,e)},CallExpression:function(t,e){var i=evaluate(t.callee,e),r=t.arguments.map(function(t){return evaluate(t,e)});if("MemberExpression"===t.callee.type){var n=evaluate(t.callee.object,e);return i.apply(n,r)}var o=e.$find("this");return i.apply(o?o.$get():null,r)},NewExpression:function(t,e){var i=evaluate(t.callee,e),r=t.arguments.map(function(t){return evaluate(t,e)});return new(i.bind.apply(i,[null].concat(r)))},SequenceExpression:function(t,e){for(var i,r=0,n=t.expressions;r<n.length;r++){var o=n[r];i=evaluate(o,e)}return i},Property:function(t,e,i){throw"这里如果被执行了那也是错的..."},ClassExpression:function(t,e){throw t.type+" 未实现"},RestElement:function(t,e){throw t.type+" 未实现"},MetaProperty:function(t,e){throw t.type+" 未实现"},AwaitExpression:function(t,e){throw t.type+" 未实现"},Super:function(t,e){throw t.type+" 未实现"},SpreadElement:function(t,e){throw t.type+" 未实现"},TemplateElement:function(t,e){throw t.type+" 未实现"},ClassDeclaration:function(t,e){throw t.type+" 未实现"},TaggedTemplateExpression:function(t,e){throw t.type+" 未实现"},MethodDefinition:function(t,e){throw t.type+" 未实现"},AssignmentPattern:function(t,e){throw t.type+" 未实现"},ObjectPattern:function(t,e){throw t.type+" 未实现"},ArrayPattern:function(t,e){throw t.type+" 未实现"},ForOfStatement:function(t,e){throw t.type+" 未实现"},TemplateLiteral:function(t,e){throw t.type+" 未实现"},ClassBody:function(t,e){throw t.type+" 未实现"},ImportDeclaration:function(t,e){throw t.type+" 未实现"},ExportNamedDeclaration:function(t,e){throw t.type+" 未实现"},ExportDefaultDeclaration:function(t,e){throw t.type+" 未实现"},ExportAllDeclaration:function(t,e){throw t.type+" 未实现"},ImportSpecifier:function(t,e){throw t.type+" 未实现"},ImportDefaultSpecifier:function(t,e){throw t.type+" 未实现"},ImportNamespaceSpecifier:function(t,e){throw t.type+" 未实现"},ExportSpecifier:function(t,e){throw t.type+" 未实现"},YieldExpression:function(t,e){throw t.type+" 未实现"},ArrowFunctionExpression:function(t,e){throw t.type+" 未实现"}},evaluate=function(t,e,i){var r=evaluate_map[t.type];return r(t,e,i)},jsjs;!function(t){function e(t,e){void 0===e&&(e={});var n=new Scope("block");n.$const("this",this);for(var o=0,s=Object.getOwnPropertyNames(r);o<s.length;o++){var a=s[o];n.$const(a,r[a])}for(var u=0,h=Object.getOwnPropertyNames(e);u<h.length;u++){var l=h[u];n.$const(l,e[l])}var c={},d={exports:c};n.$const("module",d),n.$const("exports",c),evaluate(acorn.parse(t,i),n);var p=n.$find("module");return p?p.$get().exports:null}var i={ecmaVersion:5,sourceType:"script",locations:!0},r={console:console,setTimeout:setTimeout,setInterval:setInterval,clearTimeout:clearTimeout,clearInterval:clearInterval,encodeURI:encodeURI,encodeURIComponent:encodeURIComponent,decodeURI:decodeURI,decodeURIComponent:decodeURIComponent,escape:escape,unescape:unescape,Infinity:1/0,NaN:0/0,isFinite:isFinite,isNaN:isNaN,parseFloat:parseFloat,parseInt:parseInt,Object:Object,Boolean:Boolean,Error:Error,EvalError:EvalError,RangeError:RangeError,ReferenceError:ReferenceError,SyntaxError:SyntaxError,TypeError:TypeError,URIError:URIError,Number:Number,Math:Math,Date:Date,String:String,RegExp:RegExp,Array:Array,JSON:JSON,Promise:Promise};t.run=e}(jsjs||(jsjs={}));var ScopeVar=function(){function t(t,e){this.value=e,this.kind=t}return t.prototype.$set=function(t){return"const"===this.value?!1:(this.value=t,!0)},t.prototype.$get=function(){return this.value},t}();__reflect(ScopeVar.prototype,"ScopeVar",["Var"]);var PropVar=function(){function t(t,e){this.object=t,this.property=e}return t.prototype.$set=function(t){return this.object[this.property]=t,!0},t.prototype.$get=function(){return this.object[this.property]},t.prototype.$delete=function(){delete this.object[this.property]},t}();__reflect(PropVar.prototype,"PropVar",["Var"]);var Scope=function(){function t(t,e,i){this.prefix="@",this.type=t,this.parent=e||null,this.content={},this.invasived=!1}return t.prototype.$find=function(t){var e=this.prefix+t;return this.content.hasOwnProperty(e)?this.content[e]:this.parent?this.parent.$find(t):null},t.prototype.$let=function(t,e){var i=this.prefix+t,r=this.content[i];return r?!1:(this.content[i]=new ScopeVar("let",e),!0)},t.prototype.$const=function(t,e){var i=this.prefix+t,r=this.content[i];return r?!1:(this.content[i]=new ScopeVar("const",e),!0)},t.prototype.$var=function(t,e){for(var i=this.prefix+t,r=this;null!==r.parent&&"function"!==r.type;)r=r.parent;var n=r.content[i];return n?!1:(this.content[i]=new ScopeVar("var",e),!0)},t.prototype.$declar=function(t,e,i){var r=this;return{"var":function(){return r.$var(e,i)},let:function(){return r.$let(e,i)},"const":function(){return r.$const(e,i)}}[t]()},t}();__reflect(Scope.prototype,"Scope");